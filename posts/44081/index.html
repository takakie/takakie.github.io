<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>安卓逆向技术 | 高木のBlog</title><meta name="keywords" content="APK,JAVA,逆向,安卓"><meta name="author" content="Takake"><meta name="copyright" content="Takake"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="安卓逆向技术"><meta name="application-name" content="安卓逆向技术"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="安卓逆向技术"><meta property="og:url" content="https://blog.takake.com/posts/44081/index.html"><meta property="og:site_name" content="高木のBlog"><meta property="og:description" content="1.frida核心概念：动态二进制插桩  插桩： 在程序执行流的关键位置插入额外的代码。 动态： 在程序运行时进行插桩，无需修改源代码或重新编译目标程序。 二进制： 直接作用于编译后的可执行文件（二进制文件）。 Frida 的实现： Frida 通过将一个小型引擎（frida-core）注入到目标进"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/5c4406f679dc69b549b48fa6_p17s2tfgc31jte13d51pea1l2oblr3.png?x-oss-process=style/img-to-webp"><meta property="article:author" content="Takake"><meta property="article:tag" content="技术,OpenAI,网络安全,hacker,ChatGPT,人工智能,WEB渗透测试,黑客,分享,服务器,WEB安全,红队,蓝队,"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/5c4406f679dc69b549b48fa6_p17s2tfgc31jte13d51pea1l2oblr3.png?x-oss-process=style/img-to-webp"><meta name="description" content="1.frida核心概念：动态二进制插桩  插桩： 在程序执行流的关键位置插入额外的代码。 动态： 在程序运行时进行插桩，无需修改源代码或重新编译目标程序。 二进制： 直接作用于编译后的可执行文件（二进制文件）。 Frida 的实现： Frida 通过将一个小型引擎（frida-core）注入到目标进"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.takake.com/posts/44081/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/cdn/lib/css/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"GPT-4.0-turbo","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3GpafT7n8yHKUbXT","LingQueMonitorID":"3GpatLJgdLFKhspS"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://takake.netlify.app/.netlify/functions/twikoo',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":null,"api":null,"cover_change":true},
  authorStatus: {"skills":["🤖️ 人工智能爱好者","🔍 分享与热心帮助","🔨 删库跑路一条龙","🤝 网络安全从业者","🏃 脚踏实地行动派","🧱 团队小组发动机"]},
  algolia: {"appId":"6ECK9ICH9Y","apiKey":"4d7d6edad6ebd6c982ea423b6b573b1c","indexName":"my_hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Takake","link":"链接: ","source":"来源: 高木のBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '高木のBlog',
  title: '安卓逆向技术',
  postAI: '本文详细讲解Frida框架的安装配置、基础命令、操作模式（Attach/Spawn）及核心API（Java交互、函数拦截、内存操作等）。涵盖Hook链式调用、常用代码片段实战技巧，分析APK加壳检测（dex校验、查壳工具）、脱壳方法（frida-dexdump）与加固对抗，并详解Smali语法结构与寄存器操作，适用于Android逆向分析与安全测试。',
  pageFillDescription: '1.frida, 1.1.安装, 安装证书, 1.2.基础命令, 1.3.操作模式, 1.3.1.Attach模式, 1.3.2.Spawn模式, 1.3.3.两者对比, 1.3.4.自定义端口启动, 1.4.frida常用关键词解析, Frida 脚本常用关键词深度解析, 1. Java 对象 (Android Java 交互), 2. Interceptor (函数拦截), 3. Module (模块操作), 4. Process (进程控制), 5. Memory (内存操作), 6. ptr (指针操作), 7. NativeFunction (调用原生函数), 8. NativeCallback (创建回调函数), 9. Thread (线程操作), 10. console (日志输出), 11. setImmediate x2F setTimeout (定时操作), 12. recv x2F send (进程通信), 13. Frida 核心对象, 14. Stalker (指令级跟踪), 15. File (文件操作), 实战模式：Hook 链式调用, 调试技巧, 常用代码片段, 获取当前 Activity, 修改返回值, 主动调用方法, 1.5.数据类型对比, 1.5.1.基本数据类型对比, 1.5.2.引用数据类型对比, 1.6.frida hook, 1.6.1.hook示例, 1.6.2.重载方法调用示例, 1.6.3.主动调用方法, 1.6.4.hook调用实例方法, 1.6.5.hook构造方法, 1.6.6.hook内部类, 1.6.7.枚举所有的类, 1.6.8.hook map对象, 1.6.9.hook okhttp, 1.6.10.输出当前堆栈信息, 1.7.实战hook 嘟嘟牛, 1.7.1.反编译的APK包, 1.7.2.hook 记录, 1.8.hook 技巧, 1.8.1.hook 用户输入组件, 1.8.2.hook JSON对象, 1.8.3.hook 算法, 1.8.3.1.hook md5, 1.8.3.2.hook AES, 2.抓包检测, 几种证书验证的机制, 1.常规HTTPS, 2.系统证书验证, 3.SSL pinning单向证书认证, 4.双向认证, 5.自定义协议或者TCP, 6.VPN检测, 3.1.如何判断一个APK是否加壳？, 3.1.1.dex完整性校验, 3.1.2.AndroidManifest.xml, 3.2.查壳方式, 3.2.1.凭借so文件特征, 3.2.2.查壳工具, 3.3.脱壳方式, 3.3.1.都有哪些壳, 3.3.2.frida-dexdump, 3.3.3.加固对抗 Frida 的常见手段, 3.4.so文件处理, 3.5.Smali 基础语法详解, 一、文件结构与类定义, 1. 类声明, 2. 接口实现, 3. 注解, 二、字段定义 (Fields), 三、方法定义 (Methods), 1. 方法声明, 四、数据类型, 1. 基本类型, 2. 对象类型, 3. 数组类型, 五、寄存器操作, 1. 寄存器命名, 2. 常用指令, 六、方法调用, 1. 调用类型, 2. 方法签名格式, 七、控制流指令, 1. 条件分支, 2. 无条件跳转, 3. Switch 语句, 4. 标签定义, 八、异常处理, 1. 异常捕获, 2. 抛出异常, 九、调试信息, 十、完整方法示例, 学习建议核心概念动态二进制插桩插桩在程序执行流的关键位置插入额外的代码动态在程序运行时进行插桩无需修改源代码或重新编译目标程序二进制直接作用于编译后的可执行文件二进制文件的实现通过将一个小型引擎注入到目标进程如桌面程序应用等中实现这个引擎在目标进程内部运行一个运行时环境引擎允许你执行脚本并与目标进程的地址空间交互安装是开源工具直接在下载即可版本要求在选择安装的版本之前需要先确定手机的系统和的架构可以通过以下命令获取架构根据不同的安装系统版本适配不同的版本同时我的系统是安卓因此我选择下载的这个版本使用推送解压后的文件到手机目录在手机目录中执行启动服务端客户端安装使用安装客户端需要与在手机上安装的服务端一致客户端连接测试以下显示为安装好的日历设置安卓代码提示插件安装证书以上安装证书需要使用计算然后命名为移动到的目录下同时添加对等权限如果遇到只读文件系统问题可以使用文件管理工具进行移动生成哈希并重命名或者推送证书到设备基础命令用法选项目标位置参数额外参数和或目标选项显示此帮助信息并退出连接到指定的设备连接到设备连接到远程连接到上的远程与使用通信并验证提供的证书连接到远程服务器时设置请求头为使用向进行身份验证设置保活间隔秒表示禁用默认为根据传输方式自动选择与目标建立点对点连接使用时设置要使用的服务器地址为添加中继服务器生成文件通常是可执行文件附加到最前端应用程序附加到名称为的进程附加到标识符为的进程如附加到进程为的进程等待匹配的进程生成生成进程时的标准输入输出行为默认为继承设置生成进程时的辅助选项例如支持的类型要附加到的执行域原生域模拟域要使用的脚本运行时引擎启用兼容的脚本调试器如果启用不会将崩溃报告输出到控制台包含额外命令行选项的文本文件显示程序版本号并退出加载脚本文件以格式提供参数与相同加载模块从源代码编译时使用的工具链加载代码共享执行代码片段安静模式无提示符并在执行完和后退出在安静模式下等待秒后终止在生成程序后保持主线程暂停状态输出到日志文件在退出前持久化脚本在中遇到任何异常后以代码退出退出时杀死生成的程序自动将输入的代码包装在中用于交互启用对提供的脚本和模块的自动重载默认开启未来版本将变为必需禁用对提供的脚本和模块的自动重载操作模式提供了两种核心操作模式来注入目标进程附加和生成这两种模式各有特点适用于不同场景模式附加到已经运行的进程运行中的目标进程注入附加脚本操作进程命令操作基本语法或模式启动并暂停目标进程注入脚本后继续执行启动进程暂停进程注入脚本恢复执行两者对比特性模式模式目标状态已运行未启动执行时机运行时注入启动前注入资源占用低中等初始化可能错过完整捕获反调试绕过有限有效适用场景动态分析静态分析启动命令或热重载支持不支持自定义端口启动默认端口号为由于一些应该可能会检查的默认端口导致失败因此可以使用自定义端口来进行调试具体操作步骤如下自定义端口启动使用端口转发将的端口映射到本地客户端主机指定本地端口进行常用关键词解析脚本常用关键词深度解析脚本使用与目标进程交互下面是核心关键词的详细解析和使用示例对象交互关键方法安全执行操作查找实例获取类引用等同于中的反射调用如果是需要加载内部类的化需要使用符引用例如枚举已加载类示例函数拦截关键方法回调示例拦截的函数模块操作关键方法动态加载查找基址枚举导入查找导出示例扫描模块导出进程控制关键方法当前进程架构枚举模块枚举线程获取当前线程示例枚举所有模块内存操作关键方法分配内存修改保护内存扫描读取字节数组示例读取字符串示例修改内存保护指针操作关键方法创建指针指针加法指针减法示例指针运算调用原生函数创建原生函数指针调用原生函数创建回调函数创建回调函数设置回调线程操作关键方法获取调用栈线程休眠示例获取当前线程调用栈日志输出信息日志警告日志错误日志调试日志定时操作立即执行延迟执行进程通信脚本中接收消息端发送消息核心对象获取堆大小当前架构指针大小指令级跟踪跟踪指令流跟踪调用指令不跟踪返回指令处理事件停止跟踪文件操作读写文件实战模式链式调用类方法函数调试技巧调试模式启用异常捕获阻止崩溃内存访问检查常用代码片段获取当前修改返回值修改返回值为固定值主动调用方法数据类型对比基本数据类型对比类型表示转换方法说明直接对应自动转换值使用转字符自动转换自动转换或大数需用自动转换自动转换无返回值引用数据类型对比类型表示转换方法说明自动转换包装器通过处理数组如对象使用创建自定义类实例对象通过获取类引用包装器特殊方法处理直接对应示例反编译代码片段密钥示例函数用于目标应用中的加密方法获取目标类的对象重写方法的实现打印传入的参数便于分析加密过程调用原始的方法获取加密结果打印加密结果返回加密结果函数作为入口确保在环境准备好后执行立即执行函数开始服务端启动后客户端使用进行执行方法后就可以在控制台打印出参数信息重载方法调用示例需要调用同名函数不同得方法需要使用来指定方法的参数类型例如调用四字参数均为字符串类型的方法获取目标类的对象重写方法的实现打印传入的参数便于分析加密过程打印加密结果返回加密结果所有同名方法获取方法的所有重载方法的数量循环遍历所有重载方法获取所有参数并输出调用原始方法主动调用方法每次改一次文件都会主动执行一次主动调用方法函数作为入口确保在环境准备好后执行立即执行函数开始主动调用获取实例对象获取参数为两个字符串类型的构造方法使用构造方法一个对象获取一个实例对象调用实例方法自定义实例调用获取对象新建一个实例对象直接调用其方法获取实例中的静态变量值获取全局实例调用方法是脚本用于匹配特定条件时触发的回调函数当满足特定的条件时比如某个函数被调用或者某个字符串被传递等方法可以执行相应的操作方法是在脚本执行完毕时触发的回调函数通常用于在所有操作完成后做一些清理工作或输出总结信息找到所有为类的对象每当调用这个对象时都会执行一次函数即为匹配到的对象获取非静态变量如果字段名和方法名相同时需要在前面加上获非取静态变量内存中操作完毕构造方法获取对象构造参数类型为和的构造方法执行原本逻辑内部类枚举所有的类获取所有构造方法遍历构造方法获取所有字段对象直接打印如果配置的键值对是类型的话可以输入字符串内容迭代遍历获取键值对修改中的值如果使用了的依赖进行发包那么就可以使用这个方法进行请求地址有三种重载方法分别是大多数请求都是使用的类型参数请求和响应获取新的对象调用对象的发送请求并获取响应请求头类的方法输出当前堆栈信息实战嘟嘟牛反编译的包根据反编译的源码包发现大多数代码都是经过混淆的不具有可读性仅部分具有可读性因此我们接下来的直接进行盲记录首先我们通过对类进行触发登陆请求后发现关键信息因此我们通过在类里当等于时输出其堆栈信息修改逻辑输出堆栈信息在输出的堆栈信息中我们并没用发现我们感兴趣的加密函数于是我换了一个思路获取这个包下所有的类看有什么我感兴趣的类方法使用同步过滤过滤目标包下的类找到个类我们再尝试获取该类的所有方法和字段获取类的对象正确获取所有声明的方法类方法列表获取方法名和参数类型正确获取所有声明的字段类字段列表获取字段名和类型发现了一个加密函数这个加密函数没有密钥那么我们完全可以想象一个有密钥的加密函数调用了这个函数因此我们这个方法并且输出调用这个方法时的堆栈信息查找是否有其他加密函数接下来我们一下方法通过编写以下获取该方法所有的重载方法和对应参数类型获取方法的所有重载方法重载分析共找到个重载方法未找到方法可能是方法名错误或类未加载遍历所有重载重载获取参数类型参数数量打印每个参数类型参数参数无法获取类型信息获取返回类型返回类型返回类型未知实际该重载重载被调用打印参数值调用参数特殊处理常见类型参数尝试获取对象的类名参数对象如果是类型尝试打印内容大小内容无法解析内容参数对象无法获取类信息参数无参数调用原方法打印返回值返回结果返回结果已设置等待方法调用分析失败控制台输出如下方法重载分析共找到个重载方法重载参数数量参数参数参数返回类型重载参数数量参数参数参数参数返回类型已设置等待方法调用有两个重载方法具体调用的哪个重载方法我们不得而知但是我们可以直接尝试先第一个重载方法也就是个参数的方法通过以上代码我们成功获得以下输出那么我们不难猜测字符串是明文其中一个是密钥一个是那么我们复现其加密逻辑代码如下反射获取指定参数类型的方法反射调用类中的方法输出我们最后留下一个问题通过对加密算法的复现无法复现成功这是为什么其实在处理密钥时做了一次算法并将前位十六进制表示的前个字符作为密钥如下图所示技巧用户输入组件开发通常回从组件获取用户的输入信息需要判断是否为空通常使用的时方法来判断用户输入的参数是否为空那么我们就可以通过该方法在方法内部获取堆栈信息字符串为空字符串不为空针对这个特性进行对象构造方法所有重载的构造函数打印调用堆栈和参数调用原始构造函数打印构造后的内容方法修改示例给所有对象添加新字段的方法解析入口示例算法很多开发通常都是使用自带的包实现的加密或者摘要算法因此我们可以直接通过原生算法包的方法来获取摘要和加密的明文和密文内容以下代码中就使用了原生算法包因此我们可以直接方法这也是一种通用的方法代码如下的方法将字节数组转换为字符串原始调用转换结果为十六进制字符串中加密代码示例密钥示例首先加密的明文部分再密钥将算法内部参数数组转换为字符串抓包检测几种证书验证的机制常规认证为客户端获取服务端证书加密请求服务端因此只需要利用中间人攻击让客户端使用中间人伪造的证书加密请求中间人再截获请求解密再使用服务端端证书加密请求服务器就实现了中间人攻击窃取或者伪造传输数据具体可以查看这篇文章加密流程以及抓包原理解析常见的中间人攻击的抓包软件有针对这种常规的证书加密只需要安装普通用户证书即可系统证书验证以上安装系统证书因此需要使用计算并且移动到系统证书目录然后命名为移动到的目录下同时添加对等权限如果遇到只读文件系统问题可以使用文件管理工具进行移动生成哈希并重命名或者推送证书到设备单向证书认证即客户端会强制验证服务端证书是否为对应证书否则不接受该证书对于单向证书认证问题可以使用利用脚本绕过过代码检测或者一些其他的检测还可以通过将协议转换为双向认证通常我们传输加密都是服务端返回证书客户端使用证书中的公钥进行加密但是在一些高安全要求的情况下可能会使用双向证书校验也就是说不仅服务端返回公钥证书同时客户端中也存在一个证书文件用于对服务端的证书进行证书验证一般中的证书后缀名为双向认证如何绕过也可以看这个双向证书绕过自定义协议或者直接使用请求参数和响应检测这个没啥用就算不能不能用也可以使用代理去抓也是一样可以直接使用检测代码或者直接请求参数和响应如何判断一个是否加壳完整性校验使用解析头信息若显示或指令段全零表明代码被加密启动类替换主指向壳的代理类如而非业务逻辑类权限声明异常声明防止解密到磁盘查壳方式凭借文件特征如果加壳会在的目录下生成文件根据文件名称进行判断加固厂商特有标识腾讯乐固加固百度加固阿里聚安全查壳工具使用查壳工具快速检测查壳工具直接拖入自动识别加固类型及版本如基于机器学习的查壳工具检测未知壳变种扫描漏洞同时输出加壳信息例如查壳工具脱壳方式都有哪些壳壳的发展壳的种类非常多根据其种类不同使用的技术也不同这里稍微简单分个类一代整体型壳采用整体加密动态加载运行的机制二代函数抽取型壳粒度更细将方法单独抽取出来加密保存解密执行三代壳独立虚拟机解释执行语义等价语浙迁移强度最高我们可以使用开源工具做一些脱一些简单的壳可以在下载也可以直接通过下载使用方法之后通过运行脱壳生成大量的文件这些文件都可以通过直接阅读但是可能生成的文件较多因此需要过滤通过检索存在主类的文件之后只需要重点阅读存在主类的文件即可无需再阅读其他的文件使用主类全类名搜索所有存在主类的文件加固对抗的常见手段加固厂商会采用多种技术阻止反调试检测扫描查找特征端口检测检查等默认端口线程监控检测异常线程如的代码混淆关键逻辑转移到层文件双进程守护监控进程状态崩溃即重启文件处理文件和文件一样是属于二进制动态链接库如果在分析代码时发现方法其实就算在加载文件并且使用修饰的方法都是在文件中实现的如果需要分析文件我们就需要使用工具进行逆向分析基础语法详解是平台上虚拟机的汇编语言用于表示文件中的字节码指令掌握是逆向工程的基础下面详细介绍其核心语法一文件结构与类定义类声明访问修饰符类名类定义父类继承关系源文件名可选示例公共类继承源文件接口实现接口名实现接口注解注解类型注解声明键值对二字段定义访问修饰符字段名类型示例私有整型字段公共静态常量三方法定义方法声明访问修饰符方法名参数类型返回类型使用的寄存器总数本地寄存器数量不包括参数参数注解可选代码指令示例使用个寄存器本地寄存器个参数注解四数据类型基本类型类型符号示例对象类型包名类名完整类名示例数组类型类型一维数组类型二维数组示例五寄存器操作寄存器命名本地寄存器参数寄存器在非静态方法中是常用指令指令功能示例寄存器间移动值加载常量加载字符串常量加载类引用六方法调用调用类型类型参数方法签名类型用途静态方法虚方法非私有直接方法私有构造方法接口方法调用父类方法方法签名格式示例调用七控制流指令条件分支条件跳转条件含义等于不等于小于小于等于大于大于等于等于零不等于零无条件跳转无条件跳转语句紧凑稀疏标签定义跳转标签八异常处理异常捕获异常类型示例可能抛出异常的代码异常处理代码抛出异常抛出寄存器中的异常九调试信息行号源代码行号局部变量名和类型参数名十完整方法示例使用个寄存器参数在参数在来自第行代码返回结果学习建议实践操作使用反编译查看生成的代码工具辅助尝试将转回可视化分析插件调试代码参考资源字节码官方文档语法速查表掌握语法需要实践积累建议从简单的开始分析逐步理解寄存器操作和控制流结构',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-19 09:54:46',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 8 || hour >= 22
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">高木のBlog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "10",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 站点动态</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" alt="红十字会" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp"/></a><div class="post-qr-code-desc">红十字会</div></li><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" alt="LOGO" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp"/></a><div class="post-qr-code-desc">LOGO</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI%E8%AF%AD%E8%A8%80%E5%A4%A7%E6%A8%A1%E5%9E%8B/" style="font-size: 1.05rem;">AI语言大模型<sup>1</sup></a><a href="/tags/APK/" style="font-size: 1.05rem;">APK<sup>2</sup></a><a href="/tags/Android/" style="font-size: 1.05rem;">Android<sup>1</sup></a><a href="/tags/CVE/" style="font-size: 1.05rem;">CVE<sup>5</sup></a><a href="/tags/Chrome/" style="font-size: 1.05rem;">Chrome<sup>2</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>2</sup></a><a href="/tags/IPV6/" style="font-size: 1.05rem;">IPV6<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 1.05rem;">JAVA<sup>6</sup></a><a href="/tags/JS%E9%80%86%E5%90%91/" style="font-size: 1.05rem;">JS逆向<sup>2</sup></a><a href="/tags/NAS/" style="font-size: 1.05rem;">NAS<sup>3</sup></a><a href="/tags/PHP/" style="font-size: 1.05rem;">PHP<sup>2</sup></a><a href="/tags/RCE/" style="font-size: 1.05rem;">RCE<sup>19</sup></a><a href="/tags/TLS/" style="font-size: 1.05rem;">TLS<sup>1</sup></a><a href="/tags/cisp/" style="font-size: 1.05rem;">cisp<sup>2</sup></a><a href="/tags/draft/" style="font-size: 1.05rem;">draft<sup>5</sup></a><a href="/tags/esxi/" style="font-size: 1.05rem;">esxi<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 1.05rem;">hexo<sup>1</sup></a><a href="/tags/html/" style="font-size: 1.05rem;">html<sup>1</sup></a><a href="/tags/javascript/" style="font-size: 1.05rem;">javascript<sup>1</sup></a><a href="/tags/nas/" style="font-size: 1.05rem;">nas<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.05rem;">中间件<sup>15</sup></a><a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">云存储<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">云安全<sup>2</sup></a><a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 1.05rem;">人工智能<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.05rem;">代码审计<sup>16</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">博客<sup>1</sup></a><a href="/tags/%E5%AE%9E%E9%AA%8C/" style="font-size: 1.05rem;">实验<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size: 1.05rem;">密码<sup>8</sup></a><a href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" style="font-size: 1.05rem;">权限提升<sup>2</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">渗透测试<sup>22</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 1.05rem;">漏洞复现<sup>22</sup></a><a href="/tags/%E7%A1%AC%E7%9B%98/" style="font-size: 1.05rem;">硬盘<sup>1</sup></a><a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 1.05rem;">私有云<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 1.05rem;">网络协议<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">网络安全<sup>10</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" style="font-size: 1.05rem;">网络配置<sup>1</sup></a><a href="/tags/%E8%AF%81%E4%B9%A6/" style="font-size: 1.05rem;">证书<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">软件开发<sup>1</sup></a><a href="/tags/%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87/" style="font-size: 1.05rem;">限制绕过<sup>1</sup></a><a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 1.05rem;">靶场<sup>3</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/APK/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>APK</span></a><a class="article-meta__tags" href="/tags/JAVA/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>JAVA</span></a><a class="article-meta__tags" href="/tags/%E9%80%86%E5%90%91/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>逆向</span></a><a class="article-meta__tags" href="/tags/%E5%AE%89%E5%8D%93/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>安卓</span></a></span></div></div><h1 class="post-title" itemprop="name headline">安卓逆向技术</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-22T16:00:00.000Z" title="发表于 2025-06-23 00:00:00">2025-06-23</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-07-19T01:54:46.304Z" title="更新于 2025-07-19 09:54:46">2025-07-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">10.7k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>47分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="安卓逆向技术"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长安"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长安</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/5c4406f679dc69b549b48fa6_p17s2tfgc31jte13d51pea1l2oblr3.png?x-oss-process=style/img-to-webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">GPT-4.0-turbo GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://blog.takake.com/posts/44081/"><header><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a><a href="/tags/APK/" tabindex="-1" itemprop="url">APK</a><a href="/tags/JAVA/" tabindex="-1" itemprop="url">JAVA</a><a href="/tags/%E9%80%86%E5%90%91/" tabindex="-1" itemprop="url">逆向</a><a href="/tags/%E5%AE%89%E5%8D%93/" tabindex="-1" itemprop="url">安卓</a><h1 id="CrawlerTitle" itemprop="name headline">安卓逆向技术</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Takake</span><time itemprop="dateCreated datePublished" datetime="2025-06-22T16:00:00.000Z" title="发表于 2025-06-23 00:00:00">2025-06-23</time><time itemprop="dateCreated datePublished" datetime="2025-07-19T01:54:46.304Z" title="更新于 2025-07-19 09:54:46">2025-07-19</time></header><h1 id="1-frida"><a href="#1-frida" class="headerlink" title="1.frida"></a>1.frida</h1><p><strong>核心概念：动态二进制插桩</strong></p>
<ul>
<li><strong>插桩：</strong> 在程序执行流的关键位置插入额外的代码。</li>
<li><strong>动态：</strong> 在程序运行时进行插桩，无需修改源代码或重新编译目标程序。</li>
<li><strong>二进制：</strong> 直接作用于编译后的可执行文件（二进制文件）。</li>
<li><strong>Frida 的实现：</strong> Frida 通过将一个小型引擎（<code>frida-core</code>）注入到目标进程（如 Android App, iOS App, Windows 桌面程序, macOS 应用等）中实现。这个引擎在目标进程内部运行一个 JavaScript 运行时环境（V8 引擎），允许你执行 JS 脚本并与目标进程的地址空间交互。</li>
</ul>
<h2 id="1-1-安装"><a href="#1-1-安装" class="headerlink" title="1.1.安装"></a>1.1.安装</h2><ul>
<li><p>frida是开源工具，直接在<a target="_blank" rel="noopener" href="https://github.com/frida/frida">github</a>下载即可，版本要求，</p>
</li>
<li><p>在选择安装的版本之前，需要先确定手机的系统和CPU的架构</p>
</li>
<li><p>可以通过以下命令获取CPU架构</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\GaoMu&gt; adb shell getprop ro.product.cpu.abi</span><br><span class="line">arm64<span class="literal">-v8a</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据不同的安装系统版本适配不同的frida版本</p>
</li>
<li><p>同时我的系统是安卓11，因此我选择下载frida16的这个版本</p>
</li>
<li><p>使用adb push 推送解压后的文件到手机目录</p>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> F:\Temp&gt; adb push .\frida<span class="literal">-server-16</span>.<span class="number">7.19</span><span class="literal">-android-arm64</span> /<span class="keyword">data</span>/local/tmp/workplace</span><br><span class="line">.\frida<span class="literal">-server-16</span>.<span class="number">7.19</span><span class="literal">-android-arm64</span>: <span class="number">1</span> file pushed, <span class="number">0</span> skipped. <span class="number">108.7</span> MB/s (<span class="number">53702368</span> bytes <span class="keyword">in</span> <span class="number">0.471</span>s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在手机目录中执行</span></span><br><span class="line">blueline:/<span class="keyword">data</span>/local/tmp/workplace <span class="comment"># chmod +x frida-server-16.7.19-android-arm64</span></span><br><span class="line">blueline:/<span class="keyword">data</span>/local/tmp/workplace <span class="comment"># ls -lh</span></span><br><span class="line">total <span class="number">26</span>M</span><br><span class="line"><span class="literal">-rwxrwx--x</span> <span class="number">1</span> root everybody <span class="number">51</span>M <span class="number">2025</span><span class="literal">-06-23</span> <span class="number">22</span>:<span class="number">12</span> frida<span class="literal">-server-16</span>.<span class="number">7.19</span><span class="literal">-android-arm64</span></span><br><span class="line"><span class="comment"># 启动frida服务端</span></span><br><span class="line">blueline:/<span class="keyword">data</span>/local/tmp/workplace <span class="comment"># ./frida-server-16.7.19-android-arm64</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>Windows客户端安装</strong></p>
</li>
<li><p>使用pip 安装frida客户端，需要与在手机上安装的服务端一致。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install frida==16.7.19 -i https://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">pip install frida-tools==13.7.1  -i https://mirrors.aliyun.com/pypi/simple/</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Windwos客户端连接测试</strong> 以下显示为安装好的App</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\GaoMu&gt; frida<span class="literal">-ps</span> <span class="literal">-Ua</span></span><br><span class="line"> PID  Name          Identifier</span><br><span class="line"><span class="literal">----</span>  <span class="literal">------------</span>  <span class="literal">------------------------------------</span></span><br><span class="line"><span class="number">2904</span>  AudioFX       org.lineageos.audiofx</span><br><span class="line"><span class="number">5172</span>  Aurora Store  com.aurora.store</span><br><span class="line"><span class="number">5183</span>  F<span class="literal">-Droid</span>       org.fdroid.fdroid</span><br><span class="line"><span class="number">3472</span>  Gboard        com.google.android.inputmethod.latin</span><br><span class="line"><span class="number">5553</span>  Magisk        com.topjohnwu.magisk</span><br><span class="line"><span class="number">5471</span>  日历            org.lineageos.etar</span><br><span class="line"><span class="number">3652</span>  设置            com.android.settings</span><br></pre></td></tr></table></figure>

<ul>
<li>安卓代码提示插件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @types/frida-gum --save</span><br></pre></td></tr></table></figure>



<h3 id="安装证书"><a href="#安装证书" class="headerlink" title="安装证书"></a>安装证书</h3><p>​	<strong>Android10</strong>以上安装证书需要使用openssl计算hash，然后命名为hash.0 移动到android的&#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts目录下，同时添加对等权限。如果遇到只读文件系统问题，可以使用MT文件管理工具进行移动。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成哈希并重命名hash.0</span></span><br><span class="line">┌──(kali㉿kali)-[~/Desktop/workplace]</span><br><span class="line">└─$ openssl x509 -subject_hash_old -in Charles.pem</span><br><span class="line">3b5566cf</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">....</span><br><span class="line">mv Charles.pem 3b5566cf.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者 openssl x509 -inform PEM -subject_hash_old -<span class="keyword">in</span> myCA.crt</span> </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">推送证书到设备</span></span><br><span class="line">adb root</span><br><span class="line">adb remount</span><br><span class="line">adb push 3b5566cf.0 /system/etc/security/cacerts/</span><br><span class="line">adb shell chmod 644 /system/etc/security/cacerts/3b5566cf.0</span><br><span class="line">adb reboot</span><br></pre></td></tr></table></figure>

<h2 id="1-2-基础命令"><a href="#1-2-基础命令" class="headerlink" title="1.2.基础命令"></a>1.2.基础命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">用法: frida [选项] 目标</span><br><span class="line"></span><br><span class="line">位置参数:</span><br><span class="line">  args                  额外参数和/或目标</span><br><span class="line"></span><br><span class="line">选项:</span><br><span class="line">  -h, --<span class="built_in">help</span>            显示此帮助信息并退出</span><br><span class="line">  -D ID, --device ID    连接到指定 ID 的设备</span><br><span class="line">  -U, --usb             连接到 USB 设备</span><br><span class="line">  -R, --remote          连接到远程 frida-server</span><br><span class="line">  -H HOST, --host HOST  连接到 HOST 上的远程 frida-server</span><br><span class="line">  --certificate CERTIFICATE</span><br><span class="line">                        与 HOST 使用 TLS 通信，并验证提供的 CERTIFICATE（证书）</span><br><span class="line">  --origin ORIGIN       连接到远程服务器时，设置“Origin”请求头为 ORIGIN</span><br><span class="line">  --token TOKEN         使用 TOKEN 向 HOST 进行身份验证</span><br><span class="line">  --keepalive-interval INTERVAL</span><br><span class="line">                        设置保活间隔（秒），0 表示禁用（默认为 -1，根据传输方式自动选择）</span><br><span class="line">  --p2p                 与目标建立点对点（peer-to-peer）连接</span><br><span class="line">  --stun-server ADDRESS</span><br><span class="line">                        使用 --p2p 时，设置要使用的 STUN 服务器地址 ADDRESS</span><br><span class="line">  --relay address,username,password,turn-&#123;udp,tcp,tls&#125;</span><br><span class="line">                        为 --p2p 添加中继（relay）服务器</span><br><span class="line">  -f TARGET, --file TARGET</span><br><span class="line">                        生成（spawn）文件 TARGET（通常是可执行文件）</span><br><span class="line">  -F, --attach-frontmost</span><br><span class="line">                        附加到最前端应用程序</span><br><span class="line">  -n NAME, --attach-name NAME</span><br><span class="line">                        附加到名称为 NAME 的进程</span><br><span class="line">  -N IDENTIFIER, --attach-identifier IDENTIFIER</span><br><span class="line">                        附加到标识符为 IDENTIFIER 的进程（如 bundle ID）</span><br><span class="line">  -p PID, --attach-pid PID</span><br><span class="line">                        附加到进程 ID 为 PID 的进程</span><br><span class="line">  -W PATTERN, --await PATTERN</span><br><span class="line">                        等待匹配 PATTERN 的进程生成</span><br><span class="line">  --stdio &#123;inherit,pipe&#125;</span><br><span class="line">                        生成进程时的标准输入/输出行为（默认为“inherit”继承）</span><br><span class="line">  --aux option          设置生成进程时的辅助选项（aux option），例如 “uid=(int)42”（支持的类型：string, bool, int）</span><br><span class="line">  --realm &#123;native,emulated&#125;</span><br><span class="line">                        要附加到的执行域（原生域 / 模拟域）</span><br><span class="line">  --runtime &#123;qjs,v8&#125;    要使用的脚本运行时引擎</span><br><span class="line">  --debug               启用 Node.js 兼容的脚本调试器</span><br><span class="line">  --squelch-crash       如果启用，不会将崩溃报告输出到控制台</span><br><span class="line">  -O FILE, --options-file FILE</span><br><span class="line">                        包含额外命令行选项的文本文件</span><br><span class="line">  --version             显示程序版本号并退出</span><br><span class="line">  -l SCRIPT, --load SCRIPT</span><br><span class="line">                        加载脚本文件 SCRIPT</span><br><span class="line">  -P PARAMETERS_JSON, --parameters PARAMETERS_JSON</span><br><span class="line">                        以 JSON 格式提供参数（与 Gadget 相同）</span><br><span class="line">  -C USER_CMODULE, --cmodule USER_CMODULE</span><br><span class="line">                        加载 C 模块（CModule） USER_CMODULE</span><br><span class="line">  --toolchain &#123;any,internal,external&#125;</span><br><span class="line">                        从源代码编译时使用的 CModule 工具链</span><br><span class="line">  -c CODESHARE_URI, --codeshare CODESHARE_URI</span><br><span class="line">                        加载代码共享 URI CODESHARE_URI</span><br><span class="line">  -e CODE, --<span class="built_in">eval</span> CODE  执行（evaluate）代码片段 CODE</span><br><span class="line">  -q                    安静模式（无提示符），并在执行完 -l 和 -e 后退出</span><br><span class="line">  -t TIMEOUT, --<span class="built_in">timeout</span> TIMEOUT</span><br><span class="line">                        在安静模式下，等待 TIMEOUT 秒后终止</span><br><span class="line">  --pause               在生成程序后，保持主线程暂停状态</span><br><span class="line">  -o LOGFILE, --output LOGFILE</span><br><span class="line">                        输出到日志文件 LOGFILE</span><br><span class="line">  --eternalize          在退出前持久化脚本（eternalize the script）</span><br><span class="line">  --exit-on-error       在 SCRIPT 中遇到任何异常后以代码 1 退出</span><br><span class="line">  --kill-on-exit        Frida 退出时杀死生成的程序</span><br><span class="line">  --auto-perform        自动将输入的代码包装在 `Java.perform` 中（用于 Java 交互）</span><br><span class="line">  --auto-reload         启用对提供的脚本和 C 模块的自动重载（默认开启，未来版本将变为必需）</span><br><span class="line">  --no-auto-reload      禁用对提供的脚本和 C 模块的自动重载</span><br></pre></td></tr></table></figure>

<h2 id="1-3-操作模式"><a href="#1-3-操作模式" class="headerlink" title="1.3.操作模式"></a>1.3.操作模式</h2><p><strong>Frida</strong> 提供了两种核心操作模式来注入目标进程：<strong>Attach</strong>（附加）和 <strong>Spawn</strong>（生成）。这两种模式各有特点，适用于不同场景。</p>
<h3 id="1-3-1-Attach模式"><a href="#1-3-1-Attach模式" class="headerlink" title="1.3.1.Attach模式"></a>1.3.1.Attach模式</h3><ul>
<li>附加到<strong>已经运行</strong>的进程</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[运行中的目标进程] --&gt; B[Frida 注入]</span><br><span class="line">B --&gt; C[附加脚本]</span><br><span class="line">C --&gt; D[操作进程]</span><br></pre></td></tr></table></figure>

<ul>
<li>命令操作</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本语法</span></span><br><span class="line">frida -U -p &lt;PID&gt; -l script.js</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">frida -U -n <span class="string">&quot;Process Name&quot;</span> -l script.js</span><br></pre></td></tr></table></figure>

<h3 id="1-3-2-Spawn模式"><a href="#1-3-2-Spawn模式" class="headerlink" title="1.3.2.Spawn模式"></a>1.3.2.Spawn模式</h3><ul>
<li>Frida <strong>启动并暂停</strong>目标进程，注入脚本后继续执行</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[Frida 启动进程] --&gt; B[暂停进程]</span><br><span class="line">B --&gt; C[注入脚本]</span><br><span class="line">C --&gt; D[恢复执行]</span><br></pre></td></tr></table></figure>

<h3 id="1-3-3-两者对比"><a href="#1-3-3-两者对比" class="headerlink" title="1.3.3.两者对比"></a>1.3.3.两者对比</h3><table>
<thead>
<tr>
<th>特性</th>
<th>Attach 模式</th>
<th>Spawn 模式</th>
</tr>
</thead>
<tbody><tr>
<td><strong>目标状态</strong></td>
<td>已运行</td>
<td>未启动</td>
</tr>
<tr>
<td><strong>执行时机</strong></td>
<td>运行时注入</td>
<td>启动前注入</td>
</tr>
<tr>
<td><strong>资源占用</strong></td>
<td>低</td>
<td>中等</td>
</tr>
<tr>
<td><strong>初始化Hook</strong></td>
<td>可能错过</td>
<td>完整捕获</td>
</tr>
<tr>
<td><strong>反调试绕过</strong></td>
<td>有限</td>
<td>有效</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>动态分析</td>
<td>静态分析</td>
</tr>
<tr>
<td><strong>启动命令</strong></td>
<td><code>-p PID</code> 或 <code>-n &quot;Name&quot;</code></td>
<td><code>-f package</code></td>
</tr>
<tr>
<td><strong>热重载</strong></td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody></table>
<h3 id="1-3-4-自定义端口启动"><a href="#1-3-4-自定义端口启动" class="headerlink" title="1.3.4.自定义端口启动"></a>1.3.4.自定义端口启动</h3><ul>
<li><p>frida默认端口号为27043，由于一些应该可能会检查frida的默认端口，导致hook失败，因此可以使用自定义端口来进行hook调试。</p>
<p><strong>具体操作步骤如下：</strong></p>
</li>
<li><p>自定义端口启动server</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blueline:/data/local/tmp/workplace <span class="comment"># ./frida-server-16.7.19-android-arm64  -l 0.0.0.0:9999</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用adb端口转发将Android的9999端口映射到本地客户端主机。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\GaoMu\Desktop\workplace&gt; adb forward tcp:9999 tcp:9999</span><br><span class="line">9999</span><br></pre></td></tr></table></figure>

<ul>
<li>指定本地端口进行hook</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -H 127.0.0.1:8888 -f com.example.app</span><br></pre></td></tr></table></figure>

<h2 id="1-4-frida常用关键词解析"><a href="#1-4-frida常用关键词解析" class="headerlink" title="1.4.frida常用关键词解析"></a>1.4.frida常用关键词解析</h2><h3 id="Frida-脚本常用关键词深度解析"><a href="#Frida-脚本常用关键词深度解析" class="headerlink" title="Frida 脚本常用关键词深度解析"></a>Frida 脚本常用关键词深度解析</h3><p>Frida 脚本使用 JavaScript API 与目标进程交互，下面是核心关键词的详细解析和使用示例：</p>
<h4 id="1-Java-对象-Android-Java-交互"><a href="#1-Java-对象-Android-Java-交互" class="headerlink" title="1. Java 对象 (Android Java 交互)"></a>1. <strong><code>Java</code> 对象 (Android Java 交互)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关键方法</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">/* 安全执行Java操作 */</span> &#125;);</span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.example.Class&quot;</span>, &#123; <span class="comment">/* 查找实例 */</span> &#125;);</span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.Class&quot;</span>) <span class="comment">// 获取类引用 等同于JAVA中的Class.forName() 反射调用</span></span><br><span class="line"><span class="comment">//如果是需要加载内部类的化需要使用&#x27;$&#x27;符引用例如</span></span><br><span class="line">java.<span class="title function_">use</span>(<span class="string">&quot;com.example.Class$InnerClass&quot;</span>)</span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClasses</span>() <span class="comment">// 枚举已加载类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：Hook Activity.onCreate</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Activity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.app.Activity&quot;</span>);</span><br><span class="line">  <span class="title class_">Activity</span>.<span class="property">onCreate</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">bundle</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Activity created!&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onCreate</span>(bundle);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="2-Interceptor-函数拦截"><a href="#2-Interceptor-函数拦截" class="headerlink" title="2. Interceptor (函数拦截)"></a>2. <strong><code>Interceptor</code> (函数拦截)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关键方法</span></span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(targetAddress, &#123; <span class="comment">/* 回调 */</span> &#125;);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">replace</span>(targetAddress, replacementFunc);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">detachAll</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：拦截 libc 的 open 函数</span></span><br><span class="line"><span class="keyword">const</span> openPtr = <span class="title class_">Module</span>.<span class="title function_">getExportByName</span>(<span class="literal">null</span>, <span class="string">&quot;open&quot;</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(openPtr, &#123;</span><br><span class="line">  <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">path</span> = args[<span class="number">0</span>].<span class="title function_">readUtf8String</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Opening file: <span class="subst">$&#123;<span class="variable language_">this</span>.path&#125;</span>`</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Returned fd: <span class="subst">$&#123;retval&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3-Module-模块操作"><a href="#3-Module-模块操作" class="headerlink" title="3. Module (模块操作)"></a>3. <strong><code>Module</code> (模块操作)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关键方法</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="title function_">load</span>(<span class="string">&quot;libtarget.so&quot;</span>); <span class="comment">// 动态加载</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libtarget.so&quot;</span>); <span class="comment">// 查找基址</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="title function_">enumerateImports</span>(<span class="string">&quot;libtarget.so&quot;</span>); <span class="comment">// 枚举导入</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;printf&quot;</span>); <span class="comment">// 查找导出</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：扫描模块导出</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="title function_">enumerateExports</span>(<span class="string">&quot;libart.so&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">exp</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (exp.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;JNI&quot;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Found JNI export: <span class="subst">$&#123;exp.name&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="4-Process-进程控制"><a href="#4-Process-进程控制" class="headerlink" title="4. Process (进程控制)"></a>4. <strong><code>Process</code> (进程控制)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关键方法</span></span><br><span class="line"><span class="title class_">Process</span>.<span class="property">id</span>; <span class="comment">// 当前进程ID</span></span><br><span class="line"><span class="title class_">Process</span>.<span class="property">arch</span>; <span class="comment">// 架构 arm/arm64/x64</span></span><br><span class="line"><span class="title class_">Process</span>.<span class="title function_">enumerateModules</span>(); <span class="comment">// 枚举模块</span></span><br><span class="line"><span class="title class_">Process</span>.<span class="title function_">enumerateThreads</span>(); <span class="comment">// 枚举线程</span></span><br><span class="line"><span class="title class_">Process</span>.<span class="title function_">getCurrentThreadId</span>(); <span class="comment">// 获取当前线程ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：枚举所有模块</span></span><br><span class="line"><span class="title class_">Process</span>.<span class="title function_">enumerateModules</span>().<span class="title function_">forEach</span>(<span class="function"><span class="params">mod</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Module: <span class="subst">$&#123;mod.name&#125;</span> Base: <span class="subst">$&#123;mod.base&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-Memory-内存操作"><a href="#5-Memory-内存操作" class="headerlink" title="5. Memory (内存操作)"></a>5. <strong><code>Memory</code> (内存操作)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关键方法</span></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">alloc</span>(size); <span class="comment">// 分配内存</span></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">protect</span>(address, size, protection); <span class="comment">// 修改保护</span></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">scan</span>(address, size, pattern, callbacks); <span class="comment">// 内存扫描</span></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">readByteArray</span>(address, length); <span class="comment">// 读取字节数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：读取字符串</span></span><br><span class="line"><span class="keyword">const</span> strPtr = <span class="title function_">ptr</span>(<span class="number">0x1234</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`String value: <span class="subst">$&#123;strPtr.readUtf8String()&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：修改内存保护</span></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">protect</span>(<span class="title function_">ptr</span>(<span class="number">0x4000</span>), <span class="number">4096</span>, <span class="string">&#x27;rwx&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="6-ptr-指针操作"><a href="#6-ptr-指针操作" class="headerlink" title="6. ptr (指针操作)"></a>6. <strong><code>ptr</code> (指针操作)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关键方法</span></span><br><span class="line"><span class="title function_">ptr</span>(<span class="string">&quot;0x1234&quot;</span>); <span class="comment">// 创建指针</span></span><br><span class="line">ptr.<span class="title function_">add</span>(offset); <span class="comment">// 指针加法</span></span><br><span class="line">ptr.<span class="title function_">sub</span>(offset); <span class="comment">// 指针减法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：指针运算</span></span><br><span class="line"><span class="keyword">const</span> base = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libtarget.so&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> targetFunc = base.<span class="title function_">add</span>(<span class="number">0x1234</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Target function at: <span class="subst">$&#123;targetFunc&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>

<h4 id="7-NativeFunction-调用原生函数"><a href="#7-NativeFunction-调用原生函数" class="headerlink" title="7. NativeFunction (调用原生函数)"></a>7. <strong><code>NativeFunction</code> (调用原生函数)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建原生函数指针</span></span><br><span class="line"><span class="keyword">const</span> openPtr = <span class="title class_">Module</span>.<span class="title function_">getExportByName</span>(<span class="literal">null</span>, <span class="string">&quot;open&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> open = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(openPtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用原生函数</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="title class_">Memory</span>.<span class="title function_">allocUtf8String</span>(<span class="string">&quot;/etc/passwd&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fd = <span class="title function_">open</span>(path, <span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`File descriptor: <span class="subst">$&#123;fd&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>

<h4 id="8-NativeCallback-创建回调函数"><a href="#8-NativeCallback-创建回调函数" class="headerlink" title="8. NativeCallback (创建回调函数)"></a>8. <strong><code>NativeCallback</code> (创建回调函数)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建回调函数</span></span><br><span class="line"><span class="keyword">const</span> callback = <span class="keyword">new</span> <span class="title class_">NativeCallback</span>(<span class="keyword">function</span>(<span class="params">arg1, arg2</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Callback called with: <span class="subst">$&#123;arg1&#125;</span>, <span class="subst">$&#123;arg2&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置回调</span></span><br><span class="line"><span class="keyword">const</span> setCallback = <span class="title class_">Module</span>.<span class="title function_">getExportByName</span>(<span class="string">&quot;libtarget.so&quot;</span>, <span class="string">&quot;set_callback&quot;</span>);</span><br><span class="line"><span class="title function_">setCallback</span>(callback);</span><br></pre></td></tr></table></figure>

<h4 id="9-Thread-线程操作"><a href="#9-Thread-线程操作" class="headerlink" title="9. Thread (线程操作)"></a>9. <strong><code>Thread</code> (线程操作)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关键方法</span></span><br><span class="line"><span class="title class_">Thread</span>.<span class="title function_">backtrace</span>(context); <span class="comment">// 获取调用栈</span></span><br><span class="line"><span class="title class_">Thread</span>.<span class="title function_">sleep</span>(seconds); <span class="comment">// 线程休眠</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：获取当前线程调用栈</span></span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(targetFunc, &#123;</span><br><span class="line">  <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Backtrace:\n&quot;</span> + </span><br><span class="line">      <span class="title class_">Thread</span>.<span class="title function_">backtrace</span>(<span class="variable language_">this</span>.<span class="property">context</span>).<span class="title function_">map</span>(<span class="title class_">DebugSymbol</span>.<span class="property">fromAddress</span>).<span class="title function_">join</span>(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="10-console-日志输出"><a href="#10-console-日志输出" class="headerlink" title="10. console (日志输出)"></a>10. <strong><code>console</code> (日志输出)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Info message&quot;</span>); <span class="comment">// 信息日志</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&quot;Warning!&quot;</span>); <span class="comment">// 警告日志</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error!&quot;</span>); <span class="comment">// 错误日志</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">debug</span>(<span class="string">&quot;Debug info&quot;</span>); <span class="comment">// 调试日志</span></span><br></pre></td></tr></table></figure>

<h4 id="11-setImmediate-setTimeout-定时操作"><a href="#11-setImmediate-setTimeout-定时操作" class="headerlink" title="11. setImmediate &#x2F; setTimeout (定时操作)"></a>11. <strong><code>setImmediate</code> &#x2F; <code>setTimeout</code> (定时操作)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 立即执行</span></span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;This runs immediately after script load&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 延迟执行</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;This runs after 2 seconds&quot;</span>);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>

<h4 id="12-recv-send-进程通信"><a href="#12-recv-send-进程通信" class="headerlink" title="12. recv &#x2F; send (进程通信)"></a>12. <strong><code>recv</code> &#x2F; <code>send</code> (进程通信)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 脚本中接收消息</span></span><br><span class="line"><span class="title function_">recv</span>(<span class="string">&quot;command&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Received command:&quot;</span>, data.<span class="property">payload</span>);</span><br><span class="line">  <span class="title function_">send</span>(&#123; <span class="attr">result</span>: <span class="string">&quot;success&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Python 端发送消息</span></span><br><span class="line">script.<span class="title function_">post</span>(&#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;command&quot;</span>, <span class="string">&quot;payload&quot;</span>: <span class="string">&quot;start_monitoring&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="13-Frida-核心对象"><a href="#13-Frida-核心对象" class="headerlink" title="13. Frida 核心对象"></a>13. <strong><code>Frida</code> 核心对象</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Frida</span>.<span class="property">heapSize</span>; <span class="comment">// 获取堆大小</span></span><br><span class="line"><span class="title class_">Frida</span>.<span class="property">arch</span>; <span class="comment">// 当前架构</span></span><br><span class="line"><span class="title class_">Frida</span>.<span class="property">ptrSize</span>; <span class="comment">// 指针大小</span></span><br></pre></td></tr></table></figure>

<h4 id="14-Stalker-指令级跟踪"><a href="#14-Stalker-指令级跟踪" class="headerlink" title="14. Stalker (指令级跟踪)"></a>14. <strong><code>Stalker</code> (指令级跟踪)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跟踪指令流</span></span><br><span class="line"><span class="title class_">Stalker</span>.<span class="title function_">follow</span>(threadId, &#123;</span><br><span class="line">  <span class="attr">events</span>: &#123;</span><br><span class="line">    <span class="attr">call</span>: <span class="literal">true</span>, <span class="comment">// 跟踪调用指令</span></span><br><span class="line">    <span class="attr">ret</span>: <span class="literal">false</span>  <span class="comment">// 不跟踪返回指令</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onReceive</span>: <span class="keyword">function</span>(<span class="params">events</span>) &#123;</span><br><span class="line">    <span class="comment">// 处理事件</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 停止跟踪</span></span><br><span class="line"><span class="title class_">Stalker</span>.<span class="title function_">unfollow</span>(threadId);</span><br></pre></td></tr></table></figure>

<h4 id="15-File-文件操作"><a href="#15-File-文件操作" class="headerlink" title="15. File (文件操作)"></a>15. <strong><code>File</code> (文件操作)</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读写文件</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="title class_">File</span>.<span class="title function_">readAllBytes</span>(<span class="string">&quot;/path/to/file&quot;</span>);</span><br><span class="line"><span class="title class_">File</span>.<span class="title function_">writeAllBytes</span>(<span class="string">&quot;/path/to/output&quot;</span>, <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">0x01</span>, <span class="number">0x02</span>]));</span><br></pre></td></tr></table></figure>

<h4 id="实战模式：Hook-链式调用"><a href="#实战模式：Hook-链式调用" class="headerlink" title="实战模式：Hook 链式调用"></a>实战模式：Hook 链式调用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Hook 类方法</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">StringBuilder</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.StringBuilder&quot;</span>);</span><br><span class="line">  <span class="title class_">StringBuilder</span>.<span class="property">toString</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;StringBuilder content:&quot;</span>, result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Hook JNI 函数</span></span><br><span class="line">  <span class="keyword">const</span> env = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>();</span><br><span class="line">  <span class="keyword">const</span> getStringUTFChars = env.<span class="property">getStringUTFChars</span>;</span><br><span class="line">  env.<span class="property">getStringUTFChars</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">str, isCopy</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = getStringUTFChars.<span class="title function_">call</span>(<span class="variable language_">this</span>, str, isCopy);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;JNI String:&quot;</span>, result.<span class="title function_">readUtf8String</span>());</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="调试技巧"><a href="#调试技巧" class="headerlink" title="调试技巧"></a>调试技巧</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 调试模式启用</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Debug mode enabled&quot;</span>);</span><br><span class="line"><span class="title class_">DebugSymbol</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 异常捕获</span></span><br><span class="line"><span class="title class_">Process</span>.<span class="title function_">setExceptionHandler</span>(<span class="keyword">function</span>(<span class="params">exception</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Caught exception:&quot;</span>, exception);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 阻止崩溃</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 内存访问检查</span></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">accessWatch</span>([<span class="title function_">ptr</span>(<span class="number">0x1234</span>)], &#123;</span><br><span class="line">  <span class="attr">onAccess</span>: <span class="keyword">function</span>(<span class="params">details</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Memory accessed at&quot;</span>, details.<span class="property">address</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="常用代码片段"><a href="#常用代码片段" class="headerlink" title="常用代码片段"></a>常用代码片段</h4><h5 id="获取当前-Activity"><a href="#获取当前-Activity" class="headerlink" title="获取当前 Activity"></a>获取当前 Activity</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">ActivityThread</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.app.ActivityThread&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> activity = <span class="title class_">ActivityThread</span>.<span class="title function_">currentActivityThread</span>()</span><br><span class="line">    .<span class="title function_">getActivities</span>().<span class="title function_">values</span>().<span class="title function_">toArray</span>()[<span class="number">0</span>];</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Current activity:&quot;</span>, activity);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="修改返回值"><a href="#修改返回值" class="headerlink" title="修改返回值"></a>修改返回值</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.Crypto&quot;</span>).<span class="property">encrypt</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">encrypt</span>(data);</span><br><span class="line">  <span class="comment">// 修改返回值为固定值</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;modified_result&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="主动调用方法"><a href="#主动调用方法" class="headerlink" title="主动调用方法"></a>主动调用方法</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">System</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.System&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> currentTime = <span class="title class_">System</span>.<span class="title function_">currentTimeMillis</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Current time:&quot;</span>, currentTime.<span class="title function_">toInt32</span>());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="1-5-数据类型对比"><a href="#1-5-数据类型对比" class="headerlink" title="1.5.数据类型对比"></a>1.5.数据类型对比</h2><h3 id="1-5-1-基本数据类型对比"><a href="#1-5-1-基本数据类型对比" class="headerlink" title="1.5.1.基本数据类型对比"></a>1.5.1.基本数据类型对比</h3><table>
<thead>
<tr>
<th align="left">Java 类型</th>
<th align="left">Frida JavaScript 表示</th>
<th align="left">转换方法&#x2F;说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>boolean</code></td>
<td align="left"><code>boolean</code></td>
<td align="left">直接对应 <code>true/false</code></td>
</tr>
<tr>
<td align="left"><code>byte</code></td>
<td align="left"><code>number</code></td>
<td align="left">自动转换</td>
</tr>
<tr>
<td align="left"><code>char</code></td>
<td align="left"><code>number</code> (Unicode 值)</td>
<td align="left">使用 <code>String.fromCharCode()</code> 转字符</td>
</tr>
<tr>
<td align="left"><code>short</code></td>
<td align="left"><code>number</code></td>
<td align="left">自动转换</td>
</tr>
<tr>
<td align="left"><code>int</code></td>
<td align="left"><code>number</code></td>
<td align="left">自动转换</td>
</tr>
<tr>
<td align="left"><code>long</code></td>
<td align="left"><code>number</code> 或 <code>Int64</code></td>
<td align="left">大数需用 <code>new Int64(value)</code></td>
</tr>
<tr>
<td align="left"><code>float</code></td>
<td align="left"><code>number</code></td>
<td align="left">自动转换</td>
</tr>
<tr>
<td align="left"><code>double</code></td>
<td align="left"><code>number</code></td>
<td align="left">自动转换</td>
</tr>
<tr>
<td align="left"><code>void</code></td>
<td align="left"><code>undefined</code></td>
<td align="left">无返回值</td>
</tr>
</tbody></table>
<h3 id="1-5-2-引用数据类型对比"><a href="#1-5-2-引用数据类型对比" class="headerlink" title="1.5.2.引用数据类型对比"></a>1.5.2.引用数据类型对比</h3><table>
<thead>
<tr>
<th align="left">Java 类型</th>
<th align="left">Frida JavaScript 表示</th>
<th align="left">转换方法&#x2F;说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>String</code></td>
<td align="left"><code>string</code></td>
<td align="left">自动转换</td>
</tr>
<tr>
<td align="left"><code>Object</code></td>
<td align="left"><code>Java.Object</code> 包装器</td>
<td align="left">通过 <code>Java.cast()</code> 处理</td>
</tr>
<tr>
<td align="left">数组 (如 <code>int[]</code>)</td>
<td align="left"><code>Java.Array</code> 对象</td>
<td align="left">使用 <code>Java.array()</code> 创建</td>
</tr>
<tr>
<td align="left">自定义类实例</td>
<td align="left"><code>Java.Wrapper</code> 对象</td>
<td align="left">通过 <code>Java.use()</code> 获取类引用</td>
</tr>
<tr>
<td align="left"><code>List</code>&#x2F;<code>Map</code></td>
<td align="left"><code>Java.Objects</code> 包装器</td>
<td align="left">特殊方法处理</td>
</tr>
<tr>
<td align="left"><code>null</code></td>
<td align="left"><code>null</code></td>
<td align="left">直接对应</td>
</tr>
</tbody></table>
<h2 id="1-6-frida-hook"><a href="#1-6-frida-hook" class="headerlink" title="1.6.frida hook"></a>1.6.frida hook</h2><h3 id="1-6-1-hook示例"><a href="#1-6-1-hook示例" class="headerlink" title="1.6.1.hook示例"></a>1.6.1.hook示例</h3><ul>
<li>jdx反编译代码片段</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gaomu.fridatest.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.GCMParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AES</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">aesEncrypt</span><span class="params">(String str, String str2, String str3, String str4)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        validateHex(<span class="string">&quot;密钥&quot;</span>, str3, <span class="number">32</span>);</span><br><span class="line">        <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(hexToBytes(str3), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(getTransformation(str));</span><br><span class="line">        <span class="keyword">if</span> (str.equalsIgnoreCase(<span class="string">&quot;ECB&quot;</span>)) &#123;</span><br><span class="line">            cipher.init(<span class="number">1</span>, secretKeySpec);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            validateHex(<span class="string">&quot;IV&quot;</span>, str4, <span class="number">32</span>);</span><br><span class="line">            <span class="type">byte</span>[] bArrHexToBytes = hexToBytes(str4);</span><br><span class="line">            <span class="keyword">if</span> (str.equalsIgnoreCase(<span class="string">&quot;GCM&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">12</span>];</span><br><span class="line">                System.arraycopy(bArrHexToBytes, <span class="number">0</span>, bArr, <span class="number">0</span>, <span class="number">12</span>);</span><br><span class="line">                cipher.init(<span class="number">1</span>, secretKeySpec, <span class="keyword">new</span> <span class="title class_">GCMParameterSpec</span>(<span class="number">128</span>, bArr));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cipher.init(<span class="number">1</span>, secretKeySpec, <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(bArrHexToBytes));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Base64.getEncoder().encodeToString(cipher.doFinal(str2.getBytes(StandardCharsets.UTF_8)));</span><br><span class="line">    &#125;</span><br><span class="line">.....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>hook示例</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hookAes函数用于hook目标应用中的AES加密方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hookAes</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 获取目标类com.gaomu.fridatest.utils.AES的Java对象</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">AES</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.gaomu.fridatest.utils.AES&quot;</span>)</span><br><span class="line">    <span class="comment">// 重写aesEncrypt方法的实现</span></span><br><span class="line">    <span class="variable constant_">AES</span>.<span class="property">aesEncrypt</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">mode, plainText, keyHex, ivHex</span>) &#123;</span><br><span class="line">        <span class="comment">// 打印传入的参数，便于分析加密过程</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;mode:&quot;</span> + mode);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;plainText:&quot;</span> + plainText);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;keyHex:&quot;</span> + keyHex);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ivHex:&quot;</span> + ivHex);</span><br><span class="line">        <span class="comment">// 调用原始的aesEncrypt方法，获取加密结果</span></span><br><span class="line">        <span class="keyword">var</span> res = <span class="variable language_">this</span>.<span class="title function_">aesEncrypt</span>(mode, plainText, keyHex, ivHex)</span><br><span class="line">        <span class="comment">// 打印加密结果</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        <span class="comment">// 返回加密结果</span></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main函数作为入口，确保在Java环境准备好后执行hook</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">hookAes</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 立即执行main函数，开始hook</span></span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br><span class="line">    </span><br><span class="line"><span class="comment">//服务端frida启动后，客户端使用frida -UF -l ./hook1.js 进行hook，执行方法后，就可以在控制台打印出参数信息。 </span></span><br></pre></td></tr></table></figure>

<h3 id="1-6-2-重载方法调用示例"><a href="#1-6-2-重载方法调用示例" class="headerlink" title="1.6.2.重载方法调用示例"></a>1.6.2.重载方法调用示例</h3><ul>
<li>需要调用同名函数不同得方法需要使用overload，来指定方法的参数类型</li>
<li>例如调用四字参数均为字符串类型的aesEncrypt()方法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookAes</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 获取目标类com.gaomu.fridatest.utils.AES的Java对象</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">AES</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.gaomu.fridatest.utils.AES&quot;</span>)</span><br><span class="line">    <span class="comment">// 重写aesEncrypt方法的实现</span></span><br><span class="line">    <span class="variable constant_">AES</span>.<span class="property">aesEncrypt</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>,<span class="string">&#x27;java.lang.String&#x27;</span>,<span class="string">&#x27;java.lang.String&#x27;</span>,<span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">mode, plainText, keyHex, ivHex</span>) &#123;</span><br><span class="line">        <span class="comment">// 打印传入的参数，便于分析加密过程</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;tip:&quot;</span> + <span class="string">&quot;use have four args of reload method&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> res = <span class="variable language_">this</span>.<span class="title function_">aesEncrypt</span>(mode, plainText, keyHex, ivHex)</span><br><span class="line">        <span class="comment">// 打印加密结果</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        <span class="comment">// 返回加密结果</span></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>hook所有同名方法。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取getOver方法的所有重载方法的数量</span></span><br><span class="line"><span class="keyword">var</span> len = utils.<span class="property">getOver</span>.<span class="property">overloads</span>.<span class="property">length</span>;</span><br><span class="line"><span class="comment">// 循环遍历所有重载方法</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;len; i++) &#123;</span><br><span class="line">    utils.<span class="property">getOver</span>.<span class="property">overloads</span>[i].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">//获取所有参数并输出</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> a = <span class="number">0</span>; a &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; a++) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(a + <span class="string">&#x27;---&#x27;</span> + <span class="variable language_">arguments</span>[a])</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//调用原始方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">getOver</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-6-3-主动调用方法"><a href="#1-6-3-主动调用方法" class="headerlink" title="1.6.3.主动调用方法"></a>1.6.3.主动调用方法</h3><ul>
<li>每次改一次文件都会主动执行一次</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主动调用md5方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMD5</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">MD5</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.gaomu.fridatest.utils.MD5&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> md5hash = <span class="title class_">MD5</span>.<span class="title function_">md5Hash</span>(<span class="string">&quot;adminx&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;md5: &quot;</span> + md5hash);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main函数作为入口，确保在Java环境准备好后执行hook</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">initMD5</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 立即执行main函数，开始hook</span></span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br><span class="line"></span><br><span class="line"><span class="comment">//主动调用获取实例对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useDesSecurityConstructor</span>(<span class="params"></span>) <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">DesSecurity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.dodonew.online.util.DesSecurity&quot;</span>);</span><br><span class="line">    <span class="comment">//获取参数为两个字符串类型的构造方法</span></span><br><span class="line">	<span class="keyword">const</span> ctorOverload = <span class="title class_">DesSecurity</span>.$overload(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;java.lang.String&#x27;</span>);</span><br><span class="line">    <span class="comment">//使用构造方法new一个对象</span></span><br><span class="line">	<span class="keyword">const</span> ds = ctorOverload.$new(b, c);<span class="comment">//获取一个DesSecurity实例对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-6-4-hook调用实例方法"><a href="#1-6-4-hook调用实例方法" class="headerlink" title="1.6.4.hook调用实例方法"></a>1.6.4.hook调用实例方法</h3><ul>
<li>自定义实例调用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取class对象</span></span><br><span class="line"><span class="keyword">var</span> moneyClass = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.gaomu.Money&quot;</span>);</span><br><span class="line"><span class="comment">// 新建一个实例对象</span></span><br><span class="line"><span class="keyword">var</span> money = moneyClass.$new();</span><br><span class="line"><span class="comment">// 直接调用其方法</span></span><br><span class="line"><span class="keyword">var</span> res = money.<span class="title function_">getInfo</span>();</span><br><span class="line"><span class="comment">// 获取实例中的静态变量值   .value获取</span></span><br><span class="line"><span class="keyword">var</span> value = money.<span class="property">falg</span>.<span class="property">value</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>RPC全局实例调用<ul>
<li>onMatch方法是frida脚本用于匹配特定条件时触发的回调函数。当满足特定的条件时，比如某个函数被调用或者某个字符串被传递等，onMatch方法可以执行相应的操作。</li>
<li>onComplete方法是在Frida脚本执行完毕时触发的回调函数。通常用于在所有操作完成后做一些清理工作或输出总结信息。</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">demo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.gaomu.Money&quot;</span>, &#123;</span><br><span class="line">       <span class="comment">//找到所有为com.gaomu.Money类的对象，每当调用这个对象时都会执行一次onMatch函数</span></span><br><span class="line">       <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">           <span class="comment">//obj 即为匹配到的Money对象</span></span><br><span class="line">           <span class="keyword">var</span> name = obj.<span class="property">name</span>.<span class="property">value</span> <span class="comment">//获取非静态变量 如果字段名和方法名相同时需要在前面加上_</span></span><br><span class="line">           <span class="keyword">var</span> num = obj.<span class="property">num</span>.<span class="property">value</span> <span class="comment">//获非取静态变量</span></span><br><span class="line">           <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="title function_">getInfo</span>())</span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">           <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;内存中Money操作完毕&quot;</span>)</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-6-5-hook构造方法"><a href="#1-6-5-hook构造方法" class="headerlink" title="1.6.5.hook构造方法"></a>1.6.5.hook构造方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取class对象</span></span><br><span class="line"><span class="keyword">var</span> money = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.gaomu.Money&quot;</span>)</span><br><span class="line"><span class="comment">// hook构造参数类型为java.lang.String和int的构造方法</span></span><br><span class="line">money.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">str, num</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(str, num)</span><br><span class="line">    <span class="comment">// 执行原本逻辑</span></span><br><span class="line">    <span class="variable language_">this</span>.$init(str, num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-6-6-hook内部类"><a href="#1-6-6-hook内部类" class="headerlink" title="1.6.6.hook内部类"></a>1.6.6.hook内部类</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> innerClass = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.gaomu.Money$InnerClass&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="1-6-7-枚举所有的类"><a href="#1-6-7-枚举所有的类" class="headerlink" title="1.6.7.枚举所有的类"></a>1.6.7.枚举所有的类</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClassesSync</span>().<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> utils = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.gaomu.Utils&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> methods = utils.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;methods.<span class="property">length</span>; i++)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(methods[i].<span class="title function_">getName</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取所有构造方法</span></span><br><span class="line"><span class="keyword">var</span> constructors = utils.<span class="property">class</span>.<span class="title function_">getDeclaredConstructors</span>();</span><br><span class="line"><span class="comment">//遍历构造方法</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(constructors);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; constructors.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> constructor = constructors[i];</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(constructor.<span class="title function_">toString</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(constructor.<span class="title function_">getName</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取所有字段</span></span><br><span class="line"><span class="keyword">var</span> fields = money.<span class="property">class</span>.<span class="title function_">getDeclaredFields</span>();</span><br></pre></td></tr></table></figure>

<h3 id="1-6-8-hook-map对象"><a href="#1-6-8-hook-map对象" class="headerlink" title="1.6.8.hook map对象"></a>1.6.8.hook map对象</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hashMap </span></span><br><span class="line"><span class="comment">//直接打印，如果配置的hashMap键值对是String类型的话，可以输入字符串内容</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hashMap);</span><br><span class="line"><span class="comment">//迭代遍历获取键值对</span></span><br><span class="line"><span class="keyword">var</span> key = hashMap.<span class="title function_">keySet</span>();</span><br><span class="line"><span class="keyword">var</span> it = key.<span class="title function_">iterator</span>();</span><br><span class="line"><span class="keyword">while</span>(it.<span class="title function_">hasNext</span>())&#123;</span><br><span class="line">    <span class="keyword">var</span> keyStr = it.<span class="title function_">next</span>();</span><br><span class="line">    <span class="keyword">var</span> valueStr = hashMap.<span class="title function_">get</span>(keyStr);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;key-&gt;&quot;</span> + keystr + <span class="string">&quot; | val-&gt;&quot;</span> + valSuetr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改hashMap中的值</span></span><br><span class="line">hashMap.<span class="title function_">put</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;gaomu&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="1-6-9-hook-okhttp"><a href="#1-6-9-hook-okhttp" class="headerlink" title="1.6.9.hook okhttp"></a>1.6.9.hook okhttp</h3><ul>
<li>如果app使用了okhttp的依赖进行发包，那么就可以使用这个方法进行hook</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hook 请求地址</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hookOkhttpURL</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Builder</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;okhttp3.Request$Builder&#x27;</span>);</span><br><span class="line">    <span class="comment">//url有三种重载方法，分别是java.lang.String/java.net.URL/okhttp3.HttpUrl，大多数请求都是使用的HttpUrl类型参数</span></span><br><span class="line">    <span class="title class_">Builder</span>.<span class="property">url</span>.<span class="title function_">overload</span>(<span class="string">&#x27;okhttp3.HttpUrl&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a: &#x27;</span> + a);</span><br><span class="line">        <span class="keyword">var</span> res = <span class="variable language_">this</span>.<span class="title function_">url</span>(a);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>hook 请求和响应</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> okHttpClinet = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;okhttp3.OkHttpClient&quot;</span>);</span><br><span class="line"><span class="title class_">OkHttpClient</span>.<span class="property">newCall</span>.<span class="title function_">overload</span>(<span class="string">&quot;okhttp3.Request&quot;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">request</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP Reqeust -&gt; &quot;</span> + request.<span class="title function_">url</span>().<span class="title function_">toString</span>());</span><br><span class="line">    <span class="keyword">var</span> call = <span class="variable language_">this</span>.<span class="title function_">newCall</span>(request); <span class="comment">//获取新的call对象</span></span><br><span class="line">    <span class="keyword">var</span> response = call.<span class="title function_">execute</span>(); <span class="comment">//调用call对象的execute发送请求 并获取响应</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP Response -&gt; &quot;</span> + response.<span class="title function_">body</span>().<span class="title function_">string</span>());</span><br><span class="line">    <span class="keyword">return</span> call;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>hook 请求头</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> okHttpClinet = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;okhttp3.Request$Builder&quot;</span>);</span><br><span class="line"><span class="comment">//hook Builder类的addHeader方法</span></span><br><span class="line"><span class="title class_">Builder</span>[<span class="string">&quot;addHeader&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">str, str2</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;key: &quot;</span> + str);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;val: &quot;</span> + str2);</span><br><span class="line">    <span class="comment">//showStacks()</span></span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>[<span class="string">&quot;addHeader&quot;</span>](str, str2);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-6-10-输出当前堆栈信息"><a href="#1-6-10-输出当前堆栈信息" class="headerlink" title="1.6.10.输出当前堆栈信息"></a>1.6.10.输出当前堆栈信息</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()</span><br><span class="line">        ))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-7-实战hook-嘟嘟牛"><a href="#1-7-实战hook-嘟嘟牛" class="headerlink" title="1.7.实战hook 嘟嘟牛"></a>1.7.实战hook 嘟嘟牛</h2><h3 id="1-7-1-反编译的APK包"><a href="#1-7-1-反编译的APK包" class="headerlink" title="1.7.1.反编译的APK包"></a>1.7.1.反编译的APK包</h3><ul>
<li>根据反编译的APK源码包，发现大多数代码都是经过混淆的，不具有可读性。</li>
<li>仅部分具有可读性。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250628003501716.png?x-oss-process=style/img-to-webp" alt="image-20250628003501716"></p>
<ul>
<li>因此我们接下来的直接进行盲 hook。</li>
</ul>
<h3 id="1-7-2-hook-记录"><a href="#1-7-2-hook-记录" class="headerlink" title="1.7.2.hook 记录"></a>1.7.2.hook 记录</h3><ul>
<li>首先我们通过对<strong>HashMap</strong>类进行hook。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setImmediate</span>(main)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">hookHashMap</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hookHashMap</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> hashMap = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.util.HashMap&quot;</span>);</span><br><span class="line">    hashMap.<span class="property">put</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a, b</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;print out ----------&gt;&quot;</span>,a,b);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">put</span>(a,b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>触发登陆请求后发现关键信息。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250628003951425.png?x-oss-process=style/img-to-webp" alt="image-20250628003951425"></p>
<ul>
<li><p>因此我们通过在hashMap类里当key等于Encrypt时，输出其堆栈信息。</p>
</li>
<li><p>修改hashMap逻辑，输出堆栈信息</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookHashMap</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> hashMap = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.util.HashMap&quot;</span>);</span><br><span class="line">    hashMap.<span class="property">put</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a, b</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="string">&quot;Encrypt&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;print out ----------&gt;&quot;</span>,a,b);</span><br><span class="line">            <span class="title function_">showStacks</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">put</span>(a,b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()</span><br><span class="line">        ));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在输出的堆栈信息中我们并没用发现我们感兴趣的加密函数。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250628005247626.png?x-oss-process=style/img-to-webp" alt="image-20250628005247626"></p>
<ul>
<li>于是，我换了一个思路，获取这个包下所有的类，看有什么我感兴趣的类。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookClass</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 方法1：使用同步过滤</span></span><br><span class="line">    <span class="keyword">const</span> targetPackage = <span class="string">&quot;com.dodonew.online&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> loadedClasses = <span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClassesSync</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 过滤目标包下的类</span></span><br><span class="line">    <span class="keyword">const</span> filteredClasses = loadedClasses.<span class="title function_">filter</span>(<span class="function"><span class="params">className</span> =&gt;</span></span><br><span class="line">        className.<span class="title function_">startsWith</span>(targetPackage + <span class="string">&quot;.&quot;</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[+] 找到 <span class="subst">$&#123;filteredClasses.length&#125;</span> 个类:`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(filteredClasses.<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250628005506712.png?x-oss-process=style/img-to-webp" alt="image-20250628005506712"></p>
<ul>
<li>我们再尝试获取该类的所有方法和字段。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookMethod</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">DesSecurity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.dodonew.online.util.DesSecurity&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取类的 Class 对象</span></span><br><span class="line">    <span class="keyword">var</span> clazz = <span class="title class_">DesSecurity</span>.<span class="property">class</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 正确获取所有声明的方法</span></span><br><span class="line">    <span class="keyword">var</span> methods = clazz.<span class="title function_">getDeclaredMethods</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n[+] DesSecurity 类方法列表:&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 获取方法名和参数类型</span></span><br><span class="line">        <span class="keyword">var</span> method = methods[i];</span><br><span class="line">        <span class="keyword">var</span> methodName = method.<span class="title function_">getName</span>();</span><br><span class="line">        <span class="keyword">var</span> paramTypes = method.<span class="title function_">getParameterTypes</span>().<span class="title function_">map</span>(<span class="function"><span class="params">t</span> =&gt;</span> t.<span class="title function_">getSimpleName</span>());</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  - <span class="subst">$&#123;methodName&#125;</span>(<span class="subst">$&#123;paramTypes.join(<span class="string">&quot;, &quot;</span>)&#125;</span>)`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 正确获取所有声明的字段</span></span><br><span class="line">    <span class="keyword">var</span> fields = clazz.<span class="title function_">getDeclaredFields</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n[+] DesSecurity 类字段列表:&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; fields.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 获取字段名和类型</span></span><br><span class="line">        <span class="keyword">var</span> field = fields[i];</span><br><span class="line">        <span class="keyword">var</span> fieldName = field.<span class="title function_">getName</span>();</span><br><span class="line">        <span class="keyword">var</span> fieldType = field.<span class="title function_">getType</span>().<span class="title function_">getSimpleName</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  - <span class="subst">$&#123;fieldType&#125;</span> <span class="subst">$&#123;fieldName&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>发现了一个加密函数，这个加密函数没有密钥，那么我们完全可以想象一个有密钥的加密函数调用了这个函数。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250628010848082.png?x-oss-process=style/img-to-webp" alt="image-20250628010848082"></p>
<ul>
<li>因此我们hook这个方法，并且输出调用这个方法时的堆栈信息，查找是否有其他加密函数。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookDesSecurity</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">DesSecurity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.dodonew.online.util.DesSecurity&quot;</span>);</span><br><span class="line">    <span class="title class_">DesSecurity</span>.<span class="property">encrypt64</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">byte</span>)&#123;</span><br><span class="line">        <span class="title function_">showStacks</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;encrypt64 execute!!!!!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">encrypt64</span>(byte);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250628011138394.png?x-oss-process=style/img-to-webp" alt="image-20250628011138394"></p>
<ul>
<li><p>接下来我们hook一下encodeDesMap方法。</p>
</li>
<li><p>通过deepseek编写以下hook获取该方法所有的重载方法和对应参数类型。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookEncodeDesMap</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="title class_">RequestUtil</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.dodonew.online.http.RequestUtil&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取 encodeDesMap 方法的所有重载</span></span><br><span class="line">            <span class="keyword">const</span> encodeDesMapOverloads = <span class="title class_">RequestUtil</span>.<span class="property">encodeDesMap</span>.<span class="property">overloads</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n===== encodeDesMap 方法重载分析 =====&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[+] 共找到 <span class="subst">$&#123;encodeDesMapOverloads.length&#125;</span> 个重载方法`</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (encodeDesMapOverloads.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[!] 未找到 encodeDesMap 方法，可能是方法名错误或类未加载&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 遍历所有重载</span></span><br><span class="line">            encodeDesMapOverloads.<span class="title function_">forEach</span>(<span class="function">(<span class="params">overload, index</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`\n[重载 #<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span>]`</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取参数类型</span></span><br><span class="line">                <span class="keyword">const</span> paramTypes = overload.<span class="property">argumentTypes</span>;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  参数数量: <span class="subst">$&#123;paramTypes.length&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 打印每个参数类型</span></span><br><span class="line">                paramTypes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">paramType, paramIndex</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> className = paramType.<span class="property">className</span>;</span><br><span class="line">                        <span class="keyword">const</span> simpleName = className.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">pop</span>();</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  参数 <span class="subst">$&#123;paramIndex + <span class="number">1</span>&#125;</span>: <span class="subst">$&#123;simpleName&#125;</span> (<span class="subst">$&#123;className&#125;</span>)`</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  参数 <span class="subst">$&#123;paramIndex + <span class="number">1</span>&#125;</span>: &lt;无法获取类型信息&gt;`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取返回类型</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> returnType = overload.<span class="property">returnType</span>.<span class="property">className</span>;</span><br><span class="line">                    <span class="keyword">const</span> simpleReturnType = returnType.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">pop</span>();</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  返回类型: <span class="subst">$&#123;simpleReturnType&#125;</span> (<span class="subst">$&#123;returnType&#125;</span>)`</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;  返回类型: &lt;未知&gt;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 实际 Hook 该重载</span></span><br><span class="line">                overload.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`\n[encodeDesMap 重载 #<span class="subst">$&#123;index + <span class="number">1</span>&#125;</span> 被调用]`</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 打印参数值</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;  调用参数:&quot;</span>);</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                            <span class="keyword">const</span> arg = <span class="variable language_">arguments</span>[i];</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// 特殊处理常见类型</span></span><br><span class="line">                            <span class="keyword">if</span> (arg === <span class="literal">null</span>) &#123;</span><br><span class="line">                                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`    参数 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>: null`</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> arg === <span class="string">&#x27;object&#x27;</span> &amp;&amp; arg.<span class="property">getClass</span>) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    <span class="comment">// 尝试获取对象的类名</span></span><br><span class="line">                                    <span class="keyword">const</span> className = arg.<span class="title function_">getClass</span>().<span class="title function_">getName</span>();</span><br><span class="line">                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`    参数 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>: <span class="subst">$&#123;className&#125;</span> 对象`</span>);</span><br><span class="line"></span><br><span class="line">                                    <span class="comment">// 如果是 Map 类型，尝试打印内容</span></span><br><span class="line">                                    <span class="keyword">if</span> (className.<span class="title function_">endsWith</span>(<span class="string">&#x27;Map&#x27;</span>)) &#123;</span><br><span class="line">                                        <span class="keyword">try</span> &#123;</span><br><span class="line">                                            <span class="keyword">const</span> mapSize = arg.<span class="title function_">size</span>();</span><br><span class="line">                                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`      Map 大小: <span class="subst">$&#123;mapSize&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">                                            <span class="keyword">if</span> (mapSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                                                <span class="keyword">const</span> entrySet = arg.<span class="title function_">entrySet</span>();</span><br><span class="line">                                                <span class="keyword">const</span> iterator = entrySet.<span class="title function_">iterator</span>();</span><br><span class="line"></span><br><span class="line">                                                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;      Map 内容:&quot;</span>);</span><br><span class="line">                                                <span class="keyword">while</span> (iterator.<span class="title function_">hasNext</span>()) &#123;</span><br><span class="line">                                                    <span class="keyword">const</span> entry = iterator.<span class="title function_">next</span>();</span><br><span class="line">                                                    <span class="keyword">const</span> key = entry.<span class="title function_">getKey</span>();</span><br><span class="line">                                                    <span class="keyword">const</span> value = entry.<span class="title function_">getValue</span>();</span><br><span class="line">                                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`        <span class="subst">$&#123;key&#125;</span> = <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line">                                            &#125;</span><br><span class="line">                                        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;      无法解析 Map 内容&quot;</span>);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`    参数 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>: 对象 (无法获取类信息)`</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`    参数 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>: <span class="subst">$&#123;arg&#125;</span> (<span class="subst">$&#123;<span class="keyword">typeof</span> arg&#125;</span>)`</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;  无参数&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 调用原方法</span></span><br><span class="line">                    <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="property">encodeDesMap</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 打印返回值</span></span><br><span class="line">                    <span class="keyword">if</span> (result !== <span class="literal">null</span> &amp;&amp; result !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;  返回结果:&quot;</span>, result.<span class="title function_">toString</span>());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;  返回结果: null&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n[+] Hook 已设置，等待方法调用...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;[!] 分析失败:&quot;</span>, e.<span class="property">message</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>控制台输出如下</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">===== encodeDesMap 方法重载分析 =====</span><br><span class="line">[+] 共找到 <span class="number">2</span> 个重载方法</span><br><span class="line"></span><br><span class="line">[重载 #<span class="number">1</span>]</span><br><span class="line">  参数数量: <span class="number">3</span></span><br><span class="line">  参数 <span class="number">1</span>: <span class="type">String</span> (java.lang.<span class="type">String</span>)</span><br><span class="line">  参数 <span class="number">2</span>: <span class="type">String</span> (java.lang.<span class="type">String</span>)</span><br><span class="line">  参数 <span class="number">3</span>: <span class="type">String</span> (java.lang.<span class="type">String</span>)</span><br><span class="line">  返回类型: <span class="type">String</span> (java.lang.<span class="type">String</span>)</span><br><span class="line"></span><br><span class="line">[重载 #<span class="number">2</span>]</span><br><span class="line">  参数数量: <span class="number">4</span></span><br><span class="line">  参数 <span class="number">1</span>: <span class="type">String</span> (java.lang.<span class="type">String</span>)</span><br><span class="line">  参数 <span class="number">2</span>: <span class="type">String</span> (java.lang.<span class="type">String</span>)</span><br><span class="line">  参数 <span class="number">3</span>: <span class="type">String</span> (java.lang.<span class="type">String</span>)</span><br><span class="line">  参数 <span class="number">4</span>: <span class="type">String</span> (java.lang.<span class="type">String</span>)</span><br><span class="line">  返回类型: <span class="type">Map</span> (java.util.<span class="type">Map</span>)</span><br><span class="line"></span><br><span class="line">[+] <span class="type">Hook</span> 已设置，等待方法调用...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>有两个重载方法，具体调用的哪个重载方法我们不得而知，但是我们可以直接hook尝试。</li>
<li>先hook第一个重载方法，也就是3个String参数的方法。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setImmediate</span>(main)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">hookEncodeDesMap</span>();</span><br><span class="line">        <span class="title function_">hookHashMap</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hookEncodeDesMap</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">RequestUtil</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.dodonew.online.http.RequestUtil&quot;</span>);</span><br><span class="line">    <span class="title class_">RequestUtil</span>.<span class="property">encodeDesMap</span>.<span class="title function_">overload</span>(<span class="string">&quot;java.lang.String&quot;</span>,<span class="string">&quot;java.lang.String&quot;</span>,<span class="string">&quot;java.lang.String&quot;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a,b,c</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;a---------&gt;&quot;</span>, a);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;b---------&gt;&quot;</span>, b);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;c---------&gt;&quot;</span>, c);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">encodeDesMap</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hookHashMap</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> hashMap = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.util.HashMap&quot;</span>);</span><br><span class="line">    hashMap.<span class="property">put</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a, b</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="string">&quot;Encrypt&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;print out ----------&gt;&quot;</span>,a,b);</span><br><span class="line">            <span class="comment">//showStacks();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">put</span>(a,b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>通过以上代码hook我们成功获得以下输出</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a---------&gt; &#123;<span class="string">&quot;equtype&quot;</span>:<span class="string">&quot;ANDROID&quot;</span>,<span class="string">&quot;loginImei&quot;</span>:<span class="string">&quot;Androidb40a5c0f41fef63f&quot;</span>,<span class="string">&quot;sign&quot;</span>:<span class="string">&quot;C30222B6DF6FF2BCFF34A6E412BE0CA6&quot;</span>,<span class="string">&quot;timeStamp&quot;</span>:<span class="string">&quot;1751045128588&quot;</span>,<span class="string">&quot;userPwd&quot;</span>:<span class="string">&quot;1314520&quot;</span>,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;114614&quot;</span>&#125;</span><br><span class="line">b---------&gt; <span class="number">65102933</span></span><br><span class="line">c---------&gt; <span class="number">32028092</span></span><br><span class="line">print out ----------&gt; <span class="type">Encrypt</span> <span class="type">NIszaqFPos1vd0pFqKlB42Np5itPxaNH</span><span class="comment">//FDsRnlBfgL4lcVxjXii+gDPsXiVF3VBzVAsMjQKraf</span></span><br><span class="line"><span class="number">7</span>KdDY8QjXCrDyjbdep0QyDb+fluS62QBfyio5TUMRlhfetK0JJUAEaNIwv7SujX6+<span class="number">4</span>EN/<span class="type">CAunlQe</span></span><br><span class="line">cDNagp872sabGkggHRlKAcNuPr0wcSqiY9K9GHk/<span class="type">IrHEw6rClCrfZjYolrq0MXo5I9mSpJA3NEQH</span></span><br><span class="line"><span class="type">Rp5KRms</span>=</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>那么我们不难猜测a字符串是明文，b、c其中一个是密钥，一个是iv。</p>
</li>
<li><p>那么我们复现其加密逻辑，代码如下。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookDesSecurityContructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">RequestUtil</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.dodonew.online.http.RequestUtil&quot;</span>);</span><br><span class="line">    <span class="comment">//反射获取指定参数类型的方法</span></span><br><span class="line">    <span class="keyword">const</span> encodeDesMapMethod =  <span class="title class_">RequestUtil</span>.<span class="property">encodeDesMap</span>.<span class="title function_">overload</span>(<span class="string">&quot;java.lang.String&quot;</span>,<span class="string">&quot;java.lang.String&quot;</span>,<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">   <span class="comment">//反射调用RequestUtil类中的encodeDesMapMethod方法。</span></span><br><span class="line">    <span class="keyword">var</span> cipher = encodeDesMapMethod.<span class="title function_">call</span>(<span class="title class_">RequestUtil</span>, <span class="string">&quot;&#123;\&quot;equtype\&quot;:\&quot;ANDROID\&quot;,\&quot;loginImei\&quot;:\&quot;Androidb40a5c0f41fef63f\&quot;,\&quot;sign\&quot;:\&quot;C30222B6DF6FF2BCFF34A6E412BE0CA6\&quot;,\&quot;timeStamp\&quot;:\&quot;1751045128588\&quot;,\&quot;userPwd\&quot;:\&quot;1314520\&quot;,\&quot;username\&quot;:\&quot;114614\&quot;&#125;&quot;</span>,<span class="string">&quot;65102933&quot;</span>, <span class="string">&quot;32028092&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;cipher: &quot;</span>, cipher);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出cipher:  NIszaqFPos1vd0pFqKlB42Np5itPxaNH//FDsRnlBfgL4lcVxjXii+gDPsXiVF3VBzVAsMjQKraf</span></span><br><span class="line"><span class="comment">//7KdDY8QjXCrDyjbdep0QyDb+fluS62QBfyio5TUMRlhfetK0JJUAEaNIwv7SujX6+4EN/CAunlQe</span></span><br><span class="line"><span class="comment">//cDNagp872sabGkggHRlKAcNuPr0wcSqiY9K9GHk/IrHEw6rClCrfZjYolrq0MXo5I9mSpJA3NEQH</span></span><br><span class="line"><span class="comment">//Rp5KRms=</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>我们最后留下一个问题，通过对加密算法的复现，无法复现成功？这是为什么？</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250628104409562.png?x-oss-process=style/img-to-webp" alt="image-20250628104409562"></p>
<ul>
<li>其实在处理密钥时做了一次md5算法，并将前64位，十六进制表示的前16个字符作为密钥，如下图所示。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250628141226048.png?x-oss-process=style/img-to-webp" alt="image-20250628141226048"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250628141237502.png?x-oss-process=style/img-to-webp" alt="image-20250628141237502"></p>
<h2 id="1-8-hook-技巧"><a href="#1-8-hook-技巧" class="headerlink" title="1.8.hook 技巧"></a>1.8.hook 技巧</h2><h3 id="1-8-1-hook-用户输入组件"><a href="#1-8-1-hook-用户输入组件" class="headerlink" title="1.8.1.hook 用户输入组件"></a>1.8.1.hook 用户输入组件</h3><ul>
<li>Android开发通常回从EditText组件获取用户的输入信息，需要判断是否为空，通常使用的时TextUtils.isEmpty()方法，来判断用户输入的参数是否为空，那么我们就可以通过hook该方法，在方法内部获取堆栈信息。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">myString</span> <span class="operator">=</span> <span class="string">&quot;hello, world&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (TextUtils.isEmpty(myString)) &#123;</span><br><span class="line">    <span class="comment">// 字符串为空</span></span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// 字符串不为空</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>针对这个特性进行hook</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">TextUtils</span> = java.<span class="title function_">use</span>(<span class="string">&quot;android.text,TextUtils&quot;</span>);</span><br><span class="line">    <span class="title class_">TextUtils</span>.<span class="property">isEmpty</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;TextUtils--&gt;&quot;</span> , aa);</span><br><span class="line">        retrun <span class="variable language_">this</span>.<span class="title function_">isEmpty</span>(aa);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="1-8-2-hook-JSON对象"><a href="#1-8-2-hook-JSON对象" class="headerlink" title="1.8.2.hook JSON对象"></a>1.8.2.hook JSON对象</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hook JSONObject 构造方法</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">JSON</span><span class="built_in">Object</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;org.json.JSONObject&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Hook 所有重载的构造函数</span></span><br><span class="line">    <span class="title class_">JSON</span><span class="built_in">Object</span>.<span class="property">$init</span>.<span class="property">overloads</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">overload</span>) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 打印调用堆栈和参数</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\n[JSONObject] Constructor called:&#x27;</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Arguments: &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>));</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Stack trace: &#x27;</span> + <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Exception&quot;</span>).$new()));</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 调用原始构造函数</span></span><br><span class="line">                <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="property">$init</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 打印构造后的JSON内容</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Created JSON: &#x27;</span> + result.<span class="title function_">toString</span>(<span class="number">2</span>));</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error in JSONObject hook: &#x27;</span> + e);</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$init</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hook toString() 方法</span></span><br><span class="line">    <span class="title class_">JSON</span><span class="built_in">Object</span>.<span class="property">toString</span>.<span class="title function_">overload</span>().<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> original = <span class="variable language_">this</span>.<span class="title function_">toString</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\n[JSONObject.toString()]&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Original: &#x27;</span> + original);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 修改示例：给所有JSON对象添加新字段</span></span><br><span class="line">            <span class="keyword">var</span> modified = original.<span class="title function_">replace</span>(<span class="regexp">/\&#125;$/</span>, <span class="string">&#x27;, &quot;hooked&quot;:true&#125;&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Modified: &#x27;</span> + modified);</span><br><span class="line">            <span class="keyword">return</span> modified;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(e);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">toString</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hook JSONArray 的 put 方法</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">JSON</span><span class="built_in">Array</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;org.json.JSONArray&#x27;</span>);</span><br><span class="line">    <span class="title class_">JSON</span><span class="built_in">Array</span>.<span class="property">put</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.Object&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\n[JSONArray.put]&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Inserting value: &#x27;</span> + value);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">put</span>(value);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Hook JSON 解析入口 (示例)</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">JSON</span>Tokener = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;org.json.JSONTokener&#x27;</span>);</span><br><span class="line">    <span class="title class_">JSON</span>Tokener.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">jsonStr</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\n[PARSING JSON]&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Raw JSON: &#x27;</span> + jsonStr);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.$init(jsonStr);</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>



<h3 id="1-8-3-hook-算法"><a href="#1-8-3-hook-算法" class="headerlink" title="1.8.3.hook 算法"></a>1.8.3.hook 算法</h3><ul>
<li>很多Android开发通常都是使用JAVA自带的包实现的加密或者摘要算法，因此我们可以直接通过hook java原生算法包的方法来获取摘要和加密的明文和密文内容。</li>
</ul>
<h4 id="1-8-3-1-hook-md5"><a href="#1-8-3-1-hook-md5" class="headerlink" title="1.8.3.1.hook md5"></a>1.8.3.1.hook md5</h4><ul>
<li>以下代码中就使用了MD5原生算法包。因此我们可以直接hook digest方法，这也是一种通用的方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> kotlin.UByte;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MD5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5Hash</span><span class="params">(String str)</span> <span class="keyword">throws</span> NoSuchAlgorithmException &#123;</span><br><span class="line">        <span class="type">byte</span>[] bArrDigest = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>).digest(str.getBytes());</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">byte</span> b : bArrDigest) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">hexString</span> <span class="operator">=</span> Integer.toHexString(b &amp; UByte.MAX_VALUE);</span><br><span class="line">            <span class="keyword">if</span> (hexString.length() == <span class="number">1</span>) &#123;</span><br><span class="line">                sb.append(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(hexString);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>hook 代码如下。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hook java md5</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">javaMD5</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// Hook MessageDigest 的 digest 方法</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">MessageDigest</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.security.MessageDigest&#x27;</span>);</span><br><span class="line">    <span class="title class_">MessageDigest</span>.<span class="property">digest</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">input</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将字节数组转换为 UTF-8 字符串</span></span><br><span class="line">        <span class="keyword">const</span> inputString = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).$new(input, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\nInput: &quot;</span> + inputString);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n=== MD5 Hook Called ===&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 原始调用</span></span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">digest</span>(input);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转换结果为十六进制字符串</span></span><br><span class="line">        <span class="keyword">const</span> hex = <span class="title class_">Array</span>.<span class="title function_">from</span>(result, <span class="function"><span class="params">byte</span> =&gt;</span></span><br><span class="line">            (<span class="string">&#x27;0&#x27;</span> + (byte &amp; <span class="number">0xFF</span>).<span class="title function_">toString</span>(<span class="number">16</span>)).<span class="title function_">slice</span>(-<span class="number">2</span>)).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MD5 Result: &quot;</span> + hex);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=========================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-8-3-2-hook-AES"><a href="#1-8-3-2-hook-AES" class="headerlink" title="1.8.3.2.hook AES"></a>1.8.3.2.hook AES</h4><ul>
<li>Android中AES加密代码示例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gaomu.fridatest.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.GCMParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AES</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">aesEncrypt</span><span class="params">(String str, String str2, String str3, String str4)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        validateHex(<span class="string">&quot;密钥&quot;</span>, str3, <span class="number">32</span>);</span><br><span class="line">        <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(hexToBytes(str3), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(getTransformation(str));</span><br><span class="line">        <span class="keyword">if</span> (str.equalsIgnoreCase(<span class="string">&quot;ECB&quot;</span>)) &#123;</span><br><span class="line">            cipher.init(<span class="number">1</span>, secretKeySpec);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            validateHex(<span class="string">&quot;IV&quot;</span>, str4, <span class="number">32</span>);</span><br><span class="line">            <span class="type">byte</span>[] bArrHexToBytes = hexToBytes(str4);</span><br><span class="line">            <span class="keyword">if</span> (str.equalsIgnoreCase(<span class="string">&quot;GCM&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">12</span>];</span><br><span class="line">                System.arraycopy(bArrHexToBytes, <span class="number">0</span>, bArr, <span class="number">0</span>, <span class="number">12</span>);</span><br><span class="line">                cipher.init(<span class="number">1</span>, secretKeySpec, <span class="keyword">new</span> <span class="title class_">GCMParameterSpec</span>(<span class="number">128</span>, bArr));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cipher.init(<span class="number">1</span>, secretKeySpec, <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(bArrHexToBytes));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Base64.getEncoder().encodeToString(cipher.doFinal(str2.getBytes(StandardCharsets.UTF_8)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>hook 示例</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hookJavaAes</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hookJavaAes</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 首先hookAES加密的明文部分</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Cipher</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.crypto.Cipher&quot;</span>);</span><br><span class="line">    <span class="title class_">Cipher</span>.<span class="property">doFinal</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">input</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> plainText = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).$new(input, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\nAES Encrypt plainText: -&gt;&gt;&gt;&gt; &quot;</span>, plainText);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(input);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 再hook密钥</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">SecretKeySpec</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.crypto.spec.SecretKeySpec&quot;</span>);</span><br><span class="line">    <span class="title class_">SecretKeySpec</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>, <span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">keyBytes, alg</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> keyHex = <span class="title function_">bytesToHex</span>(keyBytes);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\nAES Encrypt keyHex: -&gt;&gt;&gt;&gt;&quot;</span>, keyHex);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\nAES Encrypt ALG: -&gt;&gt;&gt;&gt;&quot;</span>, alg);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.$init(keyBytes, alg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// hook IV</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">IvParameterSpec</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.crypto.spec.IvParameterSpec&quot;</span>);</span><br><span class="line">    <span class="title class_">IvParameterSpec</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">keyBytes</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> ivHex = <span class="title function_">bytesToHex</span>(keyBytes);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\nAES Encrypt ivHex: -&gt;&gt;&gt;&gt;&quot;</span>, ivHex);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.$init(keyBytes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将hook算法内部参数Byte数组转换为hex字符串</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bytesToHex</span>(<span class="params">bytes</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(bytes, <span class="function"><span class="params">byte</span> =&gt;</span></span><br><span class="line">        (<span class="string">&#x27;0&#x27;</span> + (byte &amp; <span class="number">0xFF</span>).<span class="title function_">toString</span>(<span class="number">16</span>)).<span class="title function_">slice</span>(-<span class="number">2</span>)</span><br><span class="line">    ).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-抓包检测"><a href="#2-抓包检测" class="headerlink" title="2.抓包检测"></a>2.抓包检测</h1><h2 id="几种证书验证的机制"><a href="#几种证书验证的机制" class="headerlink" title="几种证书验证的机制"></a>几种证书验证的机制</h2><h3 id="1-常规HTTPS"><a href="#1-常规HTTPS" class="headerlink" title="1.常规HTTPS"></a>1.常规HTTPS</h3><ul>
<li>HTTPS认证为客户端获取服务端证书，加密请求服务端。</li>
<li>因此只需要利用中间人攻击，让客户端使用中间人伪造的证书，加密请求，中间人再截获请求解密，再使用服务端端证书加密请求服务器，就实现了中间人攻击，窃取或者伪造传输数据。具体可以查看这篇文章<a href="https://blog.takake.com/posts/20917/">【HTTPS加密流程以及抓包原理解析】</a></li>
<li>常见的中间人攻击的抓包软件有burpsutie、Charles、yakit。</li>
<li>针对这种常规的SSL证书加密只需要安装普通用户证书即可</li>
</ul>
<h3 id="2-系统证书验证"><a href="#2-系统证书验证" class="headerlink" title="2.系统证书验证"></a>2.系统证书验证</h3><ul>
<li><strong>Android7</strong>以上安装系统证书，因此需要使用openssl计算hash，并且移动到系统证书目录，然后命名为hash.0 移动到android的&#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts目录下，同时添加对等权限。如果遇到只读文件系统问题，可以使用MT文件管理工具进行移动。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成哈希并重命名hash.0</span></span><br><span class="line">┌──(kali㉿kali)-[~/Desktop/workplace]</span><br><span class="line">└─$ openssl x509 -subject_hash_old -<span class="keyword">in</span> Charles.pem</span><br><span class="line">3b5566cf</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">....</span><br><span class="line"><span class="built_in">mv</span> Charles.pem 3b5566cf.0</span><br><span class="line"><span class="comment"># 或者 openssl x509 -inform PEM -subject_hash_old -in myCA.crt </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送证书到设备</span></span><br><span class="line">adb root</span><br><span class="line">adb remount</span><br><span class="line">adb push 3b5566cf.0 /system/etc/security/cacerts/</span><br><span class="line">adb shell <span class="built_in">chmod</span> 644 /system/etc/security/cacerts/3b5566cf.0</span><br></pre></td></tr></table></figure>

<h3 id="3-SSL-pinning单向证书认证"><a href="#3-SSL-pinning单向证书认证" class="headerlink" title="3.SSL pinning单向证书认证"></a>3.SSL pinning单向证书认证</h3><ul>
<li><p>即客户端会强制验证服务端证书是否为对应证书，否则不接受该证书。</p>
</li>
<li><p>对于SSL pinning单向证书认证问题，可以使用利用SSL Unpinning 脚本 hook绕过过代码检测，或者一些其他的SSL检测。</p>
</li>
<li><p>还可以通过frida hook URL 将HTTPS协议转换为HTTP</p>
</li>
</ul>
<h3 id="4-双向认证"><a href="#4-双向认证" class="headerlink" title="4.双向认证"></a>4.双向认证</h3><ul>
<li>通常我们SSL传输加密都是服务端返回证书客户端使用证书中的公钥进行加密，但是在一些高安全要求的情况下，可能会使用双向证书校验，也就是说不仅服务端返回公钥证书，同时客户端APK中也存在一个证书文件，用于对服务端的证书进行证书验证。</li>
<li>一般APK中的证书后缀名为.p12</li>
<li>双向认证如何绕过也可以看这个<a href="https://blog.takake.com/posts/20917/#3-%E7%BB%95%E8%BF%87%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81%E7%9A%84%E6%96%B9%E6%B3%95">【双向证书绕过】</a></li>
</ul>
<h3 id="5-自定义协议或者TCP"><a href="#5-自定义协议或者TCP" class="headerlink" title="5.自定义协议或者TCP"></a>5.自定义协议或者TCP</h3><ul>
<li>直接使用frida hook请求参数和响应</li>
</ul>
<h3 id="6-VPN检测"><a href="#6-VPN检测" class="headerlink" title="6.VPN检测"></a>6.VPN检测</h3><ul>
<li><p>这个没啥用，就算不能不能用VPN也可以使用代理去抓也是一样。</p>
</li>
<li><p>可以直接使用frida hook VPN检测代码，或者直接hook请求参数和响应。</p>
</li>
</ul>
<h2 id="3-1-如何判断一个APK是否加壳？"><a href="#3-1-如何判断一个APK是否加壳？" class="headerlink" title="3.1.如何判断一个APK是否加壳？"></a>3.1.如何判断一个APK是否加壳？</h2><h3 id="3-1-1-dex完整性校验"><a href="#3-1-1-dex完整性校验" class="headerlink" title="3.1.1.dex完整性校验"></a>3.1.1.dex完整性校验</h3><ul>
<li>使用<code>dexdump</code>解析Dex头信息，若显示<code>code_offset=0</code>或指令段全零，表明代码被加密。</li>
</ul>
<h3 id="3-1-2-AndroidManifest-xml"><a href="#3-1-2-AndroidManifest-xml" class="headerlink" title="3.1.2.AndroidManifest.xml"></a>3.1.2.<strong>AndroidManifest.xml</strong></h3><ul>
<li><strong>启动类替换</strong>：主Activity指向壳的代理类（如<code>com.stub.StubApp</code>），而非业务逻辑类。</li>
<li><strong>权限声明异常</strong>：声明<code>android:extractNativeLibs=&quot;false&quot;</code>（防止so解密到磁盘）。</li>
</ul>
<h2 id="3-2-查壳方式"><a href="#3-2-查壳方式" class="headerlink" title="3.2.查壳方式"></a>3.2.查壳方式</h2><h3 id="3-2-1-凭借so文件特征"><a href="#3-2-1-凭借so文件特征" class="headerlink" title="3.2.1.凭借so文件特征"></a>3.2.1.凭借so文件特征</h3><p>​	如果加壳会在apk的lib目录下生成.so文件，根据文件名称进行判断。</p>
<table>
<thead>
<tr>
<th align="left"><strong>加固厂商</strong></th>
<th align="left"><strong>特有标识</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">腾讯乐固</td>
<td align="left"><code>libshellx-*.so</code></td>
</tr>
<tr>
<td align="left">360加固</td>
<td align="left"><code>libjiagu*.so</code>、<code>/assets/jiami</code></td>
</tr>
<tr>
<td align="left">百度加固</td>
<td align="left"><code>libbaiduprotect.so</code></td>
</tr>
<tr>
<td align="left">阿里聚安全</td>
<td align="left"><code>libmobisec.so</code></td>
</tr>
</tbody></table>
<h3 id="3-2-2-查壳工具"><a href="#3-2-2-查壳工具" class="headerlink" title="3.2.2.查壳工具"></a>3.2.2.查壳工具</h3><ul>
<li><p>使用查壳工具快速检测</p>
</li>
<li><p><strong>查壳工具</strong></p>
<ul>
<li><p><strong>GDA</strong>：直接拖入APK，自动识别加固类型及版本（如”Tencent Legu 3.9.0”）。</p>
</li>
<li><p><strong>PKiD</strong>：基于机器学习的查壳工具，检测未知壳变种。</p>
</li>
<li><p><strong>APKDeepLens</strong>：扫描OWASP漏洞同时输出加壳信息。</p>
</li>
</ul>
</li>
</ul>
<p>例如PKID查壳工具：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/markdown-img/image-20250629102645853.png?x-oss-process=style/img-to-webp" alt="image-20250629102645853"></p>
<h2 id="3-3-脱壳方式"><a href="#3-3-脱壳方式" class="headerlink" title="3.3.脱壳方式"></a>3.3.脱壳方式</h2><h3 id="3-3-1-都有哪些壳"><a href="#3-3-1-都有哪些壳" class="headerlink" title="3.3.1.都有哪些壳"></a>3.3.1.都有哪些壳</h3><ul>
<li>壳的发展</li>
<li>壳的种类非常多，根据其种类不同，使用的技术也不同，这里稍微简单分个类<ol>
<li>一代整体型壳，采用Dex整体加密，动态加载运行的机制。</li>
<li>二代函数抽取型壳，粒度更细，将方法单独抽取出来，加密保存，解密执行。</li>
<li>三代 VMP、Dex2C壳:独立虚拟机解释执行、语义等价语浙迁移，强度最高。</li>
</ol>
</li>
</ul>
<h3 id="3-3-2-frida-dexdump"><a href="#3-3-2-frida-dexdump" class="headerlink" title="3.3.2.frida-dexdump"></a>3.3.2.frida-dexdump</h3><ul>
<li><p>我们可以使用开源工具frida-dexdump做一些脱一些简单的壳</p>
</li>
<li><p>可以在<a target="_blank" rel="noopener" href="https://github.com/hluwa/frida-dexdump">github下载</a>也可以直接通过pip下载<code>pip install frida-dexdump</code></p>
</li>
<li><p>使用方法</p>
</li>
</ul>
<p>CLI arguments base on <a target="_blank" rel="noopener" href="https://github.com/frida/frida-tools">frida-tools</a>, you can quickly dump the foreground application like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida-dexdump -FU</span><br></pre></td></tr></table></figure>

<p>Or specify and spawn app like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida-dexdump -U -f com.app.pkgname</span><br></pre></td></tr></table></figure>

<p>Additionally, you can see in <code>-h</code> that the new options provided by frida-dexdump are:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-o OUTPUT, --output OUTPUT  Output folder path, default is <span class="string">&#x27;./&lt;appname&gt;/&#x27;</span>.</span><br><span class="line">-d, --deep-search           Enable deep search mode.</span><br><span class="line">--<span class="built_in">sleep</span> SLEEP               Waiting <span class="built_in">times</span> <span class="keyword">for</span> start, spawn mode default is 5s.</span><br></pre></td></tr></table></figure>

<p>When using, I suggest using the <code>-d, --deep-search</code> option, which may take more time, but the results will be more complete.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/hluwa/frida-dexdump/refs/heads/master/screenshot.png" alt="使用示例"></p>
<ul>
<li>之后通过运行app脱壳，生成大量的dex文件。</li>
<li>这些dex文件都可以通过GDA&#x2F;JDX-GUI直接阅读。</li>
<li>但是可能生成的文件较多，因此需要过滤，通过检索存在主类的dex文件，之后只需要重点阅读存在主类的dex文件即可，无需再阅读其他的dex文件。</li>
<li>windows使用<code>findstr /s /i /m &quot;主类全类名&quot; *</code>搜索所有存在主类的dex文件。</li>
</ul>
<h3 id="3-3-3-加固对抗-Frida-的常见手段"><a href="#3-3-3-加固对抗-Frida-的常见手段" class="headerlink" title="3.3.3.加固对抗 Frida 的常见手段"></a>3.3.3.加固对抗 Frida 的常见手段</h3><p>加固厂商会采用多种技术阻止 Hook：</p>
<ol>
<li><strong>反调试检测</strong>：扫描 <code>/proc/self/maps</code> 查找 <code>frida-agent</code> 特征</li>
<li><strong>端口检测</strong>：检查 27042&#x2F;27043 等 Frida 默认端口</li>
<li><strong>线程监控</strong>：检测异常线程（如 Frida 的 <code>gum-js-loop</code>）</li>
<li><strong>代码混淆</strong>：关键逻辑转移到 Native 层（SO 文件）</li>
<li><strong>双进程守护</strong>：监控进程状态，崩溃即重启</li>
</ol>
<h2 id="3-4-so文件处理"><a href="#3-4-so文件处理" class="headerlink" title="3.4.so文件处理"></a>3.4.so文件处理</h2><ul>
<li><p>so文件和dll文件一样是属于二进制动态链接库。</p>
</li>
<li><p>如果在分析代码时发现System.loadLibrary(“”)方法，其实就算在加载so文件。</p>
</li>
<li><p>并且使用Native修饰的方法都是在so文件中实现的，如果需要分析so文件我们就需要使用IDA工具进行逆向分析。</p>
</li>
</ul>
<h2 id="3-5-Smali-基础语法详解"><a href="#3-5-Smali-基础语法详解" class="headerlink" title="3.5.Smali 基础语法详解"></a>3.5.Smali 基础语法详解</h2><p>Smali 是 Android 平台上 Dalvik 虚拟机的汇编语言，用于表示 <code>.dex</code> 文件中的字节码指令。掌握 Smali 是 Android 逆向工程的基础，下面详细介绍其核心语法：</p>
<hr>
<h3 id="一、文件结构与类定义"><a href="#一、文件结构与类定义" class="headerlink" title="一、文件结构与类定义"></a>一、文件结构与类定义</h3><h4 id="1-类声明"><a href="#1-类声明" class="headerlink" title="1. 类声明"></a>1. 类声明</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.class</span> &lt;访问修饰符&gt; &lt;类名&gt;;       <span class="comment"># 类定义</span></span><br><span class="line"><span class="keyword">.super</span> &lt;父类&gt;;                  <span class="comment"># 继承关系</span></span><br><span class="line"><span class="keyword">.source</span> <span class="string">&quot;SourceFile&quot;</span>            <span class="comment"># 源文件名（可选）</span></span><br></pre></td></tr></table></figure>

<p><strong>示例</strong>：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.class</span><span class="keyword"> public</span> <span class="class">Lcom/example/MyClass;</span>  <span class="comment"># 公共类</span></span><br><span class="line"><span class="keyword">.super</span> <span class="class">Ljava/lang/Object;</span>           <span class="comment"># 继承 Object</span></span><br><span class="line"><span class="keyword">.source</span> <span class="string">&quot;MyClass.java&quot;</span>              <span class="comment"># 源文件</span></span><br></pre></td></tr></table></figure>

<h4 id="2-接口实现"><a href="#2-接口实现" class="headerlink" title="2. 接口实现"></a>2. 接口实现</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.implements</span> &lt;接口名&gt;;              <span class="comment"># 实现接口</span></span><br></pre></td></tr></table></figure>

<h4 id="3-注解"><a href="#3-注解" class="headerlink" title="3. 注解"></a>3. 注解</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.annotation</span> &lt;注解类型&gt;             <span class="comment"># 注解声明</span></span><br><span class="line">    key = value                 <span class="comment"># 键值对</span><span class="keyword"></span></span><br><span class="line"><span class="keyword">.end annotation</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="二、字段定义-Fields"><a href="#二、字段定义-Fields" class="headerlink" title="二、字段定义 (Fields)"></a>二、字段定义 (Fields)</h3><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.field</span> &lt;访问修饰符&gt; [static] [final] &lt;字段名&gt;:&lt;类型&gt;</span><br></pre></td></tr></table></figure>

<p><strong>示例</strong>：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.field</span><span class="keyword"> private</span> count:I               <span class="comment"># 私有整型字段</span></span><br><span class="line"><span class="keyword">.field</span><span class="keyword"> public</span><span class="keyword"> static</span><span class="keyword"> final</span> TAG:<span class="class">Ljava/lang/String;</span>  <span class="comment"># 公共静态常量</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="三、方法定义-Methods"><a href="#三、方法定义-Methods" class="headerlink" title="三、方法定义 (Methods)"></a>三、方法定义 (Methods)</h3><h4 id="1-方法声明"><a href="#1-方法声明" class="headerlink" title="1. 方法声明"></a>1. 方法声明</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.method</span> &lt;访问修饰符&gt; [static] &lt;方法名&gt;(&lt;参数类型&gt;)&lt;返回类型&gt;</span><br><span class="line"><span class="keyword">    .registers</span> &lt;N&gt;               <span class="comment"># 使用的寄存器总数</span></span><br><span class="line"><span class="keyword">    .locals</span> &lt;M&gt;                  <span class="comment"># 本地寄存器数量（不包括参数）</span></span><br><span class="line">    [.param annotations]         <span class="comment"># 参数注解（可选）</span></span><br><span class="line">    [代码指令]<span class="keyword"></span></span><br><span class="line"><span class="keyword">.end method</span></span><br></pre></td></tr></table></figure>

<p><strong>示例</strong>：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.method</span><span class="keyword"> public</span><span class="keyword"> static</span> main([<span class="class">Ljava/lang/String;</span>)V</span><br><span class="line"><span class="keyword">    .registers</span> 5                 <span class="comment"># 使用 5 个寄存器</span></span><br><span class="line"><span class="keyword">    .locals</span> 2                    <span class="comment"># 本地寄存器：2 个</span></span><br><span class="line"><span class="keyword">    .param</span> p0, <span class="string">&quot;args&quot;</span>            <span class="comment"># 参数注解</span></span><br><span class="line">    </span><br><span class="line">   <span class="built_in"> const-string </span>v0, <span class="string">&quot;Hello&quot;</span></span><br><span class="line">   <span class="built_in"> sget-object </span>v1, <span class="class">Ljava/lang/System;</span>-&gt;out:<span class="class">Ljava/io/PrintStream;</span></span><br><span class="line">   <span class="built_in"> invoke-virtual </span>&#123;v1, v0&#125;, <span class="class">Ljava/io/PrintStream;</span>-&gt;println(<span class="class">Ljava/lang/String;</span>)V</span><br><span class="line">    </span><br><span class="line">   <span class="built_in"> return-void</span></span><br><span class="line"><span class="built_in"></span><span class="keyword">.end method</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="四、数据类型"><a href="#四、数据类型" class="headerlink" title="四、数据类型"></a>四、数据类型</h3><h4 id="1-基本类型"><a href="#1-基本类型" class="headerlink" title="1. 基本类型"></a>1. 基本类型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>符号</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>void</td>
<td>V</td>
<td><code>()V</code></td>
</tr>
<tr>
<td>boolean</td>
<td>Z</td>
<td><code>Z</code></td>
</tr>
<tr>
<td>byte</td>
<td>B</td>
<td><code>B</code></td>
</tr>
<tr>
<td>short</td>
<td>S</td>
<td><code>S</code></td>
</tr>
<tr>
<td>int</td>
<td>I</td>
<td><code>I</code></td>
</tr>
<tr>
<td>long</td>
<td>J</td>
<td><code>J</code></td>
</tr>
<tr>
<td>float</td>
<td>F</td>
<td><code>F</code></td>
</tr>
<tr>
<td>double</td>
<td>D</td>
<td><code>D</code></td>
</tr>
<tr>
<td>char</td>
<td>C</td>
<td><code>C</code></td>
</tr>
</tbody></table>
<h4 id="2-对象类型"><a href="#2-对象类型" class="headerlink" title="2. 对象类型"></a>2. 对象类型</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">L&lt;包名&gt;/&lt;类名&gt;;</span>    <span class="comment"># 完整类名</span></span><br></pre></td></tr></table></figure>

<p><strong>示例</strong>：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">Ljava/lang/String;</span>   <span class="comment"># java.lang.String</span></span><br><span class="line"><span class="class">Landroid/app/Activity;</span>  <span class="comment"># android.app.Activity</span></span><br></pre></td></tr></table></figure>

<h4 id="3-数组类型"><a href="#3-数组类型" class="headerlink" title="3. 数组类型"></a>3. 数组类型</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[&lt;类型&gt;            <span class="comment"># 一维数组</span></span><br><span class="line">[[&lt;类型&gt;           <span class="comment"># 二维数组</span></span><br></pre></td></tr></table></figure>

<p><strong>示例</strong>：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[I                 <span class="comment"># int[]</span></span><br><span class="line">[[<span class="class">Ljava/lang/String;</span>  <span class="comment"># String[][]</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="五、寄存器操作"><a href="#五、寄存器操作" class="headerlink" title="五、寄存器操作"></a>五、寄存器操作</h3><h4 id="1-寄存器命名"><a href="#1-寄存器命名" class="headerlink" title="1. 寄存器命名"></a>1. 寄存器命名</h4><ul>
<li><code>v0</code>, <code>v1</code>, <code>v2</code>… - 本地寄存器</li>
<li><code>p0</code>, <code>p1</code>, <code>p2</code>… - 参数寄存器（p0 在非静态方法中是 this）</li>
</ul>
<h4 id="2-常用指令"><a href="#2-常用指令" class="headerlink" title="2. 常用指令"></a>2. 常用指令</h4><table>
<thead>
<tr>
<th>指令</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>move vA, vB</code></td>
<td>寄存器间移动值</td>
<td><code>move v1, v0</code></td>
</tr>
<tr>
<td><code>const vA, value</code></td>
<td>加载常量</td>
<td><code>const v0, 0x1</code></td>
</tr>
<tr>
<td><code>const-string vA, &quot;str&quot;</code></td>
<td>加载字符串常量</td>
<td><code>const-string v0, &quot;OK&quot;</code></td>
</tr>
<tr>
<td><code>const-class vA, Lcls;</code></td>
<td>加载类引用</td>
<td><code>const-class v0, Ljava/lang/Object;</code></td>
</tr>
</tbody></table>
<hr>
<h3 id="六、方法调用"><a href="#六、方法调用" class="headerlink" title="六、方法调用"></a>六、方法调用</h3><h4 id="1-调用类型"><a href="#1-调用类型" class="headerlink" title="1. 调用类型"></a>1. 调用类型</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invoke-&lt;类型&gt; &#123;参数&#125;, &lt;方法签名&gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>类型</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td><code>static</code></td>
<td>静态方法</td>
</tr>
<tr>
<td><code>virtual</code></td>
<td>虚方法（非私有）</td>
</tr>
<tr>
<td><code>direct</code></td>
<td>直接方法（私有&#x2F;构造方法）</td>
</tr>
<tr>
<td><code>interface</code></td>
<td>接口方法</td>
</tr>
<tr>
<td><code>super</code></td>
<td>调用父类方法</td>
</tr>
</tbody></table>
<h4 id="2-方法签名格式"><a href="#2-方法签名格式" class="headerlink" title="2. 方法签名格式"></a>2. 方法签名格式</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">Lpackage/name/ObjectName;</span>-&gt;methodName(<span class="class">LparamTypes;</span>)ReturnType</span><br></pre></td></tr></table></figure>

<p><strong>示例</strong>：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调用 System.out.println(&quot;Hello&quot;)</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">sget-object </span>v0, <span class="class">Ljava/lang/System;</span>-&gt;out:<span class="class">Ljava/io/PrintStream;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">const-string </span>v1, <span class="string">&quot;Hello&quot;</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">invoke-virtual </span>&#123;v0, v1&#125;, <span class="class">Ljava/io/PrintStream;</span>-&gt;println(<span class="class">Ljava/lang/String;</span>)V</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="七、控制流指令"><a href="#七、控制流指令" class="headerlink" title="七、控制流指令"></a>七、控制流指令</h3><h4 id="1-条件分支"><a href="#1-条件分支" class="headerlink" title="1. 条件分支"></a>1. 条件分支</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if-&lt;cond&gt; vA, vB,<span class="keyword"> :label</span>   <span class="comment"># 条件跳转</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>条件</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>eq</code></td>
<td>等于 (&#x3D;&#x3D;)</td>
</tr>
<tr>
<td><code>ne</code></td>
<td>不等于 (!&#x3D;)</td>
</tr>
<tr>
<td><code>lt</code></td>
<td>小于 (&lt;)</td>
</tr>
<tr>
<td><code>le</code></td>
<td>小于等于 (&lt;&#x3D;)</td>
</tr>
<tr>
<td><code>gt</code></td>
<td>大于 (&gt;)</td>
</tr>
<tr>
<td><code>ge</code></td>
<td>大于等于 (&gt;&#x3D;)</td>
</tr>
<tr>
<td><code>eqz</code></td>
<td>等于零 (&#x3D;&#x3D;0)</td>
</tr>
<tr>
<td><code>nez</code></td>
<td>不等于零 (!&#x3D;0)</td>
</tr>
</tbody></table>
<h4 id="2-无条件跳转"><a href="#2-无条件跳转" class="headerlink" title="2. 无条件跳转"></a>2. 无条件跳转</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goto<span class="keyword"> :label</span>           <span class="comment"># 无条件跳转</span></span><br></pre></td></tr></table></figure>

<h4 id="3-Switch-语句"><a href="#3-Switch-语句" class="headerlink" title="3. Switch 语句"></a>3. Switch 语句</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">packed-switch vA,<span class="keyword"> :switch_table</span>   <span class="comment"># 紧凑switch</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">sparse-switch </span>vA,<span class="keyword"> :switch_table</span>   <span class="comment"># 稀疏switch</span></span><br></pre></td></tr></table></figure>

<h4 id="4-标签定义"><a href="#4-标签定义" class="headerlink" title="4. 标签定义"></a>4. 标签定义</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:label_name            <span class="comment"># 跳转标签</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="八、异常处理"><a href="#八、异常处理" class="headerlink" title="八、异常处理"></a>八、异常处理</h3><h4 id="1-异常捕获"><a href="#1-异常捕获" class="headerlink" title="1. 异常捕获"></a>1. 异常捕获</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.catch</span> &lt;异常类型&gt; &#123;from_label&#125; &#123;to_label&#125; &#123;target_label&#125;</span><br></pre></td></tr></table></figure>

<p><strong>示例</strong>：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">:try_start</span><br><span class="line">    <span class="comment"># 可能抛出异常的代码</span><span class="keyword"></span></span><br><span class="line"><span class="keyword">:try_end</span></span><br><span class="line"><span class="keyword">.catch</span> <span class="class">Ljava/lang/Exception;</span> &#123;:try_start ..<span class="keyword"> :try_end</span>&#125;<span class="keyword"> :catch_block</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">:catch_block</span></span><br><span class="line">    <span class="comment"># 异常处理代码</span></span><br></pre></td></tr></table></figure>

<h4 id="2-抛出异常"><a href="#2-抛出异常" class="headerlink" title="2. 抛出异常"></a>2. 抛出异常</h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">throw vA               <span class="comment"># 抛出vA寄存器中的异常</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="九、调试信息"><a href="#九、调试信息" class="headerlink" title="九、调试信息"></a>九、调试信息</h3><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.line</span> &lt;行号&gt;           <span class="comment"># 源代码行号</span></span><br><span class="line"><span class="keyword">.local</span> vA, <span class="string">&quot;name&quot;</span>:&lt;type&gt;  <span class="comment"># 局部变量名和类型</span></span><br><span class="line"><span class="keyword">.param</span> pA, <span class="string">&quot;name&quot;</span>     <span class="comment"># 参数名</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="十、完整方法示例"><a href="#十、完整方法示例" class="headerlink" title="十、完整方法示例"></a>十、完整方法示例</h3><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.method</span><span class="keyword"> public</span> sum(II)I</span><br><span class="line"><span class="keyword">    .registers</span> 5       <span class="comment"># 使用2个寄存器 (v0, v1)</span></span><br><span class="line"><span class="keyword">    .param</span> p1, <span class="string">&quot;a&quot;</span>     <span class="comment"># 参数a (在p1)</span></span><br><span class="line"><span class="keyword">    .param</span> p2, <span class="string">&quot;b&quot;</span>     <span class="comment"># 参数b (在p2)</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">    .line</span> 10           <span class="comment"># 来自第10行代码</span></span><br><span class="line">   <span class="built_in"> add-int </span>v0, p1, p2 <span class="comment"># v0 = a + b</span></span><br><span class="line">    </span><br><span class="line">   <span class="built_in"> return </span>v0          <span class="comment"># 返回结果</span><span class="keyword"></span></span><br><span class="line"><span class="keyword">.end method</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="学习建议"><a href="#学习建议" class="headerlink" title="学习建议"></a>学习建议</h3><ol>
<li><p><strong>实践操作</strong>：使用 apktool 反编译 APK，查看生成的 smali 代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d app.apk -o output_dir</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>工具辅助</strong>：</p>
<ul>
<li>Jadx：尝试将 smali 转回 Java</li>
<li>Bytecode Viewer：可视化分析</li>
<li>Android Studio + smalidea 插件：调试 smali 代码</li>
</ul>
</li>
<li><p><strong>参考资源</strong>：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://source.android.com/devices/tech/dalvik/dalvik-bytecode">Dalvik 字节码官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/JesusFreke/smali/wiki/SmaliBaksmali">Smali 语法速查表</a></li>
</ul>
</li>
</ol>
<p>掌握 Smali 语法需要实践积累，建议从简单的 APK 开始分析，逐步理解寄存器操作和控制流结构。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">Takake</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.takake.com/posts/44081/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.takake.com/posts/44081/')">安卓逆向技术</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/red_cross.png?x-oss-process=style/img-to-webp" alt="红十字会"/></a><div class="post-qr-code-desc">红十字会</div></li><li class="reward-item"><a href="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/logo.png?x-oss-process=style/img-to-webp" alt="LOGO"/></a><div class="post-qr-code-desc">LOGO</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.takake.com/posts/44081/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=安卓逆向技术&amp;url=https://blog.takake.com/posts/44081/&amp;pic=https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/5c4406f679dc69b549b48fa6_p17s2tfgc31jte13d51pea1l2oblr3.png?x-oss-process=style/img-to-webp" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.takake.com" target="_blank">高木のBlog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/APK/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>APK<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/JAVA/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>JAVA<span class="tagsPageCount">6</span></a><a class="post-meta__box__tags" href="/tags/%E9%80%86%E5%90%91/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>逆向<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/%E5%AE%89%E5%8D%93/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>安卓<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/AI%20Infra%20feature%20image-1.png?x-oss-process=style/img-to-webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/18965/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/5c4406f679dc69b549b48fa6_p17s2tfgc31jte13d51pea1l2oblr3.png?x-oss-process=style/img-to-webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Android-JAVA开发基础</div></div></a></div><div class="next-post pull-right"><a href="/posts/16167/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/AI%20Infra%20feature%20image-1.png?x-oss-process=style/img-to-webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">提示词注入攻击(Prompt Injecting)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/18965/" title="Android-JAVA开发基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/5c4406f679dc69b549b48fa6_p17s2tfgc31jte13d51pea1l2oblr3.png?x-oss-process=style/img-to-webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-16</div><div class="title">Android-JAVA开发基础</div></div></a></div><div><a href="/posts/26566/" title="JAVA反射"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/java_logo_icon_168609.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-01-30</div><div class="title">JAVA反射</div></div></a></div><div><a href="/posts/60615/" title="JAVA内存马"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/java_logo_icon_168609.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-10</div><div class="title">JAVA内存马</div></div></a></div><div><a href="/posts/37606/" title="基于某电力系统传输加解密操作BP插件编写"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/3477bbcf5d315abda18ef35f71624002.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-06</div><div class="title">基于某电力系统传输加解密操作BP插件编写</div></div></a></div><div><a href="/posts/50413/" title="类的动态加载机制"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/java_logo_icon_168609.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-18</div><div class="title">类的动态加载机制</div></div></a></div><div><a href="/posts/56203/" title="WX小程序渗透"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/170_a_6661_52f20a56.jpg?x-oss-process=style/img-to-webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-29</div><div class="title">WX小程序渗透</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/avtor.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://emotion.acs.pw/emotion/Heo-100/%E6%BB%91%E7%A8%BD.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">网络安全、开发、人工智能</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Takake</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/takakie" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/3494356843497618" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">防疫指南：菊花上插葱，新冠去无踪✌️</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/645fa415e869402.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-frida"><span class="toc-number">1.</span> <span class="toc-text">1.frida</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">1.1.安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%AF%81%E4%B9%A6"><span class="toc-number">1.1.1.</span> <span class="toc-text">安装证书</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">1.2.基础命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">1.3.操作模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-Attach%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1.Attach模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-Spawn%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2.Spawn模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-%E4%B8%A4%E8%80%85%E5%AF%B9%E6%AF%94"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.3.3.两者对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AB%AF%E5%8F%A3%E5%90%AF%E5%8A%A8"><span class="toc-number">1.3.4.</span> <span class="toc-text">1.3.4.自定义端口启动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-frida%E5%B8%B8%E7%94%A8%E5%85%B3%E9%94%AE%E8%AF%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text">1.4.frida常用关键词解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Frida-%E8%84%9A%E6%9C%AC%E5%B8%B8%E7%94%A8%E5%85%B3%E9%94%AE%E8%AF%8D%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="toc-number">1.4.1.</span> <span class="toc-text">Frida 脚本常用关键词深度解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Java-%E5%AF%B9%E8%B1%A1-Android-Java-%E4%BA%A4%E4%BA%92"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">1. Java 对象 (Android Java 交互)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Interceptor-%E5%87%BD%E6%95%B0%E6%8B%A6%E6%88%AA"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">2. Interceptor (函数拦截)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Module-%E6%A8%A1%E5%9D%97%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">3. Module (模块操作)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Process-%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">4. Process (进程控制)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-Memory-%E5%86%85%E5%AD%98%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.1.5.</span> <span class="toc-text">5. Memory (内存操作)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-ptr-%E6%8C%87%E9%92%88%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.1.6.</span> <span class="toc-text">6. ptr (指针操作)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-NativeFunction-%E8%B0%83%E7%94%A8%E5%8E%9F%E7%94%9F%E5%87%BD%E6%95%B0"><span class="toc-number">1.4.1.7.</span> <span class="toc-text">7. NativeFunction (调用原生函数)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-NativeCallback-%E5%88%9B%E5%BB%BA%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="toc-number">1.4.1.8.</span> <span class="toc-text">8. NativeCallback (创建回调函数)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-Thread-%E7%BA%BF%E7%A8%8B%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.1.9.</span> <span class="toc-text">9. Thread (线程操作)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-console-%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA"><span class="toc-number">1.4.1.10.</span> <span class="toc-text">10. console (日志输出)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-setImmediate-setTimeout-%E5%AE%9A%E6%97%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.1.11.</span> <span class="toc-text">11. setImmediate &#x2F; setTimeout (定时操作)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-recv-send-%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1"><span class="toc-number">1.4.1.12.</span> <span class="toc-text">12. recv &#x2F; send (进程通信)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-Frida-%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.4.1.13.</span> <span class="toc-text">13. Frida 核心对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14-Stalker-%E6%8C%87%E4%BB%A4%E7%BA%A7%E8%B7%9F%E8%B8%AA"><span class="toc-number">1.4.1.14.</span> <span class="toc-text">14. Stalker (指令级跟踪)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-File-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.1.15.</span> <span class="toc-text">15. File (文件操作)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A8%A1%E5%BC%8F%EF%BC%9AHook-%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="toc-number">1.4.1.16.</span> <span class="toc-text">实战模式：Hook 链式调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="toc-number">1.4.1.17.</span> <span class="toc-text">调试技巧</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5"><span class="toc-number">1.4.1.18.</span> <span class="toc-text">常用代码片段</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D-Activity"><span class="toc-number">1.4.1.18.1.</span> <span class="toc-text">获取当前 Activity</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">1.4.1.18.2.</span> <span class="toc-text">修改返回值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.1.18.3.</span> <span class="toc-text">主动调用方法</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%AF%B9%E6%AF%94"><span class="toc-number">1.5.</span> <span class="toc-text">1.5.数据类型对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-1-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%AF%B9%E6%AF%94"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.5.1.基本数据类型对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-2-%E5%BC%95%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%AF%B9%E6%AF%94"><span class="toc-number">1.5.2.</span> <span class="toc-text">1.5.2.引用数据类型对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-frida-hook"><span class="toc-number">1.6.</span> <span class="toc-text">1.6.frida hook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-1-hook%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">1.6.1.hook示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-2-%E9%87%8D%E8%BD%BD%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">1.6.2.重载方法调用示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-3-%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.6.3.</span> <span class="toc-text">1.6.3.主动调用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-4-hook%E8%B0%83%E7%94%A8%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="toc-number">1.6.4.</span> <span class="toc-text">1.6.4.hook调用实例方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-5-hook%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">1.6.5.</span> <span class="toc-text">1.6.5.hook构造方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-6-hook%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-number">1.6.6.</span> <span class="toc-text">1.6.6.hook内部类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-7-%E6%9E%9A%E4%B8%BE%E6%89%80%E6%9C%89%E7%9A%84%E7%B1%BB"><span class="toc-number">1.6.7.</span> <span class="toc-text">1.6.7.枚举所有的类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-8-hook-map%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.6.8.</span> <span class="toc-text">1.6.8.hook map对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-9-hook-okhttp"><span class="toc-number">1.6.9.</span> <span class="toc-text">1.6.9.hook okhttp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-10-%E8%BE%93%E5%87%BA%E5%BD%93%E5%89%8D%E5%A0%86%E6%A0%88%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.10.</span> <span class="toc-text">1.6.10.输出当前堆栈信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-%E5%AE%9E%E6%88%98hook-%E5%98%9F%E5%98%9F%E7%89%9B"><span class="toc-number">1.7.</span> <span class="toc-text">1.7.实战hook 嘟嘟牛</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-1-%E5%8F%8D%E7%BC%96%E8%AF%91%E7%9A%84APK%E5%8C%85"><span class="toc-number">1.7.1.</span> <span class="toc-text">1.7.1.反编译的APK包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-2-hook-%E8%AE%B0%E5%BD%95"><span class="toc-number">1.7.2.</span> <span class="toc-text">1.7.2.hook 记录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-8-hook-%E6%8A%80%E5%B7%A7"><span class="toc-number">1.8.</span> <span class="toc-text">1.8.hook 技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-1-hook-%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E7%BB%84%E4%BB%B6"><span class="toc-number">1.8.1.</span> <span class="toc-text">1.8.1.hook 用户输入组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-2-hook-JSON%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.8.2.</span> <span class="toc-text">1.8.2.hook JSON对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-3-hook-%E7%AE%97%E6%B3%95"><span class="toc-number">1.8.3.</span> <span class="toc-text">1.8.3.hook 算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-8-3-1-hook-md5"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">1.8.3.1.hook md5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-8-3-2-hook-AES"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">1.8.3.2.hook AES</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%8A%93%E5%8C%85%E6%A3%80%E6%B5%8B"><span class="toc-number">2.</span> <span class="toc-text">2.抓包检测</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%A0%E7%A7%8D%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81%E7%9A%84%E6%9C%BA%E5%88%B6"><span class="toc-number">2.1.</span> <span class="toc-text">几种证书验证的机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B8%B8%E8%A7%84HTTPS"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.常规HTTPS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%B3%BB%E7%BB%9F%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.系统证书验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-SSL-pinning%E5%8D%95%E5%90%91%E8%AF%81%E4%B9%A6%E8%AE%A4%E8%AF%81"><span class="toc-number">2.1.3.</span> <span class="toc-text">3.SSL pinning单向证书认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81"><span class="toc-number">2.1.4.</span> <span class="toc-text">4.双向认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE%E6%88%96%E8%80%85TCP"><span class="toc-number">2.1.5.</span> <span class="toc-text">5.自定义协议或者TCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-VPN%E6%A3%80%E6%B5%8B"><span class="toc-number">2.1.6.</span> <span class="toc-text">6.VPN检测</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AAAPK%E6%98%AF%E5%90%A6%E5%8A%A0%E5%A3%B3%EF%BC%9F"><span class="toc-number">2.2.</span> <span class="toc-text">3.1.如何判断一个APK是否加壳？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-dex%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C"><span class="toc-number">2.2.1.</span> <span class="toc-text">3.1.1.dex完整性校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-AndroidManifest-xml"><span class="toc-number">2.2.2.</span> <span class="toc-text">3.1.2.AndroidManifest.xml</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%9F%A5%E5%A3%B3%E6%96%B9%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">3.2.查壳方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%87%AD%E5%80%9Fso%E6%96%87%E4%BB%B6%E7%89%B9%E5%BE%81"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.2.1.凭借so文件特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E6%9F%A5%E5%A3%B3%E5%B7%A5%E5%85%B7"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2.2.查壳工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E8%84%B1%E5%A3%B3%E6%96%B9%E5%BC%8F"><span class="toc-number">2.4.</span> <span class="toc-text">3.3.脱壳方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%A3%B3"><span class="toc-number">2.4.1.</span> <span class="toc-text">3.3.1.都有哪些壳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-frida-dexdump"><span class="toc-number">2.4.2.</span> <span class="toc-text">3.3.2.frida-dexdump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E5%8A%A0%E5%9B%BA%E5%AF%B9%E6%8A%97-Frida-%E7%9A%84%E5%B8%B8%E8%A7%81%E6%89%8B%E6%AE%B5"><span class="toc-number">2.4.3.</span> <span class="toc-text">3.3.3.加固对抗 Frida 的常见手段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-so%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-number">2.5.</span> <span class="toc-text">3.4.so文件处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-Smali-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.6.</span> <span class="toc-text">3.5.Smali 基础语法详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E4%B8%8E%E7%B1%BB%E5%AE%9A%E4%B9%89"><span class="toc-number">2.6.1.</span> <span class="toc-text">一、文件结构与类定义</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%B1%BB%E5%A3%B0%E6%98%8E"><span class="toc-number">2.6.1.1.</span> <span class="toc-text">1. 类声明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.6.1.2.</span> <span class="toc-text">2. 接口实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.6.1.3.</span> <span class="toc-text">3. 注解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AD%97%E6%AE%B5%E5%AE%9A%E4%B9%89-Fields"><span class="toc-number">2.6.2.</span> <span class="toc-text">二、字段定义 (Fields)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89-Methods"><span class="toc-number">2.6.3.</span> <span class="toc-text">三、方法定义 (Methods)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%96%B9%E6%B3%95%E5%A3%B0%E6%98%8E"><span class="toc-number">2.6.3.1.</span> <span class="toc-text">1. 方法声明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.6.4.</span> <span class="toc-text">四、数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.6.4.1.</span> <span class="toc-text">1. 基本类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.6.4.2.</span> <span class="toc-text">2. 对象类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.6.4.3.</span> <span class="toc-text">3. 数组类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%AF%84%E5%AD%98%E5%99%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">2.6.5.</span> <span class="toc-text">五、寄存器操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AF%84%E5%AD%98%E5%99%A8%E5%91%BD%E5%90%8D"><span class="toc-number">2.6.5.1.</span> <span class="toc-text">1. 寄存器命名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">2.6.5.2.</span> <span class="toc-text">2. 常用指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-number">2.6.6.</span> <span class="toc-text">六、方法调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%B0%83%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.6.6.1.</span> <span class="toc-text">1. 调用类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%96%B9%E6%B3%95%E7%AD%BE%E5%90%8D%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.6.6.2.</span> <span class="toc-text">2. 方法签名格式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%8E%A7%E5%88%B6%E6%B5%81%E6%8C%87%E4%BB%A4"><span class="toc-number">2.6.7.</span> <span class="toc-text">七、控制流指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF"><span class="toc-number">2.6.7.1.</span> <span class="toc-text">1. 条件分支</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%97%A0%E6%9D%A1%E4%BB%B6%E8%B7%B3%E8%BD%AC"><span class="toc-number">2.6.7.2.</span> <span class="toc-text">2. 无条件跳转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Switch-%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.6.7.3.</span> <span class="toc-text">3. Switch 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%A0%87%E7%AD%BE%E5%AE%9A%E4%B9%89"><span class="toc-number">2.6.7.4.</span> <span class="toc-text">4. 标签定义</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.6.8.</span> <span class="toc-text">八、异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7"><span class="toc-number">2.6.8.1.</span> <span class="toc-text">1. 异常捕获</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8"><span class="toc-number">2.6.8.2.</span> <span class="toc-text">2. 抛出异常</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF"><span class="toc-number">2.6.9.</span> <span class="toc-text">九、调试信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E5%AE%8C%E6%95%B4%E6%96%B9%E6%B3%95%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.6.10.</span> <span class="toc-text">十、完整方法示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.6.11.</span> <span class="toc-text">学习建议</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/16167/" title="提示词注入攻击(Prompt Injecting)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/AI%20Infra%20feature%20image-1.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="提示词注入攻击(Prompt Injecting)"/></a><div class="content"><a class="title" href="/posts/16167/" title="提示词注入攻击(Prompt Injecting)">提示词注入攻击(Prompt Injecting)</a><time datetime="2025-06-22T16:00:00.000Z" title="发表于 2025-06-23 00:00:00">2025-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/44081/" title="安卓逆向技术"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/5c4406f679dc69b549b48fa6_p17s2tfgc31jte13d51pea1l2oblr3.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="安卓逆向技术"/></a><div class="content"><a class="title" href="/posts/44081/" title="安卓逆向技术">安卓逆向技术</a><time datetime="2025-06-22T16:00:00.000Z" title="发表于 2025-06-23 00:00:00">2025-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/18965/" title="Android-JAVA开发基础"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/5c4406f679dc69b549b48fa6_p17s2tfgc31jte13d51pea1l2oblr3.png?x-oss-process=style/img-to-webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android-JAVA开发基础"/></a><div class="content"><a class="title" href="/posts/18965/" title="Android-JAVA开发基础">Android-JAVA开发基础</a><time datetime="2025-06-15T16:00:00.000Z" title="发表于 2025-06-16 00:00:00">2025-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/60615/" title="JAVA内存马"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/java_logo_icon_168609.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JAVA内存马"/></a><div class="content"><a class="title" href="/posts/60615/" title="JAVA内存马">JAVA内存马</a><time datetime="2025-06-09T16:00:00.000Z" title="发表于 2025-06-10 00:00:00">2025-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/32372/" title="内网穿透技术"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="内网穿透技术"/></a><div class="content"><a class="title" href="/posts/32372/" title="内网穿透技术">内网穿透技术</a><time datetime="2025-05-23T16:00:00.000Z" title="发表于 2025-05-24 00:00:00">2025-05-24</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/184064234.png" alt="网络安全行业初级从业者！~" title="网络安全行业初级从业者！~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2022 - 2025 By <a class="footer-bar-link" href="/" title="Takake" target="_blank">Takake</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com" title="GITHUB">GITHUB</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://chat.opengpt.lol" title="CHATGPT">CHATGPT</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">91</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">166</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">12</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.takake.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https:/api.opengpt.lol/" title="GPT-API"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="GPT-API"/><span class="back-menu-item-text">GPT-API</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 站点动态</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI%E8%AF%AD%E8%A8%80%E5%A4%A7%E6%A8%A1%E5%9E%8B/" style="font-size: 0.88rem;">AI语言大模型<sup>1</sup></a><a href="/tags/APK/" style="font-size: 0.88rem;">APK<sup>2</sup></a><a href="/tags/Android/" style="font-size: 0.88rem;">Android<sup>1</sup></a><a href="/tags/CVE/" style="font-size: 0.88rem;">CVE<sup>5</sup></a><a href="/tags/Chrome/" style="font-size: 0.88rem;">Chrome<sup>2</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>2</sup></a><a href="/tags/IPV6/" style="font-size: 0.88rem;">IPV6<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 0.88rem;">JAVA<sup>6</sup></a><a href="/tags/JS%E9%80%86%E5%90%91/" style="font-size: 0.88rem;">JS逆向<sup>2</sup></a><a href="/tags/NAS/" style="font-size: 0.88rem;">NAS<sup>3</sup></a><a href="/tags/PHP/" style="font-size: 0.88rem;">PHP<sup>2</sup></a><a href="/tags/RCE/" style="font-size: 0.88rem;">RCE<sup>19</sup></a><a href="/tags/TLS/" style="font-size: 0.88rem;">TLS<sup>1</sup></a><a href="/tags/cisp/" style="font-size: 0.88rem;">cisp<sup>2</sup></a><a href="/tags/draft/" style="font-size: 0.88rem;">draft<sup>5</sup></a><a href="/tags/esxi/" style="font-size: 0.88rem;">esxi<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 0.88rem;">hexo<sup>1</sup></a><a href="/tags/html/" style="font-size: 0.88rem;">html<sup>1</sup></a><a href="/tags/javascript/" style="font-size: 0.88rem;">javascript<sup>1</sup></a><a href="/tags/nas/" style="font-size: 0.88rem;">nas<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">中间件<sup>15</sup></a><a href="/tags/%E4%BA%91%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">云存储<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">云安全<sup>2</sup></a><a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 0.88rem;">人工智能<sup>2</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 0.88rem;">代码审计<sup>16</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">博客<sup>1</sup></a><a href="/tags/%E5%AE%9E%E9%AA%8C/" style="font-size: 0.88rem;">实验<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81/" style="font-size: 0.88rem;">密码<sup>8</sup></a><a href="/tags/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/" style="font-size: 0.88rem;">权限提升<sup>2</sup></a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">渗透测试<sup>22</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 0.88rem;">漏洞复现<sup>22</sup></a><a href="/tags/%E7%A1%AC%E7%9B%98/" style="font-size: 0.88rem;">硬盘<sup>1</sup></a><a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 0.88rem;">私有云<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 0.88rem;">网络协议<sup>2</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">网络安全<sup>10</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" style="font-size: 0.88rem;">网络配置<sup>1</sup></a><a href="/tags/%E8%AF%81%E4%B9%A6/" style="font-size: 0.88rem;">证书<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">软件开发<sup>1</sup></a><a href="/tags/%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87/" style="font-size: 0.88rem;">限制绕过<sup>1</sup></a><a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 0.88rem;">靶场<sup>3</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8923547078" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=8923547078&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://hongkong-img.oss-cn-hongkong.aliyuncs.com/cdn/lib/js/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/01/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎来到My Blog!`,
    `生活明朗, 万物可爱`,
    `
    ████████╗ █████╗ ██╗  ██╗ █████╗ ██╗  ██╗███████╗
    ╚══██╔══╝██╔══██╗██║ ██╔╝██╔══██╗██║ ██╔╝██╔════╝
       ██║   ███████║█████╔╝ ███████║█████╔╝ █████╗  
       ██║   ██╔══██║██╔═██╗ ██╔══██║██╔═██╗ ██╔══╝  
       ██║   ██║  ██║██║  ██╗██║  ██║██║  ██╗███████╗
       ╚═╝   ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝
        `,
    "已上线",
    dnum,
    "天",
    "©2022 By Takake V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【骇客】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Takake 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("12/01/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://hongkong-img.oss-cn-hongkong.aliyuncs.com/blog-web-img/184064228.png";
        img.title = "下班玩人工智能，嘿嘿~";
        img.alt = "下班玩人工智能，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://takake.netlify.app/.netlify/functions/twikoo',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "vister@takake.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script>(() => {
  const isChatBtn = false
  const isChatHideShow = false

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = {
      startHidden: true
    }
  
    window.chatBtnFn = () => {
      const isShow = document.getElementById('chatra').classList.contains('chatra--expanded')
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        Chatra('hide')
      },
      show: () => {
        Chatra('show')
      }
    }
  }

  (function(d, w, c) {
    w.ChatraID = 'MYtmap9meYHQGdDTJ'
    var s = d.createElement('script')
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')

})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>